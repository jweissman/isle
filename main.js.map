{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/util.ts","webpack:///./src/resources.ts","webpack:///./src/world.ts","webpack:///./src/basic_sprites.ts","webpack:///./src/actors/hud.ts","webpack:///./src/actors/brand/logo.ts","webpack:///./src/actors/player/player.ts","webpack:///./src/actors/index.ts","webpack:///./src/actors/thing.ts","webpack:///./src/models.ts","webpack:///./src/game.ts","webpack:///./src/sounds/finemist.mp3","webpack:///./src/images/campfire.png","webpack:///./src/images/palm.png","webpack:///./src/images/greatpalm.png","webpack:///./src/images/miranda-portrait.png","webpack:///./src/images/miranda-sprites.png","webpack:///./src/images/alex-portrait.png","webpack:///./src/images/alex-sprites.png","webpack:///./src/images/basic-sprites.png","webpack:///./src/images/spritemap.png","webpack:///./src/images/brand.png","webpack:///./src/images/alpha.png","webpack:///./src/scenes/level-one/level-one.ts","webpack:///./src/index.ts"],"names":["webpackJsonpCallback","data","moduleId","chunkId","chunkIds","moreModules","executeModules","i","resolves","length","installedChunks","push","Object","prototype","hasOwnProperty","call","modules","parentJsonpFunction","shift","deferredModules","apply","checkDeferredModules","result","deferredModule","fulfilled","j","depId","splice","__webpack_require__","s","installedModules","1","exports","module","l","m","c","d","name","getter","o","defineProperty","configurable","enumerable","get","r","value","n","__esModule","default","object","property","p","jsonpArray","window","webpackJsonp","oldJsonpFunction","bind","slice","ex","coinflip","Math","random","clamp","min","max","val","clamped","keyToDirection","key","direction","Input","Keys","A","Left","D","Right","S","Down","W","Up","oppositeWay","dir","opp","mode","array","map","Map","maxFreq","item","freq","has","set","addScalarToVec","vec","step","y","x","dirFromVec","abs","angleFromDir","e","t","excalibur_tiled_1","alpha","brand","spritemap","basicSprites","alex","alexPortrait","miranda","mirandaPortrait","greatPalm","palm","campfire","fineMist","Resources","Brand","Texture","Alphabet","Alex","AlexPortrait","Miranda","MirandaPortrait","Spritemap","BasicSprites","GreatPalm","Palm","Campfire","FineMist","Sound","imagePathAccessor","path","tileset","replace","models_1","thing_1","resources_1","actors_1","Material","Wood","Stone","World","[object Object]","scene","hud","config","engine","this","island","Isle","itemKinds","playerCharacterMeta","sprites","SpriteSheet","portrait","asSprite","primary","debugBoxes","debugBoundingBoxes","stocks","wood","stone","itemName","crafting","craftingItem","craftingAt","it","_primaryCharacter","equipped","spawn","kind","playerCell","equip","material","count","console","log","destroy","updateInventory","cell","Item","description","activate","Player","currentPc","message","__isle_pc","move","halt","makePrimaryCharacter","equipment","msg","describe","tileMap","getCellByPoint","__isle_item","entity","entityAt","size","Array","keys","getCellByIndex","index","cols","actor","kill","thing","Thing","drawing","addDrawing","constructCollisionArea","collision","theItem","buildItem","items","add","setZIndex","computeZ","pcMeta","pc","wireWorld","camera","strategy","lockToActor","zoom","playing","mapResource","_mapRes","terrainMeta","spriteTerrainById","spriteCollisionById","characterById","itemKindBySpriteId","tilesets","forEach","ts","terrains","terrain","properties","tile","reduce","acc","curr","assign","terrainName","tiles","id","terrainTile","solid","every","some","objectgroup","objects","prop","currMeta","warn","find","getTileMap","spriteId","spriteSheetKey","removeSprite","characterName","createPlayableCharacter","sheet","_spriteSheets","cx","cy","cellToRemove","newSprite","getSprite","BigCampfire","BasicSpriteMap","chestClosed","chestOpen","world_1","basic_sprites_1","inventorySprites","StockLine","yOff","baseFontFamily","label","Label","fontSize","color","Color","White","ctx","sprite","clone","scale","Vector","draw","text","Hud","UIActor","game","super","canvasWidth","canvasHeight","initialize","output","setWidth","textAlign","TextAlign","Center","Azure","inventory","fontFamily","lineItems","delta","activePlayer","baseFont","currentPlayer","playerPortrait","equipmentDrawing","setDrawing","remove","player","setStock","opacity","actions","clearActions","fade","util_1","Logo","strobeClamp","strobe","intensity","ceil","Actor","spriteSheet","world","_world","vel","currentDrawing","facing","speed","walkSprites","collisionArea","body","useCircleCollision","collisionType","CollisionType","Active","recalc","playerSpeed","interacting","usingItem","down","up","right","left","walkFrames","getAnimationByIndices","pos","interactionPos","entityAndCell","entityNear","interact","equipSprite","useItem","getCenter","usingItemTicks","interactUsingEquipped","equipmentPos","littleDrawing","ticks","flipHorizontal","anchor","rotation","equipPos","debugDraw","Chartreuse","fillRect","update","itemSwingTime","player_1","logo_1","zOff","LightGray","Fixed","ellipse","center","width","height","polygon","vecs","usePolygonCollision","useBoxCollision","setHeight","PreventCollision","itemClasses","Chest","state","open","hp","damage","baseCells","offset","base","logKind","WoodLog","collect","WoodLogStack","Handaxe","Machete","Game","Engine","displayMode","DisplayMode","FullScreen","setup","loader","Loader","addResource","logo","logoWidth","playButtonText","start","then","kick","LevelOne","Scene","level_one_1","game_1","hud_1","debugCells","bgMusic","levelOne","input","keyboard","on","evt","currentScene","primaryCharacter","E","interaction","C","enterCraftMode","processTiledMap","addTileMap","goToScene","theme","setTimeout","play","pointers","debit","useEquippedItem"],"mappings":"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","file":"main.js","sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n \t\tvar executeModules = data[2];\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t\t// add entry modules from loaded chunk to deferred list\n \t\tdeferredModules.push.apply(deferredModules, executeModules || []);\n\n \t\t// run deferred modules when all chunks ready\n \t\treturn checkDeferredModules();\n \t};\n \tfunction checkDeferredModules() {\n \t\tvar result;\n \t\tfor(var i = 0; i < deferredModules.length; i++) {\n \t\t\tvar deferredModule = deferredModules[i];\n \t\t\tvar fulfilled = true;\n \t\t\tfor(var j = 1; j < deferredModule.length; j++) {\n \t\t\t\tvar depId = deferredModule[j];\n \t\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n \t\t\t}\n \t\t\tif(fulfilled) {\n \t\t\t\tdeferredModules.splice(i--, 1);\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n \t\t\t}\n \t\t}\n \t\treturn result;\n \t}\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t1: 0\n \t};\n\n \tvar deferredModules = [];\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \tvar jsonpArray = window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// add entry module to deferred list\n \tdeferredModules.push([26,0]);\n \t// run deferred modules when ready\n \treturn checkDeferredModules();\n","import * as ex from 'excalibur';\n\n// tiny probability handler...\nconst coinflip = () => Math.random() > 0.5\n\n// restrain a value between a min and a max\nconst clamp = (min: number, max: number) => (val: number) => {\n  let clamped = Math.min(val, max);\n  clamped = Math.max(clamped, min);\n  return clamped;\n}\n\ntype Direction = 'left' | 'right' | 'up' | 'down';\n\nconst keyToDirection = (key: number): Direction => {\n  let direction : Direction;\n  if (key === ex.Input.Keys.A || key === ex.Input.Keys.Left) {\n    direction = 'left';\n  }\n  if (key === ex.Input.Keys.D || key === ex.Input.Keys.Right) {\n    direction = 'right';\n  }\n  if (key === ex.Input.Keys.S || key === ex.Input.Keys.Down) {\n    direction = 'down';\n  }\n  if (key === ex.Input.Keys.W || key === ex.Input.Keys.Up) {\n    direction = 'up';\n  }\n  return direction;\n}\n\nconst oppositeWay = (dir: Direction): Direction => {\n  let opp: Direction;\n  switch(dir) {\n    case 'left': opp = 'right'; break;\n    case 'right': opp = 'left'; break;\n    case 'up': opp = 'down'; break;\n    case 'down': opp = 'up'; break;\n  }\n  return opp;\n}\n\n// suggested impl from https://codereview.stackexchange.com/a/169667\nconst mode = (array) => {\n  const map = new Map(); // new Map();\n\n  let maxFreq = 0;\n  let mode;\n\n  for(const item of array) {\n    let freq = map.has(item) ? map.get(item) : 0;\n    freq++;\n\n    if(freq > maxFreq) {\n      maxFreq = freq;\n      mode = item;\n    }\n    \n    map.set(item, freq);\n  }\n\n  return mode;\n};\n\nconst addScalarToVec = (vec: ex.Vector, direction: Direction, step: number) => {\n  switch (direction) {\n    case 'up':\n      vec.y -= step;\n      break;\n    case 'down':\n      vec.y += step;\n      break;\n    case 'left':\n      vec.x -= step;\n      break;\n    case 'right':\n      vec.x += step;\n      break;\n  }\n}\n\nconst dirFromVec = (vec: ex.Vector): Direction => {\n  let {x,y} = vec;\n  if (Math.abs(x) > Math.abs(y)) {\n    return x > 0 ? 'right' : 'left';\n  } else {\n    return y > 0 ? 'down' : 'up';\n  }\n}\n\nconst angleFromDir = (dir: Direction): number => {\n   switch (dir) {\n    case 'up':\n      return 90;\n    case 'down':\n      return 270;\n    case 'left':\n      return 180;\n    case 'right':\n      return 0;\n  }\n \n}\n\nexport {\n  clamp,\n  Direction,\n  keyToDirection,\n  addScalarToVec,\n  dirFromVec,\n  oppositeWay,\n  mode,\n  coinflip,\n  angleFromDir\n};\n","import * as ex from 'excalibur';\r\nimport TiledResource from '@excaliburjs/excalibur-tiled';\r\n\r\nconst alpha = require('./images/alpha.png')\r\nconst brand = require('./images/brand.png')\r\n// const sword = require('./images/sword.png');\r\nconst spritemap = require('./images/spritemap.png')\r\nconst basicSprites = require('./images/basic-sprites.png')\r\n\r\nconst alex = require('./images/alex-sprites.png')\r\nconst alexPortrait = require('./images/alex-portrait.png')\r\n\r\nconst miranda = require('./images/miranda-sprites.png')\r\nconst mirandaPortrait = require('./images/miranda-portrait.png')\r\n\r\nconst greatPalm = require('./images/greatpalm.png')\r\nconst palm = require('./images/palm.png')\r\nconst campfire = require('./images/campfire.png')\r\n\r\nconst fineMist = require('./sounds/finemist.mp3')\r\n// const science = require('./sounds/science.mp3')\r\n\r\nlet mapName = 'solidity';\r\n\r\nlet Resources = {\r\n    // app logo\r\n    Brand: new ex.Texture(brand),\r\n\r\n    // spritefont\r\n    Alphabet: new ex.Texture(alpha),\r\n\r\n    // images\r\n    Alex: new ex.Texture(alex),\r\n    AlexPortrait: new ex.Texture(alexPortrait),\r\n    Miranda: new ex.Texture(miranda),\r\n    MirandaPortrait: new ex.Texture(mirandaPortrait),\r\n\r\n    //Sword: new ex.Texture(sword),\r\n    Spritemap: new ex.Texture(spritemap), // SpriteSheet(spritemap)\r\n    BasicSprites: new ex.Texture(basicSprites),\r\n    Map: new TiledResource(`map/${mapName}.json`),\r\n    GreatPalm: new ex.Texture(greatPalm),\r\n    Palm: new ex.Texture(palm),\r\n    Campfire: new ex.Texture(campfire),\r\n\r\n    // music\r\n    FineMist: new ex.Sound(fineMist),\r\n    // Science: new ex.Sound(science)\r\n}\r\n\r\nResources.Map.imagePathAccessor = (path, tileset) => {\r\n    let actualPath = path.replace(/^(?:\\.\\.\\/)+/, \"\");\r\n    // console.log(\"LOAD IMG\", { path, actualPath });\r\n    return actualPath;\r\n    // return \"/assets/\" + path;\r\n}\r\n\r\nexport { Resources }\r\n","import * as ex from 'excalibur';\r\nimport { TiledResource } from '@excaliburjs/excalibur-tiled';\r\nimport { Isle, Item, ItemKind, buildItem } from './models';\r\nimport { Thing } from './actors/thing';\r\nimport { Resources } from './resources';\r\nimport { Player } from './actors';\r\nimport { GameConfig } from './game_config';\r\nimport { Hud } from './actors/hud';\r\n\r\ntype Entity = Item | Player\r\n\r\n// maybe goes in models??\r\nexport enum Material {\r\n    Wood = 'wood',\r\n    Stone = 'stone',\r\n}\r\n\r\ntype Stocks = { [key in Material]: number }\r\n\r\nclass World {\r\n    island: Isle\r\n    tileMap: ex.TileMap\r\n    itemKinds: { [key: string]: ItemKind }\r\n    playerCharacterMeta: { [name: string]: {\r\n        sprites: ex.SpriteSheet,\r\n        portrait: ex.Sprite,\r\n        primary: boolean\r\n    }}\r\n    debugBoxes: boolean\r\n\r\n    // craft state...\r\n    crafting: boolean\r\n    craftingItem: string\r\n    craftingAt: { x: number, y: number }\r\n\r\n    stocks: Stocks\r\n\r\n    constructor(\r\n        public scene: ex.Scene,\r\n        public hud: Hud,\r\n        public config: GameConfig,\r\n        protected engine: ex.Engine\r\n    ) {\r\n        this.island = new Isle('sorna');\r\n        this.itemKinds = {};\r\n        this.playerCharacterMeta = {\r\n            Alex: {\r\n                sprites: new ex.SpriteSheet(Resources.Alex, 4, 7, 32, 64),\r\n                portrait: Resources.AlexPortrait.asSprite(),\r\n                primary: true\r\n            },\r\n            Miranda: {\r\n                sprites: new ex.SpriteSheet(Resources.Miranda, 4, 7, 32, 64),\r\n                portrait: Resources.MirandaPortrait.asSprite(),\r\n                //portrait: Resources.AlexPortrait.asSprite,\r\n                primary: false\r\n            }\r\n        }\r\n        this.debugBoxes = config.debugBoundingBoxes;\r\n\r\n        this.stocks = {\r\n            wood: 0,\r\n            stone: 0,\r\n        }\r\n    }\r\n\r\n    enterCraftMode(itemName: string, x: number, y: number) {\r\n        this.crafting = true;\r\n        this.craftingItem = itemName;\r\n        this.craftingAt = { x, y };\r\n    }\r\n\r\n    equip(it: Item) {\r\n        if (this._primaryCharacter.equipped) {\r\n            // drop current item\r\n            this.spawn(this._primaryCharacter.equipped.kind, this.playerCell())\r\n        }\r\n        this._primaryCharacter.equip(it);\r\n        this.hud.equip(it);\r\n    }\r\n\r\n    collect(it: Item, material: Material, count: number = 1) {\r\n      console.log(\"WOULD COLLECT ITEM\", { it, material, count });\r\n      this.destroy(it);\r\n      this.stocks[material] += count;\r\n      this.hud.updateInventory(this.stocks);\r\n      console.log(\"AFTER COLLECT ITEM\", { it, material, count, stocks: this.stocks });\r\n    }\r\n\r\n    debit(material: Material, count: number = 1) {\r\n        this.stocks[material] -= count;\r\n        this.hud.updateInventory(this.stocks);\r\n    }\r\n\r\n    // need to remove it from the cell...?\r\n    //\r\n\r\n    interact(it: Entity, cell: ex.Cell): string {\r\n        if (it instanceof Item) {\r\n            // console.log(\"WOULD INTERACT WITH ITEM\", { it });\r\n            let { name, description } = it.kind;\r\n            return it.activate() || description;\r\n        } else if (it instanceof Player) {\r\n            // console.log(\"WOULD SWAP PLAYER CHARACTER!!!\", {it});\r\n            let currentPc = this._primaryCharacter;\r\n            let message = `nice to see you again, ${currentPc.name}`;\r\n            cell['__isle_pc'] = currentPc;\r\n            currentPc.x = cell.x\r\n            currentPc.y = cell.y //+16 //-48\r\n            currentPc.move('down');\r\n            currentPc.halt();\r\n            //cell.removeSprite(cell.sprites[1]);\r\n            // todo remove new pc from cell, add old pc TO that cell...\r\n            this.makePrimaryCharacter(it);\r\n            // this.hud.equip(it.equipped);\r\n            return message;\r\n        }\r\n    }\r\n\r\n    useItem(it: Entity, cell: ex.Cell, equipment: Item): string {\r\n        if (it instanceof Item) {\r\n            let msg = it.activate(equipment) || `use ${equipment.kind.name} on ${it.kind.name} `;\r\n            this.hud.describe(msg);\r\n            return msg;\r\n\r\n        }\r\n    }\r\n\r\n    entityAt(x: number, y: number): { entity: Entity, cell: ex.Cell } {\r\n        let cell = this.tileMap.getCellByPoint(x, y);\r\n        // console.log(\"looking for entity at \", { x, y, cell });\r\n        if (cell) {\r\n            if (cell['__isle_item']) {\r\n                let it: Item = cell['__isle_item'];\r\n                return { entity: it, cell };\r\n            } else if (cell['__isle_pc']) {\r\n                let pc: Player = cell['__isle_pc'];\r\n                return { entity: pc, cell };\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n\r\n    entityNear(x: number, y: number): { entity: Entity, cell: ex.Cell} {\r\n        return this.entityAt(x, y) ||\r\n            this.entityAt(x, y + 10) ||\r\n            this.entityAt(x, y - 10) ||\r\n            this.entityAt(x - 10, y) ||\r\n            this.entityAt(x + 10, y)\r\n    }\r\n\r\n    destroy(it: Item) {\r\n        console.log(\"DESTROY\", { it });\r\n        let { kind, cell } = it;\r\n        let { size } = kind;\r\n        for (const x of Array(size).keys()) {\r\n            for (const y of Array(size).keys()) {\r\n                let cellToMark = this.tileMap.getCellByIndex(cell.index + x + (y * this.tileMap.cols));\r\n                // remove item from list...\r\n                cellToMark['__isle_item'] = null;\r\n            }\r\n        }\r\n\r\n        it.actor.kill();\r\n\r\n        return true;\r\n    }\r\n\r\n    spawn(kind: ItemKind, cell: ex.Cell): Thing {\r\n        let { size } = kind;\r\n        size = size || 1;\r\n\r\n        let x = cell.x + 16 * size;\r\n        let y = cell.y + 16 * size;\r\n        let thing: Thing = new Thing(x, y, size, size, this.debugBoxes);\r\n\r\n        if (kind.drawing) {\r\n          thing.addDrawing(kind.drawing);\r\n        }\r\n\r\n        thing.constructCollisionArea(kind.collision);\r\n\r\n        let theItem: Item = buildItem(kind, thing, cell, this);\r\n        this.island.items.push(theItem);\r\n        for (const x of Array(size).keys()) {\r\n            for (const y of Array(size).keys()) {\r\n                let cellToMark = this.tileMap.getCellByIndex(cell.index + x + (y * this.tileMap.cols));\r\n                cellToMark['__isle_item'] = theItem;\r\n            }\r\n        }\r\n\r\n        this.scene.add(thing);\r\n        thing.setZIndex(thing.computeZ());\r\n        // console.log(`SPAWN ${kind.name}`, { kind, thing });\r\n        return thing;\r\n    }\r\n\r\n    _primaryCharacter: Player\r\n    createPlayableCharacter(name: string, cell: ex.Cell) { // x: number, y: number) {\r\n        let pcMeta = this.playerCharacterMeta[name];\r\n        if (pcMeta) {\r\n            let { x, y } = cell;\r\n            console.log(\"CREATE PC\", { pcMeta });\r\n            const pc = new Player(\r\n                name,\r\n                x, y,\r\n                this.config,\r\n                pcMeta.sprites,\r\n                pcMeta.portrait,\r\n                this.engine\r\n            );\r\n            pc.wireWorld(this);\r\n            this.scene.add(pc);\r\n            if (pcMeta.primary) {\r\n                this.makePrimaryCharacter(pc);\r\n            } else {\r\n                console.log(\"PC is not primary\", { pcMeta });\r\n                cell['__isle_pc'] = pc;\r\n            }\r\n        }\r\n    }\r\n\r\n    makePrimaryCharacter(pc: Player) {\r\n        console.log(\"CREATE PRIMARY PC!!!\", { pc });\r\n        this._primaryCharacter = pc;\r\n        pc.move('down');\r\n        pc.halt();\r\n        //pc.facing = 'down';\r\n        // fix cam!\r\n        this.scene.camera.strategy.lockToActor(pc);\r\n        this.scene.camera.zoom(this.config.zoom);\r\n\r\n        // tell hud\r\n        this.hud.playing(pc);\r\n    }\r\n\r\n    primaryCharacter() {\r\n        return this._primaryCharacter;\r\n    }\r\n\r\n    playerCell() {\r\n        return this.tileMap.getCellByPoint(\r\n            this._primaryCharacter.x,\r\n            this._primaryCharacter.y\r\n        )\r\n    }\r\n\r\n    processTiledMap(mapResource: TiledResource) {\r\n        let _mapRes: TiledResource = mapResource; // Resources.Map;\r\n        let terrainMeta = {};\r\n        let spriteTerrainById = {};\r\n        let spriteCollisionById = {};\r\n\r\n        let characterById = {};\r\n\r\n        let itemKindBySpriteId: { [spriteId: number]: ItemKind } = {};\r\n\r\n        _mapRes.data.tilesets.forEach((ts) => {\r\n            //console.log(\"TILESET\", { ts });\r\n            if (ts.terrains) {\r\n                ts.terrains.forEach(terrain => {\r\n                    if (terrain.properties) {\r\n                        terrainMeta[terrain.tile] = terrain.properties.reduce((acc, curr) => {\r\n                            let { name, value } = curr;\r\n                            return (<any>Object).assign(acc, { [name]: value })\r\n                        }, {});\r\n\r\n                        terrainMeta[terrain.tile].terrainName = terrain.name;\r\n\r\n                        console.log(\r\n                            `terrain ${terrain.name} (${terrain.tile}) has props: `,\r\n                            terrainMeta[terrain.tile]\r\n                        )\r\n                    }\r\n                });\r\n\r\n                spriteTerrainById = ts.tiles.reduce((acc, curr) => {\r\n                    let { terrain, id } = curr;\r\n                    const solid = terrain.every(tile => terrainMeta[tile] && terrainMeta[tile].solid); // : false);\r\n                    let terrainTile = { solid };\r\n                    // console.log(`terrain set for ${id}`, { solid }, terrain.map(tile => terrainMeta[tile]))\r\n                    return (<any>Object).assign(acc, { [id]: terrainTile });\r\n                }, {});\r\n\r\n                // console.log({ terrainMeta, spriteTerrainById });\r\n            }\r\n\r\n            // console.log({tiles: ts.tiles})\r\n            if (ts.tiles && ts.tiles.some(tile => tile.objectgroup)) {\r\n                // should also grab item/obj metadata here?\r\n                // console.log(\"todo -- extract obj group collision frame?\");\r\n                //debugger;\r\n                spriteCollisionById = ts.tiles.reduce((acc, curr) => {\r\n                    let { objectgroup, id } = curr;\r\n                    if (objectgroup && objectgroup.objects && objectgroup.objects.length) {\r\n                        return (<any>Object).assign(acc, { [id]: objectgroup.objects[0] });\r\n                    } else {\r\n                        return acc;\r\n                    }\r\n                }, {});\r\n\r\n                console.log({ spriteCollisionById });\r\n                console.log({ ts });\r\n\r\n                itemKindBySpriteId = ts.tiles.reduce((acc, curr) => {\r\n                    // debugger;\r\n                    //console.log({ curr });\r\n                    if (curr.properties && !curr.properties.some(prop => prop.name === 'character')) {\r\n                        let currMeta = curr.properties.reduce((acc, curr) => {\r\n                            let { name, value } = curr;\r\n                            return (<any>Object).assign(acc, { [name]: value })\r\n                        }, {});\r\n                        return (<any>Object).assign(acc, { [curr.id]: currMeta });\r\n                    } else {\r\n                        console.warn(\"no props for sprite with id (or maybe char?)\", { curr });\r\n                        // no props for this one?\r\n                        return acc;\r\n                    }\r\n                }, {})\r\n                //console.log({ itemKindBySpriteId })\r\n\r\n                \r\n            }\r\n\r\n            if (ts.tiles && ts.tiles.some(tile => tile.properties && tile.properties.some(prop => prop.name === 'character'))) {\r\n                // console.log('character somewhere!!');\r\n                characterById = ts.tiles.reduce((acc, curr) => {\r\n                    if (curr.properties && curr.properties.some(prop => prop.name === 'character')) {\r\n                        // console.log('char found!', { curr });\r\n                        let charProp = curr.properties.find(prop => prop.name === 'character');\r\n                        let name = charProp.value;\r\n                        return (<any>Object.assign(acc, {\r\n                            [curr.id]: name // charProp.value // curr.properties.character.name\r\n                        }));\r\n                    } else {\r\n                        return acc;\r\n                    }\r\n                }, {});\r\n                console.log({ characterById });\r\n            } else {\r\n                console.warn('no chars in tileset', { tiles: ts.tiles })\r\n            }\r\n        });\r\n\r\n        this.tileMap = _mapRes.getTileMap();\r\n\r\n        // this.blockingActors = [];\r\n\r\n        this.tileMap.data.forEach((cell: ex.Cell, index) => {\r\n\r\n            if (cell.sprites[0]) {\r\n                let tile = spriteTerrainById[cell.sprites[0].spriteId];\r\n                cell = Object.assign(cell, tile);\r\n                // we have another sprite, maybe a thing to build a box for?\r\n                if (cell.sprites[1]) {\r\n                    // we could use the sprite, but... also we could do something else\r\n                    // build our own sprite with z-indexes\r\n                    // better yet: spawn an entity\r\n\r\n                    let { spriteSheetKey, spriteId } = cell.sprites[1];\r\n                    cell.removeSprite(cell.sprites[1]); //hhclearSprites();\r\n                    const kind: ItemKind = itemKindBySpriteId[spriteId];\r\n                    if (!kind) {\r\n                        const characterName: string = characterById[spriteId];\r\n                        if (characterName) {\r\n                            console.log(\"WOULD CREATE PLAYABLE CHARACTER\", {characterName, cell});\r\n                            this.createPlayableCharacter(characterName, cell); // cell.x, cell.y);\r\n                        } else {\r\n                            console.warn(\"CELL has sprite with no kind or character\", { cell, itemKindBySpriteId, characterById });\r\n                        }\r\n                        return;\r\n                    } // hm\r\n                    this.itemKinds[kind.name] = kind;\r\n\r\n                    // we could get the image and attach it to an actor\r\n                    const collision = spriteCollisionById[spriteId]; //cell.sprites[1].spriteId];\r\n                    //cell.removeSprite(cell.sprites[1]);\r\n\r\n                    let sheet: ex.SpriteSheet = (<any>this.tileMap)._spriteSheets[spriteSheetKey];\r\n                    // let xOff = 16, yOff = 16;\r\n                    let size = kind.size || 1;\r\n                    //let cellsToMark = [];\r\n                    if (size > 1) {\r\n                        // xOff = 16 * size; yOff = 16 * size;\r\n                        for (const x of Array(size).keys()) {\r\n                            for (const y of Array(size).keys()) {\r\n                                let cx = x, cy = y;\r\n                                let cellToRemove = this.tileMap.getCellByIndex(index + cx + (cy * this.tileMap.cols));\r\n                                if (cellToRemove.sprites[1]) {\r\n                                    //console.log(\"REMOVE SPRITE FROM\", {x,y,cellToRemove});\r\n                                    cellToRemove.removeSprite(cellToRemove.sprites[1]);\r\n                                    //cellsToMark.push(cellToRemove);\r\n                                } else {\r\n                                    // console.warn(\"NO SPRITE TO REMOVE FROM\", { x, y, size });\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                    // let z: number = (kind && kind.z) || 0;\r\n                    kind.collision = collision;\r\n                    let newSprite: ex.Sprite = sheet.getSprite(spriteId)\r\n                    kind.drawing = newSprite; \r\n\r\n                    // let thing: Thing = \r\n                    this.spawn(kind, cell);\r\n                }\r\n            }\r\n        });\r\n\r\n        // console.log({ itemKinds: this.itemKinds });\r\n    }\r\n\r\n}\r\n\r\nexport { World };","import * as ex from 'excalibur';\r\nimport { Resources } from './resources';\r\n\r\nconst basicSprites = new ex.SpriteSheet(Resources.BasicSprites, 8, 8, 32, 32);\r\nconst greatPalm = Resources.GreatPalm.asSprite();\r\nconst palm = Resources.Palm.asSprite();\r\n\r\nconst BigCampfire = Resources.Campfire.asSprite();\r\n\r\n//new ex.Sprite(Resources.GreatPalm.once)\r\nexport const BasicSpriteMap = {\r\n    chestClosed: basicSprites.getSprite(2),\r\n    chestOpen: basicSprites.getSprite(3),\r\n    greatPalm,\r\n    palm,\r\n\r\n    // also used for crafting, so needs to be capitalized/match item name\r\n    BigCampfire,\r\n\r\n    // materials...\r\n    wood: basicSprites.getSprite(9),\r\n    stone: basicSprites.getSprite(15),\r\n};","import * as ex from 'excalibur';\r\nimport { Game } from '../game';\r\nimport { Material } from '../world';\r\nimport { Resources } from '../resources';\r\nimport { BasicSpriteMap } from '../basic_sprites';\r\nimport { Item } from '../models';\r\nimport { Player } from '.';\r\nimport { UIActor, Actor } from 'excalibur';\r\n\r\n//class Inventory extends ex.UIActor {\r\n//    // backpack:\r\n//}\r\n// inv is complex, like it's own actor/obj tree? \r\nconst inventorySprites: { [key in Material]: ex.Sprite } = {\r\n    [Material.Wood]: BasicSpriteMap.wood,\r\n    [Material.Stone]: BasicSpriteMap.stone\r\n}\r\n\r\nclass StockLine { // extends ex.UIActor {\r\n    // spriteFont: ex.SpriteFont\r\n    label: ex.Label\r\n    constructor(\r\n        public material: Material,\r\n        public count: number,\r\n        public yOff: number,\r\n        public baseFontFamily: string,\r\n        // public spriteFont: ex.SpriteFont\r\n        ) {\r\n        //super(0, yOff * 30, 200, 20)\r\n        \r\n\r\n        this.label = new ex.Label(`${material} x ${count}`, 0, 0, baseFontFamily); // 'Helvetica', this.spriteFont)\r\n        this.label.fontSize = 12\r\n        this.label.color = ex.Color.White\r\n        //this.add(this.label)\r\n    }\r\n\r\n    draw(ctx, x: number, y: number) { // delta) {\r\n        //super.draw(ctx, delta);\r\n        let sprite = inventorySprites[this.material].clone();\r\n        sprite.scale = new ex.Vector(0.5, 0.5)\r\n        sprite.draw(ctx, x, y); // - 16, y - 16)\r\n\r\n        this.label.text = `${this.material} x ${this.count}`;\r\n        this.label.x = x + 24;\r\n        this.label.y = y + 16;\r\n        this.label.draw(ctx, 0);\r\n    }\r\n}\r\n\r\nclass Inventory extends ex.UIActor {\r\n    lineItems: { [key in Material]: StockLine }\r\n\r\n    constructor(\r\n        public x: number,\r\n        public y: number,\r\n        public fontFamily: string,\r\n        // public spriteFont: ex.SpriteFont\r\n    ) {\r\n        super(x,y,100,300);\r\n\r\n        this.lineItems = {\r\n            [Material.Wood]: new StockLine(Material.Wood, 0, 0, fontFamily), //, spriteFont),\r\n            [Material.Stone]: new StockLine(Material.Stone, 0, 1, fontFamily) //, spriteFont)\r\n        }\r\n\r\n        //Object.keys(this.lineItems).forEach(material => this.add(this.lineItems[material]));\r\n    }\r\n\r\n    setStock(stocks: {[key: string]: number}) {\r\n        Object.keys(stocks).forEach((material: Material) => {\r\n            this.lineItems[material].count = stocks[material]\r\n        });\r\n\r\n        // console.log(\"AFTER SET STOCKS\", { items: this.lineItems });\r\n    }\r\n\r\n    draw(ctx, delta) {\r\n        super.draw(ctx, delta);\r\n        Object.keys(this.lineItems).forEach(\r\n            (material: Material, index: number) =>\r\n                this.lineItems[material].draw(ctx, this.x, this.y + index * 32)\r\n        );\r\n    }\r\n}\r\n\r\nclass ActivePlayer extends ex.UIActor {\r\n    currentPlayer: ex.Label\r\n    equipped: ex.Label\r\n    playerPortrait: ex.UIActor\r\n    equipmentDrawing: ex.UIActor\r\n\r\n    constructor(public x: number, public y: number, public baseFont: string) {\r\n        super(x,y); //,64,48)\r\n\r\n        //this.add(//new Actor()\r\n\r\n        this.currentPlayer = new ex.Label('???', 0, 10, baseFont);\r\n        this.currentPlayer.color = ex.Color.White;\r\n        this.currentPlayer.fontSize = 16\r\n        //this.currentPlayer.addDrawing(player.)\r\n        this.add(this.currentPlayer)\r\n\r\n        this.equipped = new ex.Label('Equipped: NONE', 0, 124, baseFont) //, this.spriteFont);\r\n        this.equipped.color = ex.Color.White;\r\n        this.equipped.fontSize = 16\r\n        this.add(this.equipped);\r\n\r\n        this.playerPortrait = new ex.UIActor(0,10); //x,y,48,48);\r\n        this.playerPortrait.scale = new ex.Vector(2,2);\r\n        this.add(this.playerPortrait);\r\n\r\n        this.equipmentDrawing = new ex.UIActor(0,124);\r\n        this.equipmentDrawing.scale = new ex.Vector(2,2)\r\n        this.add(this.equipmentDrawing);\r\n    }\r\n\r\n    equip(item: Item) {\r\n        if (item && item.kind) {\r\n            this.equipped.text = `${item.kind.name}`;\r\n            if (item.kind.drawing) {\r\n                this.equipmentDrawing.addDrawing(item.kind.name, item.kind.drawing);\r\n                this.equipmentDrawing.setDrawing(item.kind.name)\r\n                this.add(this.equipmentDrawing);\r\n            }\r\n        } else {\r\n            this.equipped.text = \"(no equipment)\" // `Equipped. None`;\r\n            this.remove(this.equipmentDrawing);\r\n            //this.equipmentDrawing.opacity = 0; //.setDrawing(null);\r\n        }\r\n    }\r\n\r\n    playing(player: Player) {\r\n        this.currentPlayer.text = `Playing: ${player.name}`\r\n        if (player.equipped) {\r\n            this.equip(player.equipped)\r\n        } else {\r\n            this.equip(null);\r\n        }\r\n        this.playerPortrait.addDrawing(player.name, player.portrait);\r\n        this.playerPortrait.setDrawing(player.name);\r\n        //this.currentPlayer.pos = new ex.Vector(200,200)\r\n    }\r\n}\r\n\r\n\r\nclass Hud extends ex.UIActor {\r\n    output: ex.Label\r\n    activePlayer: ActivePlayer\r\n    //currentPlayer: ex.Label\r\n    //equipped: ex.Label\r\n\r\n    inventory: Inventory //ex.UIActor\r\n    //spriteFont: ex.SpriteFont\r\n\r\n    constructor(game: Game) {\r\n        super(0, 0, game.canvasWidth, game.canvasHeight);\r\n        this.initialize(game);\r\n    }\r\n\r\n    initialize(game: Game) {\r\n        const baseFont = 'Helvetica';\r\n\r\n        this.output = new ex.Label(\r\n            '(press E to interact)',\r\n            game.canvasWidth / 2,\r\n            game.canvasHeight - 40,\r\n            baseFont,\r\n        );\r\n        this.output.color = ex.Color.White;\r\n        this.output.fontSize = 48\r\n        this.output.setWidth(game.canvasWidth);\r\n        this.output.textAlign = ex.TextAlign.Center;\r\n\r\n        const brand = new ex.Label('ISLE', 20, 60, baseFont)\r\n        brand.color = ex.Color.Azure;\r\n        brand.fontSize = 24\r\n\r\n        this.inventory = new Inventory(game.canvasWidth - 300, 50, baseFont) //, this.spriteFont) // .text = 'a bunch of stuff';\r\n\r\n        this.add(this.output);\r\n        this.add(brand);\r\n        this.add(this.inventory);\r\n\r\n        this.updateInventory({\r\n            [Material.Wood]: 0,\r\n            [Material.Stone]: 0\r\n        })\r\n\r\n        this.activePlayer = new ActivePlayer(20,70,baseFont);\r\n        this.add(this.activePlayer);\r\n        //this.currentPlayer = new ex.Label('Current Player. ???', 10, 80, baseFont);\r\n        ////this.currentPlayer.addDrawing(player.)\r\n        //this.add(this.currentPlayer)\r\n\r\n        //this.equipped = new ex.Label('Equipped. NONE', 10, 80, baseFont) //, this.spriteFont);\r\n        //this.add(this.equipped);\r\n    }\r\n\r\n    updateInventory(stocks: {[key: string]: number}) {\r\n        // console.log(\"UPDATE INV\", { stocks });\r\n        this.inventory.setStock(stocks);\r\n    }\r\n\r\n    describe(description) {\r\n      this.output.text = description;\r\n      this.output.opacity = 1;\r\n      this.output.actions.clearActions();\r\n      this.output.actions.fade(0, 4000);\r\n    }\r\n\r\n    equip(item: Item) {\r\n        this.activePlayer.equip(item);\r\n    }\r\n\r\n    playing(player: Player) {\r\n        this.activePlayer.playing(player);\r\n    }\r\n}\r\n\r\n\r\nexport { Hud };","import * as ex from 'excalibur';\nimport { clamp } from '../../util';\n\nexport class Logo extends ex.Label {\n  intensity: number;\n  constructor(x: number, y: number, message: string) {\n    super(message);\n    //this.setWidth(200);\n    this.x = x; // (game.drawWidth / 2) - 200;\n    this.y = y; // 400;\n\n    this.fontFamily = 'Arial';\n    this.fontSize = 256;\n\n    this.color = new ex.Color(255,255,255);\n    this.intensity = 150;\n    this.strobe();\n  }\n\n  strobeClamp = clamp(50, 200);\n\n  strobe = () => {\n    this.intensity = this.intensity + Math.ceil(Math.random()*16) - 8;\n    this.intensity = this.strobeClamp(this.intensity);\n    // console.log(\"strobe\", { intensity: this.intensity });\n\n    this.opacity = this.intensity / 255;\n  }\n}\n","import * as ex from 'excalibur';\r\nimport { Game } from '../../game';\r\nimport { Direction, oppositeWay, addScalarToVec, dirFromVec, angleFromDir } from '../../util';\r\nimport { Vector, Effects } from 'excalibur';\r\nimport { World } from '../../world';\r\nimport { GameConfig } from '../../game_config';\r\nimport { Item } from '../../models';\r\n\r\nexport class Player extends ex.Actor {\r\n  interacting: boolean // is querying world?\r\n  usingItem: boolean   // currently using equipped item?\r\n  usingItemTicks: number\r\n\r\n  equipped: Item\r\n\r\n  speed: number\r\n  facing: Direction\r\n  _world: World\r\n  sprites: { [key: string]: ex.Sprite }\r\n  walkSprites: { [key: string]: ex.Animation }\r\n  equipSprite: ex.Sprite\r\n\r\n  constructor(\r\n    public name: string,\r\n    public x: number,\r\n    public y: number,\r\n    protected config: GameConfig,\r\n    protected spriteSheet: ex.SpriteSheet,\r\n    public portrait: ex.Sprite,\r\n    engine: ex.Engine,\r\n  ) {\r\n    super(x, y, 32, 64);\r\n\r\n    this.collisionArea.body.useCircleCollision(6, new ex.Vector(0, 22));\r\n    this.color = new ex.Color(255, 255, 255);\r\n\r\n    this.collisionType = ex.CollisionType.Active;\r\n    this.collisionArea.recalc();\r\n    this.speed = config.playerSpeed;\r\n    this.interacting = false;\r\n    this.usingItem = false;\r\n\r\n    this.sprites = {\r\n      'down':  spriteSheet.getSprite(0),\r\n      'up':    spriteSheet.getSprite(1),\r\n      'right': spriteSheet.getSprite(2),\r\n      'left':  spriteSheet.getSprite(3),\r\n    }\r\n\r\n    let walkFrames = [1,2,3,4,5,6].map(x => x * 4)\r\n    let animRate = 125; // 100; // 50; //25;\r\n    this.walkSprites = {\r\n      'down': spriteSheet.getAnimationByIndices(\r\n        engine,\r\n        walkFrames, // [4, 8, 12, 16, 20, 24], // 1, 2, 3, 4],\r\n        animRate\r\n      ),\r\n      'up': spriteSheet.getAnimationByIndices(\r\n        engine,\r\n        walkFrames.map(x => x+1),\r\n        animRate\r\n      ),\r\n      'right': spriteSheet.getAnimationByIndices(\r\n        engine,\r\n        walkFrames.map(x => x+2),\r\n        animRate\r\n      ),\r\n      'left': spriteSheet.getAnimationByIndices(\r\n        engine,\r\n        walkFrames.map(x => x+3),\r\n        animRate\r\n      )\r\n    }\r\n\r\n    // set facing + init sprite\r\n    this.move('down');\r\n    this.halt();\r\n  }\r\n\r\n  wireWorld = (world: World) => { this._world = world; }\r\n\r\n  interact() {\r\n    let pos = this.interactionPos();\r\n    this.interacting = true;\r\n    let entityAndCell = this._world.entityNear(pos.x, pos.y)\r\n\r\n    if (entityAndCell) {\r\n      let { entity, cell } = entityAndCell;\r\n      return this._world.interact(entity, cell);\r\n    }\r\n  }\r\n\r\n  equip(it: Item) {\r\n    this.equipped = it;\r\n    this.equipSprite = it.kind.drawing.clone()\r\n    this.equipSprite.scale = new ex.Vector(1.25, 1.25)\r\n    //this.equipSprite.anchor = new ex.Vector(0,1);\r\n  }\r\n\r\n  interactUsingEquipped() {\r\n    let pos = this.interactionPos();\r\n    this.interacting = true;\r\n    let entityAndCell = this._world.entityNear(pos.x, pos.y)\r\n    if (entityAndCell) {\r\n      let { entity, cell } = entityAndCell;\r\n      return this._world.useItem(entity, cell, this.equipped)\r\n    }\r\n  }\r\n\r\n  interactionPos(): { x:number, y:number }  {\r\n    let interactionPos = this.getCenter().clone();\r\n    let yOff = 20;\r\n    if (this.facing === 'up') { yOff -= 2; }\r\n    if (this.facing === 'down') { yOff -= 4; }\r\n    interactionPos.y += yOff; //this.getHeight();\r\n    interactionPos.x -= 2;\r\n    addScalarToVec(interactionPos, this.facing, 24);\r\n    return interactionPos;\r\n  }\r\n\r\n  useEquippedItem() {\r\n    // if (!this.usingItem) {\r\n      this.usingItem = true;\r\n      this.usingItemTicks = 0;\r\n      this.interactUsingEquipped();\r\n    // }\r\n  }\r\n\r\n  equipmentPos(): { x: number, y: number } {\r\n    let equipmentPos = this.getCenter().clone();\r\n    if (this.facing === 'left') {\r\n      //equipmentPos.x -= 6;\r\n      equipmentPos.y += 6;\r\n    } else {\r\n      equipmentPos.x -= 4;\r\n      equipmentPos.y += 8;\r\n    }\r\n    return equipmentPos;\r\n  }\r\n\r\n  draw(ctx: CanvasRenderingContext2D, engine) {\r\n    if (!(this.facing === 'up')) {\r\n      super.draw(ctx, engine);\r\n    }\r\n\r\n    if (this.usingItem && this.equipped && this.equipSprite) {\r\n      let littleDrawing = this.equipSprite;\r\n      let ticks = this.usingItemTicks;\r\n      if (this.facing === 'left') {\r\n        ticks = 6-ticks;\r\n        littleDrawing.flipHorizontal = true;\r\n        littleDrawing.anchor = new ex.Vector(-1, 1);\r\n      } else {\r\n        littleDrawing.flipHorizontal = false;\r\n        littleDrawing.anchor = new ex.Vector(0, 1);\r\n        if (this.facing === 'up') { ticks = ticks-4; }\r\n        if (this.facing === 'down') { ticks = ticks+6; }\r\n        //if (this.facing === 'down') { ticks = ticks-4; }\r\n      }\r\n      littleDrawing.rotation = (ticks / 3) - 1;\r\n      let equipPos = this.equipmentPos();\r\n      littleDrawing.draw(ctx, equipPos.x, equipPos.y); //this.x, this.y); //equipPos.y);\r\n    }\r\n\r\n    if ((this.facing === 'up')) {\r\n      super.draw(ctx, engine);\r\n    }\r\n\r\n    if (this.config.debugBoundingBoxes) {\r\n      this.collisionArea.debugDraw(ctx, ex.Color.Chartreuse);\r\n      if (this.interacting) {\r\n        let pos = this.interactionPos();\r\n        ctx.fillRect(pos.x, pos.y - 10, 4, 4);\r\n        ctx.fillRect(pos.x, pos.y, 4, 4);\r\n        ctx.fillRect(pos.x, pos.y + 10, 4, 4);\r\n        ctx.fillRect(pos.x - 10, pos.y, 4, 4);\r\n        ctx.fillRect(pos.x + 10, pos.y, 4, 4);\r\n      }\r\n      ctx.fillRect(this.x, this.computeZ(), 3, 3);\r\n    }\r\n  }\r\n\r\n  computeZ = () => (this.y + 24); // / 10000; //8;\r\n\r\n  halt = () => {\r\n    this.vel = new ex.Vector(0, 0);\r\n    this.currentDrawing = this.sprites[this.facing];\r\n  }\r\n\r\n  move = (direction: Direction) => {\r\n    this.facing = direction;\r\n    const step = this.speed * 32;\r\n    this.halt();\r\n    if (direction === 'left')  { this.vel.x = -step; }\r\n    if (direction === 'right') { this.vel.x = step; }\r\n    if (direction === 'up')    { this.vel.y = -step; }\r\n    if (direction === 'down')  { this.vel.y = step; }\r\n\r\n    this.currentDrawing = this.walkSprites[this.facing];\r\n    //if (Math.abs(this.vel.x + this.vel.y) < this.speed) {\r\n    //  this.halt();\r\n    //  this.currentDrawing = this.sprites[this.facing];\r\n    //}\r\n  }\r\n\r\n  update(engine, delta) {\r\n    //this.currentDrawing = this.walkSprites[this.facing];\r\n    //if (Math.abs(this.vel.x + this.vel.y) < this.speed) {\r\n    //  this.halt();\r\n    //  //this.currentDrawing = this.sprites[this.facing];\r\n    //}\r\n    super.update(engine, delta);\r\n    this.setZIndex(this.computeZ());\r\n    //console.log({z: this.getZIndex()})\r\n    if (this.usingItem) {\r\n      let itemSwingTime = 5;\r\n      this.usingItemTicks += 1;\r\n      if (this.usingItemTicks > itemSwingTime) {\r\n        this.usingItem = false;\r\n      } else {\r\n        // this.interactUsingEquipped();\r\n      }\r\n    }\r\n  }\r\n\r\n}\r\n","import { Player } from './player/player';\nimport { Logo } from './brand/logo';\nexport { Player, Logo };\n","import * as ex from 'excalibur';\r\nimport { GameConfig } from '../game_config';\r\n\r\nexport class Thing extends ex.Actor {\r\n    constructor(\r\n        public x: number,\r\n        public y: number,\r\n        public zOff: number = 0,\r\n        public size: number = 1,\r\n        public debugBoxes: boolean,\r\n    ) {\r\n        super(x, y, 32 * size, 32 * size, ex.Color.Chartreuse);\r\n    }\r\n\r\n    draw(ctx, engine) {\r\n        super.draw(ctx, engine);\r\n        if (this.debugBoxes) {\r\n            this.collisionArea.debugDraw(ctx, ex.Color.LightGray);\r\n            ctx.fillRect(this.x, this.computeZ(), 5, 5);\r\n        }\r\n    }\r\n\r\n    computeZ = () => (this.y + 4 + (this.size-1) * 16); // / 10000;\r\n    constructCollisionArea(collision) {\r\n        if (!collision) {\r\n            if (this.size > 1) {\r\n                // console.log(\"CREATE LARGE THING!!!\")\r\n                this.collisionType = ex.CollisionType.Fixed;\r\n                this.body.useBoxCollision(\r\n                    new ex.Vector(\r\n                        0, //(32 * this.size) / 2,\r\n                        (16 * this.size) - 14 \r\n                    )\r\n                )\r\n                this.setHeight((26*this.size) / 4);\r\n                this.setWidth(24*this.size);\r\n            } else {\r\n                this.collisionType = ex.CollisionType.PreventCollision;\r\n            }\r\n        }\r\n        else {\r\n            this.collisionType = ex.CollisionType.Fixed;\r\n            if (collision.ellipse) {\r\n                let center = new ex.Vector((collision.x + collision.width / 2) - 16, (collision.y + collision.height / 2) - 16);\r\n                this.body.useCircleCollision(collision.height / 2, center);\r\n            }\r\n            else if (collision.polygon) {\r\n                //console.log(\"poly\", { polygon: collision.polygon });\r\n                //debugger;\r\n                let vecs: ex.Vector[] = collision.polygon.map(({ x, y }) => new ex.Vector(x + collision.x, y + collision.y));\r\n                this.body.usePolygonCollision(vecs);\r\n            }\r\n            else {\r\n                // console.warn(\"implement collider:\", { collision });\r\n                //debugger;\r\n            }\r\n        }\r\n    }\r\n}","import * as ex from 'excalibur';\r\nimport { World, Material } from './world';\r\nimport { Cell } from 'excalibur';\r\nimport { coinflip } from './util';\r\nimport { BasicSpriteMap } from './basic_sprites';\r\n\r\n//type Material = 'wood' | 'stone' | 'glass'; // | 'rope'\r\n\r\ninterface ItemKind {\r\n    name: string\r\n    description: string\r\n    //public sprite: ex.Sprite,\r\n\r\n    z?: number\r\n    size?: number\r\n\r\n    drawing?: ex.Sprite\r\n    collision?: any\r\n    // alternate?: boolean\r\n}\r\n\r\nclass Item {\r\n    //static sprites: { [key: string]: ex.Sprite }\r\n\r\n    constructor(\r\n        public kind: ItemKind,\r\n        public actor: ex.Actor,\r\n        public cell: ex.Cell, // the 'root' cell (upper-left corner of large objs)\r\n        //public sprite: ex.Sprite,\r\n        //public state: Object = {},\r\n        public world: World\r\n    ) {\r\n        //console.log(\"CREATED ITEM\", { kind: this.kind, sprite: this.sprite });\r\n        this.initialize();\r\n    }\r\n\r\n    initialize() {}\r\n\r\n    activate(it?: Item) {\r\n    //   console.warn(\"item is non-interactive\",\r\n    //       { kind: this.kind });\r\n        return null; //'...';\r\n    }\r\n}\r\n\r\nclass Chest extends Item {\r\n    state: { open: boolean } = { open: false }\r\n\r\n    initialize() {\r\n        this.actor.addDrawing('closed', BasicSpriteMap.chestClosed);\r\n        this.actor.addDrawing('open', BasicSpriteMap.chestOpen);\r\n        //this.actor.addDrawing();\r\n    }\r\n\r\n    activate(it: Item) {\r\n        if (!it) {\r\n            console.log(\"Chest activated!\");\r\n            if (this.state.open) {\r\n                this.actor.setDrawing('closed');\r\n                this.state = { open: false };\r\n                return 'closed';\r\n            } else {\r\n                this.actor.setDrawing('open');\r\n                this.state = { open: true }\r\n                return 'opened';\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nclass Palm extends Item {\r\n    initialize() {\r\n        this.actor.addDrawing('palm', BasicSpriteMap.palm);\r\n        this.actor.setDrawing('palm');\r\n    }\r\n}\r\n\r\nclass BigCampfire extends Item {\r\n    initialize() {\r\n        this.actor.addDrawing('fire', BasicSpriteMap.BigCampfire);\r\n        this.actor.setDrawing('fire');\r\n        //this.actor.setDrawing('big')\r\n    }\r\n}\r\n\r\nclass WoodLog extends Item {\r\n  activate(it: Item) {\r\n      if (!it) {\r\n          this.world.collect(this, Material.Wood);\r\n      }\r\n      return this.kind.description;\r\n    }\r\n}\r\n\r\nclass WoodLogStack extends Item {\r\n    activate(it: Item) {\r\n        if (!it) {\r\n            this.world.collect(this, Material.Wood, 3);\r\n        }\r\n        return this.kind.description;\r\n    }\r\n}\r\n\r\nclass GreatPalm extends Item {\r\n    state: { hp: number } = { hp: 100 }\r\n\r\n    initialize() {\r\n        this.actor.addDrawing('palm', BasicSpriteMap.greatPalm);\r\n        this.actor.setDrawing('palm');\r\n    }\r\n\r\n    activate(it: Item) {\r\n        if (this.state.hp > 0) {\r\n            const message: string = `once a seed (${this.state.hp})`\r\n            let damage = it && it.kind.name === 'Handaxe' ? 25 : 0; // this.world._primaryCharacter.equipped ? 30 : 3;\r\n            this.state.hp -= damage;\r\n            return message;\r\n        } else {\r\n            let baseCells: Array<ex.Cell> = [-2,-1,0,1,2].map((offset) => //this.cell; //world.tileMap.getCellByPoint(this.actor.x, this.actor.y);\r\n                this.world.tileMap.getCellByIndex(\r\n                    this.cell.index +\r\n                    (this.kind.size / 2) + offset +\r\n                    ((this.kind.size - 1) * this.world.tileMap.cols)\r\n                )\r\n            );\r\n\r\n            this.world.destroy(this);\r\n\r\n            baseCells.forEach(base => {\r\n                let logKind = coinflip() ? 'WoodLogStack' : 'WoodLog';\r\n\r\n                this.world.spawn(\r\n                    this.world.itemKinds[logKind],\r\n                    base,\r\n                );\r\n            });\r\n            return \"timber\";\r\n        }\r\n    }\r\n}\r\n\r\nclass Handaxe extends Item {\r\n    activate() {\r\n        this.world.equip(this);\r\n        this.world.destroy(this);\r\n        return this.kind.description;\r\n    }\r\n}\r\n\r\nclass Machete extends Item {\r\n    activate() {\r\n        this.world.equip(this);\r\n        this.world.destroy(this);\r\n        return this.kind.description;\r\n    }\r\n}\r\n\r\nconst itemClasses = {\r\n    Chest,\r\n    Palm,\r\n    GreatPalm,\r\n    BigCampfire,\r\n    WoodLog,\r\n    WoodLogStack,\r\n    Handaxe,\r\n    Machete,\r\n};\r\n\r\nconst buildItem = (kind: ItemKind, actor: ex.Actor, cell: Cell, world: World): Item => {\r\n    if (itemClasses[kind.name]) {\r\n        return new itemClasses[kind.name](kind, actor, cell, world);\r\n    } else {\r\n        return new Item(kind, actor, cell, world);\r\n    }\r\n}\r\n\r\nclass Isle {\r\n    constructor(public name: string, public items: Array<Item> = []) {\r\n    }\r\n}\r\n\r\nexport { Isle, Item, ItemKind, buildItem };","import * as ex from 'excalibur';\nimport { Resources } from './resources';\nimport { GameConfig } from './game_config';\nimport { setupMaster } from 'cluster';\nimport { LevelOne } from './scenes/level-one/level-one';\nimport { Logo } from './actors';\n\nexport class Game extends ex.Engine {\n  constructor(width: number, height: number, config: GameConfig) {\n    super({ width, height, displayMode: ex.DisplayMode.FullScreen });\n\n    this.setup();\n  }\n\n\n  // entrypoint\n\n  public start() {\n    let loader = new ex.Loader();\n    for (let key in Resources) {\n      loader.addResource(Resources[key]);\n    }\n\n    //loader.backgroundColor = '#8abec0'\n    loader.logo = \"data:image/png;base64,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\";\n      // \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAACACAQAAABOvH+BAAAFUklEQVR4nO2dS5bjIAxFcZ/aR0be/4IYeSXpAXHZ8VfCEjyodyfpU53jyOghxD8EQgghhBBCCCGEEEIIIYQQQgghhBBCCCGEENI8Q20D0Hi90+cEWzKv9zQsdibyrYV9zRq83iHEz79HOAnMLo9hDIudiTGEkCcDsJesyeu9LVQUCSTXx7uvhTHoRQDyis+wCNtb94dQWwJLkL93/YJWBD+KZ3/4bn1syC/or7D9a5n2eUfur0Oe2xdiCGF8y99fXVC5hl0zfj51jju3RlcPzt1fKgY8dfsWud2qCOBXT5Y6LDX8WoqpHoSAnM2HsE7sbIniklQIoESYlBkui0PpG5pw6MV5o1m/4cnIAWqjE2L8zQxyhCCvSefg5BdHNCaAnBxE37zY4ZUz2dGUAJ7VpRQLSosA2/0h/KttgJznoTSGEF5vTTcWZzDIi2YEYNOSxo8IDB7VCWACOKtxlokUelC2QB65wARwjHUeHYvFgGkY779UFUUSOA2ja057NnpXrxvVfwag7AVMw3q8/RiJs45rRf+FXQqNcNXdwLtHjxfj6tJnrMEeRkFEF7eMxwHO29YS4XQfWf6WeHKWhRgLYBqOJZDrfmn9P3v146wFqW23TBJz3qrISKBvgV9N/S5ZS1x9H8n9tW2BHgqW1P/7Ikz/n79YxI/67ocWgI37Z/RFjeAef5oYCDrjb7jIl6YFQJ4DKwD2/8sAKwBShqYFUG5SxwcE+5sWAEYRtk3jAqAEngIrAPlMelQu80KivnzNJ4Nq5O7a7VBIxJsJdu+3Ah4J1FFnza8F11XGW9iwTYCe2HRjcIZ3IwEsgJz1dLMIepKBrwS6aQIW5j2BbTYIpelQAIlW9gdLsNiheAZwE/B8UXX8NAlG5nQJtABs1tX3mBraAS6AJIGnImAcOAdeACFMg1UcMDCmOxoQQAhzHHiaEVACe0x7AZ4DwdulnTlr/j2z6VZprBu4dt92ubeENiXgufaxMQGsWccELh/LpWEBJGYZ9CsB37XPzQsgId+6jtQIyJJaX2uLCKBEoadNYC3FAYxdDY10A2XYnsfh223EcH9nAmjhSBY0OhOARAIcEFrTnQAYBXQUEkDZWkcJyOkwAoRACcjpVAD4oGQiFMAFKE7ypFsBsBGQYSiA68ngv1CbdGCUSLcRoAUQJEABVKX+gtVOZgPbZd6/UGtmgAIAoKYIzJqA+/WAZVu81g6ZqrW11SACSK82Lklr7k/U2M6mvDn06K94RX3tfs1MfPn1Q8vW1gTQAREWt3aVKE7b2l9nCdnqaGuDm9GvKJwEas/x0F8Mbx/8Y9Vdxuub0T0sEAvAqmCXdu6b69uCZC7wuqfzOyzXE8LddT05tlXpBh45aR9o15K7vwha6vz8tXjfYtzjLwzB6enq5kooAP+setvWHv1iPEyOSvdCTu9EAjiTRJ+xNDYQtE+OdK73XItbe0xvtkInASABrE2XDCshsj+xcBpK71bQSQB0MshnNr/MWvztiCf2ygRQAXhQbysGsgSEAkB+BRkl3b+f9bA46MYHoBzgG9u2s3Tt37fD62t3kfIXWAFYSuDO/aUStdkKJCEACWDvJhvHSGq/983o219LnwhCEAugfHfGBmnwv74Z3efNt0KQYzXbCRQBjs1+JrurS2WPOP+ub13NuNTyQjKdjQTmBmet8++s+DxVOP7onXTaPV31IL9R97sCk8/zzZ0t76z/dSEFlMMfJGQY+jILh0vPWFJg9/KzrfVS9uuk2nF/lgBmni9gzCmoq19tqeAJIYQQQgghhBBCCCGEEEIIIYQQQgghhBBCCCGEEAP+AwVxGTrL66gaAAAAAElFTkSuQmCC\";\n    loader.logoWidth = 256;\n    loader.playButtonText = \"Let's go!\"\n    // null; // Resources.Brand;\n\n    return super.start(loader).then(this.kick);\n  }\n\n  // runs on new Game\n  protected setup() {\n    // console.log(\"game setup here\")\n    // initialize island...\n\n    // const levelOne = new LevelOne();\n    // this.add(levelOne);\n  }\n\n  // runs after loader\n  protected kick() {\n\n  } \n}\n","module.exports = __webpack_public_path__ + \"fac8210e66067d101e48370329fc4c5a.mp3\";","module.exports = __webpack_public_path__ + \"8e8aa6414e948820c3ad76cc2be5950e.png\";","module.exports = __webpack_public_path__ + \"db6f4f593c47b1aa561da3453157f4bb.png\";","module.exports = __webpack_public_path__ + \"e12b440e05a78caaa8a410ac5a9ae975.png\";","module.exports = __webpack_public_path__ + \"a50b1e1e7cee2ca0bc0432c2f60c9762.png\";","module.exports = __webpack_public_path__ + \"4370e7e154e6bf9f7f29f94d09f57d4d.png\";","module.exports = __webpack_public_path__ + \"9ed23a06339fdd13866ae30b9487fee6.png\";","module.exports = __webpack_public_path__ + \"2a68646c6ea259ec7876244b66663310.png\";","module.exports = __webpack_public_path__ + \"62a76f84a12bb5ca1f3aa3ee157a7612.png\";","module.exports = __webpack_public_path__ + \"b9b405c74e06d77b7a88f04d6d3ae5cd.png\";","module.exports = __webpack_public_path__ + \"95be6eddfa20f80a10098ddeddb5e618.png\";","module.exports = __webpack_public_path__ + \"721a1650db3d410b2328a96727466a7f.png\";","import * as ex from 'excalibur';\nimport { World } from '../../world';\nimport { BasicSpriteMap } from '../../basic_sprites';\n\nexport class LevelOne extends ex.Scene {\n  world: World\n\n  public onInitialize(engine: ex.Engine) {\n  }\n\n  public wireWorld(world: World) { this.world = world; }\n\n  public onActivate() {\n    \n  }\n\n  public onDeactivate() {\n\n  }\n\n  // public update(engine: ex.Engine, delta) {\n  //   super.update(engine, delta);\n  // }\n\n  public draw(ctx, delta) {\n    super.draw(ctx, delta);\n\n    // draw currently-crafting item...\n    //if (this.world && this.world.crafting) {\n    //  // console.log(\"TRYING TO DRAW CRAFTING ITEM\", this.world.craftingItem);\n    //  let sprite: ex.Sprite = BasicSpriteMap[this.world.craftingItem]; //.clone();\n    //  if (sprite) { //BasicSpriteMap[this.world.craftingItem])\n    //    let craftPreview = sprite.clone()\n    //    let { x, y } = this.world.craftingAt;\n    //    // console.log(\"draw crafting item at\", {x,y});\n    //    craftPreview.opacity(0.5);\n    //    craftPreview.scale = new ex.Vector(2, 2);\n\n    //    // maybe it's red if we can't do it??\n\n    //    craftPreview.draw(ctx, x, y);\n    //  }\n    //}\n  }\n}\n","import * as ex from 'excalibur';\r\nimport { LevelOne } from './scenes/level-one/level-one';\r\nimport { Resources } from './resources';\r\nimport { Game } from './game';\r\nimport { keyToDirection, Direction, mode } from './util';\r\nimport { World, Material } from './world';\r\nimport { GameConfig } from './game_config';\r\nimport { Hud } from './actors/hud';\r\nimport { BasicSpriteMap } from './basic_sprites';\r\nimport { TileMap } from 'excalibur';\r\n\r\n// Islands are either from before or for after humankind. (gd)\r\n\r\n/* \r\nDreaming of islands — whether with joy or in fear, it \r\ndoesn't matter — is dreaming of pulling away, of being already separate, far \r\nfrom any continent, of being lost and alone — or it is dreaming of starting from \r\nscratch, recreating, beginning anew. (gd)\r\n*/\r\n\r\n// An island doesn't stop being deserted simply because it is inhabited. (gd)\r\n\r\nconst config: GameConfig = {\r\n  debugCells: false,\r\n  debugBoundingBoxes: false,\r\n  zoom: 2,\r\n  playerSpeed: 6.8, //.4,\r\n  bgMusic: true\r\n}\r\n\r\n// ex.Physics.boundsPadding = config.playerSpeed * 3;\r\n// ex.Physics.collisionPasses = 2;\r\n\r\nconst game = new Game(800, 600, config);\r\nconst levelOne = new LevelOne();\r\n\r\nconst hud = new Hud(game);\r\nlevelOne.add(hud);\r\n\r\nconst world = new World(levelOne, hud, config, game);\r\nlevelOne.wireWorld(world); // hmmm\r\n\r\ngame.input.keyboard.on('press', (evt: ex.Input.KeyEvent) => {\r\n    // check for current scene?\r\n  if (game.currentScene === levelOne) {\r\n    let player = world.primaryCharacter();\r\n\r\n    let { key } = evt;\r\n    if (key === ex.Input.Keys.E) {\r\n      let interaction = player.interact();\r\n      if (interaction) {\r\n        hud.describe(interaction);\r\n      }\r\n    } else if (key === ex.Input.Keys.C) {\r\n      if (!world.crafting) {\r\n        hud.describe('would craft!');\r\n        world.enterCraftMode('BigCampfire', 0,0);\r\n      } else {\r\n        world.crafting = false;\r\n      }\r\n    } else {\r\n      // assume we're trying to move\r\n      let direction = keyToDirection(key);\r\n      if (direction) { player.move(direction); }\r\n    }\r\n  }\r\n})\r\n\r\ngame.input.keyboard.on('hold', (evt: ex.Input.KeyEvent) => {\r\n  let { key } = evt;\r\n  let direction: Direction = keyToDirection(key);\r\n  if (direction) {\r\n    let player = world.primaryCharacter();\r\n    player.move(direction);\r\n  }\r\n})\r\n\r\ngame.input.keyboard.on('release', (evt: ex.Input.KeyEvent) => {\r\n  // console.log(\"RELEASE\", { evt });\r\n  let { key } = evt;\r\n  let direction: Direction = keyToDirection(key);\r\n  if (direction) {\r\n    let player = world.primaryCharacter();\r\n    player.halt(); //direction);\r\n    player.interacting = false;\r\n  }\r\n});\r\n\r\ngame.add('wander', levelOne);\r\n\r\ngame.start().then(() => {\r\n  world.processTiledMap(Resources.Map);\r\n\r\n  let tileMap = world.tileMap;\r\n  levelOne.addTileMap(tileMap);\r\n  game.goToScene('wander');\r\n\r\n  // really should be an audio player!\r\n  if (config.bgMusic) {\r\n    let theme = Resources.FineMist; //Science;\r\n    // wait a tiny bit for music to load??? (seems to work welll)\r\n    setTimeout(() => {\r\n      // console.log('about to play music', { theme, isLoaded: theme.isLoaded() });\r\n      theme.play(0.2) //1.0)\r\n    }, 3000);\r\n  }\r\n\r\n  //game.input.pointers.primary.on('move', (e: ex.Input.PointerEvent) => {\r\n  //  // console.log(\"MOUSE MOVE\");\r\n  //  let { pos } = e;\r\n  //  if (world && world.crafting) {\r\n  //    // console.log(\"MOUSE MOVE while CRAFTING...\");\r\n  //    let cell = world.tileMap.getCellByPoint(pos.x, pos.y);\r\n  //    let x = cell.x, y = cell.y;\r\n  //    let screenPos = game.worldToScreenCoordinates(new ex.Vector(x,y));\r\n  //    //world.craftingItem = 'campfire';\r\n  //    world.craftingAt = screenPos;\r\n  //    //console.log(\"draw fire sprite at\", {x,y});\r\n  //    //fireSprite.draw(game.ctx, x, y); //cell.x * 32, cell.y * 32);\r\n  //  }\r\n  //});\r\n\r\n  game.input.pointers.primary.on('down', (e: ex.Input.PointerEvent) => {\r\n    let { pos } = e;\r\n    // console.log(\"CLICK\", { pos });\r\n    if (world && world.crafting) { // && world.ableToCraft()) {\r\n      // console.log(\"CLICK while CRAFTING\");\r\n      // hud.describe(`would build ${world.craftingItem}!`);\r\n      let kind = world.itemKinds[world.craftingItem];\r\n\r\n      let cell = world.tileMap.getCellByPoint(pos.x, pos.y);\r\n      //debugger;\r\n      world.spawn(kind, cell);\r\n      world.crafting = false;\r\n      world.debit(Material.Wood);\r\n      //world.primaryCharacter().a\r\n    } else {\r\n      if (world._primaryCharacter.equipped) {\r\n        world.primaryCharacter().useEquippedItem();\r\n      }\r\n    }\r\n  })\r\n\r\n});"],"sourceRoot":""}