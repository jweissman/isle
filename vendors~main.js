(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{0:function(t,e,i){
/*!
 * excalibur - 0.19.1 - 2018-10-23
 * https://github.com/excaliburjs/Excalibur
 * Copyright (c) 2018 Excalibur.js <https://github.com/excaliburjs/Excalibur/graphs/contributors>
 * Licensed BSD-2-Clause
 * @preserve
 */
window,t.exports=function(t){var e={};function i(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}return i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:n})},i.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";i.r(e);var n={};i.d(n,"GameEvent",function(){return W}),i.d(n,"KillEvent",function(){return N}),i.d(n,"PreKillEvent",function(){return q}),i.d(n,"PostKillEvent",function(){return X}),i.d(n,"GameStartEvent",function(){return V}),i.d(n,"GameStopEvent",function(){return G}),i.d(n,"PreDrawEvent",function(){return Z}),i.d(n,"PostDrawEvent",function(){return K}),i.d(n,"PreDebugDrawEvent",function(){return Y}),i.d(n,"PostDebugDrawEvent",function(){return Q}),i.d(n,"PreUpdateEvent",function(){return J}),i.d(n,"PostUpdateEvent",function(){return $}),i.d(n,"PreFrameEvent",function(){return tt}),i.d(n,"PostFrameEvent",function(){return et}),i.d(n,"GamepadConnectEvent",function(){return it}),i.d(n,"GamepadDisconnectEvent",function(){return nt}),i.d(n,"GamepadButtonEvent",function(){return ot}),i.d(n,"GamepadAxisEvent",function(){return rt}),i.d(n,"SubscribeEvent",function(){return st}),i.d(n,"UnsubscribeEvent",function(){return at}),i.d(n,"VisibleEvent",function(){return ht}),i.d(n,"HiddenEvent",function(){return ct}),i.d(n,"PreCollisionEvent",function(){return ut}),i.d(n,"PostCollisionEvent",function(){return lt}),i.d(n,"CollisionStartEvent",function(){return pt}),i.d(n,"CollisionEndEvent",function(){return dt}),i.d(n,"InitializeEvent",function(){return ft}),i.d(n,"ActivateEvent",function(){return _t}),i.d(n,"DeactivateEvent",function(){return gt}),i.d(n,"ExitViewPortEvent",function(){return yt}),i.d(n,"EnterViewPortEvent",function(){return vt}),i.d(n,"EnterTriggerEvent",function(){return mt}),i.d(n,"ExitTriggerEvent",function(){return bt});var o={};i.d(o,"Grayscale",function(){return Ft}),i.d(o,"Invert",function(){return It}),i.d(o,"Opacity",function(){return Lt}),i.d(o,"Colorize",function(){return Ht}),i.d(o,"Lighten",function(){return jt}),i.d(o,"Darken",function(){return Ut}),i.d(o,"Saturate",function(){return Wt}),i.d(o,"Desaturate",function(){return Nt}),i.d(o,"Fill",function(){return qt});var r={};i.d(r,"EaseTo",function(){return Jt}),i.d(r,"MoveTo",function(){return $t}),i.d(r,"MoveBy",function(){return te}),i.d(r,"Follow",function(){return ee}),i.d(r,"Meet",function(){return ie}),i.d(r,"RotateTo",function(){return ne}),i.d(r,"RotateBy",function(){return oe}),i.d(r,"ScaleTo",function(){return re}),i.d(r,"ScaleBy",function(){return se}),i.d(r,"Delay",function(){return ae}),i.d(r,"Blink",function(){return he}),i.d(r,"Fade",function(){return ce}),i.d(r,"Die",function(){return ue}),i.d(r,"CallMethod",function(){return le}),i.d(r,"Repeat",function(){return pe}),i.d(r,"RepeatForever",function(){return de}),i.d(r,"ActionQueue",function(){return fe});var s={};i.d(s,"line",function(){return ye}),i.d(s,"point",function(){return ve}),i.d(s,"vector",function(){return me}),i.d(s,"roundRect",function(){return be}),i.d(s,"circle",function(){return we});var a={};i.d(a,"Gamepads",function(){return Ji}),i.d(a,"Gamepad",function(){return $i}),i.d(a,"Buttons",function(){return Gi}),i.d(a,"Axes",function(){return Zi}),i.d(a,"PointerType",function(){return Ti}),i.d(a,"PointerButton",function(){return Mi}),i.d(a,"WheelDeltaMode",function(){return Di}),i.d(a,"PointerScope",function(){return Bi}),i.d(a,"PointerEvent",function(){return Fi}),i.d(a,"PointerEventFactory",function(){return Ii}),i.d(a,"PointerDragEvent",function(){return Li}),i.d(a,"PointerUpEvent",function(){return Hi}),i.d(a,"PointerDownEvent",function(){return ji}),i.d(a,"PointerMoveEvent",function(){return Ui}),i.d(a,"PointerEnterEvent",function(){return Wi}),i.d(a,"PointerLeaveEvent",function(){return Ni}),i.d(a,"PointerCancelEvent",function(){return qi}),i.d(a,"WheelEvent",function(){return Xi}),i.d(a,"Pointers",function(){return Ki}),i.d(a,"Pointer",function(){return Yi}),i.d(a,"Keys",function(){return xi}),i.d(a,"KeyEvent",function(){return Oi}),i.d(a,"Keyboard",function(){return Ri});var h={};i.d(h,"CapturePointer",function(){return ke}),i.d(h,"EulerMovement",function(){return Fn}),i.d(h,"OffscreenCulling",function(){return Ee}),i.d(h,"TileMapCollisionDetection",function(){return Ce});var c,u={};i.d(u,"DrawUtil",function(){return s}),i.d(u,"TwoPI",function(){return f}),i.d(u,"extend",function(){return _}),i.d(u,"base64Encode",function(){return g}),i.d(u,"clamp",function(){return y}),i.d(u,"randomInRange",function(){return v}),i.d(u,"randomIntInRange",function(){return m}),i.d(u,"canonicalizeAngle",function(){return b}),i.d(u,"toDegrees",function(){return w}),i.d(u,"toRadians",function(){return x}),i.d(u,"getPosition",function(){return P}),i.d(u,"addItemToArray",function(){return S}),i.d(u,"removeItemFromArray",function(){return A}),i.d(u,"contains",function(){return E}),i.d(u,"getOppositeSide",function(){return k}),i.d(u,"getSideFromVector",function(){return C}),i.d(u,"Collection",function(){return B}),function(t){t[t.Resolved=0]="Resolved",t[t.Rejected=1]="Rejected",t[t.Pending=2]="Pending"}(c||(c={}));var l,p=function(){function t(){this._state=c.Pending,this._successCallbacks=[],this._rejectCallback=function(){}}return t.resolve=function(e){return(new t).resolve(e)},t.reject=function(e){return(new t).reject(e)},t.join=function(){var e=[];if(arguments.length>0&&!Array.isArray(arguments[0]))for(var i=0;i<arguments.length;i++)e[i-0]=arguments[i];else 1===arguments.length&&Array.isArray(arguments[0])&&(e=arguments[0]);var n=new t;if(!e||!e.length)return n.resolve();var o=e.length,r=0,s=0,a=[];return e.forEach(function(t){t.then(function(){(r+=1)===o?n.resolve():r+s+a.length===o&&n.reject(a)},function(){r+(s+=1)+a.length===o&&n.reject(a)}).error(function(t){a.push(t),a.length+r+s===o&&n.reject(a)})}),n},t.prototype.then=function(t,e){if(t&&(this._successCallbacks.push(t),this.state()===c.Resolved))try{t.call(this,this._value)}catch(t){this._handleError(t)}if(e&&(this._rejectCallback=e,this.state()===c.Rejected))try{e.call(this,this._value)}catch(t){this._handleError(t)}return this},t.prototype.error=function(t){return t&&(this._errorCallback=t),this},t.prototype.resolve=function(t){var e=this;if(this._state!==c.Pending)throw new Error("Cannot resolve a promise that is not in a pending state!");this._value=t;try{this._state=c.Resolved,this._successCallbacks.forEach(function(t){t.call(e,e._value)})}catch(t){this._handleError(t)}return this},t.prototype.reject=function(t){if(this._state!==c.Pending)throw new Error("Cannot reject a promise that is not in a pending state!");this._value=t;try{this._state=c.Rejected,this._rejectCallback.call(this,this._value)}catch(t){this._handleError(t)}return this},t.prototype.state=function(){return this._state},t.prototype._handleError=function(t){if(!this._errorCallback)throw t;this._errorCallback.call(this,t)},t}(),d=function(){function t(t){this.seed=t,this._lowerMask=2147483647,this._upperMask=2147483648,this._w=32,this._n=624,this._m=397,this._a=2567483615,this._u=11,this._s=7,this._b=2636928640,this._t=15,this._c=4022730752,this._l=18,this._f=1812433253,this._mt=new Array(this._n),this._mt[0]=(t||Date.now())>>>0;for(var e=1;e<this._n;e++){var i=this._mt[e-1]^this._mt[e-1]>>>this._w-2;this._mt[e]=(this._f*((4294901760&i)>>>16)<<16)+this._f*(65535&i)+e>>>0}this._index=this._n}return t.prototype._twist=function(){for(var t=[0,this._a],e=0,i=0;i<this._n-this._m;i++)e=this._mt[i]&this._upperMask|this._mt[i+1]&this._lowerMask,this._mt[i]=this._mt[i+this._m]^e>>>1^4294967295&t[1&e];for(;i<this._n-1;i++)e=this._mt[i]&this._upperMask|this._mt[i+1]&this._lowerMask,this._mt[i]=this._mt[i+(this._m-this._n)]^e>>>1^4294967295&t[1&e];e=this._mt[this._n-1]&this._upperMask|this._mt[0]&this._lowerMask,this._mt[this._n-1]=this._mt[this._m-1]^e>>>1^4294967295&t[1&e],this._index=0},t.prototype.nextInt=function(){this._index>=this._n&&this._twist();var t=this._mt[this._index++];return t^=t>>>this._u,t^=t<<this._s&this._b,t^=t<<this._t&this._c,(t^=t>>>this._l)>>>0},t.prototype.next=function(){return this.nextInt()*(1/4294967296)},t.prototype.floating=function(t,e){return(e-t)*this.next()+t},t.prototype.integer=function(t,e){return Math.floor((e-t+1)*this.next()+t)},t.prototype.bool=function(t){return void 0===t&&(t=.5),this.next()<=t},t.prototype.pickOne=function(t){return t[this.integer(0,t.length-1)]},t.prototype.pickSet=function(t,e,i){return void 0===i&&(i=!1),i?this._pickSetWithDuplicates(t,e):this._pickSetWithoutDuplicates(t,e)},t.prototype._pickSetWithoutDuplicates=function(t,e){if(e>t.length||e<0)throw new Error("Invalid number of elements to pick, must pick a value 0 < n <= length");if(e===t.length)return t;for(var i=new Array(e),n=0,o=t.slice(0);n<e;){var r=this.integer(0,o.length-1);i[n++]=o[r],o.splice(r,1)}return i},t.prototype._pickSetWithDuplicates=function(t,e){if(e<0)throw new Error("Invalid number of elements to pick, must pick a value 0 <= n < MAX_INT");for(var i=new Array(e),n=0;n<e;n++)i[n]=this.pickOne(t);return i},t.prototype.shuffle=function(t){for(var e=t.slice(0),i=null,n=0;n<e.length-2;n++){var o=this.integer(n,e.length-1);i=e[n],e[n]=e[o],e[o]=i}return e},t.prototype.range=function(t,e,i){for(var n=new Array(t),o=0;o<t;o++)n[o]=this.integer(e,i);return n},t.prototype.d4=function(){return this.integer(1,4)},t.prototype.d6=function(){return this.integer(1,6)},t.prototype.d8=function(){return this.integer(1,8)},t.prototype.d10=function(){return this.integer(1,10)},t.prototype.d12=function(){return this.integer(1,12)},t.prototype.d20=function(){return this.integer(1,20)},t}();!function(t){t[t.None=0]="None",t[t.Top=1]="Top",t[t.Bottom=2]="Bottom",t[t.Left=3]="Left",t[t.Right=4]="Right"}(l||(l={}));var f=2*Math.PI;function _(){var t={},e=!1,i=0,n=arguments.length;"[object Boolean]"===Object.prototype.toString.call(arguments[0])&&(e=arguments[0],i++);var o="function"==typeof Object.assign,r=null;for(r=o?Object.assign:function(i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e&&"[object Object]"===Object.prototype.toString.call(i[n])?t[n]=_(!0,t[n],i[n]):t[n]=i[n])};i<n;i++){var s=arguments[i];o?r(t,s):r(s)}return t}function g(t){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",i="",n=0;n<t.length;){var o,r,s=255&t.charCodeAt(n++),a=255&t.charCodeAt(n++),h=255&t.charCodeAt(n++),c=s>>2,u=(3&s)<<4|a>>4;isNaN(a)?o=r=64:(o=(15&a)<<2|h>>6,r=isNaN(h)?64:63&h),i+=e.charAt(c)+e.charAt(u)+e.charAt(o)+e.charAt(r)}return i}function y(t,e,i){return Math.min(Math.max(e,t),i)}function v(t,e,i){return void 0===i&&(i=new d),i?i.floating(t,e):t+Math.random()*(e-t)}function m(t,e,i){return void 0===i&&(i=new d),i?i.integer(t,e):Math.round(v(t,e))}function b(t){var e=t;if(t>f)for(;e>f;)e-=f;if(t<0)for(;e<0;)e+=f;return e}function w(t){return 180/Math.PI*t}function x(t){return t/180*Math.PI}function P(t){var e=0,i=0,n=function(t){e+=t.offsetLeft,t.offsetParent&&n(t.offsetParent)},o=function(t){i+=t.offsetTop,t.offsetParent&&o(t.offsetParent)};return n(t),o(t),new O(e,i)}function S(t,e){return-1===e.indexOf(t)&&(e.push(t),!0)}function A(t,e){var i;return(i=e.indexOf(t))>-1&&(e.splice(i,1),!0)}function E(t,e){for(var i=0;i<t.length;i++)if(t[i]===e)return!0;return!1}function k(t){return t===l.Top?l.Bottom:t===l.Bottom?l.Top:t===l.Left?l.Right:t===l.Right?l.Left:l.None}function C(t){for(var e=[O.Left,O.Right,O.Up,O.Down],i=[l.Left,l.Right,l.Top,l.Bottom],n=-Number.MAX_VALUE,o=-1,r=0;r<e.length;r++)e[r].dot(t)>n&&(n=e[r].dot(t),o=r);return i[o]}var T,M,D,B=function(){function t(e){void 0===e&&(e=t.DefaultSize),this._internalArray=null,this._endPointer=0,this._internalArray=new Array(e)}return t.prototype._resize=function(){for(var t=2*this._internalArray.length,e=new Array(t),i=this.count(),n=0;n<i;n++)e[n]=this._internalArray[n];delete this._internalArray,this._internalArray=e},t.prototype.push=function(t){return this._endPointer===this._internalArray.length&&this._resize(),this._internalArray[this._endPointer++]=t},t.prototype.pop=function(){return this._endPointer=this._endPointer-1<0?0:this._endPointer-1,this._internalArray[this._endPointer]},t.prototype.count=function(){return this._endPointer},t.prototype.clear=function(){this._endPointer=0},t.prototype.internalSize=function(){return this._internalArray.length},t.prototype.elementAt=function(t){if(t>=this.count())throw new Error("Invalid index "+t);return this._internalArray[t]},t.prototype.insert=function(t,e){return t>=this.count()&&this._resize(),this._internalArray[t]=e},t.prototype.remove=function(t){var e=this.count();if(0===e)throw new Error("Invalid parameter "+t);for(var i=this._internalArray[t],n=t;n<e;n++)this._internalArray[n]=this._internalArray[n+1];return this._endPointer--,i},t.prototype.removeElement=function(t){var e=this._internalArray.indexOf(t);this.remove(e)},t.prototype.toArray=function(){return this._internalArray.slice(0,this._endPointer)},t.prototype.forEach=function(t){for(var e=0,i=this.count();e<i;e++)t.call(this,this._internalArray[e],e)},t.prototype.map=function(t){for(var e=this.count(),i=0;i<e;i++)this._internalArray[i]=t.call(this,this._internalArray[i],i)},t.DefaultSize=200,t}(),O=function(){function t(t,e){this.x=t,this.y=e}return t.fromAngle=function(e){return new t(Math.cos(e),Math.sin(e))},t.isValid=function(t){return null!==t&&void 0!==t&&!isNaN(t.x)&&!isNaN(t.y)&&t.x!==1/0&&t.y!==1/0&&t.x!==-1/0&&t.y!==-1/0},t.distance=function(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))},t.prototype.setTo=function(t,e){this.x=t,this.y=e},t.prototype.equals=function(t,e){return void 0===e&&(e=.001),Math.abs(this.x-t.x)<=e&&Math.abs(this.y-t.y)<=e},t.prototype.distance=function(e){return e||(e=t.Zero),Math.sqrt(Math.pow(this.x-e.x,2)+Math.pow(this.y-e.y,2))},t.prototype.magnitude=function(){return this.distance()},t.prototype.normalize=function(){var e=this.distance();return e>0?new t(this.x/e,this.y/e):new t(0,1)},t.prototype.average=function(t){return this.add(t).scale(.5)},t.prototype.scale=function(e){return new t(this.x*e,this.y*e)},t.prototype.add=function(e){return new t(this.x+e.x,this.y+e.y)},t.prototype.sub=function(e){return new t(this.x-e.x,this.y-e.y)},t.prototype.addEqual=function(t){return this.x+=t.x,this.y+=t.y,this},t.prototype.subEqual=function(t){return this.x-=t.x,this.y-=t.y,this},t.prototype.scaleEqual=function(t){return this.x*=t,this.y*=t,this},t.prototype.dot=function(t){return this.x*t.x+this.y*t.y},t.prototype.cross=function(e){return e instanceof t?this.x*e.y-this.y*e.x:"number"==typeof e?new t(e*this.y,-e*this.x):void 0},t.prototype.perpendicular=function(){return new t(this.y,-this.x)},t.prototype.normal=function(){return this.perpendicular().normalize()},t.prototype.negate=function(){return this.scale(-1)},t.prototype.toAngle=function(){return Math.atan2(this.y,this.x)},t.prototype.rotate=function(e,i){i||(i=new t(0,0));var n=Math.sin(e),o=Math.cos(e);return new t(o*(this.x-i.x)-n*(this.y-i.y)+i.x,n*(this.x-i.x)+o*(this.y-i.y)+i.y)},t.prototype.clone=function(){return new t(this.x,this.y)},t.prototype.toString=function(){return"("+this.x+", "+this.y+")"},t.Zero=new t(0,0),t.One=new t(1,1),t.Half=new t(.5,.5),t.Up=new t(0,-1),t.Down=new t(0,1),t.Left=new t(-1,0),t.Right=new t(1,0),t}(),R=function(){function t(t,e){this.pos=t,this.dir=e.normalize()}return t.prototype.intersect=function(t){var e=t.begin.sub(this.pos);if(0===this.dir.cross(t.getSlope())&&0!==e.cross(this.dir))return-1;var i=this.dir.cross(t.getSlope());if(0===i)return-1;var n=e.cross(t.getSlope())/i;if(n>=0){var o=e.cross(this.dir)/i/t.getLength();if(o>=0&&o<=1)return n}return-1},t.prototype.getPoint=function(t){return this.pos.add(this.dir.scale(t))},t}(),z=function(){function t(t,e){this.begin=t,this.end=e}return Object.defineProperty(t.prototype,"slope",{get:function(){return(this.end.y-this.begin.y)/(this.end.x-this.begin.x)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"intercept",{get:function(){return this.begin.y-this.slope*this.begin.x},enumerable:!0,configurable:!0}),t.prototype.normal=function(){return this.end.sub(this.begin).normal()},t.prototype.getSlope=function(){var t=this.begin,e=this.end,i=t.distance(e);return e.sub(t).scale(1/i)},t.prototype.getLength=function(){var t=this.begin,e=this.end;return t.distance(e)},t.prototype.distanceToPoint=function(t){var e=t.x,i=t.y,n=this.getLength(),o=this.end.y-this.begin.y,r=this.end.x-this.begin.x;return Math.abs(o*e-r*i+this.end.x*this.begin.y-this.end.y*this.begin.x)/n},t.prototype.findPoint=function(t,e){void 0===t&&(t=null),void 0===e&&(e=null);var i=this.slope,n=this.intercept;if(null!==t)return new O(t,i*t+n);if(null!==e)return new O((e-n)/i,e);throw new Error("You must provide an X or a Y value")},t.prototype.hasPoint=function(){var t,e=0;if("number"==typeof arguments[0]&&"number"==typeof arguments[1])t=new O(arguments[0],arguments[1]),e=arguments[2]||0;else{if(!(arguments[0]instanceof O))throw"Could not determine the arguments for Vector.hasPoint";t=arguments[0],e=arguments[1]||0}var i=t.x-this.begin.x,n=t.y-this.begin.y,o=this.end.x-this.begin.x,r=this.end.y-this.begin.y,s=i*r-n*o;return!(Math.abs(s)>e)&&(Math.abs(o)>=Math.abs(r)?o>0?this.begin.x<=t.x&&t.x<=this.end.x:this.end.x<=t.x&&t.x<=this.begin.x:r>0?this.begin.y<=t.y&&t.y<=this.end.y:this.end.y<=t.y&&t.y<=this.begin.y)},t}(),F=function(){function t(t,e){this.min=t,this.max=e}return t.prototype.overlaps=function(t){return this.max>t.min&&t.max>this.min},t.prototype.getOverlap=function(t){return this.overlaps(t)?this.max>t.max?t.max-this.min:this.max-t.min:0},t}(),I=function(){function t(t,e,i){this.worldPos=t,this.pagePos=e,this.screenPos=i}return t.fromPagePosition=function(e,i,n){var o,r,s,a;3===arguments.length?(s=new O(o=e,r=i),a=n):(o=(s=e).x,r=s.y,a=i);var h=o-P(a.canvas).x,c=r-P(a.canvas).y,u=new O(h,c);return new t(a.screenToWorldCoordinates(u),s,u)},t}();!function(t){t[t.Box=0]="Box",t[t.RigidBody=1]="RigidBody"}(T||(T={})),function(t){t[t.Naive=0]="Naive",t[t.DynamicAABBTree=1]="DynamicAABBTree"}(M||(M={})),function(t){t[t.Euler=0]="Euler"}(D||(D={}));var L,H,j=function(){function t(){}return t.useBoxPhysics=function(){t.collisionResolutionStrategy=T.Box},t.useRigidBodyPhysics=function(){t.collisionResolutionStrategy=T.RigidBody},t.acc=new O(0,0),t.enabled=!0,t.collisionPasses=5,t.broadphaseStrategy=M.DynamicAABBTree,t.broadphaseDebug=!1,t.showCollisionNormals=!1,t.showMotionVectors=!1,t.showBounds=!1,t.showArea=!1,t.showContacts=!1,t.showNormals=!1,t.collisionResolutionStrategy=T.Box,t.defaultMass=10,t.integrator=D.Euler,t.integrationSteps=1,t.allowRigidBodyRotation=!0,t.collisionShift=.001,t.dynamicTreeVelocityMultiplyer=2,t.boundsPadding=5,t.surfaceEpsilon=.1,t.checkForFastBodies=!0,t.disableMinimumSpeedForFastBody=!1,t}(),U=(L=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}L(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),W=function(){function t(){this.bubbles=!0,this._path=[],this._name=""}return Object.defineProperty(t.prototype,"eventPath",{get:function(){return this._path},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),t.prototype.stopPropagation=function(){this.bubbles=!1},t.prototype.action=function(){var t=this.eventPath.pop();t&&(this._onActionStart(t),t.eventDispatcher.emit(this._name,this),this._onActionEnd(t))},t.prototype.propagate=function(){this.eventPath.length&&(this.action(),this.bubbles&&this.propagate())},t.prototype.layPath=function(t){var e=t.getAncestors();this._path=e.length>this._path.length?e:this._path},t.prototype._onActionStart=function(t){},t.prototype._onActionEnd=function(t){},t}(),N=function(t){function e(e){var i=t.call(this)||this;return i.target=e,i}return U(e,t),e}(W),q=function(t){function e(e){var i=t.call(this)||this;return i.target=e,i}return U(e,t),e}(W),X=function(t){function e(e){var i=t.call(this)||this;return i.target=e,i}return U(e,t),e}(W),V=function(t){function e(e){var i=t.call(this)||this;return i.target=e,i}return U(e,t),e}(W),G=function(t){function e(e){var i=t.call(this)||this;return i.target=e,i}return U(e,t),e}(W),Z=function(t){function e(e,i,n){var o=t.call(this)||this;return o.ctx=e,o.delta=i,o.target=n,o}return U(e,t),e}(W),K=function(t){function e(e,i,n){var o=t.call(this)||this;return o.ctx=e,o.delta=i,o.target=n,o}return U(e,t),e}(W),Y=function(t){function e(e,i){var n=t.call(this)||this;return n.ctx=e,n.target=i,n}return U(e,t),e}(W),Q=function(t){function e(e,i){var n=t.call(this)||this;return n.ctx=e,n.target=i,n}return U(e,t),e}(W),J=function(t){function e(e,i,n){var o=t.call(this)||this;return o.engine=e,o.delta=i,o.target=n,o}return U(e,t),e}(W),$=function(t){function e(e,i,n){var o=t.call(this)||this;return o.engine=e,o.delta=i,o.target=n,o}return U(e,t),e}(W),tt=function(t){function e(e,i){var n=t.call(this)||this;return n.engine=e,n.prevStats=i,n.target=e,n}return U(e,t),e}(W),et=function(t){function e(e,i){var n=t.call(this)||this;return n.engine=e,n.stats=i,n.target=e,n}return U(e,t),e}(W),it=function(t){function e(e,i){var n=t.call(this)||this;return n.index=e,n.gamepad=i,n.target=i,n}return U(e,t),e}(W),nt=function(t){function e(e,i){var n=t.call(this)||this;return n.index=e,n.gamepad=i,n.target=i,n}return U(e,t),e}(W),ot=function(t){function e(e,i,n){var o=t.call(this)||this;return o.button=e,o.value=i,o.target=n,o}return U(e,t),e}(W),rt=function(t){function e(e,i,n){var o=t.call(this)||this;return o.axis=e,o.value=i,o.target=n,o}return U(e,t),e}(W),st=function(t){function e(e,i){var n=t.call(this)||this;return n.topic=e,n.handler=i,n}return U(e,t),e}(W),at=function(t){function e(e,i){var n=t.call(this)||this;return n.topic=e,n.handler=i,n}return U(e,t),e}(W),ht=function(t){function e(e){var i=t.call(this)||this;return i.target=e,i}return U(e,t),e}(W),ct=function(t){function e(e){var i=t.call(this)||this;return i.target=e,i}return U(e,t),e}(W),ut=function(t){function e(e,i,n,o){var r=t.call(this)||this;return r.actor=e,r.other=i,r.side=n,r.intersection=o,r.target=e,r}return U(e,t),e}(W),lt=function(t){function e(e,i,n,o){var r=t.call(this)||this;return r.actor=e,r.other=i,r.side=n,r.intersection=o,r.target=e,r}return U(e,t),e}(W),pt=function(t){function e(e,i,n){var o=t.call(this)||this;return o.actor=e,o.other=i,o.pair=n,o.target=e,o}return U(e,t),e}(W),dt=function(t){function e(e,i){var n=t.call(this)||this;return n.actor=e,n.other=i,n.target=e,n}return U(e,t),e}(W),ft=function(t){function e(e,i){var n=t.call(this)||this;return n.engine=e,n.target=i,n}return U(e,t),e}(W),_t=function(t){function e(e,i){var n=t.call(this)||this;return n.oldScene=e,n.target=i,n}return U(e,t),e}(W),gt=function(t){function e(e,i){var n=t.call(this)||this;return n.newScene=e,n.target=i,n}return U(e,t),e}(W),yt=function(t){function e(e){var i=t.call(this)||this;return i.target=e,i}return U(e,t),e}(W),vt=function(t){function e(e){var i=t.call(this)||this;return i.target=e,i}return U(e,t),e}(W),mt=function(t){function e(e,i){var n=t.call(this)||this;return n.target=e,n.actor=i,n}return U(e,t),e}(W),bt=function(t){function e(e,i){var n=t.call(this)||this;return n.target=e,n.actor=i,n}return U(e,t),e}(W),wt=function(){function t(t){this._handlers={},this._wiredEventDispatchers=[],this._target=t}return t.prototype.emit=function(t,e){if(t){t=t.toLowerCase();var i,n,o=this._target;if(e||(e=new W),e.target=o,this._handlers[t])for(i=0,n=this._handlers[t].length;i<n;i++)this._handlers[t][i].call(o,e);for(i=0,n=this._wiredEventDispatchers.length;i<n;i++)this._wiredEventDispatchers[i].emit(t,e)}},t.prototype.on=function(t,e){t=t.toLowerCase(),this._handlers[t]||(this._handlers[t]=[]),this._handlers[t].push(e),"unsubscribe"!==t&&"subscribe"!==t&&this.emit("subscribe",new st(t,e))},t.prototype.off=function(t,e){t=t.toLowerCase();var i=this._handlers[t];if(i)if(e){var n=i.indexOf(e);this._handlers[t].splice(n,1)}else this._handlers[t].length=0;"unsubscribe"!==t&&"subscribe"!==t&&this.emit("unsubscribe",new at(t,e))},t.prototype.once=function(t,e){var i=this;this.on(t,function(n){var o=n||new W;o.target=o.target||i._target,i.off(t,e),e.call(o.target,o)})},t.prototype.wire=function(t){t._wiredEventDispatchers.push(this)},t.prototype.unwire=function(t){var e=t._wiredEventDispatchers.indexOf(this);e>-1&&t._wiredEventDispatchers.splice(e,1)},t}(),xt=function(){function t(){this.eventDispatcher=new wt(this)}return t.prototype.on=function(t,e){this.eventDispatcher.on(t,e)},t.prototype.off=function(t,e){this.eventDispatcher.off(t,e)},t.prototype.emit=function(t,e){this.eventDispatcher.emit(t,e)},t.prototype.once=function(t,e){this.eventDispatcher.once(t,e)},t.extend=function(e){var i,n=this;i=e&&e.hasOwnProperty("constructor")?e.constructor:function(){return n.apply(this,arguments)};var o=function(){this.constructor=i};if(o.prototype=n.prototype,i.prototype=new o,e)for(var r in e)e.hasOwnProperty(r)&&(i.prototype[r]=e[r]);return i.extend=t.extend,i},t}(),Pt=function(){function t(t,e,i,n){this.r=t,this.g=e,this.b=i,this.a=null!=n?n:1}return t.fromRGB=function(e,i,n,o){return new t(e,i,n,o)},t.fromHex=function(e){var i;if(i=e.match(/^#?([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})?$/i)){var n=parseInt(i[1],16),o=parseInt(i[2],16),r=parseInt(i[3],16),s=1;return i[4]&&(s=parseInt(i[4],16)/255),new t(n,o,r,s)}throw new Error("Invalid hex string: "+e)},t.fromHSL=function(t,e,i,n){return void 0===n&&(n=1),new St(t,e,i,n).toRGBA()},t.prototype.lighten=function(t){void 0===t&&(t=.1);var e=St.fromRGBA(this.r,this.g,this.b,this.a);return e.l+=e.l*t,e.toRGBA()},t.prototype.darken=function(t){void 0===t&&(t=.1);var e=St.fromRGBA(this.r,this.g,this.b,this.a);return e.l-=e.l*t,e.toRGBA()},t.prototype.saturate=function(t){void 0===t&&(t=.1);var e=St.fromRGBA(this.r,this.g,this.b,this.a);return e.s+=e.s*t,e.toRGBA()},t.prototype.desaturate=function(t){void 0===t&&(t=.1);var e=St.fromRGBA(this.r,this.g,this.b,this.a);return e.s-=e.s*t,e.toRGBA()},t.prototype.mulitiply=function(e){return new t(e.r/255*this.r/255*255,e.g/255*this.g/255*255,e.b/255*this.b/255*255,e.a*this.a)},t.prototype.screen=function(t){var e=t.invert(),i=t.invert();return e.mulitiply(i).invert()},t.prototype.invert=function(){return new t(255-this.r,255-this.g,255-this.b,1-this.a)},t.prototype.average=function(e){return new t((e.r+this.r)/2,(e.g+this.g)/2,(e.b+this.b)/2,(e.a+this.a)/2)},t.prototype.toString=function(t){switch(void 0===t&&(t="rgb"),t){case"rgb":return this.toRGBA();case"hsl":return this.toHSLA();case"hex":return this.toHex();default:throw new Error("Invalid Color format")}},t.prototype._componentToHex=function(t){var e=t.toString(16);return 1===e.length?"0"+e:e},t.prototype.toHex=function(){return"#"+this._componentToHex(this.r)+this._componentToHex(this.g)+this._componentToHex(this.b)},t.prototype.toRGBA=function(){var t=String(this.r.toFixed(0))+", "+String(this.g.toFixed(0))+", "+String(this.b.toFixed(0));return void 0!==this.a||null!==this.a?"rgba("+t+", "+String(this.a)+")":"rgb("+t+")"},t.prototype.toHSLA=function(){return St.fromRGBA(this.r,this.g,this.b,this.a).toString()},t.prototype.fillStyle=function(){return this.toString()},t.prototype.clone=function(){return new t(this.r,this.g,this.b,this.a)},t.Black=t.fromHex("#000000"),t.White=t.fromHex("#FFFFFF"),t.Gray=t.fromHex("#808080"),t.LightGray=t.fromHex("#D3D3D3"),t.DarkGray=t.fromHex("#A9A9A9"),t.Yellow=t.fromHex("#FFFF00"),t.Orange=t.fromHex("#FFA500"),t.Red=t.fromHex("#FF0000"),t.Vermillion=t.fromHex("#FF5B31"),t.Rose=t.fromHex("#FF007F"),t.Magenta=t.fromHex("#FF00FF"),t.Violet=t.fromHex("#7F00FF"),t.Blue=t.fromHex("#0000FF"),t.Azure=t.fromHex("#007FFF"),t.Cyan=t.fromHex("#00FFFF"),t.Viridian=t.fromHex("#59978F"),t.Green=t.fromHex("#00FF00"),t.Chartreuse=t.fromHex("#7FFF00"),t.Transparent=t.fromHex("#FFFFFF00"),t}(),St=function(){function t(t,e,i,n){this.h=t,this.s=e,this.l=i,this.a=n}return t.hue2rgb=function(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+(e-t)*(2/3-i)*6:t},t.fromRGBA=function(e,i,n,o){e/=255,i/=255,n/=255;var r,s,a=Math.max(e,i,n),h=Math.min(e,i,n),c=(a+h)/2;if(a===h)r=s=0;else{var u=a-h;switch(s=c>.5?u/(2-a-h):u/(a+h),a){case e:r=(i-n)/u+(i<n?6:0);break;case i:r=(n-e)/u+2;break;case n:r=(e-i)/u+4}r/=6}return new t(r,s,c,o)},t.prototype.toRGBA=function(){var e,i,n;if(0===this.s)e=i=n=this.l;else{var o=this.l<.5?this.l*(1+this.s):this.l+this.s-this.l*this.s,r=2*this.l-o;e=t.hue2rgb(r,o,this.h+1/3),i=t.hue2rgb(r,o,this.h),n=t.hue2rgb(r,o,this.h-1/3)}return new Pt(255*e,255*i,255*n,this.a)},t.prototype.toString=function(){return"hsla("+this.h.toFixed(0)+", "+this.s.toFixed(0)+", "+this.l.toFixed(0)+", "+this.a.toFixed(0)+")"},t}(),At=function(){function t(t,e,i,n,o){this.bodyA=t,this.bodyB=e,this.mtv=i,this.point=n,this.normal=o}return t.prototype.resolve=function(t){if(t===T.RigidBody)this._resolveRigidBodyCollision();else{if(t!==T.Box)throw new Error("Unknown collision resolution strategy");this._resolveBoxCollision()}},t.prototype._applyBoxImpulse=function(t,e,i){if(t.collisionType===xe.Active&&e.collisionType!==xe.Passive){t.collisionType===xe.Active&&e.collisionType===xe.Active&&(i=i.scale(.5)),t.pos.y+=i.y,t.pos.x+=i.x;var n=i.normalize();if(n.dot(t.vel)<0){var o=n.scale(n.dot(t.vel.negate()));t.vel=t.vel.add(o)}t.emit("postcollision",new lt(t,e,C(i),i))}},t.prototype._resolveBoxCollision=function(){var t=this.bodyA.body.actor,e=this.bodyB.body.actor,i=C(this.mtv),n=this.mtv.negate();t.emit("precollision",new ut(t,e,i,n)),e.emit("precollision",new ut(e,t,k(i),n.negate())),this._applyBoxImpulse(t,e,n),this._applyBoxImpulse(e,t,n.negate())},t.prototype._resolveRigidBodyCollision=function(){var t=this.bodyA.body,e=this.bodyB.body,i=this.mtv,n=this.normal;if(t.actor!==e.actor){var o=C(this.mtv);if(t.actor.emit("precollision",new ut(this.bodyA.body.actor,this.bodyB.body.actor,o,this.mtv)),e.actor.emit("precollision",new ut(this.bodyB.body.actor,this.bodyA.body.actor,k(o),this.mtv.negate())),t.actor.collisionType!==xe.Passive&&e.actor.collisionType!==xe.Passive){var r=t.actor.collisionType===xe.Fixed?0:1/t.mass,s=e.actor.collisionType===xe.Fixed?0:1/e.mass,a=t.actor.collisionType===xe.Fixed?0:1/t.moi,h=e.actor.collisionType===xe.Fixed?0:1/e.moi,c=Math.min(t.restitution,e.restitution),u=Math.min(t.friction,e.friction),l=(n=n.normalize()).normal().normalize(),p=this.point.sub(this.bodyA.getCenter()),d=this.point.sub(this.bodyB.getCenter()),f=e.vel.add(d.cross(-e.rx)).sub(t.vel.sub(p.cross(t.rx))),_=f.dot(n),g=f.dot(l),y=p.dot(l),v=p.dot(n),m=d.dot(l),b=d.dot(n);if(!(_>0)){var w=-(1+c)*_/(r+s+a*y*y+h*m*m);if(t.actor.collisionType===xe.Fixed?(e.vel=e.vel.add(n.scale(w*s)),j.allowRigidBodyRotation&&(e.rx-=w*h*-d.cross(n)),e.addMtv(i)):e.actor.collisionType===xe.Fixed?(t.vel=t.vel.sub(n.scale(w*r)),j.allowRigidBodyRotation&&(t.rx+=w*a*-p.cross(n)),t.addMtv(i.negate())):(e.vel=e.vel.add(n.scale(w*s)),t.vel=t.vel.sub(n.scale(w*r)),j.allowRigidBodyRotation&&(e.rx-=w*h*-d.cross(n),t.rx+=w*a*-p.cross(n)),e.addMtv(i.scale(.5)),t.addMtv(i.scale(-.5))),u&&g){var x=f.sub(n.scale(f.dot(n))).normalize(),P=f.dot(x)/(r+s+v*v*a+b*b*h),S=new O(0,0);S=Math.abs(P)<=w*u?x.scale(P).negate():x.scale(-w*u),t.actor.collisionType===xe.Fixed?(e.vel=e.vel.add(S.scale(s)),j.allowRigidBodyRotation&&(e.rx+=S.dot(x)*h*d.cross(x))):e.actor.collisionType===xe.Fixed?(t.vel=t.vel.sub(S.scale(r)),j.allowRigidBodyRotation&&(t.rx-=S.dot(x)*a*p.cross(x))):(e.vel=e.vel.add(S.scale(s)),t.vel=t.vel.sub(S.scale(r)),j.allowRigidBodyRotation&&(e.rx+=S.dot(x)*h*d.cross(x),t.rx-=S.dot(x)*a*p.cross(x)))}t.actor.emit("postcollision",new lt(this.bodyA.body.actor,this.bodyB.body.actor,o,this.mtv)),e.actor.emit("postcollision",new lt(this.bodyB.body.actor,this.bodyA.body.actor,k(o),this.mtv.negate()))}}}},t}(),Et={CollideCircleCircle:function(t,e){var i=t.radius+e.radius,n=t.body.pos.add(t.pos),o=e.body.pos.add(e.pos);if(n.distance(o)>i)return null;var r=o.sub(n).normalize(),s=r.scale(i-o.distance(n)),a=t.getFurthestPoint(r);return new At(t,e,s,a,r)},CollideCirclePolygon:function(t,e){var i=t.testSeparatingAxisTheorem(e);if(!i)return null;i=i.dot(e.getCenter().sub(t.getCenter()))<0?i.negate():i;var n=[],o=e.getFurthestPoint(i.negate()),r=t.getFurthestPoint(i);return t.contains(o)&&n.push(o),e.contains(r)&&n.push(r),0===n.length?null:new At(t,e,i,2===n.length?n[0].average(n[1]):n[0],i.normalize())},CollideCircleEdge:function(t,e){var i=t.getCenter(),n=e.end.sub(e.begin),o=n.dot(e.end.sub(i)),r=n.dot(i.sub(e.begin));if(r<=0){var s=e.begin.sub(i),a=s.dot(s);return a>t.radius*t.radius?null:new At(t,e,s.normalize().scale(t.radius-Math.sqrt(a)),e.begin,s.normalize())}if(o<=0){var h=e.end.sub(i),c=h.dot(h);return c>t.radius*t.radius?null:new At(t,e,h.normalize().scale(t.radius-Math.sqrt(c)),e.end,h.normalize())}var u=n.dot(n),l=e.begin.scale(o).add(e.end.scale(r)).scale(1/u),p=i.sub(l),d=p.dot(p);if(d>t.radius*t.radius)return null;var f=n.perpendicular();f.dot(i.sub(e.begin))<0&&(f.x=-f.x,f.y=-f.y);var _=(f=f.normalize()).scale(Math.abs(t.radius-Math.sqrt(d)));return new At(t,e,_.negate(),l,f.negate())},CollideEdgeEdge:function(){return null},CollidePolygonEdge:function(t,e){var i=e.end.sub(e.begin).normal();if(t.contains(e.begin)){var n=t.getClosestFace(e.begin),o=n.distance,r=n.face;if(o)return new At(t,e,o.negate(),e.begin.add(o.negate()),r.normal().negate())}if(t.contains(e.end)){var s=t.getClosestFace(e.end);if(o=s.distance,r=s.face,o)return new At(t,e,o.negate(),e.end.add(o.negate()),r.normal().negate())}var a=t.getCenter(),h=e.getCenter().sub(a).normalize(),c=new Tt({points:[e.begin,e.end,e.end.add(h.scale(30)),e.begin.add(h.scale(30))]}),u=t.testSeparatingAxisTheorem(c);return u?(i=i.dot(h)<0?i.negate():i,u=u.dot(h)<0?u.negate():u,new At(t,e,u,t.getFurthestPoint(i),i)):null},CollidePolygonPolygon:function(t,e){var i=t.testSeparatingAxisTheorem(e);if(!i)return null;i=i.dot(e.getCenter().sub(t.getCenter()))<0?i.negate():i;var n=[],o=t.getFurthestPoint(i),r=e.getFurthestPoint(i.negate());e.contains(o)&&n.push(o),t.contains(r)&&n.push(r),0===n.length&&n.push(r);var s=2===n.length?n[0].add(n[1]).scale(.5):n[0];return new At(t,e,i,s,i.normalize())}},kt=function(){function t(t){this.pos=O.Zero.clone(),this.pos=t.pos||O.Zero.clone(),this.radius=t.radius||0,this.body=t.body||null}return t.prototype.getCenter=function(){return this.body?this.pos.add(this.body.pos):this.pos},t.prototype.contains=function(t){return this.body.pos.distance(t)<=this.radius},t.prototype.rayCast=function(t,e){void 0===e&&(e=1/0);var i=this.getCenter(),n=t.dir,o=t.pos,r=Math.sqrt(Math.pow(n.dot(o.sub(i)),2)-Math.pow(o.sub(i).distance(),2)+Math.pow(this.radius,2));if(r<0)return null;var s=0;if(0===r)return(s=-n.dot(o.sub(i)))>0&&s<e?t.getPoint(s):null;var a=-n.dot(o.sub(i))+r,h=-n.dot(o.sub(i))-r,c=Math.min(a,h);return c<=e?t.getPoint(c):null},t.prototype.collide=function(e){if(e instanceof t)return Et.CollideCircleCircle(this,e);if(e instanceof Tt)return Et.CollideCirclePolygon(this,e);if(e instanceof Ct)return Et.CollideCircleEdge(this,e);throw new Error("Circle could not collide with unknown ICollisionArea "+typeof e)},t.prototype.getFurthestPoint=function(t){return this.getCenter().add(t.normalize().scale(this.radius))},t.prototype.getBounds=function(){return new Mt(this.pos.x+this.body.pos.x-this.radius,this.pos.y+this.body.pos.y-this.radius,this.pos.x+this.body.pos.x+this.radius,this.pos.y+this.body.pos.y+this.radius)},t.prototype.getAxes=function(){return null},t.prototype.getMomentOfInertia=function(){return(this.body?this.body.mass:j.defaultMass)*this.radius*this.radius/2},t.prototype.testSeparatingAxisTheorem=function(t){var e=t.getAxes(),i=t.getCenter(),n=t.getFurthestPoint(this.pos.sub(i));e.push(this.pos.sub(n).normalize());for(var o=Number.MAX_VALUE,r=null,s=-1,a=0;a<e.length;a++){var h=t.project(e[a]),c=this.project(e[a]),u=h.getOverlap(c);if(u<=0)return null;u<o&&(o=u,r=e[a],s=a)}return s<0?null:r.normalize().scale(o)},t.prototype.recalc=function(){},t.prototype.project=function(t){var e=[],i=this.getCenter().dot(t);return e.push(i),e.push(i+this.radius),e.push(i-this.radius),new F(Math.min.apply(Math,e),Math.max.apply(Math,e))},t.prototype.debugDraw=function(t,e){void 0===e&&(e=Pt.Green.clone());var i=this.body?this.body.pos.add(this.pos):this.pos,n=this.body?this.body.rotation:0;t.beginPath(),t.strokeStyle=e.toString(),t.arc(i.x,i.y,this.radius,0,2*Math.PI),t.closePath(),t.stroke(),t.beginPath(),t.moveTo(i.x,i.y),t.lineTo(Math.cos(n)*this.radius+i.x,Math.sin(n)*this.radius+i.y),t.closePath(),t.stroke()},t}(),Ct=function(){function t(t){this.begin=t.begin||O.Zero.clone(),this.end=t.end||O.Zero.clone(),this.body=t.body||null,this.pos=this.getCenter()}return t.prototype.getCenter=function(){return this.begin.average(this.end).add(this._getBodyPos())},t.prototype._getBodyPos=function(){var t=O.Zero.clone();return this.body.pos&&(t=this.body.pos),t},t.prototype._getTransformedBegin=function(){var t=this.body?this.body.rotation:0;return this.begin.rotate(t).add(this._getBodyPos())},t.prototype._getTransformedEnd=function(){var t=this.body?this.body.rotation:0;return this.end.rotate(t).add(this._getBodyPos())},t.prototype.getSlope=function(){var t=this._getTransformedBegin(),e=this._getTransformedEnd(),i=t.distance(e);return e.sub(t).scale(1/i)},t.prototype.getLength=function(){var t=this._getTransformedBegin(),e=this._getTransformedEnd();return t.distance(e)},t.prototype.contains=function(){return!1},t.prototype.rayCast=function(t,e){void 0===e&&(e=1/0);var i=this._getTransformedBegin().sub(t.pos);if(0===t.dir.cross(this.getSlope())&&0!==i.cross(t.dir))return null;var n=t.dir.cross(this.getSlope());if(0===n)return null;var o=i.cross(this.getSlope())/n;if(o>=0&&o<=e){var r=i.cross(t.dir)/n/this.getLength();if(r>=0&&r<=1)return t.getPoint(o)}return null},t.prototype.collide=function(e){if(e instanceof kt)return Et.CollideCircleEdge(e,this);if(e instanceof Tt)return Et.CollidePolygonEdge(e,this);if(e instanceof t)return Et.CollideEdgeEdge();throw new Error("Edge could not collide with unknown ICollisionArea "+typeof e)},t.prototype.getFurthestPoint=function(t){var e=this._getTransformedBegin(),i=this._getTransformedEnd();return t.dot(e)>0?e:i},t.prototype.getBounds=function(){var t=this._getTransformedBegin(),e=this._getTransformedEnd();return new Mt(Math.min(t.x,e.x),Math.min(t.y,e.y),Math.max(t.x,e.x),Math.max(t.y,e.y))},t.prototype.getAxes=function(){var t=this._getTransformedEnd().sub(this._getTransformedBegin()).normal(),e=[];return e.push(t),e.push(t.negate()),e.push(t.normal()),e.push(t.normal().negate()),e},t.prototype.getMomentOfInertia=function(){var t=this.body?this.body.mass:j.defaultMass,e=this.end.sub(this.begin).distance()/2;return t*e*e},t.prototype.recalc=function(){},t.prototype.project=function(t){for(var e=[],i=[this._getTransformedBegin(),this._getTransformedEnd()],n=i.length,o=0;o<n;o++)e.push(i[o].dot(t));return new F(Math.min.apply(Math,e),Math.max.apply(Math,e))},t.prototype.debugDraw=function(t,e){void 0===e&&(e=Pt.Red.clone()),t.strokeStyle=e.toString(),t.beginPath(),t.moveTo(this.begin.x,this.begin.y),t.lineTo(this.end.x,this.end.y),t.closePath(),t.stroke()},t}(),Tt=function(){function t(t){this._transformedPoints=[],this._axes=[],this._sides=[],this.pos=t.pos||O.Zero.clone();var e=!!t.clockwiseWinding;this.points=(e?t.points.reverse():t.points)||[],this.body=t.body||null,this._calculateTransformation()}return t.prototype.getCenter=function(){return this.body?this.body.pos.add(this.pos):this.pos},t.prototype._calculateTransformation=function(){var t=this.body?this.body.pos.add(this.pos):this.pos,e=this.body?this.body.rotation:0,i=this.points.length;this._transformedPoints.length=0;for(var n=0;n<i;n++)this._transformedPoints[n]=this.points[n].rotate(e).add(t)},t.prototype.getTransformedPoints=function(){return this._transformedPoints.length||this._calculateTransformation(),this._transformedPoints},t.prototype.getSides=function(){if(this._sides.length)return this._sides;for(var t=[],e=this.getTransformedPoints(),i=e.length,n=0;n<i;n++)t.push(new z(e[n],e[(n-1+i)%i]));return this._sides=t,this._sides},t.prototype.recalc=function(){this._sides.length=0,this._axes.length=0,this._transformedPoints.length=0,this.getTransformedPoints(),this.getAxes(),this.getSides()},t.prototype.contains=function(t){var e=new R(t,new O(1,0));return this.getSides().reduce(function(t,i){return e.intersect(i)>=0?t+1:t},0)%2!=0},t.prototype.collide=function(e){if(e instanceof kt)return Et.CollideCirclePolygon(e,this);if(e instanceof t)return Et.CollidePolygonPolygon(this,e);if(e instanceof Ct)return Et.CollidePolygonEdge(this,e);throw new Error("Polygon could not collide with unknown ICollisionArea "+typeof e)},t.prototype.getFurthestPoint=function(t){for(var e=this.getTransformedPoints(),i=null,n=-Number.MAX_VALUE,o=0;o<e.length;o++){var r=t.dot(e[o]);r>n&&(n=r,i=e[o])}return i},t.prototype.getClosestFace=function(t){for(var e=this.getSides(),i=Number.POSITIVE_INFINITY,n=-1,o=-1,r=0;r<e.length;r++){var s=e[r].distanceToPoint(t);s<i&&(i=s,n=r,o=s)}return-1!==n?{distance:e[n].normal().scale(o),face:e[n]}:null},t.prototype.getBounds=function(){var t=this.getTransformedPoints(),e=t.reduce(function(t,e){return Math.min(t,e.x)},999999999),i=t.reduce(function(t,e){return Math.max(t,e.x)},-99999999),n=t.reduce(function(t,e){return Math.min(t,e.y)},9999999999),o=t.reduce(function(t,e){return Math.max(t,e.y)},-9999999999);return new Mt(e,n,i,o)},t.prototype.getMomentOfInertia=function(){for(var t=this.body?this.body.mass:j.defaultMass,e=0,i=0,n=0;n<this.points.length;n++){var o=(n+1)%this.points.length,r=this.points[o].cross(this.points[n]);e+=r*(this.points[n].dot(this.points[n])+this.points[n].dot(this.points[o])+this.points[o].dot(this.points[o])),i+=r}return t/6*(e/i)},t.prototype.rayCast=function(t,e){void 0===e&&(e=1/0);for(var i=this.getSides(),n=i.length,o=Number.MAX_VALUE,r=-1,s=0;s<n;s++){var a=t.intersect(i[s]);a>=0&&a<o&&a<=e&&(o=a,r=s)}return r>=0?t.getPoint(o):null},t.prototype.getAxes=function(){if(this._axes.length)return this._axes;for(var t=[],e=this.getTransformedPoints(),i=e.length,n=0;n<i;n++)t.push(e[n].sub(e[(n+1)%i]).normal());return this._axes=t,this._axes},t.prototype.testSeparatingAxisTheorem=function(t){for(var e=t,i=this.getAxes().concat(e.getAxes()),n=Number.MAX_VALUE,o=null,r=-1,s=0;s<i.length;s++){var a=this.project(i[s]),h=e.project(i[s]),c=a.getOverlap(h);if(c<=0)return null;c<n&&(n=c,o=i[s],r=s)}return-1===r?null:o.normalize().scale(n)},t.prototype.project=function(t){for(var e=this.getTransformedPoints(),i=e.length,n=Number.MAX_VALUE,o=-Number.MAX_VALUE,r=0;r<i;r++){var s=e[r].dot(t);n=Math.min(n,s),o=Math.max(o,s)}return new F(n,o)},t.prototype.debugDraw=function(t,e){void 0===e&&(e=Pt.Red.clone()),t.beginPath(),t.strokeStyle=e.toString();var i=this.getTransformedPoints()[0];t.moveTo(i.x,i.y),this.getTransformedPoints().forEach(function(e){t.lineTo(e.x,e.y)}),t.lineTo(i.x,i.y),t.closePath(),t.stroke()},t}(),Mt=function(){function t(t,e,i,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),this.left=t,this.top=e,this.right=i,this.bottom=n}return t.fromPoints=function(e){for(var i=1/0,n=1/0,o=-1/0,r=-1/0,s=0;s<e.length;s++)e[s].x<i&&(i=e[s].x),e[s].x>o&&(o=e[s].x),e[s].y<n&&(n=e[s].y),e[s].y>r&&(r=e[s].y);return new t(i,n,o,r)},t.prototype.getWidth=function(){return this.right-this.left},t.prototype.getHeight=function(){return this.bottom-this.top},t.prototype.rotate=function(e,i){void 0===i&&(i=O.Zero.clone());var n=this.getPoints().map(function(t){return t.rotate(e,i)});return t.fromPoints(n)},t.prototype.getPerimeter=function(){return 2*(this.getWidth()+this.getHeight())},t.prototype.getPoints=function(){var t=[];return t.push(new O(this.left,this.top)),t.push(new O(this.right,this.top)),t.push(new O(this.right,this.bottom)),t.push(new O(this.left,this.bottom)),t},t.prototype.toPolygon=function(t){return new Tt({body:t?t.body:null,points:this.getPoints(),pos:O.Zero.clone()})},t.prototype.rayCast=function(t,e){void 0===e&&(e=1/0);var i=-1/0,n=1/0,o=0===t.dir.x?Number.MAX_VALUE:1/t.dir.x,r=0===t.dir.y?Number.MAX_VALUE:1/t.dir.y,s=(this.left-t.pos.x)*o,a=(this.right-t.pos.x)*o;i=Math.min(s,a),n=Math.max(s,a);var h=(this.top-t.pos.y)*r,c=(this.bottom-t.pos.y)*r;return i=Math.max(i,Math.min(h,c)),(n=Math.min(n,Math.max(h,c)))>=Math.max(0,i)&&i<e},t.prototype.rayCastTime=function(t,e){void 0===e&&(e=1/0);var i=-1/0,n=1/0,o=0===t.dir.x?Number.MAX_VALUE:1/t.dir.x,r=0===t.dir.y?Number.MAX_VALUE:1/t.dir.y,s=(this.left-t.pos.x)*o,a=(this.right-t.pos.x)*o;i=Math.min(s,a),n=Math.max(s,a);var h=(this.top-t.pos.y)*r,c=(this.bottom-t.pos.y)*r;return i=Math.max(i,Math.min(h,c)),(n=Math.min(n,Math.max(h,c)))>=Math.max(0,i)&&i<e?i:-1},t.prototype.contains=function(e){return e instanceof O?this.left<=e.x&&this.top<=e.y&&this.bottom>=e.y&&this.right>=e.x:e instanceof t&&this.left<e.left&&this.top<e.top&&e.bottom<this.bottom&&e.right<this.right},t.prototype.combine=function(e){return new t(Math.min(this.left,e.left),Math.min(this.top,e.top),Math.max(this.right,e.right),Math.max(this.bottom,e.bottom))},t.prototype.collides=function(e){if(e instanceof t){var i=e,n=this.combine(i);if(n.getWidth()<i.getWidth()+this.getWidth()&&n.getHeight()<i.getHeight()+this.getHeight()){var o;o=this.right>=i.left&&this.right<=i.right?i.left-this.right:i.right-this.left;var r;return r=this.top<=i.bottom&&this.top>=i.top?i.bottom-this.top:i.top-this.bottom,Math.abs(o)<Math.abs(r)?new O(o,0):new O(0,r)}return null}return null},t.prototype.debugDraw=function(t,e){void 0===e&&(e=Pt.Yellow),t.strokeStyle=e.toString(),t.strokeRect(this.left,this.top,this.getWidth(),this.getHeight())},t}();!function(t){t[t.Debug=0]="Debug",t[t.Info=1]="Info",t[t.Warn=2]="Warn",t[t.Error=3]="Error",t[t.Fatal=4]="Fatal"}(H||(H={}));var Dt=function(){function t(){if(this._appenders=[],this.defaultLevel=H.Info,t._instance)throw new Error("Logger is a singleton");return t._instance=this,t._instance.addAppender(new Bt),t._instance}return t.getInstance=function(){return null==t._instance&&(t._instance=new t),t._instance},t.prototype.addAppender=function(t){this._appenders.push(t)},t.prototype.clearAppenders=function(){this._appenders.length=0},t.prototype._log=function(t,e){null==t&&(t=this.defaultLevel);for(var i=0,n=this._appenders.length;i<n;i++)t>=this.defaultLevel&&this._appenders[i].log(t,e)},t.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._log(H.Debug,t)},t.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._log(H.Info,t)},t.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._log(H.Warn,t)},t.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._log(H.Error,t)},t.prototype.fatal=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._log(H.Fatal,t)},t._instance=null,t}(),Bt=function(){function t(){}return t.prototype.log=function(t,e){if(console||console.log||!console.warn||!console.error){var i=[];i.unshift.apply(i,e),i.unshift("["+H[t]+"] : "),t<H.Warn?console.log.apply?console.log.apply(console,i):console.log(i.join(" ")):t<H.Error?console.warn.apply?console.warn.apply(console,i):console.warn(i.join(" ")):console.error.apply?console.error.apply(console,i):console.error(i.join(" "))}},t}(),Ot=function(){function t(t,e){this._messages=[],this._canvas=document.createElement("canvas"),this._canvas.width=t||window.innerWidth,this._canvas.height=e||window.innerHeight,this._canvas.style.position="absolute",this._ctx=this._canvas.getContext("2d"),document.body.appendChild(this._canvas)}return t.prototype.log=function(t,e){var i=e.join(",");this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._messages.unshift("["+H[t]+"] : "+i);for(var n=10,o=1,r=0;r<this._messages.length;r++)this._ctx.fillStyle="rgba(255,255,255,"+o.toFixed(2)+")",this._ctx.fillText(this._messages[r],200,n),n+=10,o=o>0?o-.05:0},t}(),Rt=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),zt=function(t){function e(e,i,n){void 0===n&&(n=!0);var o=t.call(this)||this;return o.path=e,o.responseType=i,o.bustCache=n,o.data=null,o.logger=Dt.getInstance(),o.onprogress=function(){},o.oncomplete=function(){},o.onerror=function(){},o}return Rt(e,t),e.prototype.isLoaded=function(){return null!==this.data},e.prototype.wireEngine=function(t){},e.prototype._cacheBust=function(t){return/\?\w*=\w*/.test(t)?t+="&__="+Date.now():t+="?__="+Date.now(),t},e.prototype._start=function(){this.logger.debug("Started loading resource "+this.path)},e.prototype.load=function(){var t=this,e=new p;if(null!==this.data)return this.logger.debug("Already have data for resource",this.path),e.resolve(this.data),this.oncomplete(),e;var i=new XMLHttpRequest;return i.open("GET",this.bustCache?this._cacheBust(this.path):this.path,!0),i.responseType=this.responseType,i.onloadstart=function(){t._start()},i.onprogress=this.onprogress,i.onerror=this.onerror,i.onload=function(){if(0!==i.status&&200!==i.status)return t.logger.error("Failed to load resource ",t.path," server responded with error code",i.status),t.onerror(i.response),void e.resolve(i.response);t.data=t.processData(i.response),t.oncomplete(),t.logger.debug("Completed loading resource",t.path),e.resolve(t.data)},i.send(),e},e.prototype.getData=function(){return this.data},e.prototype.setData=function(t){this.data=this.processData(t)},e.prototype.processData=function(t){return"blob"===this.responseType?URL.createObjectURL(t):t},e}(xt),Ft=function(){function t(){}return t.prototype.updatePixel=function(t,e,i){var n=4*(t+e*i.width),o=i.data,r=(o[n+0]+o[n+1]+o[n+2])/3;o[n+0]=r,o[n+1]=r,o[n+2]=r},t}(),It=function(){function t(){}return t.prototype.updatePixel=function(t,e,i){var n=4*(t+e*i.width),o=i.data;o[n+0]=255-o[n+0],o[n+1]=255-o[n+1],o[n+2]=255-o[n+2]},t}(),Lt=function(){function t(t){this.opacity=t}return t.prototype.updatePixel=function(t,e,i){var n=4*(t+e*i.width),o=i.data;0!==o[n+3]&&(o[n+3]=Math.round(this.opacity*o[n+3]))},t}(),Ht=function(){function t(t){this.color=t}return t.prototype.updatePixel=function(t,e,i){var n=4*(t+e*i.width),o=i.data;0!==o[n+3]&&(o[n+0]=(o[n+0]+this.color.r)/2,o[n+1]=(o[n+1]+this.color.g)/2,o[n+2]=(o[n+2]+this.color.b)/2)},t}(),jt=function(){function t(t){void 0===t&&(t=.1),this.factor=t}return t.prototype.updatePixel=function(t,e,i){var n=4*(t+e*i.width),o=i.data,r=Pt.fromRGB(o[n+0],o[n+1],o[n+2],o[n+3]).lighten(this.factor);o[n+0]=r.r,o[n+1]=r.g,o[n+2]=r.b,o[n+3]=r.a},t}(),Ut=function(){function t(t){void 0===t&&(t=.1),this.factor=t}return t.prototype.updatePixel=function(t,e,i){var n=4*(t+e*i.width),o=i.data,r=Pt.fromRGB(o[n+0],o[n+1],o[n+2],o[n+3]).darken(this.factor);o[n+0]=r.r,o[n+1]=r.g,o[n+2]=r.b,o[n+3]=r.a},t}(),Wt=function(){function t(t){void 0===t&&(t=.1),this.factor=t}return t.prototype.updatePixel=function(t,e,i){var n=4*(t+e*i.width),o=i.data,r=Pt.fromRGB(o[n+0],o[n+1],o[n+2],o[n+3]).saturate(this.factor);o[n+0]=r.r,o[n+1]=r.g,o[n+2]=r.b,o[n+3]=r.a},t}(),Nt=function(){function t(t){void 0===t&&(t=.1),this.factor=t}return t.prototype.updatePixel=function(t,e,i){var n=4*(t+e*i.width),o=i.data,r=Pt.fromRGB(o[n+0],o[n+1],o[n+2],o[n+3]).desaturate(this.factor);o[n+0]=r.r,o[n+1]=r.g,o[n+2]=r.b,o[n+3]=r.a},t}(),qt=function(){function t(t){this.color=t}return t.prototype.updatePixel=function(t,e,i){var n=4*(t+e*i.width),o=i.data;0!==o[n+3]&&(o[n+0]=this.color.r,o[n+1]=this.color.g,o[n+2]=this.color.b)},t}(),Xt=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();function Vt(t){return function(t){function e(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];var n=t.apply(this,e)||this;return 1!==e.filter(function(t){return void 0!==t}).length||!e[0]||"object"!=typeof e[0]||e[0]instanceof Array||n.assign(e[0]),n}return Xt(e,t),e.prototype.assign=function(t){for(var e in t)"function"!=typeof this[e]&&(this[e]=t[e])},e}(t)}var Gt,Zt=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Kt=function(t){function e(e,i,n,o,r){return t.call(this,e,i,n,o,r)||this}return Zt(e,t),e}(Vt(function(){function t(t,e,i,n,o){var r=this;this.x=0,this.y=0,this.rotation=0,this.anchor=new O(0,0),this.scale=new O(1,1),this.logger=Dt.getInstance(),this.flipVertical=!1,this.flipHorizontal=!1,this.effects=[],this.width=0,this.height=0,this._spriteCanvas=null,this._spriteCtx=null,this._pixelData=null,this._pixelsLoaded=!1,this._dirtyEffect=!1;var s=t;if(t&&!(t instanceof Qt)&&(e=0|t.x,i=0|t.y,n=0|t.width,o=0|t.height,!(s=t.image)))throw new Error("An image texture is required to contsruct a sprite");this.x=e||0,this.y=i||0,this._texture=s,this._spriteCanvas=document.createElement("canvas"),this._spriteCanvas.width=n,this._spriteCanvas.height=o,this._spriteCtx=this._spriteCanvas.getContext("2d"),this._texture.loaded.then(function(){r.width=r.width||r._texture.image.naturalWidth,r.height=r.height||r._texture.image.naturalHeight,r._spriteCanvas.width=r._spriteCanvas.width||r._texture.image.naturalWidth,r._spriteCanvas.height=r._spriteCanvas.height||r._texture.image.naturalHeight,r._loadPixels(),r._dirtyEffect=!0}).error(function(t){r.logger.error("Error loading texture ",r._texture.path,t)}),this.width=n,this.height=o}return Object.defineProperty(t.prototype,"drawWidth",{get:function(){return this.width*this.scale.x},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"drawHeight",{get:function(){return this.height*this.scale.y},enumerable:!0,configurable:!0}),t.prototype._loadPixels=function(){if(this._texture.isLoaded()&&!this._pixelsLoaded){var t=this._texture.image.naturalWidth||0,e=this._texture.image.naturalHeight||0;if(this.width>t&&this.logger.warn("The sprite width "+this.width+" exceeds the width \n                              "+t+" of the backing texture "+this._texture.path),this.width<=0||t<=0)throw new Error("The width of a sprite cannot be 0 or negative, sprite width: "+this.width+", original width: "+t);if(this.height>e&&this.logger.warn("The sprite height "+this.height+" exceeds the height \n                              "+e+" of the backing texture "+this._texture.path),this.height<=0||e<=0)throw new Error("The height of a sprite cannot be 0 or negative, sprite height: "+this.height+", original height: "+e);this._spriteCtx.drawImage(this._texture.image,y(this.x,0,t),y(this.y,0,e),y(this.width,0,t),y(this.height,0,e),0,0,this.width,this.height),this._pixelsLoaded=!0}},t.prototype.opacity=function(t){this.addEffect(new Lt(t))},t.prototype.grayscale=function(){this.addEffect(new Ft)},t.prototype.invert=function(){this.addEffect(new It)},t.prototype.fill=function(t){this.addEffect(new qt(t))},t.prototype.colorize=function(t){this.addEffect(new Ht(t))},t.prototype.lighten=function(t){void 0===t&&(t=.1),this.addEffect(new jt(t))},t.prototype.darken=function(t){void 0===t&&(t=.1),this.addEffect(new Ut(t))},t.prototype.saturate=function(t){void 0===t&&(t=.1),this.addEffect(new Wt(t))},t.prototype.desaturate=function(t){void 0===t&&(t=.1),this.addEffect(new Nt(t))},t.prototype.addEffect=function(t){this.effects.push(t),this._texture.isLoaded()&&this._pixelsLoaded?this._applyEffects():this._dirtyEffect=!0},t.prototype.removeEffect=function(t){var e;(e="number"==typeof t?t:this.effects.indexOf(t))<0||e>=this.effects.length||(this.effects.splice(e,1),this._texture.isLoaded()&&this._pixelsLoaded?this._applyEffects():this._dirtyEffect=!0)},t.prototype._applyEffects=function(){var t=this._texture.image.naturalWidth||0,e=this._texture.image.naturalHeight||0;this._spriteCtx.clearRect(0,0,this.width,this.height),this._spriteCtx.drawImage(this._texture.image,y(this.x,0,t),y(this.y,0,e),y(this.width,0,t),y(this.height,0,e),0,0,this.width,this.height),this._pixelData=this._spriteCtx.getImageData(0,0,this.width,this.height);for(var i=0,n=0,o=0,r=this.effects.length;i<r;i++)for(o=0;o<this.height;o++)for(n=0;n<this.width;n++)this.effects[i].updatePixel(n,o,this._pixelData);this._spriteCtx.clearRect(0,0,this.width,this.height),this._spriteCtx.putImageData(this._pixelData,0,0),this._dirtyEffect=!1},t.prototype.clearEffects=function(){this.effects.length=0,this._applyEffects()},t.prototype.reset=function(){},t.prototype.debugDraw=function(t,e,i){t.save(),t.translate(e,i),t.rotate(this.rotation);var n=this.drawWidth*this.anchor.x,o=this.drawHeight*this.anchor.y;t.strokeStyle=Pt.Black.toString(),t.strokeRect(-n,-o,this.drawWidth,this.drawHeight),t.restore()},t.prototype.draw=function(t,e,i){this._dirtyEffect&&this._applyEffects(),t.save();var n=this.drawWidth*this.anchor.x,o=this.drawHeight*this.anchor.y;t.translate(e,i),t.rotate(this.rotation),this.flipHorizontal&&(t.translate(this.drawWidth,0),t.scale(-1,1)),this.flipVertical&&(t.translate(0,this.drawHeight),t.scale(1,-1)),t.drawImage(this._spriteCanvas,0,0,this.width,this.height,-n,-o,this.drawWidth,this.drawHeight),t.restore()},t.prototype.clone=function(){var t=new Kt(this._texture,this.x,this.y,this.width,this.height);t.scale=this.scale.clone(),t.rotation=this.rotation,t.flipHorizontal=this.flipHorizontal,t.flipVertical=this.flipVertical;for(var e=0,i=this.effects.length;e<i;e++)t.addEffect(this.effects[e]);return t},t}())),Yt=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Qt=function(t){function e(e,i){void 0===i&&(i=!0);var n=t.call(this,e,"blob",i)||this;return n.path=e,n.bustCache=i,n.loaded=new p,n._isLoaded=!1,n._sprite=null,n._sprite=new Kt(n,0,0,0,0),n}return Yt(e,t),e.prototype.isLoaded=function(){return this._isLoaded},e.prototype.load=function(){var e=this,i=new p;return t.prototype.load.call(this).then(function(){e.image=new Image,e.image.addEventListener("load",function(){e._isLoaded=!0,e.width=e._sprite.width=e.image.naturalWidth,e.height=e._sprite.height=e.image.naturalHeight,e.loaded.resolve(e.image),i.resolve(e.image)}),e.image.src=t.prototype.getData.call(e)},function(){i.reject("Error loading texture.")}),i},e.prototype.asSprite=function(){return this._sprite},e}(zt);!function(t){t[t.ShortestPath=0]="ShortestPath",t[t.LongestPath=1]="LongestPath",t[t.Clockwise=2]="Clockwise",t[t.CounterClockwise=3]="CounterClockwise"}(Gt||(Gt={}));var Jt=function(){function t(t,e,i,n,o){this.actor=t,this.easingFcn=o,this._currentLerpTime=0,this._lerpDuration=1e3,this._lerpStart=new O(0,0),this._lerpEnd=new O(0,0),this._initialized=!1,this._stopped=!1,this._distance=0,this._lerpDuration=n,this._lerpEnd=new O(e,i)}return t.prototype._initialize=function(){this._lerpStart=new O(this.actor.pos.x,this.actor.pos.y),this._currentLerpTime=0,this._distance=this._lerpStart.distance(this._lerpEnd)},t.prototype.update=function(t){this._initialized||(this._initialize(),this._initialized=!0);var e=this.actor.pos.x,i=this.actor.pos.y;this._currentLerpTime<this._lerpDuration?(e=this._lerpEnd.x<this._lerpStart.x?this._lerpStart.x-(this.easingFcn(this._currentLerpTime,this._lerpEnd.x,this._lerpStart.x,this._lerpDuration)-this._lerpEnd.x):this.easingFcn(this._currentLerpTime,this._lerpStart.x,this._lerpEnd.x,this._lerpDuration),i=this._lerpEnd.y<this._lerpStart.y?this._lerpStart.y-(this.easingFcn(this._currentLerpTime,this._lerpEnd.y,this._lerpStart.y,this._lerpDuration)-this._lerpEnd.y):this.easingFcn(this._currentLerpTime,this._lerpStart.y,this._lerpEnd.y,this._lerpDuration),this.actor.pos.x=e,this.actor.pos.y=i,this._currentLerpTime+=t):(this.actor.pos.x=this._lerpEnd.x,this.actor.pos.y=this._lerpEnd.y)},t.prototype.isComplete=function(t){return this._stopped||new O(t.pos.x,t.pos.y).distance(this._lerpStart)>=this._distance},t.prototype.reset=function(){this._initialized=!1},t.prototype.stop=function(){this._stopped=!0},t}(),$t=function(){function t(t,e,i,n){this._started=!1,this._stopped=!1,this._actor=t,this._end=new O(e,i),this._speed=n}return t.prototype.update=function(t){this._started||(this._started=!0,this._start=new O(this._actor.pos.x,this._actor.pos.y),this._distance=this._start.distance(this._end),this._dir=this._end.sub(this._start).normalize());var e=this._dir.scale(this._speed);this._actor.vel.x=e.x,this._actor.vel.y=e.y,this.isComplete(this._actor)&&(this._actor.pos.x=this._end.x,this._actor.pos.y=this._end.y,this._actor.vel.y=0,this._actor.vel.x=0)},t.prototype.isComplete=function(t){return this._stopped||new O(t.pos.x,t.pos.y).distance(this._start)>=this._distance},t.prototype.stop=function(){this._actor.vel.y=0,this._actor.vel.x=0,this._stopped=!0},t.prototype.reset=function(){this._started=!1},t}(),te=function(){function t(t,e,i,n){if(this._started=!1,this._stopped=!1,this._actor=t,this._end=new O(e,i),n<=0)throw Dt.getInstance().error("Attempted to moveBy time less than or equal to zero : "+n),new Error("Cannot move in time <= 0");this._time=n}return t.prototype.update=function(t){this._started||(this._started=!0,this._start=new O(this._actor.pos.x,this._actor.pos.y),this._distance=this._start.distance(this._end),this._dir=this._end.sub(this._start).normalize(),this._speed=this._distance/(this._time/1e3));var e=this._dir.scale(this._speed);this._actor.vel.x=e.x,this._actor.vel.y=e.y,this.isComplete(this._actor)&&(this._actor.pos.x=this._end.x,this._actor.pos.y=this._end.y,this._actor.vel.y=0,this._actor.vel.x=0)},t.prototype.isComplete=function(t){return this._stopped||new O(t.pos.x,t.pos.y).distance(this._start)>=this._distance},t.prototype.stop=function(){this._actor.vel.y=0,this._actor.vel.x=0,this._stopped=!0},t.prototype.reset=function(){this._started=!1},t}(),ee=function(){function t(t,e,i){this._started=!1,this._stopped=!1,this._actor=t,this._actorToFollow=e,this._current=new O(this._actor.pos.x,this._actor.pos.y),this._end=new O(e.pos.x,e.pos.y),this._maximumDistance=void 0!==i?i:this._current.distance(this._end),this._speed=0}return t.prototype.update=function(t){this._started||(this._started=!0,this._distanceBetween=this._current.distance(this._end),this._dir=this._end.sub(this._current).normalize());var e=Math.sqrt(Math.pow(this._actorToFollow.vel.x,2)+Math.pow(this._actorToFollow.vel.y,2));if(0!==e&&(this._speed=e),this._current.x=this._actor.pos.x,this._current.y=this._actor.pos.y,this._end.x=this._actorToFollow.pos.x,this._end.y=this._actorToFollow.pos.y,this._distanceBetween=this._current.distance(this._end),this._dir=this._end.sub(this._current).normalize(),this._distanceBetween>=this._maximumDistance){var i=this._dir.scale(this._speed);this._actor.vel.x=i.x,this._actor.vel.y=i.y}else this._actor.vel.x=0,this._actor.vel.y=0;this.isComplete()&&(this._actor.pos.x=this._end.x,this._actor.pos.y=this._end.y,this._actor.vel.y=0,this._actor.vel.x=0)},t.prototype.stop=function(){this._actor.vel.y=0,this._actor.vel.x=0,this._stopped=!0},t.prototype.isComplete=function(){return this._stopped},t.prototype.reset=function(){this._started=!1},t}(),ie=function(){function t(t,e,i){this._started=!1,this._stopped=!1,this._speedWasSpecified=!1,this._actor=t,this._actorToMeet=e,this._current=new O(this._actor.pos.x,this._actor.pos.y),this._end=new O(e.pos.x,e.pos.y),this._speed=i||0,void 0!==i&&(this._speedWasSpecified=!0)}return t.prototype.update=function(t){this._started||(this._started=!0,this._distanceBetween=this._current.distance(this._end),this._dir=this._end.sub(this._current).normalize());var e=Math.sqrt(Math.pow(this._actorToMeet.vel.x,2)+Math.pow(this._actorToMeet.vel.y,2));0===e||this._speedWasSpecified||(this._speed=e),this._current.x=this._actor.pos.x,this._current.y=this._actor.pos.y,this._end.x=this._actorToMeet.pos.x,this._end.y=this._actorToMeet.pos.y,this._distanceBetween=this._current.distance(this._end),this._dir=this._end.sub(this._current).normalize();var i=this._dir.scale(this._speed);this._actor.vel.x=i.x,this._actor.vel.y=i.y,this.isComplete()&&(this._actor.pos.x=this._end.x,this._actor.pos.y=this._end.y,this._actor.vel.y=0,this._actor.vel.x=0)},t.prototype.isComplete=function(){return this._stopped||this._distanceBetween<=1},t.prototype.stop=function(){this._actor.vel.y=0,this._actor.vel.x=0,this._stopped=!0},t.prototype.reset=function(){this._started=!1},t}(),ne=function(){function t(t,e,i,n){this._started=!1,this._stopped=!1,this._actor=t,this._end=e,this._speed=i,this._rotationType=n||Gt.ShortestPath}return t.prototype.update=function(t){if(!this._started){this._started=!0,this._start=this._actor.rotation;var e=Math.abs(this._end-this._start),i=f-e;switch(e>i?(this._shortDistance=i,this._longDistance=e):(this._shortDistance=e,this._longDistance=i),this._shortestPathIsPositive=(this._start-this._end+f)%f>=Math.PI,this._rotationType){case Gt.ShortestPath:this._distance=this._shortDistance,this._shortestPathIsPositive?this._direction=1:this._direction=-1;break;case Gt.LongestPath:this._distance=this._longDistance,this._shortestPathIsPositive?this._direction=-1:this._direction=1;break;case Gt.Clockwise:this._direction=1,this._shortestPathIsPositive?this._distance=this._shortDistance:this._distance=this._longDistance;break;case Gt.CounterClockwise:this._direction=-1,this._shortestPathIsPositive?this._distance=this._longDistance:this._distance=this._shortDistance}}this._actor.rx=this._direction*this._speed,this.isComplete()&&(this._actor.rotation=this._end,this._actor.rx=0,this._stopped=!0)},t.prototype.isComplete=function(){var t=Math.abs(this._actor.rotation-this._start);return this._stopped||t>=Math.abs(this._distance)},t.prototype.stop=function(){this._actor.rx=0,this._stopped=!0},t.prototype.reset=function(){this._started=!1},t}(),oe=function(){function t(t,e,i,n){this._started=!1,this._stopped=!1,this._actor=t,this._end=e,this._time=i,this._rotationType=n||Gt.ShortestPath}return t.prototype.update=function(t){if(!this._started){this._started=!0,this._start=this._actor.rotation;var e=Math.abs(this._end-this._start),i=f-e;switch(e>i?(this._shortDistance=i,this._longDistance=e):(this._shortDistance=e,this._longDistance=i),this._shortestPathIsPositive=(this._start-this._end+f)%f>=Math.PI,this._rotationType){case Gt.ShortestPath:this._distance=this._shortDistance,this._shortestPathIsPositive?this._direction=1:this._direction=-1;break;case Gt.LongestPath:this._distance=this._longDistance,this._shortestPathIsPositive?this._direction=-1:this._direction=1;break;case Gt.Clockwise:this._direction=1,this._shortDistance>=0?this._distance=this._shortDistance:this._distance=this._longDistance;break;case Gt.CounterClockwise:this._direction=-1,this._shortDistance<=0?this._distance=this._shortDistance:this._distance=this._longDistance}this._speed=Math.abs(this._distance/this._time*1e3)}this._actor.rx=this._direction*this._speed,this.isComplete()&&(this._actor.rotation=this._end,this._actor.rx=0,this._stopped=!0)},t.prototype.isComplete=function(){var t=Math.abs(this._actor.rotation-this._start);return this._stopped||t>=Math.abs(this._distance)},t.prototype.stop=function(){this._actor.rx=0,this._stopped=!0},t.prototype.reset=function(){this._started=!1},t}(),re=function(){function t(t,e,i,n,o){this._started=!1,this._stopped=!1,this._actor=t,this._endX=e,this._endY=i,this._speedX=n,this._speedY=o}return t.prototype.update=function(t){if(this._started||(this._started=!0,this._startX=this._actor.scale.x,this._startY=this._actor.scale.y,this._distanceX=Math.abs(this._endX-this._startX),this._distanceY=Math.abs(this._endY-this._startY)),Math.abs(this._actor.scale.x-this._startX)>=this._distanceX)this._actor.sx=0;else{var e=this._endY<this._startY?-1:1;this._actor.sx=this._speedX*e}if(Math.abs(this._actor.scale.y-this._startY)>=this._distanceY)this._actor.sy=0;else{var i=this._endY<this._startY?-1:1;this._actor.sy=this._speedY*i}this.isComplete()&&(this._actor.scale.x=this._endX,this._actor.scale.y=this._endY,this._actor.sx=0,this._actor.sy=0)},t.prototype.isComplete=function(){return this._stopped||Math.abs(this._actor.scale.y-this._startX)>=this._distanceX&&Math.abs(this._actor.scale.y-this._startY)>=this._distanceY},t.prototype.stop=function(){this._actor.sx=0,this._actor.sy=0,this._stopped=!0},t.prototype.reset=function(){this._started=!1},t}(),se=function(){function t(t,e,i,n){this._started=!1,this._stopped=!1,this._actor=t,this._endX=e,this._endY=i,this._speedX=(this._endX-this._actor.scale.x)/n*1e3,this._speedY=(this._endY-this._actor.scale.y)/n*1e3}return t.prototype.update=function(t){this._started||(this._started=!0,this._startX=this._actor.scale.x,this._startY=this._actor.scale.y,this._distanceX=Math.abs(this._endX-this._startX),this._distanceY=Math.abs(this._endY-this._startY));var e=this._endX<this._startX?-1:1,i=this._endY<this._startY?-1:1;this._actor.sx=this._speedX*e,this._actor.sy=this._speedY*i,this.isComplete()&&(this._actor.scale.x=this._endX,this._actor.scale.y=this._endY,this._actor.sx=0,this._actor.sy=0)},t.prototype.isComplete=function(){return this._stopped||Math.abs(this._actor.scale.x-this._startX)>=this._distanceX&&Math.abs(this._actor.scale.y-this._startY)>=this._distanceY},t.prototype.stop=function(){this._actor.sx=0,this._actor.sy=0,this._stopped=!0},t.prototype.reset=function(){this._started=!1},t}(),ae=function(){function t(t,e){this._elapsedTime=0,this._started=!1,this._stopped=!1,this._actor=t,this._delay=e}return t.prototype.update=function(t){this._started||(this._started=!0),this.x=this._actor.pos.x,this.y=this._actor.pos.y,this._elapsedTime+=t},t.prototype.isComplete=function(){return this._stopped||this._elapsedTime>=this._delay},t.prototype.stop=function(){this._stopped=!0},t.prototype.reset=function(){this._elapsedTime=0,this._started=!1},t}(),he=function(){function t(t,e,i,n){void 0===n&&(n=1),this._timeVisible=0,this._timeNotVisible=0,this._elapsedTime=0,this._totalTime=0,this._stopped=!1,this._started=!1,this._actor=t,this._timeVisible=e,this._timeNotVisible=i,this._duration=(e+i)*n}return t.prototype.update=function(t){this._started||(this._started=!0),this._elapsedTime+=t,this._totalTime+=t,this._actor.visible&&this._elapsedTime>=this._timeVisible&&(this._actor.visible=!1,this._elapsedTime=0),!this._actor.visible&&this._elapsedTime>=this._timeNotVisible&&(this._actor.visible=!0,this._elapsedTime=0),this.isComplete()&&(this._actor.visible=!0)},t.prototype.isComplete=function(){return this._stopped||this._totalTime>=this._duration},t.prototype.stop=function(){this._actor.visible=!0,this._stopped=!0},t.prototype.reset=function(){this._started=!1,this._elapsedTime=0,this._totalTime=0},t}(),ce=function(){function t(t,e,i){this._multiplier=1,this._started=!1,this._stopped=!1,this._actor=t,this._endOpacity=e,this._speed=i}return t.prototype.update=function(t){this._started||(this._started=!0,this._endOpacity<this._actor.opacity?this._multiplier=-1:this._multiplier=1),this._speed>0&&(this._actor.opacity+=this._multiplier*(Math.abs(this._actor.opacity-this._endOpacity)*t)/this._speed),this._speed-=t,this.isComplete()&&(this._actor.opacity=this._endOpacity),Dt.getInstance().debug("[Action fade] Actor opacity:",this._actor.opacity)},t.prototype.isComplete=function(){return this._stopped||Math.abs(this._actor.opacity-this._endOpacity)<.05},t.prototype.stop=function(){this._stopped=!0},t.prototype.reset=function(){this._started=!1},t}(),ue=function(){function t(t){this._stopped=!1,this._actor=t}return t.prototype.update=function(t){this._actor.actionQueue.clearActions(),this._actor.kill(),this._stopped=!0},t.prototype.isComplete=function(){return this._stopped},t.prototype.stop=function(){},t.prototype.reset=function(){},t}(),le=function(){function t(t,e){this._method=null,this._actor=null,this._hasBeenCalled=!1,this._actor=t,this._method=e}return t.prototype.update=function(t){this._method.call(this._actor),this._hasBeenCalled=!0},t.prototype.isComplete=function(){return this._hasBeenCalled},t.prototype.reset=function(){this._hasBeenCalled=!1},t.prototype.stop=function(){this._hasBeenCalled=!0},t}(),pe=function(){function t(t,e,i){this._stopped=!1,this._actor=t,this._actionQueue=new fe(t),this._repeat=e,this._originalRepeat=e;for(var n=0,o=i.length;n<o;n++)i[n].reset(),this._actionQueue.add(i[n])}return t.prototype.update=function(t){this.x=this._actor.pos.x,this.y=this._actor.pos.y,this._actionQueue.hasNext()||(this._actionQueue.reset(),this._repeat--),this._actionQueue.update(t)},t.prototype.isComplete=function(){return this._stopped||this._repeat<=0},t.prototype.stop=function(){this._stopped=!0},t.prototype.reset=function(){this._repeat=this._originalRepeat},t}(),de=function(){function t(t,e){this._stopped=!1,this._actor=t,this._actionQueue=new fe(t);for(var i=0,n=e.length;i<n;i++)e[i].reset(),this._actionQueue.add(e[i])}return t.prototype.update=function(t){this.x=this._actor.pos.x,this.y=this._actor.pos.y,this._stopped||(this._actionQueue.hasNext()||this._actionQueue.reset(),this._actionQueue.update(t))},t.prototype.isComplete=function(){return this._stopped},t.prototype.stop=function(){this._stopped=!0,this._actionQueue.clearActions()},t.prototype.reset=function(){},t}(),fe=function(){function t(t){this._actions=[],this._completedActions=[],this._actor=t}return t.prototype.add=function(t){this._actions.push(t)},t.prototype.remove=function(t){var e=this._actions.indexOf(t);this._actions.splice(e,1)},t.prototype.clearActions=function(){this._actions.length=0,this._completedActions.length=0,this._currentAction&&this._currentAction.stop()},t.prototype.getActions=function(){return this._actions.concat(this._completedActions)},t.prototype.hasNext=function(){return this._actions.length>0},t.prototype.reset=function(){this._actions=this.getActions();for(var t=0,e=this._actions.length;t<e;t++)this._actions[t].reset();this._completedActions=[]},t.prototype.update=function(t){this._actions.length>0&&(this._currentAction=this._actions[0],this._currentAction.update(t),this._currentAction.isComplete(this._actor)&&this._completedActions.push(this._actions.shift()))},t}(),_e=function(){function t(){}return t.CreateReversableEasingFunction=function(t){return function(e,i,n,o){return n<i?i-(t(e,n,i,o)-n):t(e,i,n,o)}},t.CreateVectorEasingFunction=function(t){return function(e,i,n,o){return new O(t(e,i.x,n.x,o),t(e,i.y,n.y,o))}},t.Linear=t.CreateReversableEasingFunction(function(t,e,i,n){return(i-=e)*t/n+e}),t.EaseInQuad=t.CreateReversableEasingFunction(function(t,e,i,n){return(i-=e)*(t/=n)*t+e}),t.EaseOutQuad=t.CreateReversableEasingFunction(function(t,e,i,n){return-(i-=e)*(t/=n)*(t-2)+e}),t.EaseInOutQuad=t.CreateReversableEasingFunction(function(t,e,i,n){return i-=e,(t/=n/2)<1?i/2*t*t+e:-i/2*(--t*(t-2)-1)+e}),t.EaseInCubic=t.CreateReversableEasingFunction(function(t,e,i,n){return(i-=e)*(t/=n)*t*t+e}),t.EaseOutCubic=t.CreateReversableEasingFunction(function(t,e,i,n){return t/=n,(i-=e)*(--t*t*t+1)+e}),t.EaseInOutCubic=t.CreateReversableEasingFunction(function(t,e,i,n){return i-=e,(t/=n/2)<1?i/2*t*t*t+e:i/2*((t-=2)*t*t+2)+e}),t}(),ge=function(){function t(){this._actors=[],this._queues=[],null!==arguments&&(this._actors=Array.prototype.slice.call(arguments,0),this._queues=this._actors.map(function(t){return t.actionQueue}))}return t.prototype.clearActions=function(){for(var t=0,e=this._queues.length;t<e;t++)this._queues[t].clearActions()},t.prototype.addActorToContext=function(t){this._actors.push(t),this._queues.push(t.actionQueue)},t.prototype.removeActorFromContext=function(t){var e=this._actors.indexOf(t);e>-1&&(this._actors.splice(e,1),this._queues.splice(e,1))},t.prototype.easeTo=function(t,e,i,n){void 0===n&&(n=_e.Linear);for(var o=0,r=this._queues.length;o<r;o++)this._queues[o].add(new Jt(this._actors[o],t,e,i,n));return this},t.prototype.moveTo=function(t,e,i){for(var n=0,o=this._queues.length;n<o;n++)this._queues[n].add(new $t(this._actors[n],t,e,i));return this},t.prototype.moveBy=function(t,e,i){for(var n=0,o=this._queues.length;n<o;n++)this._queues[n].add(new te(this._actors[n],t,e,i));return this},t.prototype.rotateTo=function(t,e,i){for(var n=0,o=this._queues.length;n<o;n++)this._queues[n].add(new ne(this._actors[n],t,e,i));return this},t.prototype.rotateBy=function(t,e,i){for(var n=0,o=this._queues.length;n<o;n++)this._queues[n].add(new oe(this._actors[n],t,e,i));return this},t.prototype.scaleTo=function(t,e,i,n){for(var o=0,r=this._queues.length;o<r;o++)this._queues[o].add(new re(this._actors[o],t,e,i,n));return this},t.prototype.scaleBy=function(t,e,i){for(var n=0,o=this._queues.length;n<o;n++)this._queues[n].add(new se(this._actors[n],t,e,i));return this},t.prototype.blink=function(t,e,i){void 0===i&&(i=1);for(var n=0,o=this._queues.length;n<o;n++)this._queues[n].add(new he(this._actors[n],t,e,i));return this},t.prototype.fade=function(t,e){for(var i=0,n=this._queues.length;i<n;i++)this._queues[i].add(new ce(this._actors[i],t,e));return this},t.prototype.delay=function(t){for(var e=0,i=this._queues.length;e<i;e++)this._queues[e].add(new ae(this._actors[e],t));return this},t.prototype.die=function(){for(var t=0,e=this._queues.length;t<e;t++)this._queues[t].add(new ue(this._actors[t]));return this},t.prototype.callMethod=function(t){for(var e=0,i=this._queues.length;e<i;e++)this._queues[e].add(new le(this._actors[e],t));return this},t.prototype.repeat=function(t){if(!t)return this.repeatForever(),this;for(var e=0,i=this._queues.length;e<i;e++)this._queues[e].add(new pe(this._actors[e],t,this._actors[e].actionQueue.getActions()));return this},t.prototype.repeatForever=function(){for(var t=0,e=this._queues.length;t<e;t++)this._queues[t].add(new de(this._actors[t],this._actors[t].actionQueue.getActions()));return this},t.prototype.follow=function(t,e){for(var i=0,n=this._queues.length;i<n;i++)void 0===e?this._queues[i].add(new ee(this._actors[i],t)):this._queues[i].add(new ee(this._actors[i],t,e));return this},t.prototype.meet=function(t,e){for(var i=0,n=this._queues.length;i<n;i++)void 0===e?this._queues[i].add(new ie(this._actors[i],t)):this._queues[i].add(new ie(this._actors[i],t,e));return this},t.prototype.asPromise=function(){var t=this,e=this._queues.map(function(e,i){var n=new p;return e.add(new le(t._actors[i],function(){n.resolve()})),n});return p.join.apply(this,e)},t}();function ye(t,e,i,n,o,r,s,a){void 0===e&&(e=Pt.Red.clone()),void 0===s&&(s=1),void 0===a&&(a="butt"),t.beginPath(),t.lineWidth=s,t.lineCap=a,t.strokeStyle=e.toString(),t.moveTo(i,n),t.lineTo(o,r),t.closePath(),t.stroke()}function ve(t,e,i){void 0===e&&(e=Pt.Red.clone()),t.beginPath(),t.strokeStyle=e.toString(),t.arc(i.x,i.y,5,0,2*Math.PI),t.closePath(),t.stroke()}function me(t,e,i,n,o){void 0===o&&(o=1);var r=e?e.toString():"blue",s=n.scale(o);t.beginPath(),t.strokeStyle=r,t.moveTo(i.x,i.y),t.lineTo(i.x+s.x,i.y+s.y),t.closePath(),t.stroke()}function be(t,e,i,n,o,r,s,a){var h;if(void 0===r&&(r=5),void 0===s&&(s=Pt.White),void 0===a&&(a=null),"number"==typeof r)h={tl:r,tr:r,br:r,bl:r};else{var c={tl:0,tr:0,br:0,bl:0};for(var u in c)if(c.hasOwnProperty(u)){var l=u;h[l]=r[l]||c[l]}}t.beginPath(),t.moveTo(e+h.tl,i),t.lineTo(e+n-h.tr,i),t.quadraticCurveTo(e+n,i,e+n,i+h.tr),t.lineTo(e+n,i+o-h.br),t.quadraticCurveTo(e+n,i+o,e+n-h.br,i+o),t.lineTo(e+h.bl,i+o),t.quadraticCurveTo(e,i+o,e,i+o-h.bl),t.lineTo(e,i+h.tl),t.quadraticCurveTo(e,i,e+h.tl,i),t.closePath(),a&&(t.fillStyle=a.toString(),t.fill()),s&&(t.strokeStyle=s.toString(),t.stroke())}function we(t,e,i,n,o,r){void 0===o&&(o=Pt.White),void 0===r&&(r=null),t.beginPath(),t.arc(e,i,n,0,2*Math.PI),t.closePath(),r&&(t.fillStyle=r.toString(),t.fill()),o&&(t.strokeStyle=o.toString(),t.stroke())}var xe,Pe=function(){function t(e,i){this.bodyA=e,this.bodyB=i,this.id=null,this.collision=null,this.id=t.calculatePairHash(e,i)}return t.canCollide=function(t,e){return!(t.collisionType===xe.Fixed&&e.collisionType===xe.Fixed||e.collisionType===xe.PreventCollision||t.collisionType===xe.PreventCollision||t.isKilled()||e.isKilled())},Object.defineProperty(t.prototype,"canCollide",{get:function(){var e=this.bodyA.actor,i=this.bodyB.actor;return t.canCollide(e,i)},enumerable:!0,configurable:!0}),t.prototype.collide=function(){this.collision=this.bodyA.collisionArea.collide(this.bodyB.collisionArea)},t.prototype.resolve=function(t){this.collision&&this.collision.resolve(t)},t.calculatePairHash=function(t,e){return t.actor.id<e.actor.id?"#"+t.actor.id+"+"+e.actor.id:"#"+e.actor.id+"+"+t.actor.id},t.prototype.debugDraw=function(t){this.collision&&(j.showContacts&&ve(t,Pt.Red,this.collision.point),j.showCollisionNormals&&me(t,Pt.Cyan,this.collision.point,this.collision.normal,30))},t}(),Se=function(){function t(t){this.actor=t,this.collisionArea=null,this.pos=new O(0,0),this.oldPos=new O(0,0),this.vel=new O(0,0),this.oldVel=new O(0,0),this.acc=new O(0,0),this.torque=0,this.mass=1,this.moi=1e3,this.motion=10,this.friction=.99,this.restitution=.2,this.rotation=0,this.rx=0,this._totalMtv=O.Zero.clone()}return t.prototype.addMtv=function(t){this._totalMtv.addEqual(t)},t.prototype.applyMtv=function(){this.pos.addEqual(this._totalMtv),this._totalMtv.setTo(0,0)},t.prototype.getBounds=function(){return j.collisionResolutionStrategy===T.Box?this.actor.getBounds():this.collisionArea.getBounds()},t.prototype.getRelativeBounds=function(){return j.collisionResolutionStrategy,T.Box,this.actor.getRelativeBounds()},t.prototype.update=function(){this.collisionArea&&(this.actor&&this.actor.isGeometryDirty&&this.collisionArea instanceof Tt&&(this.collisionArea.points=this.actor.getRelativeGeometry()),this.collisionArea.recalc())},t.prototype.useBoxCollision=function(t){void 0===t&&(t=O.Zero.clone()),this.collisionArea=new Tt({body:this,points:this.actor.getRelativeGeometry(),pos:t}),this.moi=this.collisionArea.getMomentOfInertia()||this.moi},t.prototype.usePolygonCollision=function(t,e){void 0===e&&(e=O.Zero.clone()),this.collisionArea=new Tt({body:this,points:t,pos:e}),this.moi=this.collisionArea.getMomentOfInertia()||this.moi},t.prototype.useCircleCollision=function(t,e){void 0===e&&(e=O.Zero.clone()),t||(t=this.actor.getWidth()/2),this.collisionArea=new kt({body:this,radius:t,pos:e}),this.moi=this.collisionArea.getMomentOfInertia()||this.moi},t.prototype.useEdgeCollision=function(t,e){this.collisionArea=new Ct({begin:t,end:e,body:this}),this.moi=this.collisionArea.getMomentOfInertia()||this.moi},t.prototype.debugDraw=function(t){j.showMotionVectors&&(me(t,Pt.Yellow,this.pos,this.acc.add(j.acc)),me(t,Pt.Red,this.pos,this.vel),ve(t,Pt.Red,this.pos)),j.showBounds&&this.getBounds().debugDraw(t,Pt.Yellow),j.showArea&&this.collisionArea.debugDraw(t,Pt.Green)},t.prototype.touching=function(t){var e=new Pe(this,t.body);return e.collide(),!!e.collision},t}(),Ae=function(){function t(){this._topLeft=new O(0,0),this._topRight=new O(0,0),this._bottomLeft=new O(0,0),this._bottomRight=new O(0,0)}return t.prototype.isSpriteOffScreen=function(t,e){var i=t.currentDrawing.drawWidth,n=t.currentDrawing.drawHeight,o=t.rotation,r=t.getCenter(),s=t.getWorldPos();this._topLeft.x=s.x-i/2,this._topLeft.y=s.y-n/2,this._topLeft=this._topLeft.rotate(o,r),this._topRight.x=s.x+i/2,this._topRight.y=s.y-n/2,this._topRight=this._topRight.rotate(o,r),this._bottomLeft.x=s.x-i/2,this._bottomLeft.y=s.y+n/2,this._bottomLeft=this._bottomLeft.rotate(o,r),this._bottomRight.x=s.x+i/2,this._bottomRight.y=s.y+n/2,this._bottomRight=this._bottomRight.rotate(o,r);var a=e.worldToScreenCoordinates(this._topLeft),h=e.worldToScreenCoordinates(this._topRight),c=e.worldToScreenCoordinates(this._bottomLeft),u=e.worldToScreenCoordinates(this._bottomRight);this._xCoords=[],this._yCoords=[],this._xCoords.push(a.x,h.x,c.x,u.x),this._yCoords.push(a.y,h.y,c.y,u.y),this._xMin=Math.min.apply(null,this._xCoords),this._yMin=Math.min.apply(null,this._yCoords),this._xMax=Math.max.apply(null,this._xCoords),this._yMax=Math.max.apply(null,this._yCoords);var l=e.screenToWorldCoordinates(new O(this._xMin,this._yMin)),p=e.screenToWorldCoordinates(new O(this._xMax,this._yMax));this._xMinWorld=l.x,this._yMinWorld=l.y,this._xMaxWorld=p.x,this._yMaxWorld=p.y;var d=[new O(this._xMin,this._yMin),new O(this._xMax,this._yMin),new O(this._xMin,this._yMax),new O(this._xMax,this._yMax)];if(d[0].x<0&&d[1].x>e.canvas.clientWidth&&(d[0].y>0||d[2].y<e.canvas.clientHeight))return!1;if(d[0].y<0&&d[2].y>e.canvas.clientHeight&&(d[1].x>0||d[0].x<e.canvas.clientWidth))return!1;for(var f=0;f<d.length;f++)if(d[f].x>0&&d[f].y>0&&d[f].x<e.canvas.clientWidth&&d[f].y<e.canvas.clientHeight)return!1;return!0},t.prototype.debugDraw=function(t){t.beginPath(),t.strokeStyle=Pt.White.toString(),t.rect(this._xMinWorld,this._yMinWorld,this._xMaxWorld-this._xMinWorld,this._yMaxWorld-this._yMinWorld),t.stroke(),t.fillStyle=Pt.Red.toString(),t.beginPath(),t.arc(this._topLeft.x,this._topLeft.y,5,0,2*Math.PI),t.closePath(),t.fill(),t.fillStyle=Pt.Green.toString(),t.beginPath(),t.arc(this._topRight.x,this._topRight.y,5,0,2*Math.PI),t.closePath(),t.fill(),t.fillStyle=Pt.Blue.toString(),t.beginPath(),t.arc(this._bottomLeft.x,this._bottomLeft.y,5,0,2*Math.PI),t.closePath(),t.fill(),t.fillStyle=Pt.Magenta.toString(),t.beginPath(),t.arc(this._bottomRight.x,this._bottomRight.y,5,0,2*Math.PI),t.closePath(),t.fill()},t}(),Ee=function(){function t(){this.cullingBox=new Ae}return t.prototype.update=function(t,e){var i=t.eventDispatcher,n=t.anchor,o=t.getGlobalScale(),r=o.x*t.getWidth()/t.scale.x,s=o.y*t.getHeight()/t.scale.y,a=e.currentScene.camera.pos,h=t.getWorldPos(),c=e.worldToScreenCoordinates(new O(h.x-n.x*r,h.y-n.y*s)),u=e.worldToScreenCoordinates(a),l=1;t.scene&&t.scene.camera&&(l=Math.abs(t.scene.camera.getZoom()));var p=!0;null!=t.currentDrawing&&(p=this.cullingBox.isSpriteOffScreen(t,e)),t.isOffScreen?(c.x+r*l>0&&c.y+s*l>0&&c.x<e.halfDrawWidth+u.x&&c.y<e.halfDrawHeight+u.y||!p)&&(i.emit("enterviewport",new vt(t)),t.isOffScreen=!1):(c.x+r*l<0||c.y+s*l<0||c.x>e.halfDrawWidth+u.x||c.y>e.halfDrawHeight+u.y)&&p&&(i.emit("exitviewport",new yt(t)),t.isOffScreen=!0)},t}(),ke=function(){function t(){}return t.prototype.update=function(t,e){t.enableCapturePointer&&(t.isKilled()||e.input.pointers.revisePointerEventsPaths(t))},t}(),Ce=function(){function t(){}return t.prototype.update=function(t,e){var i=t.eventDispatcher;if(t.collisionType!==xe.PreventCollision&&e.currentScene&&e.currentScene.tileMaps)for(var n=0;n<e.currentScene.tileMaps.length;n++)for(var o,r=e.currentScene.tileMaps[n],s=l.None,a=2;(o=r.collides(t))&&!(a--<0);)s=t.getSideFromIntersect(o),i.emit("precollision",new ut(t,null,s,o)),t.collisionType===xe.Active&&(t.pos.y+=o.y,t.pos.x+=o.x,i.emit("postcollision",new lt(t,null,s,o)))},t}(),Te=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Me=function(t){function e(e,i,n,o,r){return t.call(this,e,i,n,o,r)||this}return Te(e,t),e}(Vt(function(t){function e(i,n,o,r,s){var a=t.call(this)||this;if(a.id=e.maxId++,a.body=new Se(a),a.oldAcc=O.Zero.clone(),a._height=0,a._width=0,a.scale=O.One.clone(),a.oldScale=O.One.clone(),a.sx=0,a.sy=0,a.isOffScreen=!1,a.visible=!0,a.opacity=1,a.previousOpacity=1,a.logger=Dt.getInstance(),a.scene=null,a.parent=null,a.children=[],a.collisionType=xe.PreventCollision,a.collisionGroups=[],a._geometryDirty=!1,a._collisionHandlers={},a._isInitialized=!1,a.frames={},a._effectsDirty=!1,a.currentDrawing=null,a.traits=[],a.enableCapturePointer=!1,a.capturePointer={captureMoveEvents:!1,captureDragEvents:!1},a._zIndex=0,a._isKilled=!1,a._opacityFx=new Lt(a.opacity),a._capturePointerEvents=["pointerup","pointerdown","pointermove","pointerenter","pointerleave","pointerdragstart","pointerdragend","pointerdragmove","pointerdragenter","pointerdragleave"],a._captureMoveEvents=["pointermove","pointerenter","pointerleave","pointerdragmove","pointerdragenter","pointerdragleave"],a._captureDragEvents=["pointerdragstart","pointerdragend","pointerdragmove","pointerdragenter","pointerdragleave"],i&&"object"==typeof i){var h=i;i=h.pos?h.pos.x:h.x,n=h.pos?h.pos.y:h.y,o=h.width,r=h.height}return a.pos.x=i||0,a.pos.y=n||0,a._width=o||0,a._height=r||0,s&&(a.color=s,a.opacity=s.a),a.traits.push(new Ce),a.traits.push(new Ee),a.traits.push(new ke),a.actionQueue=new fe(a),a.actions=new ge(a),a._initDefaults(),a.body.useBoxCollision(),a}return Te(e,t),Object.defineProperty(e.prototype,"collisionArea",{get:function(){return this.body.collisionArea},set:function(t){this.body.collisionArea=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"x",{get:function(){return this.body.pos.x},set:function(t){this.body.pos.x=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this.body.pos.y},set:function(t){this.body.pos.y=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pos",{get:function(){return this.body.pos},set:function(t){this.body.pos.setTo(t.x,t.y)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"oldPos",{get:function(){return this.body.oldPos},set:function(t){this.body.oldPos.setTo(t.x,t.y)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"vel",{get:function(){return this.body.vel},set:function(t){this.body.vel.setTo(t.x,t.y)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"oldVel",{get:function(){return this.body.oldVel},set:function(t){this.body.oldVel.setTo(t.x,t.y)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"acc",{get:function(){return this.body.acc},set:function(t){this.body.acc.setTo(t.x,t.y)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rotation",{get:function(){return this.body.rotation},set:function(t){this.body.rotation=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rx",{get:function(){return this.body.rx},set:function(t){this.body.rx=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"torque",{get:function(){return this.body.torque},set:function(t){this.body.torque=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mass",{get:function(){return this.body.mass},set:function(t){this.body.mass=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"moi",{get:function(){return this.body.moi},set:function(t){this.body.moi=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"friction",{get:function(){return this.body.friction},set:function(t){this.body.friction=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"restitution",{get:function(){return this.body.restitution},set:function(t){this.body.restitution=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"color",{get:function(){return this._color},set:function(t){this._color=t.clone()},enumerable:!0,configurable:!0}),e.prototype.onInitialize=function(t){},Object.defineProperty(e.prototype,"isInitialized",{get:function(){return this._isInitialized},enumerable:!0,configurable:!0}),e.prototype._initialize=function(e){this.isInitialized||(this.onInitialize(e),t.prototype.emit.call(this,"initialize",new ft(e,this)),this._isInitialized=!0);for(var i=0,n=this.children;i<n.length;i++)n[i]._initialize(e)},e.prototype._initDefaults=function(){this.anchor=Me.defaults.anchor.clone()},e.prototype._checkForPointerOptIn=function(t){if(t){var e=t.toLowerCase();-1!==this._capturePointerEvents.indexOf(e)&&(this.enableCapturePointer=!0,-1!==this._captureMoveEvents.indexOf(e)&&(this.capturePointer.captureMoveEvents=!0),-1!==this._captureDragEvents.indexOf(e)&&(this.capturePointer.captureDragEvents=!0))}},e.prototype.on=function(e,i){this._checkForPointerOptIn(e),t.prototype.on.call(this,e,i)},e.prototype.once=function(e,i){this._checkForPointerOptIn(e),t.prototype.once.call(this,e,i)},e.prototype.off=function(e,i){t.prototype.off.call(this,e,i)},e.prototype._prekill=function(e){t.prototype.emit.call(this,"prekill",new q(this)),this.onPreKill(e)},e.prototype.onPreKill=function(t){},e.prototype._postkill=function(e){t.prototype.emit.call(this,"postkill",new X(this)),this.onPostKill(e)},e.prototype.onPostKill=function(t){},e.prototype.kill=function(){this.scene?(this._prekill(this.scene),this.emit("kill",new N(this)),this._isKilled=!0,this.scene.remove(this),this._postkill(this.scene)):this.logger.warn("Cannot kill actor, it was never added to the Scene")},e.prototype.unkill=function(){this._isKilled=!1},e.prototype.isKilled=function(){return this._isKilled},e.prototype.add=function(t){t.collisionType=xe.PreventCollision,S(t,this.children)&&(t.parent=this)},e.prototype.remove=function(t){A(t,this.children)&&(t.parent=null)},e.prototype.setDrawing=function(t){t=t.toString(),this.currentDrawing!==this.frames[t]&&(null!=this.frames[t]?(this.frames[t].reset(),this.currentDrawing=this.frames[t]):Dt.getInstance().error("the specified drawing key "+t+" does not exist"))},e.prototype.addDrawing=function(){2===arguments.length?(this.frames[arguments[0]]=arguments[1],this.currentDrawing||(this.currentDrawing=arguments[1]),this._effectsDirty=!0):(arguments[0]instanceof Kt&&this.addDrawing("default",arguments[0]),arguments[0]instanceof Qt&&this.addDrawing("default",arguments[0].asSprite()))},Object.defineProperty(e.prototype,"z",{get:function(){return this.getZIndex()},set:function(t){this.setZIndex(t)},enumerable:!0,configurable:!0}),e.prototype.getZIndex=function(){return this._zIndex},e.prototype.setZIndex=function(t){this.scene.cleanupDrawTree(this),this._zIndex=t,this.scene.updateDrawTree(this)},e.prototype.addCollisionGroup=function(t){this.collisionGroups.push(t)},e.prototype.removeCollisionGroup=function(t){var e=this.collisionGroups.indexOf(t);-1!==e&&this.collisionGroups.splice(e,1)},e.prototype.getCenter=function(){return new O(this.pos.x+this.getWidth()/2-this.anchor.x*this.getWidth(),this.pos.y+this.getHeight()/2-this.anchor.y*this.getHeight())},e.prototype.getWidth=function(){return this._width*this.getGlobalScale().x},e.prototype.setWidth=function(t){this._width=t/this.scale.x,this._geometryDirty=!0},e.prototype.getHeight=function(){return this._height*this.getGlobalScale().y},e.prototype.setHeight=function(t){this._height=t/this.scale.y,this._geometryDirty=!0},e.prototype.getLeft=function(){return this.getBounds().left},e.prototype.getRight=function(){return this.getBounds().right},e.prototype.getTop=function(){return this.getBounds().top},e.prototype.getBottom=function(){return this.getBounds().bottom},e.prototype.getWorldRotation=function(){return this.parent?this.rotation+this.parent.getWorldRotation():this.rotation},e.prototype.getWorldPos=function(){if(!this.parent)return this.pos.clone();var t=[],e=this;for(t.push(this);e.parent;)e=e.parent,t.push(e);var i=t.reduceRight(function(t,e){return e.parent?t+e.pos.x*e.getGlobalScale().x:t+e.pos.x},0),n=t.reduceRight(function(t,e){return e.parent?t+e.pos.y*e.getGlobalScale().y:t+e.pos.y},0),o=e.getWorldPos(),r=this.getWorldRotation();return new O(i,n).rotate(r,o)},e.prototype.getGlobalScale=function(){if(!this.parent)return new O(this.scale.x,this.scale.y);var t=this.parent.getGlobalScale();return new O(this.scale.x*t.x,this.scale.y*t.y)},e.prototype.getBounds=function(t){void 0===t&&(t=!0);var e=this._getCalculatedAnchor(),i=this.getWorldPos(),n=new Mt(i.x-e.x,i.y-e.y,i.x+this.getWidth()-e.x,i.y+this.getHeight()-e.y);return t?n.rotate(this.rotation,i):n},e.prototype.getRelativeBounds=function(t){void 0===t&&(t=!0);var e=this._getCalculatedAnchor(),i=new Mt(-e.x,-e.y,this.getWidth()-e.x,this.getHeight()-e.y);return t?i.rotate(this.rotation):i},e.prototype.getGeometry=function(){return this.getBounds(!1).getPoints()},e.prototype.getRelativeGeometry=function(){return this.getRelativeBounds(!1).getPoints()},Object.defineProperty(e.prototype,"isGeometryDirty",{get:function(){return this._geometryDirty},enumerable:!0,configurable:!0}),e.prototype.contains=function(t,e,i){void 0===i&&(i=!1);var n=this.getBounds().contains(new O(t,e));return i?n||this.children.some(function(i){return i.contains(t,e,!0)}):n},e.prototype.getSideFromIntersect=function(t){return t?Math.abs(t.x)>Math.abs(t.y)?t.x<0?l.Right:l.Left:t.y<0?l.Bottom:l.Top:l.None},e.prototype.collidesWithSide=function(t){var e=this.collides(t);return e?Math.abs(e.x)>Math.abs(e.y)?this.pos.x<t.pos.x?l.Right:l.Left:this.pos.y<t.pos.y?l.Bottom:l.Top:l.None},e.prototype.collides=function(t){var e=this.getBounds(),i=t.getBounds();return e.collides(i)},e.prototype.onCollidesWith=function(t,e){this._collisionHandlers[t]||(this._collisionHandlers[t]=[]),this._collisionHandlers[t].push(e)},e.prototype.getCollisionHandlers=function(){return this._collisionHandlers},e.prototype.removeCollidesWith=function(t){this._collisionHandlers[t]=[]},e.prototype.within=function(t,e){return Math.sqrt(Math.pow(this.pos.x-t.pos.x,2)+Math.pow(this.pos.y-t.pos.y,2))<=e},e.prototype._getCalculatedAnchor=function(){return new O(this.getWidth()*this.anchor.x,this.getHeight()*this.anchor.y)},e.prototype._reapplyEffects=function(t){t.removeEffect(this._opacityFx),t.addEffect(this._opacityFx)},e.prototype.integrate=function(t){var e=t/1e3,i=this.acc.clone();this.collisionType===xe.Active&&i.addEqual(j.acc),this.vel.addEqual(i.scale(e)),this.pos.addEqual(this.vel.scale(e)).addEqual(i.scale(.5*e*e)),this.rx+=this.torque*(1/this.moi)*e,this.rotation+=this.rx*e,this.scale.x+=this.sx*t/1e3,this.scale.y+=this.sy*t/1e3,this.scale.equals(this.oldScale)||(this._geometryDirty=!0),this.body.update(),this._geometryDirty=!1},e.prototype.update=function(t,e){this._initialize(t),this._preupdate(t,e),this.actionQueue.update(e),this.color&&(this.color.a=this.opacity),this.previousOpacity!==this.opacity&&(this.previousOpacity=this.opacity,this._opacityFx.opacity=this.opacity,this._effectsDirty=!0),this.oldVel.setTo(this.vel.x,this.vel.y),this.oldPos.setTo(this.pos.x,this.pos.y),this.oldAcc.setTo(this.acc.x,this.acc.y),this.oldScale.setTo(this.scale.x,this.scale.y),this.integrate(e);for(var i=0,n=this.traits;i<n.length;i++)n[i].update(this,t,e);for(var o=0;o<this.children.length;o++)this.children[o].update(t,e);this._postupdate(t,e)},e.prototype.onPreUpdate=function(t,e){},e.prototype.onPostUpdate=function(t,e){},e.prototype._preupdate=function(t,e){this.emit("preupdate",new J(t,e,this)),this.onPreUpdate(t,e)},e.prototype._postupdate=function(t,e){this.emit("postupdate",new J(t,e,this)),this.onPostUpdate(t,e)},e.prototype.draw=function(t,e){if(t.save(),t.translate(this.pos.x,this.pos.y),t.rotate(this.rotation),t.scale(this.scale.x,this.scale.y),t.save(),t.translate(-this._width*this.anchor.x,-this._height*this.anchor.y),this._predraw(t,e),this.currentDrawing){var i=this.currentDrawing,n=(this._width-i.width*i.scale.x)*this.anchor.x,o=(this._height-i.height*i.scale.y)*this.anchor.y;this._effectsDirty&&(this._reapplyEffects(this.currentDrawing),this._effectsDirty=!1),this.currentDrawing.draw(t,n,o)}else this.color&&(t.fillStyle=this.color.toString(),t.fillRect(0,0,this._width,this._height));t.restore();for(var r=0;r<this.children.length;r++)this.children[r].visible&&this.children[r].draw(t,e);this._postdraw(t,e),t.restore()},e.prototype.onPreDraw=function(t,e){},e.prototype.onPostDraw=function(t,e){},e.prototype._predraw=function(t,e){this.emit("predraw",new Z(t,e,this)),this.onPreDraw(t,e)},e.prototype._postdraw=function(t,e){this.emit("postdraw",new Z(t,e,this)),this.onPostDraw(t,e)},e.prototype.debugDraw=function(t){this.emit("predebugdraw",new Y(t,this)),this.body.debugDraw(t);var e=this.getBounds();e.debugDraw(t),t.fillText("id: "+this.id,e.left+3,e.top+10),t.fillStyle=Pt.Yellow.toString(),t.beginPath(),t.arc(this.getWorldPos().x,this.getWorldPos().y,3,0,2*Math.PI),t.closePath(),t.fill();for(var i=0;i<this.traits.length;i++)this.traits[i]instanceof Ee&&this.traits[i].cullingBox.debugDraw(t);t.strokeStyle=Pt.Yellow.toString(),t.beginPath();var n=Math.min(this.getWidth(),this.getHeight());t.arc(this.getWorldPos().x,this.getWorldPos().y,n,0,2*Math.PI),t.closePath(),t.stroke();var o={"0 Pi":0,"Pi/2":Math.PI/2,Pi:Math.PI,"3/2 Pi":3*Math.PI/2},r=t.font;for(var s in o)t.fillStyle=Pt.Yellow.toString(),t.font="14px",t.textAlign="center",t.fillText(s,this.getWorldPos().x+Math.cos(o[s])*(n+10),this.getWorldPos().y+Math.sin(o[s])*(n+10));t.font=r;for(var a=0;a<this.children.length;a++)this.children[a].debugDraw(t);this.emit("postdebugdraw",new Q(t,this))},e.prototype.getAncestors=function(){for(var t,e=[this],i=this;t=i.parent;)i=t,e.push(i);return e.reverse()},e.defaults={anchor:O.Half.clone()},e.maxId=0,e}(xt)));!function(t){t[t.PreventCollision=0]="PreventCollision",t[t.Passive=1]="Passive",t[t.Active=2]="Active",t[t.Fixed=3]="Fixed"}(xe||(xe={}));var De=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Be=function(t){function e(e,i,n,o){var r=this;return(r="object"!=typeof e?t.call(this,e,i,n,o)||this:t.call(this,e)||this).traits=[],r.traits.push(new ke),r.anchor.setTo(0,0),r.collisionType=xe.PreventCollision,r.enableCapturePointer=!0,r}return De(e,t),e.prototype._initialize=function(e){this._engine=e,t.prototype._initialize.call(this,e)},e.prototype.contains=function(e,i,n){if(void 0===n&&(n=!0),n)return t.prototype.contains.call(this,e,i);var o=this._engine.worldToScreenCoordinates(new O(e,i));return t.prototype.contains.call(this,o.x,o.y)},e}(Me),Oe=function(){function t(e,i,n,o){if(this.id=0,this.interval=10,this.fcn=function(){},this.repeats=!1,this.maxNumberOfRepeats=-1,this._elapsedTime=0,this._totalTimeAlive=0,this._paused=!1,this._numberOfTicks=0,this.complete=!1,this.scene=null,o&&o>=0&&(this.maxNumberOfRepeats=o,!n))throw new Error("repeats must be set to true if numberOfRepeats is set");this.id=t.id++,this.interval=i||this.interval,this.fcn=e||this.fcn,this.repeats=n||this.repeats}return t.prototype.update=function(t){this._paused||(this._totalTimeAlive+=t,this._elapsedTime+=t,this.maxNumberOfRepeats>-1&&this._numberOfTicks>=this.maxNumberOfRepeats&&(this.complete=!0),!this.complete&&this._elapsedTime>=this.interval&&(this.fcn.call(this),this._numberOfTicks++,this.repeats?this._elapsedTime=0:this.complete=!0))},t.prototype.reset=function(t,e){if(t&&t>=0&&(this.interval=t),this.maxNumberOfRepeats&&this.maxNumberOfRepeats>=0&&(this.maxNumberOfRepeats=e,!this.repeats))throw new Error("repeats must be set to true if numberOfRepeats is set");this.complete=!1,this._elapsedTime=0,this._numberOfTicks=0},Object.defineProperty(t.prototype,"timesRepeated",{get:function(){return this._numberOfTicks},enumerable:!0,configurable:!0}),t.prototype.getTimeRunning=function(){return this._totalTimeAlive},t.prototype.pause=function(){this._paused=!0},t.prototype.unpause=function(){this._paused=!1},t.prototype.cancel=function(){this.scene&&this.scene.cancelTimer(this)},t.id=0,t}(),Re=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),ze=function(t){function e(e,i,n,o,r,s){return t.call(this,e,i,n,o,r,s)||this}return Re(e,t),e}(Vt(function(t){function e(e,i,n,o,r,s){var a,h=t.call(this)||this;if(h._collidingX=-1,h._collidingY=-1,h._onScreenXStart=0,h._onScreenXEnd=9999,h._onScreenYStart=0,h._onScreenYEnd=9999,h._spriteSheets={},h.logger=Dt.getInstance(),h.data=[],e&&"object"==typeof e){var c=e;e=c.x,i=c.y,n=c.cellWidth,o=c.cellHeight,r=c.rows,s=c.cols}h.x=e,h.y=i,h.cellWidth=n,h.cellHeight=o,h.rows=r,h.cols=s,h.data=new Array(r*s);for(var u=0;u<s;u++)for(var l=0;l<r;l++)a=new Ie(u*n+e,l*o+i,n,o,u+l*s),h.data[u+l*s]=a;return h}return Re(e,t),e.prototype.on=function(e,i){t.prototype.on.call(this,e,i)},e.prototype.registerSpriteSheet=function(t,e){this._spriteSheets[t]=e},e.prototype.collides=function(t){for(var e=t.pos.x+t.getWidth(),i=t.pos.y+t.getHeight(),n=t.getBounds(),o=[],r=n.left;r<=e;r+=Math.min(t.getWidth()/2,this.cellWidth/2))for(var s=n.top;s<=i;s+=Math.min(t.getHeight()/2,this.cellHeight/2)){var a=this.getCellByPoint(r,s);if(a&&a.solid){var h=n.collides(a.getBounds()),c=t.getCenter().sub(a.getCenter());h&&h.dot(c)>0&&o.push(h)}}return 0===o.length?null:o.reduce(function(t,e){var i=t.x,n=t.y;return Math.abs(t.x)<Math.abs(e.x)&&(i=e.x),Math.abs(t.y)<Math.abs(e.y)&&(n=e.y),new O(i,n)})},e.prototype.getCellByIndex=function(t){return this.data[t]},e.prototype.getCell=function(t,e){return t<0||e<0||t>=this.cols||e>=this.rows?null:this.data[t+e*this.cols]},e.prototype.getCellByPoint=function(t,e){t=Math.floor((t-this.x)/this.cellWidth),e=Math.floor((e-this.y)/this.cellHeight);var i=this.getCell(t,e);return t>=0&&e>=0&&t<this.cols&&e<this.rows&&i?i:null},e.prototype.update=function(t,e){this.emit("preupdate",new J(t,e,this));var i=t.screenToWorldCoordinates(new O(0,0)),n=t.screenToWorldCoordinates(new O(t.canvas.clientWidth,t.canvas.clientHeight));this._onScreenXStart=Math.max(Math.floor((i.x-this.x)/this.cellWidth)-2,0),this._onScreenYStart=Math.max(Math.floor((i.y-this.y)/this.cellHeight)-2,0),this._onScreenXEnd=Math.max(Math.floor((n.x-this.x)/this.cellWidth)+2,0),this._onScreenYEnd=Math.max(Math.floor((n.y-this.y)/this.cellHeight)+2,0),this.emit("postupdate",new $(t,e,this))},e.prototype.draw=function(t,e){this.emit("predraw",new Z(t,e,this)),t.save(),t.translate(this.x,this.y);for(var i,n,o,r=this._onScreenXStart,s=Math.min(this._onScreenXEnd,this.cols),a=this._onScreenYStart,h=Math.min(this._onScreenYEnd,this.rows);r<s;r++){for(;a<h;a++)for(n=0,o=(i=this.getCell(r,a).sprites.filter(function(t){return t.spriteId>-1})).length;n<o;n++){var c=this._spriteSheets[i[n].spriteSheetKey];if(c){var u=c.getSprite(i[n].spriteId);u?u.draw(t,r*this.cellWidth,a*this.cellHeight):this.logger.warn("Sprite does not exist for id",i[n].spriteId,"in sprite sheet",i[n].spriteSheetKey,u,c)}else this.logger.warn("Sprite sheet",i[n].spriteSheetKey,"does not exist",c)}a=this._onScreenYStart}t.restore(),this.emit("postdraw",new K(t,e,this))},e.prototype.debugDraw=function(t){var e=this.cols*this.cellWidth,i=this.rows*this.cellHeight;t.save(),t.strokeStyle=Pt.Red.toString();for(var n=0;n<this.cols+1;n++)t.beginPath(),t.moveTo(this.x+n*this.cellWidth,this.y),t.lineTo(this.x+n*this.cellWidth,this.y+i),t.stroke();for(var o=0;o<this.rows+1;o++)t.beginPath(),t.moveTo(this.x,this.y+o*this.cellHeight),t.lineTo(this.x+e,this.y+o*this.cellHeight),t.stroke();var r=Pt.Red.clone();r.a=.3,this.data.filter(function(t){return t.solid}).forEach(function(e){t.fillStyle=r.toString(),t.fillRect(e.x,e.y,e.width,e.height)}),this._collidingY>-1&&this._collidingX>-1&&(t.fillStyle=Pt.Cyan.toString(),t.fillRect(this.x+this._collidingX*this.cellWidth,this.y+this._collidingY*this.cellHeight,this.cellWidth,this.cellHeight)),t.restore()},e}(xt))),Fe=function(t,e){this.spriteSheetKey=t,this.spriteId=e},Ie=function(t){function e(e,i,n,o,r,s,a){return t.call(this,e,i,n,o,r,s,a)||this}return Re(e,t),e}(Vt(function(){function t(t,e,i,n,o,r,s){if(void 0===r&&(r=!1),void 0===s&&(s=[]),this.solid=!1,this.sprites=[],t&&"object"==typeof t){var a=t;t=a.x,e=a.y,i=a.width,n=a.height,o=a.index,r=a.solid,s=a.sprites}this.x=t,this.y=e,this.width=i,this.height=n,this.index=o,this.solid=r,this.sprites=s,this._bounds=new Mt(this.x,this.y,this.x+this.width,this.y+this.height)}return t.prototype.getBounds=function(){return this._bounds},t.prototype.getCenter=function(){return new O(this.x+this.width/2,this.y+this.height/2)},t.prototype.pushSprite=function(t){this.sprites.push(t)},t.prototype.removeSprite=function(t){var e;(e=this.sprites.indexOf(t))>-1&&this.sprites.splice(e,1)},t.prototype.clearSprites=function(){this.sprites.length=0},t}())),Le=function(){function t(){}return t.create=function(){return this._INSTANCE||(window.AudioContext||window.webkitAudioContext)&&(this._INSTANCE=new window.AudioContext),this._INSTANCE},t._INSTANCE=null,t}(),He=function(){function t(){}return t.unlock=function(){var e=new p;if(t._unlocked||!Le.create())return e.resolve(!0);var i=Le.create();return i.resume().then(function(){var n=i.createBuffer(1,1,22050),o=i.createBufferSource(),r=!1;o.buffer=n,o.connect(i.destination),o.onended=function(){return r=!0},o.noteOn?o.noteOn(0):o.start(0),setTimeout(function(){o.playbackState?o.playbackState!==o.PLAYING_STATE&&o.playbackState!==o.FINISHED_STATE||(t._unlocked=!0):(i.currentTime>0||r)&&(t._unlocked=!0)},0),e.resolve()},function(){e.reject(!1)}),e},t.isUnlocked=function(){return this._unlocked},t._unlocked=!1,t}();function je(t){return t=_({},{message:"This method will be removed in future versions of Excalibur.",alternateMethod:null},t),function(e,i,n){if("function"!=typeof n.value&&"function"!=typeof n.get&&"function"!=typeof n.set)throw new SyntaxError("Only functions/getters/setters can be marked as obsolete");var o=(e.name||"")+(e.name?".":"")+i+" is marked obsolete: "+t.message+(t.alternateMethod?" Use "+t.alternateMethod+" instead":""),r=_({},n);return n.value?(r.value=function(){return Dt.getInstance().warn(o),n.value.apply(this,arguments)},r):(n.get&&(r.get=function(){return Dt.getInstance().warn(o),n.get.apply(this,arguments)}),n.set&&(r.set=function(){return Dt.getInstance().warn(o),n.set.apply(this,arguments)}),r)}}var Ue,We=i(4),Ne=i.n(We),qe=i(3),Xe=i.n(qe),Ve=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Ge=function(t){function e(e){var i=t.call(this)||this;return i._resourceList=[],i._index=0,i._playButtonShown=!1,i._resourceCount=0,i._numLoaded=0,i._progressCounts={},i._totalCounts={},i.logo=Ne.a,i.logoWidth=468,i.logoHeight=118,i.backgroundColor="#176BAA",i.suppressPlayButton=!1,i._playButtonStyles=Xe.a.toString(),i.playButtonText="Play game",i.startButtonFactory=function(){var t=document.createElement("button");return t.id="excalibur-play",t.textContent=i.playButtonText,t.style.display="none",t},i.getData=function(){},i.setData=function(){},i.processData=function(){},i.onprogress=function(t){Dt.getInstance().debug("[ex.Loader] Loading "+(100*t.loaded/t.total).toFixed(0))},i.oncomplete=function(){},i.onerror=function(){},e&&i.addResources(e),i}return Ve(e,t),Object.defineProperty(e.prototype,"_image",{get:function(){return this._imageElement||(this._imageElement=new Image,this._imageElement.src=this.logo),this._imageElement},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_playButton",{get:function(){return this._playButtonRootElement||(this._playButtonRootElement=document.createElement("div"),this._playButtonRootElement.style.position="absolute",document.body.appendChild(this._playButtonRootElement)),this._styleBlock||(this._styleBlock=document.createElement("style"),this._styleBlock.textContent=this._playButtonStyles,document.head.appendChild(this._styleBlock)),this._playButtonElement||(this._playButtonElement=this.startButtonFactory(),this._playButtonRootElement.appendChild(this._playButtonElement)),this._playButtonElement},enumerable:!0,configurable:!0}),e.prototype.wireEngine=function(t){this._engine=t},e.prototype.addResource=function(t){var e=this._index++;this._resourceList.push(t),this._progressCounts[e]=0,this._totalCounts[e]=1,this._resourceCount++},e.prototype.addResources=function(t){for(var e=0,i=t.length;e<i;e++)this.addResource(t[e])},e.prototype.isLoaded=function(){return this._numLoaded===this._resourceCount},e.prototype.showPlayButton=function(){if(this.suppressPlayButton)return p.resolve();this._playButtonShown=!0,this._playButton.style.display="block";var t=new p;return this._playButton.addEventListener("click",function(){return t.state()===c.Pending?t.resolve():t}),this._playButton.addEventListener("touchend",function(){return t.state()===c.Pending?t.resolve():t}),this._playButton.addEventListener("pointerup",function(){return t.state()===c.Pending?t.resolve():t}),t},e.prototype.hidePlayButton=function(){this._playButtonShown=!1,this._playButton.style.display="none"},e.prototype.load=function(){var t=this,e=new p,i=this;if(0===this._resourceList.length)return i.showPlayButton().then(function(){He.unlock().then(function(){i.hidePlayButton(),i.oncomplete.call(i),e.resolve()})}),e;var n=new Array(this._resourceList.length),o=this._resourceList.length;return this._resourceList.forEach(function(r,s){t._engine&&r.wireEngine(t._engine),r.onprogress=function(t){var e=t.total,r=t.loaded;n[s]={loaded:r/e*(100/o),total:100};var a=n.reduce(function(t,e){return{loaded:t.loaded+e.loaded,total:100}},{loaded:0,total:100});i.onprogress.call(i,a)},r.oncomplete=r.onerror=function(){i._numLoaded++,i._numLoaded===i._resourceCount&&setTimeout(function(){i.showPlayButton().then(function(){He.unlock().then(function(){i.hidePlayButton(),i.oncomplete.call(i),e.resolve()})})},200)}}),function t(e,i){e[i]&&e[i].load().then(function(){t(e,i+1)})}(this._resourceList,0),e},e.prototype.draw=function(t){var e=this._engine.canvasHeight/window.devicePixelRatio,i=this._engine.canvasWidth/window.devicePixelRatio;if(this._playButtonRootElement){var n=t.canvas.offsetLeft,o=t.canvas.offsetTop,r=this._playButton.clientWidth,s=this._playButton.clientHeight;this._playButtonRootElement.style.left=n+i/2-r/2+"px",this._playButtonRootElement.style.top=o+e/2-s/2+100+"px"}t.fillStyle=this.backgroundColor,t.fillRect(0,0,i,e);var a=e/2,h=Math.min(this.logoWidth,.75*i),c=i/2-h/2,u=Math.floor(h*(this.logoHeight/this.logoWidth)),l=this._engine.getAntialiasing();if(this._engine.setAntialiasing(!0),t.drawImage(this._image,0,0,this.logoWidth,this.logoHeight,c,a-u-20,h,u),this.suppressPlayButton||!this._playButtonShown){t.lineWidth=2,be(t,c,a,h,20,10);var p=h*(this._numLoaded/this._resourceCount)-10;be(t,c+5,a+5,p>0?p:0,10,5,null,Pt.White),this._engine.setAntialiasing(l)}else this._engine.setAntialiasing(l)},e.prototype.update=function(t,e){},e}(xt),Ze=function(t){function e(e,i){var n=t.call(this,i)||this;return n._handleOnTrigger=function(){return n._waitPromise.state()===c.Pending&&(He.unlock(),n._waitPromise.resolve(n._loadedValue),n._playTrigger.style.display="none",!1)},n._playTrigger=document.getElementById(e),n._playTrigger.addEventListener("click",n._handleOnTrigger),n}return Ve(e,t),e.prototype.load=function(){var e=this;return this._waitPromise=new p,t.prototype.load.call(this).then(function(t){e._loadedValue=t,e._playTrigger.style.display="block"},function(t){e._waitPromise.reject(t)}),this._waitPromise},function(t,e,i,n){var o,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(r<3?o(s):r>3?o(e,i,s):o(e,i))||s);r>3&&s&&Object.defineProperty(e,i,s)}([je({message:"Deprecated in v0.20.0",alternateMethod:"Use ex.Loader instead"})],e.prototype,"load",null),e}(Ge),Ke={webgl:"WebGL",webaudio:"WebAudio",gamepadapi:"Gamepad API"},Ye=function(){function t(){this._features=null,this.failedTests=[],this._criticalTests={canvasSupport:function(){var t=document.createElement("canvas");return!(!t.getContext||!t.getContext("2d"))},arrayBufferSupport:function(){var t=new XMLHttpRequest;t.open("GET","/");try{t.responseType="arraybuffer"}catch(t){return!1}return"arraybuffer"===t.responseType},dataUrlSupport:function(){return 0===document.createElement("canvas").toDataURL("image/png").indexOf("data:image/png")},objectUrlSupport:function(){return"URL"in window&&"revokeObjectURL"in URL&&"createObjectURL"in URL},rgbaSupport:function(){var t=document.createElement("a").style;return t.cssText="background-color:rgba(150,255,150,.5)",(""+t.backgroundColor).indexOf("rgba")>-1}},this._warningTest={webAudioSupport:function(){return!!(window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext||window.oAudioContext)},webglSupport:function(){var t=document.createElement("canvas");return!(!t.getContext||!t.getContext("webgl"))}},this._features=this._loadBrowserFeatures()}return t.prototype.getBrowserFeatures=function(){return null===this._features&&(this._features=this._loadBrowserFeatures()),this._features},t.prototype.logBrowserFeatures=function(){for(var t="%cSUPPORTED BROWSER FEATURES\n==========================%c\n",e=["font-weight: bold; color: navy","font-weight: normal; color: inherit"],i=this.getBrowserFeatures(),n=0,o=Object.keys(Ke);n<o.length;n++){var r=o[n];i[r]?(t+="(%c✓%c)",e.push("font-weight: bold; color: green"),e.push("font-weight: normal; color: inherit")):(t+="(%c✗%c)",e.push("font-weight: bold; color: red"),e.push("font-weight: normal; color: inherit")),t+=" "+Ke[r]+"\n"}e.unshift(t),console.log.apply(console,e)},t.prototype._loadBrowserFeatures=function(){var t=this;return{canvas:t._criticalTests.canvasSupport(),arraybuffer:t._criticalTests.arrayBufferSupport(),dataurl:t._criticalTests.dataUrlSupport(),objecturl:t._criticalTests.objectUrlSupport(),rgba:t._criticalTests.rgbaSupport(),webaudio:t._warningTest.webAudioSupport(),webgl:t._warningTest.webglSupport(),gamepadapi:!!navigator.getGamepads}},t.prototype.test=function(){var t=!1;for(var e in this._criticalTests)this._criticalTests[e].call(this)||(this.failedTests.push(e),Dt.getInstance().error("Critical browser feature missing, Excalibur requires:",e),t=!0);if(t)return!1;for(var i in this._warningTest)this._warningTest[i]()||Dt.getInstance().warn("Warning browser feature missing, Excalibur will have reduced performance:",i);return!0},t}(),Qe=function(){function t(t){this.parent=t,this.parent=t||null,this.body=null,this.bounds=new Mt,this.left=null,this.right=null,this.height=0}return t.prototype.isLeaf=function(){return!this.left&&!this.right},t}(),Je=function(){function t(t){void 0===t&&(t=new Mt(-Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)),this.worldBounds=t,this.root=null,this.nodes={}}return t.prototype._insert=function(t){if(null===this.root)return this.root=t,void(this.root.parent=null);for(var e=t.bounds,i=this.root;!i.isLeaf();){var n,o=i.left,r=i.right,s=i.bounds.getPerimeter(),a=i.bounds.combine(e).getPerimeter(),h=2*a,c=2*(a-s),u=0,l=e.combine(o.bounds);o.isLeaf()?u=l.getPerimeter()+c:(n=o.bounds.getPerimeter(),u=l.getPerimeter()-n+c);var p=0,d=e.combine(r.bounds);if(r.isLeaf()?p=d.getPerimeter()+c:(n=r.bounds.getPerimeter(),p=d.getPerimeter()-n+c),h<u&&h<p)break;i=u<p?o:r}var f=i.parent,_=new Qe(f);_.bounds=e.combine(i.bounds),_.height=i.height+1,null!==f?(f.left===i?f.left=_:f.right=_,_.left=i,_.right=t,i.parent=_,t.parent=_):(_.left=i,_.right=t,i.parent=_,t.parent=_,this.root=_);for(var g=t.parent;g;){if(!(g=this._balance(g)).left)throw new Error("Parent of current leaf cannot have a null left child"+g);if(!g.right)throw new Error("Parent of current leaf cannot have a null right child"+g);g.height=1+Math.max(g.left.height,g.right.height),g.bounds=g.left.bounds.combine(g.right.bounds),g=g.parent}},t.prototype._remove=function(t){if(t!==this.root){var e,i=t.parent,n=i.parent;if(e=i.left===t?i.right:i.left,n){n.left===i?n.left=e:n.right=e,e.parent=n;for(var o=n;o;)(o=this._balance(o)).bounds=o.left.bounds.combine(o.right.bounds),o.height=1+Math.max(o.left.height,o.right.height),o=o.parent}else this.root=e,e.parent=null}else this.root=null},t.prototype.trackBody=function(t){var e=new Qe;e.body=t,e.bounds=t.getBounds(),e.bounds.left-=2,e.bounds.top-=2,e.bounds.right+=2,e.bounds.bottom+=2,this.nodes[t.actor.id]=e,this._insert(e)},t.prototype.updateBody=function(t){var e=this.nodes[t.actor.id];if(!e)return!1;var i=t.getBounds();if(!this.worldBounds.contains(i))return Dt.getInstance().warn("Actor with id "+t.actor.id+" is outside the world bounds and will no longer be tracked for physics"),this.untrackBody(t),!1;if(e.bounds.contains(i))return!1;this._remove(e),i.left-=j.boundsPadding,i.top-=j.boundsPadding,i.right+=j.boundsPadding,i.bottom+=j.boundsPadding;var n=t.vel.x*j.dynamicTreeVelocityMultiplyer,o=t.vel.y*j.dynamicTreeVelocityMultiplyer;return n<0?i.left+=n:i.right+=n,o<0?i.top+=o:i.bottom+=o,e.bounds=i,this._insert(e),!0},t.prototype.untrackBody=function(t){var e=this.nodes[t.actor.id];e&&(this._remove(e),this.nodes[t.actor.id]=null,delete this.nodes[t.actor.id])},t.prototype._balance=function(t){if(null===t)throw new Error("Cannot balance at null node");if(t.isLeaf()||t.height<2)return t;var e=t.left,i=t.right,n=t,o=e,r=i,s=e.left,a=e.right,h=i.left,c=i.right,u=r.height-o.height;if(u>1)return r.left=n,r.parent=n.parent,n.parent=r,r.parent?r.parent.left===n?r.parent.left=r:r.parent.right=r:this.root=r,h.height>c.height?(r.right=h,n.right=c,c.parent=n,n.bounds=o.bounds.combine(c.bounds),r.bounds=n.bounds.combine(h.bounds),n.height=1+Math.max(o.height,c.height),r.height=1+Math.max(n.height,h.height)):(r.right=c,n.right=h,h.parent=n,n.bounds=o.bounds.combine(h.bounds),r.bounds=n.bounds.combine(c.bounds),n.height=1+Math.max(o.height,h.height),r.height=1+Math.max(n.height,c.height)),r;if(u<-1){if(o.left=n,o.parent=n.parent,n.parent=o,o.parent)if(o.parent.left===n)o.parent.left=o;else{if(o.parent.right!==n)throw"Error rotating Dynamic Tree";o.parent.right=o}else this.root=o;return s.height>a.height?(o.right=s,n.left=a,a.parent=n,n.bounds=r.bounds.combine(a.bounds),o.bounds=n.bounds.combine(s.bounds),n.height=1+Math.max(r.height,a.height),o.height=1+Math.max(n.height,s.height)):(o.right=a,n.left=s,s.parent=n,n.bounds=r.bounds.combine(s.bounds),o.bounds=n.bounds.combine(a.bounds),n.height=1+Math.max(r.height,s.height),o.height=1+Math.max(n.height,a.height)),o}return t},t.prototype.getHeight=function(){return null===this.root?0:this.root.height},t.prototype.query=function(t,e){var i=t.getBounds(),n=function(o){if(o&&o.bounds.collides(i)){if(!o.isLeaf()||o.body===t)return n(o.left)||n(o.right);if(e.call(t,o.body))return!0}return!1};n(this.root)},t.prototype.rayCastQuery=function(t,e,i){void 0===e&&(e=1/0);var n=function(o){if(o&&o.bounds.rayCast(t,e)){if(!o.isLeaf())return n(o.left)||n(o.right);if(i.call(t,o.body))return!0}return!1};n(this.root)},t.prototype.getNodes=function(){var t=function(e){return e?[e].concat(t(e.left),t(e.right)):[]};return t(this.root)},t.prototype.debugDraw=function(t){var e=function(i){i&&(i.isLeaf()?(t.lineWidth=1,t.strokeStyle="green"):(t.lineWidth=1,t.strokeStyle="white"),i.bounds.debugDraw(t),i.left&&e(i.left),i.right&&e(i.right))};e(this.root)},t}(),$e=function(){function t(){this._dynamicCollisionTree=new Je,this._collisionHash={},this._collisionPairCache=[],this._lastFramePairs=[],this._lastFramePairsHash={}}return t.prototype.track=function(t){t?this._dynamicCollisionTree.trackBody(t):Dt.getInstance().warn("Cannot track null physics body")},t.prototype.untrack=function(t){t?this._dynamicCollisionTree.untrackBody(t):Dt.getInstance().warn("Cannot untrack a null physics body")},t.prototype._shouldGenerateCollisionPair=function(t,e){var i=Pe.calculatePairHash(t.body,e.body);return!this._collisionHash[i]&&Pe.canCollide(t,e)},t.prototype.broadphase=function(t,e,i){var n=this,o=e/1e3,r=t.filter(function(t){return!t.isKilled()&&t.collisionType!==xe.PreventCollision});this._collisionPairCache=[],this._collisionHash={};for(var s=0,a=r.length;s<a;s++)u=r[s],this._dynamicCollisionTree.query(u.body,function(t){if(n._shouldGenerateCollisionPair(u,t.actor)){var e=new Pe(u.body,t);n._collisionHash[e.id]=!0,n._collisionPairCache.push(e)}return!1});if(i&&(i.physics.pairs=this._collisionPairCache.length),j.checkForFastBodies)for(var h=0,c=r;h<c.length;h++){var u;if((u=c[h]).collisionType===xe.Active){var l=u.vel.magnitude()*o+.5*u.acc.magnitude()*o*o,p=Math.min(u.body.getBounds().getHeight(),u.body.getBounds().getWidth());if(j.disableMinimumSpeedForFastBody||l>p/2){i&&i.physics.fastBodies++;var d,f=u.pos.sub(u.oldPos),_=u.body.collisionArea.getCenter(),g=u.body.collisionArea.getFurthestPoint(u.vel),y=g.sub(f),v=new R(y,u.vel);v.pos=v.pos.add(v.dir.scale(-2*j.surfaceEpsilon));var m=new O(1/0,1/0);if(this._dynamicCollisionTree.rayCastQuery(v,l+2*j.surfaceEpsilon,function(t){if(u.body!==t&&t.collisionArea){var e=t.collisionArea.rayCast(v,l+10*j.surfaceEpsilon);if(e){var i=e.sub(y);i.magnitude()<m.magnitude()&&(m=i,d=t)}}return!1}),d&&O.isValid(m)){var b=new Pe(u.body,d);this._collisionHash[b.id]||(this._collisionHash[b.id]=!0,this._collisionPairCache.push(b));var w=_.sub(g);u.pos=y.add(w).add(m).add(v.dir.scale(2*j.surfaceEpsilon)),u.body.collisionArea.recalc(),i&&i.physics.fastBodyCollisions++}}}}return this._collisionPairCache},t.prototype.narrowphase=function(t,e){for(var i=0;i<t.length;i++)t[i].collide(),e&&t[i].collision&&(e.physics.collisions++,e.physics.collidersHash[t[i].id]=t[i]);return t.filter(function(t){return t.collision})},t.prototype.resolve=function(t,e,i){for(var n=0,o=t;n<o.length;n++){var r=o[n];r.resolve(i),r.collision&&(r.bodyA.applyMtv(),r.bodyB.applyMtv(),r.bodyA.actor.integrate(e*j.collisionShift),r.bodyB.actor.integrate(e*j.collisionShift))}return t.filter(function(t){return t.canCollide})},t.prototype.runCollisionStartEnd=function(t){for(var e={},i=0,n=t;i<n.length;i++)if(e[(h=n[i]).id]=h,!this._lastFramePairsHash[h.id]){var o=h.bodyA.actor,r=h.bodyB.actor;o.emit("collisionstart",new pt(o,r,h)),r.emit("collisionstart",new pt(r,o,h))}for(var s=0,a=this._lastFramePairs;s<a.length;s++){var h;e[(h=a[s]).id]||(o=h.bodyA.actor,r=h.bodyB.actor,o.emit("collisionend",new dt(o,r)),r.emit("collisionend",new dt(r,o)))}this._lastFramePairs=t,this._lastFramePairsHash=e},t.prototype.update=function(t){for(var e=0,i=0,n=t.length;i<n;i++)this._dynamicCollisionTree.updateBody(t[i].body)&&e++;return e},t.prototype.debugDraw=function(t){if(j.broadphaseDebug&&this._dynamicCollisionTree.debugDraw(t),j.showContacts||j.showCollisionNormals)for(var e=0,i=this._collisionPairCache;e<i.length;e++)i[e].debugDraw(t)},t}(),ti=function(){function t(t){this._getComparable=t}return t.prototype.find=function(t){return this._find(this._root,t)},t.prototype._find=function(t,e){return null!=t&&(this._getComparable.call(e)===t.getKey()?t.getData().indexOf(e)>-1:this._getComparable.call(e)<t.getKey()?this._find(t.getLeft(),e):this._find(t.getRight(),e))},t.prototype.get=function(t){return this._get(this._root,t)},t.prototype._get=function(t,e){return null==t?[]:e===t.getKey()?t.getData():e<t.getKey()?this._get(t.getLeft(),e):this._get(t.getRight(),e)},t.prototype.add=function(t){return null==this._root?(this._root=new ei(this._getComparable.call(t),[t],null,null),!0):this._insert(this._root,t)},t.prototype._insert=function(t,e){return null!=t&&(this._getComparable.call(e)===t.getKey()?!(t.getData().indexOf(e)>-1||(t.getData().push(e),0)):this._getComparable.call(e)<t.getKey()?null==t.getLeft()?(t.setLeft(new ei(this._getComparable.call(e),[e],null,null)),!0):this._insert(t.getLeft(),e):null==t.getRight()?(t.setRight(new ei(this._getComparable.call(e),[e],null,null)),!0):this._insert(t.getRight(),e))},t.prototype.removeByComparable=function(t){this._root=this._remove(this._root,t)},t.prototype._remove=function(t,e){if(null==t)return null;if(this._getComparable.call(e)!==t.getKey())return this._getComparable.call(e)<t.getKey()?(t.setLeft(this._remove(t.getLeft(),e)),t):(t.setRight(this._remove(t.getRight(),e)),t);var i=t.getData().indexOf(e);if(i>-1){if(t.getData().splice(i,1),0===t.getData().length){if(null==t.getLeft()&&null==t.getRight())return null;if(null==t.getLeft())return t.getRight();if(null==t.getRight())return t.getLeft();var n=this._findMinNode(t.getRight());return t.setKey(n.getKey()),t.setData(n.getData()),t.setRight(this._cleanup(t.getRight(),n)),t}return t}return null},t.prototype._cleanup=function(t,e){var i=e.getKey();if(null==t)return null;if(i===t.getKey()){if(null==t.getLeft()&&null==t.getRight())return null;if(null==t.getLeft())return t.getRight();if(null==t.getRight())return t.getLeft();var n=this._findMinNode(t.getRight());return t.setKey(n.getKey()),t.setData(n.getData()),t.setRight(this._cleanup(t.getRight(),n)),t}return this._getComparable.call(e)<t.getKey()?(t.setLeft(this._cleanup(t.getLeft(),e)),t):(t.setRight(this._cleanup(t.getRight(),e)),t)},t.prototype._findMinNode=function(t){for(var e=t;null!=e.getLeft();)e=e.getLeft();return e},t.prototype.list=function(){var t=new Array;return this._list(this._root,t),t},t.prototype._list=function(t,e){null!=t&&(this._list(t.getLeft(),e),t.getData().forEach(function(t){e.push(t)}),this._list(t.getRight(),e))},t}(),ei=function(){function t(t,e,i,n){this._key=t,this._data=e,this._left=i,this._right=n}return t.prototype.getKey=function(){return this._key},t.prototype.setKey=function(t){this._key=t},t.prototype.getData=function(){return this._data},t.prototype.setData=function(t){this._data=t},t.prototype.getLeft=function(){return this._left},t.prototype.setLeft=function(t){this._left=t},t.prototype.getRight=function(){return this._right},t.prototype.setRight=function(t){this._right=t},t}(),ii=function(){function t(t){this._key=0,this._key=t}return t.prototype.getTheKey=function(){return this._key},t.prototype.setKey=function(t){this._key=t},t}(),ni=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),oi=function(t){function e(e,i){var n=t.call(this)||this;return n.name=e,n.scene=i,n._logger=Dt.getInstance(),n._members=[],n.actions=new ge,null==i?n._logger.error("Invalid constructor arguments passed to Group: ",e,", scene must not be null!"):(i.groups[e]&&n._logger.warn("Group with name",e,"already exists. This new group will replace it."),i.groups[e]=n),n}return ni(e,t),e.prototype.add=function(t){t instanceof Me&&(t=[].concat(t));for(var e=0,i=t.length;e<i;e++)-1===this.getMembers().indexOf(t[e])&&(this._members.push(t[e]),this.scene.add(t[e]),this.actions.addActorToContext(t[e]),this.eventDispatcher.wire(t[e].eventDispatcher))},e.prototype.remove=function(t){var e=this._members.indexOf(t);e>-1&&(this._members.splice(e,1),this.actions.removeActorFromContext(t),this.eventDispatcher.unwire(t.eventDispatcher))},e.prototype.move=function(t){var e=0,i=this.getMembers(),n=i.length;if(1===arguments.length&&t instanceof O)for(;e<n;e++)i[e].pos.x+=t.x,i[e].pos.y+=t.y;else if("number"==typeof arguments[0]&&"number"==typeof arguments[1])for(var o=arguments[0],r=arguments[1];e<n;e++)i[e].pos.x+=o,i[e].pos.y+=r;else this._logger.error("Invalid arguments passed to group move",this.name,"args:",arguments)},e.prototype.rotate=function(t){if("number"==typeof t)for(var e=0,i=this.getMembers();e<i.length;e++)i[e].rotation+=t;else this._logger.error("Invalid arguments passed to group rotate",this.name,"args:",arguments)},e.prototype.on=function(t,e){this.eventDispatcher.on(t,e)},e.prototype.off=function(t,e){this.eventDispatcher.off(t,e)},e.prototype.emit=function(t,e){this.eventDispatcher.emit(t,e)},e.prototype.contains=function(t){return this.getMembers().indexOf(t)>-1},e.prototype.getMembers=function(){return this._members},e.prototype.getRandomMember=function(){return this._members[Math.floor(Math.random()*this._members.length)]},e.prototype.getBounds=function(){return this.getMembers().map(function(t){return t.getBounds()}).reduce(function(t,e){return t.combine(e)})},e}(xt),ri=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),si=function(){function t(t){this.camera=t}return t.prototype.lockToActor=function(t){this.camera.addStrategy(new li(t))},t.prototype.lockToActorAxis=function(t,e){this.camera.addStrategy(new pi(t,e))},t.prototype.elasticToActor=function(t,e,i){this.camera.addStrategy(new di(t,e,i))},t.prototype.radiusAroundActor=function(t,e){this.camera.addStrategy(new fi(t,e))},t}();!function(t){t[t.X=0]="X",t[t.Y=1]="Y"}(Ue||(Ue={}));var ai,hi,ci,ui,li=function(t){this.target=t,this.action=function(t,e,i,n){return t.getCenter()}},pi=function(t,e){var i=this;this.target=t,this.axis=e,this.action=function(t,e,n,o){var r=t.getCenter(),s=e.getFocus();return i.axis===Ue.X?new O(r.x,s.y):new O(s.x,r.y)}},di=function(t,e,i){var n=this;this.target=t,this.cameraElasticity=e,this.cameraFriction=i,this.action=function(t,e,i,o){var r=t.getCenter(),s=e.getFocus(),a=new O(e.dx,e.dy),h=r.sub(s).scale(n.cameraElasticity),c=(a=a.add(h)).scale(-1).scale(n.cameraFriction);return a=a.add(c),s.add(a)}},fi=function(t,e){var i=this;this.target=t,this.radius=e,this.action=function(t,e,n,o){var r=t.getCenter(),s=e.getFocus(),a=r.sub(s),h=a.magnitude();if(h>=i.radius){var c=h-i.radius;return s.add(a.normalize().scale(c))}return s}},_i=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._cameraStrategies=[],e.strategy=new si(e),e.z=1,e.dx=0,e.dy=0,e.dz=0,e.ax=0,e.ay=0,e.az=0,e.rotation=0,e.rx=0,e._x=0,e._y=0,e._cameraMoving=!1,e._currentLerpTime=0,e._lerpDuration=1e3,e._lerpStart=null,e._lerpEnd=null,e._isShaking=!1,e._shakeMagnitudeX=0,e._shakeMagnitudeY=0,e._shakeDuration=0,e._elapsedShakeTime=0,e._xShake=0,e._yShake=0,e._isZooming=!1,e._zoomStart=1,e._zoomEnd=1,e._currentZoomTime=0,e._zoomDuration=0,e._zoomEasing=_e.EaseInOutCubic,e._easing=_e.EaseInOutCubic,e._isInitialized=!1,e}return ri(e,t),Object.defineProperty(e.prototype,"x",{get:function(){return this._x},set:function(t){this._follow||this._cameraMoving||(this._x=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},set:function(t){this._follow||this._cameraMoving||(this._y=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pos",{get:function(){return new O(this.x,this.y)},set:function(t){this.x=t.x,this.y=t.y},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"vel",{get:function(){return new O(this.dx,this.dy)},set:function(t){this.dx=t.x,this.dy=t.y},enumerable:!0,configurable:!0}),e.prototype.getFocus=function(){return new O(this.x,this.y)},e.prototype.move=function(t,e,i){if(void 0===i&&(i=_e.EaseInOutCubic),"function"!=typeof i)throw"Please specify an EasingFunction";return this._follow?(new p).reject(t):(this._lerpPromise&&this._lerpPromise.state()===c.Pending&&this._lerpPromise.resolve(t),this._lerpPromise=new p,this._lerpStart=this.getFocus().clone(),this._lerpDuration=e,this._lerpEnd=t,this._currentLerpTime=0,this._cameraMoving=!0,this._easing=i,this._lerpPromise)},e.prototype.shake=function(t,e,i){this._isShaking=!0,this._shakeMagnitudeX=t,this._shakeMagnitudeY=e,this._shakeDuration=i},e.prototype.zoom=function(t,e,i){return void 0===e&&(e=0),void 0===i&&(i=_e.EaseInOutCubic),this._zoomPromise=new p,e?(this._isZooming=!0,this._zoomEasing=i,this._currentZoomTime=0,this._zoomDuration=e,this._zoomStart=this.z,this._zoomEnd=t):(this._isZooming=!1,this.z=t,this._zoomPromise.resolve(!0)),this._zoomPromise},e.prototype.getZoom=function(){return this.z},e.prototype.addStrategy=function(t){this._cameraStrategies.push(t)},e.prototype.removeStrategy=function(t){A(t,this._cameraStrategies)},e.prototype.clearAllStrategies=function(){this._cameraStrategies.length=0},e.prototype._preupdate=function(t,e){this.emit("preupdate",new J(t,e,this)),this.onPreUpdate(t,e)},e.prototype.onPreUpdate=function(t,e){},e.prototype._postupdate=function(t,e){this.emit("postupdate",new $(t,e,this)),this.onPostUpdate(t,e)},e.prototype.onPostUpdate=function(t,e){},Object.defineProperty(e.prototype,"isInitialized",{get:function(){return this._isInitialized},enumerable:!0,configurable:!0}),e.prototype._initialize=function(e){this.isInitialized||(this.onInitialize(e),t.prototype.emit.call(this,"initialize",new ft(e,this)),this._isInitialized=!0)},e.prototype.onInitialize=function(t){},e.prototype.on=function(e,i){t.prototype.on.call(this,e,i)},e.prototype.off=function(e,i){t.prototype.off.call(this,e,i)},e.prototype.once=function(e,i){t.prototype.once.call(this,e,i)},e.prototype.update=function(t,e){if(this._initialize(t),this._preupdate(t,e),this._x+=this.dx*e/1e3,this._y+=this.dy*e/1e3,this.z+=this.dz*e/1e3,this.dx+=this.ax*e/1e3,this.dy+=this.ay*e/1e3,this.dz+=this.az*e/1e3,this.rotation+=this.rx*e/1e3,this._isZooming)if(this._currentZoomTime<this._zoomDuration){var i=(0,this._zoomEasing)(this._currentZoomTime,this._zoomStart,this._zoomEnd,this._zoomDuration);this.z=i,this._currentZoomTime+=e}else this._isZooming=!1,this.z=this._zoomEnd,this._currentZoomTime=0,this._zoomPromise.resolve(!0);if(this._cameraMoving)if(this._currentLerpTime<this._lerpDuration){var n=_e.CreateVectorEasingFunction(this._easing)(this._currentLerpTime,this._lerpStart,this._lerpEnd,this._lerpDuration);this._x=n.x,this._y=n.y,this._currentLerpTime+=e}else{this._x=this._lerpEnd.x,this._y=this._lerpEnd.y;var o=this._lerpEnd.clone();this._lerpStart=null,this._lerpEnd=null,this._currentLerpTime=0,this._cameraMoving=!1,this._lerpPromise.resolve(o)}this._isDoneShaking()?(this._isShaking=!1,this._elapsedShakeTime=0,this._shakeMagnitudeX=0,this._shakeMagnitudeY=0,this._shakeDuration=0,this._xShake=0,this._yShake=0):(this._elapsedShakeTime+=e,this._xShake=1+(Math.random()*this._shakeMagnitudeX|0),this._yShake=1+(Math.random()*this._shakeMagnitudeY|0));for(var r=0,s=this._cameraStrategies;r<s.length;r++){var a=s[r];this.pos=a.action.call(a,a.target,this,t,e)}this._postupdate(t,e)},e.prototype.draw=function(t){var e=this.getFocus(),i=t.canvas.width,n=t.canvas.height,o=window.devicePixelRatio,r=this.getZoom(),s=i/r/o,a=n/r/o;t.scale(r,r),t.translate(-e.x+s/2+this._xShake,-e.y+a/2+this._yShake)},e.prototype.debugDraw=function(t){var e=this.getFocus();t.fillStyle="red",t.strokeStyle="white",t.lineWidth=3,t.beginPath(),t.arc(e.x,e.y,15,0,2*Math.PI),t.closePath(),t.stroke(),t.beginPath(),t.arc(e.x,e.y,5,0,2*Math.PI),t.closePath(),t.stroke()},e.prototype._isDoneShaking=function(){return!this._isShaking||this._elapsedShakeTime>=this._shakeDuration},e}(xt),gi=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();!function(t){t[t.Em=0]="Em",t[t.Rem=1]="Rem",t[t.Px=2]="Px",t[t.Pt=3]="Pt",t[t.Percent=4]="Percent"}(ai||(ai={})),function(t){t[t.Left=0]="Left",t[t.Right=1]="Right",t[t.Center=2]="Center",t[t.Start=3]="Start",t[t.End=4]="End"}(hi||(hi={})),function(t){t[t.Top=0]="Top",t[t.Hanging=1]="Hanging",t[t.Middle=2]="Middle",t[t.Alphabetic=3]="Alphabetic",t[t.Ideographic=4]="Ideographic",t[t.Bottom=5]="Bottom"}(ci||(ci={})),function(t){t[t.Normal=0]="Normal",t[t.Italic=1]="Italic",t[t.Oblique=2]="Oblique"}(ui||(ui={}));var yi=function(t){function e(e,i,n,o,r){return t.call(this,e,i,n,o,r)||this}return gi(e,t),e}(Vt(function(t){function e(e,i,n,o,r){var s=t.call(this,e&&"object"==typeof e?{x:e.x,y:e.y}:{x:i,y:n})||this;s.bold=!1,s.fontSize=10,s.fontStyle=ui.Normal,s.fontUnit=ai.Px,s.textAlign=hi.Left,s.baseAlign=ci.Bottom,s.letterSpacing=0,s.caseInsensitive=!0;var a="";return e&&"object"==typeof e?(o=e.fontFamily,r=e.spriteFont,a=e.text):a=e,s.text=a||"",s.color=Pt.Black.clone(),s.spriteFont=r,s.collisionType=xe.PreventCollision,s.fontFamily=o||"sans-serif",s._textShadowOn=!1,s._shadowOffsetX=0,s._shadowOffsetY=0,s}return gi(e,t),e.prototype.getTextWidth=function(t){var e=t.font;t.font=this._fontString;var i=t.measureText(this.text).width;return t.font=e,i},e.prototype._lookupFontUnit=function(t){switch(t){case ai.Em:return"em";case ai.Rem:return"rem";case ai.Pt:return"pt";case ai.Px:return"px";case ai.Percent:return"%";default:return"px"}},e.prototype._lookupTextAlign=function(t){switch(t){case hi.Left:return"left";case hi.Right:return"right";case hi.Center:return"center";case hi.End:return"end";case hi.Start:default:return"start"}},e.prototype._lookupBaseAlign=function(t){switch(t){case ci.Alphabetic:return"alphabetic";case ci.Bottom:return"bottom";case ci.Hanging:return"hangin";case ci.Ideographic:return"ideographic";case ci.Middle:return"middle";case ci.Top:return"top";default:return"alphabetic"}},e.prototype._lookupFontStyle=function(t){var e=this.bold?" bold":"";switch(t){case ui.Italic:return"italic"+e;case ui.Normal:return"normal"+e;case ui.Oblique:return"oblique"+e;default:return"normal"+e}},e.prototype.setTextShadow=function(t,e,i){this.spriteFont.setTextShadow(t,e,i)},e.prototype.useTextShadow=function(t){this.spriteFont.useTextShadow(t)},e.prototype.clearTextShadow=function(){this._textShadowOn=!1,this._shadowOffsetX=0,this._shadowOffsetY=0},e.prototype.update=function(e,i){t.prototype.update.call(this,e,i)},e.prototype.draw=function(e,i){e.save(),e.translate(this.pos.x,this.pos.y),e.scale(this.scale.x,this.scale.y),e.rotate(this.rotation),this._textShadowOn&&(e.save(),e.translate(this._shadowOffsetX,this._shadowOffsetY),this._fontDraw(e),e.restore()),this._fontDraw(e),t.prototype.draw.call(this,e,i),e.restore()},e.prototype._fontDraw=function(t){if(this.spriteFont)this.spriteFont.draw(t,this.text,0,0,{color:this.color.clone(),baseAlign:this.baseAlign,textAlign:this.textAlign,fontSize:this.fontSize,letterSpacing:this.letterSpacing,opacity:this.opacity});else{var e=t.textAlign,i=t.textBaseline;t.textAlign=this._lookupTextAlign(this.textAlign),t.textBaseline=this._lookupBaseAlign(this.baseAlign),this.color&&(this.color.a=this.opacity),t.fillStyle=this.color.toString(),t.font=this._fontString,this.maxWidth?t.fillText(this.text,0,0,this.maxWidth):t.fillText(this.text,0,0),t.textAlign=e,t.textBaseline=i}},Object.defineProperty(e.prototype,"_fontString",{get:function(){return this._lookupFontStyle(this.fontStyle)+" "+this.fontSize+this._lookupFontUnit(this.fontUnit)+" "+this.fontFamily},enumerable:!0,configurable:!0}),e.prototype.debugDraw=function(e){t.prototype.debugDraw.call(this,e)},e}(Me))),vi=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),mi={pos:O.Zero.clone(),width:10,height:10,visible:!1,action:function(){},filter:function(){return!0},repeat:-1},bi=function(t){function e(e){var i=t.call(this,e.pos.x,e.pos.y,e.width,e.height)||this;return i.action=function(){},i.filter=function(){return!0},i.repeat=-1,e=_({},mi,e),i.filter=e.filter||i.filter,i.repeat=e.repeat||i.repeat,i.action=e.action||i.action,e.target&&(i.target=e.target),i.visible=e.visible,i.collisionType=xe.Passive,i.eventDispatcher=new wt(i),i.actionQueue=new fe(i),i.on("collisionstart",function(t){i.filter(t.other)&&(i.emit("enter",new mt(i,t.other)),i._dispatchAction(),0===i.repeat&&i.kill())}),i.on("collisionend",function(t){i.filter(t.other)&&i.emit("exit",new bt(i,t.other))}),i}return vi(e,t),Object.defineProperty(e.prototype,"target",{get:function(){return this._target},set:function(t){this._target=t,this.filter=function(e){return e===t}},enumerable:!0,configurable:!0}),e.prototype._initialize=function(e){t.prototype._initialize.call(this,e)},e.prototype._dispatchAction=function(){this.action.call(this),this.repeat--},e.prototype.debugDraw=function(e){t.prototype.debugDraw.call(this,e),e.save(),e.translate(this.pos.x,this.pos.y);var i=this.getBounds(),n=this.getWorldPos();i.left=i.left-n.x,i.right=i.right-n.x,i.top=i.top-n.y,i.bottom=i.bottom-n.y,e.fillStyle=Pt.Violet.toString(),e.strokeStyle=Pt.Violet.toString(),e.fillText("Trigger",10,10),i.debugDraw(e),e.restore()},e}(Me);function wi(t){return t instanceof Be}var xi,Pi=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Si=function(t){function e(e){var i=t.call(this)||this;return i.actors=[],i.triggers=[],i.tileMaps=[],i.groups={},i.uiActors=[],i._isInitialized=!1,i._sortedDrawingTree=new ti(Me.prototype.getZIndex),i._broadphase=new $e,i._killQueue=[],i._triggerKillQueue=[],i._timers=[],i._cancelQueue=[],i._logger=Dt.getInstance(),i.camera=new _i,e&&(i.camera.x=e.halfDrawWidth,i.camera.y=e.halfDrawHeight),i}return Pi(e,t),e.prototype.on=function(e,i){t.prototype.on.call(this,e,i)},e.prototype.once=function(e,i){t.prototype.once.call(this,e,i)},e.prototype.off=function(e,i){t.prototype.off.call(this,e,i)},e.prototype.onInitialize=function(t){},e.prototype.onActivate=function(t,e){},e.prototype.onDeactivate=function(t,e){},e.prototype.onPreUpdate=function(t,e){},e.prototype.onPostUpdate=function(t,e){},e.prototype.onPreDraw=function(t,e){},e.prototype.onPostDraw=function(t,e){},e.prototype._initializeChildren=function(){for(var t=0,e=this.actors;t<e.length;t++)e[t]._initialize(this.engine)},Object.defineProperty(e.prototype,"isInitialized",{get:function(){return this._isInitialized},enumerable:!0,configurable:!0}),e.prototype._initialize=function(t){this.isInitialized||(this.camera&&(this.camera.x=t.halfDrawWidth,this.camera.y=t.halfDrawHeight),this._initializeChildren(),this._logger.debug("Scene.onInitialize",this,t),this.eventDispatcher.emit("initialize",new ft(t,this)),this.onInitialize.call(this,t),this._isInitialized=!0)},e.prototype._activate=function(t,e){this._logger.debug("Scene.onActivate",this),this.onActivate(t,e)},e.prototype._deactivate=function(t,e){this._logger.debug("Scene.onDectivate",this),this.onDeactivate(t,e)},e.prototype._preupdate=function(t,e){this.emit("preupdate",new J(t,e,this)),this.onPreUpdate(t,e)},e.prototype._postupdate=function(t,e){this.emit("postupdate",new $(t,e,this)),this.onPostUpdate(t,e)},e.prototype._predraw=function(t,e){this.emit("predraw",new Z(t,e,this)),this.onPreDraw(t,e)},e.prototype._postdraw=function(t,e){this.emit("postdraw",new K(t,e,this)),this.onPostDraw(t,e)},e.prototype.update=function(t,e){var i,n;for(this._preupdate(t,e),i=0,n=this._cancelQueue.length;i<n;i++)this.removeTimer(this._cancelQueue[i]);this._cancelQueue.length=0;for(var o=0,r=this._timers;o<r.length;o++)r[o].update(e);for(i=0,n=this.uiActors.length;i<n;i++)this.uiActors[i].update(t,e);for(i=0,n=this.tileMaps.length;i<n;i++)this.tileMaps[i].update(t,e);for(i=0,n=this.actors.length;i<n;i++)this.actors[i].update(t,e);for(i=0,n=this.triggers.length;i<n;i++)this.triggers[i].update(t,e);if(this._collectActorStats(t),t.input.pointers.propagate(),this._broadphase&&j.enabled){var s=Date.now();this._broadphase.update(this.actors,e);for(var a=this._broadphase.broadphase(this.actors,e,t.stats.currFrame),h=Date.now(),c=Date.now(),u=j.collisionPasses,l=e/u;u>0;)a=this._broadphase.narrowphase(a,t.stats.currFrame),a=this._broadphase.resolve(a,l,j.collisionResolutionStrategy),this._broadphase.runCollisionStartEnd(a),u--;var p=Date.now();t.stats.currFrame.physics.broadphase=h-s,t.stats.currFrame.physics.narrowphase=p-c}t.stats.currFrame.actors.killed=this._killQueue.length+this._triggerKillQueue.length,this._processKillQueue(this._killQueue,this.actors),this._processKillQueue(this._triggerKillQueue,this.triggers),this.camera&&this.camera.update(t,e),this._postupdate(t,e)},e.prototype._processKillQueue=function(t,e){for(var i,n=0,o=t;n<o.length;n++){var r=o[n];r.isKilled()&&(i=e.indexOf(r))>-1&&(this._sortedDrawingTree.removeByComparable(r),e.splice(i,1))}t.length=0},e.prototype.draw=function(t,e){var i,n;for(this._predraw(t,e),t.save(),this.camera&&this.camera.draw(t),i=0,n=this.tileMaps.length;i<n;i++)this.tileMaps[i].draw(t,e);var o=this._sortedDrawingTree.list();for(i=0,n=o.length;i<n;i++)o[i].visible&&!o[i].isOffScreen&&o[i].draw(t,e);for(this.engine&&this.engine.isDebug&&(t.strokeStyle="yellow",this.debugDraw(t)),t.restore(),i=0,n=this.uiActors.length;i<n;i++)this.uiActors[i].visible&&this.uiActors[i].draw(t,e);if(this.engine&&this.engine.isDebug)for(i=0,n=this.uiActors.length;i<n;i++)this.uiActors[i].debugDraw(t);this._postdraw(t,e)},e.prototype.debugDraw=function(t){var e,i;for(this.emit("predebugdraw",new Y(t,this)),e=0,i=this.tileMaps.length;e<i;e++)this.tileMaps[e].debugDraw(t);for(e=0,i=this.actors.length;e<i;e++)this.actors[e].debugDraw(t);for(e=0,i=this.triggers.length;e<i;e++)this.triggers[e].debugDraw(t);this._broadphase.debugDraw(t,20),this.camera.debugDraw(t),this.emit("postdebugdraw",new Q(t,this))},e.prototype.contains=function(t){return this.actors.indexOf(t)>-1},e.prototype.add=function(t){t instanceof Me&&t.unkill(),t instanceof Be?E(this.uiActors,t)||this.addUIActor(t):t instanceof Me?E(this.actors,t)||this._addChild(t):t instanceof Oe?E(this._timers,t)||this.addTimer(t):t instanceof ze&&(E(this.tileMaps,t)||this.addTileMap(t))},e.prototype.remove=function(t){t instanceof Be?this.removeUIActor(t):(t instanceof Me&&this._removeChild(t),t instanceof Oe&&this.removeTimer(t),t instanceof ze&&this.removeTileMap(t))},e.prototype.addUIActor=function(t){this.uiActors.push(t),t.scene=this},e.prototype.removeUIActor=function(t){var e=this.uiActors.indexOf(t);e>-1&&this.uiActors.splice(e,1)},e.prototype._addChild=function(t){this._broadphase.track(t.body),t.scene=this,t instanceof bi?this.triggers.push(t):this.actors.push(t),this._sortedDrawingTree.add(t)},e.prototype.addTileMap=function(t){this.tileMaps.push(t)},e.prototype.removeTileMap=function(t){var e=this.tileMaps.indexOf(t);e>-1&&this.tileMaps.splice(e,1)},e.prototype._removeChild=function(t){E(this.actors,t)&&(this._broadphase.untrack(t.body),t instanceof bi?this._triggerKillQueue.push(t):(t.isKilled()||t.kill(),this._killQueue.push(t)),t.parent=null)},e.prototype.addTimer=function(t){return this._timers.push(t),t.scene=this,t},e.prototype.removeTimer=function(t){var e=this._timers.indexOf(t);return-1!==e&&this._timers.splice(e,1),t},e.prototype.cancelTimer=function(t){return this._cancelQueue.push(t),t},e.prototype.isTimerActive=function(t){return this._timers.indexOf(t)>-1&&!t.complete},e.prototype.createGroup=function(t){return new oi(t,this)},e.prototype.getGroup=function(t){return this.groups[t]},e.prototype.removeGroup=function(t){"string"==typeof t?delete this.groups[t]:t instanceof oi?delete this.groups[t.name]:this._logger.error("Invalid arguments to removeGroup",t)},e.prototype.cleanupDrawTree=function(t){this._sortedDrawingTree.removeByComparable(t)},e.prototype.updateDrawTree=function(t){this._sortedDrawingTree.add(t)},e.prototype.isActorInDrawTree=function(t){return this._sortedDrawingTree.find(t)},e.prototype.isCurrentScene=function(){return!!this.engine&&this.engine.currentScene===this},e.prototype._collectActorStats=function(t){for(var e=0,i=this.uiActors;e<i.length;e++)i[e],t.stats.currFrame.actors.ui++;for(var n=0,o=this.actors;n<o.length;n++){var r=o[n];t.stats.currFrame.actors.alive++;for(var s=0,a=r.children;s<a.length;s++)wi(a[s])?t.stats.currFrame.actors.ui++:t.stats.currFrame.actors.alive++}},e}(xt),Ai=function(){this.stats={currFrame:new Ei,prevFrame:new Ei}},Ei=function(){function t(){this._id=0,this._delta=0,this._fps=0,this._actorStats={alive:0,killed:0,ui:0,get remaining(){return this.alive-this.killed},get total(){return this.remaining+this.ui}},this._durationStats={update:0,draw:0,get total(){return this.update+this.draw}},this._physicsStats=new ki}return t.prototype.reset=function(t){t?(this.id=t.id,this.delta=t.delta,this.fps=t.fps,this.actors.alive=t.actors.alive,this.actors.killed=t.actors.killed,this.actors.ui=t.actors.ui,this.duration.update=t.duration.update,this.duration.draw=t.duration.draw,this._physicsStats.reset(t.physics)):(this.id=this.delta=this.fps=0,this.actors.alive=this.actors.killed=this.actors.ui=0,this.duration.update=this.duration.draw=0,this._physicsStats.reset())},t.prototype.clone=function(){var e=new t;return e.reset(this),e},Object.defineProperty(t.prototype,"id",{get:function(){return this._id},set:function(t){this._id=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"delta",{get:function(){return this._delta},set:function(t){this._delta=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fps",{get:function(){return this._fps},set:function(t){this._fps=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"actors",{get:function(){return this._actorStats},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"duration",{get:function(){return this._durationStats},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"physics",{get:function(){return this._physicsStats},enumerable:!0,configurable:!0}),t}(),ki=function(){function t(){this._pairs=0,this._collisions=0,this._collidersHash={},this._fastBodies=0,this._fastBodyCollisions=0,this._broadphase=0,this._narrowphase=0}return t.prototype.reset=function(t){t?(this.pairs=t.pairs,this.collisions=t.collisions,this.collidersHash=t.collidersHash,this.fastBodies=t.fastBodies,this.fastBodyCollisions=t.fastBodyCollisions,this.broadphase=t.broadphase,this.narrowphase=t.narrowphase):(this.pairs=this.collisions=this.fastBodies=0,this.fastBodyCollisions=this.broadphase=this.narrowphase=0,this.collidersHash={})},t.prototype.clone=function(){var e=new t;return e.reset(this),e},Object.defineProperty(t.prototype,"pairs",{get:function(){return this._pairs},set:function(t){this._pairs=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"collisions",{get:function(){return this._collisions},set:function(t){this._collisions=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"collidersHash",{get:function(){return this._collidersHash},set:function(t){this._collidersHash=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fastBodies",{get:function(){return this._fastBodies},set:function(t){this._fastBodies=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fastBodyCollisions",{get:function(){return this._fastBodyCollisions},set:function(t){this._fastBodyCollisions=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"broadphase",{get:function(){return this._broadphase},set:function(t){this._broadphase=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"narrowphase",{get:function(){return this._narrowphase},set:function(t){this._narrowphase=t},enumerable:!0,configurable:!0}),t}(),Ci=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();!function(t){t[t.Num1=97]="Num1",t[t.Num2=98]="Num2",t[t.Num3=99]="Num3",t[t.Num4=100]="Num4",t[t.Num5=101]="Num5",t[t.Num6=102]="Num6",t[t.Num7=103]="Num7",t[t.Num8=104]="Num8",t[t.Num9=105]="Num9",t[t.Num0=96]="Num0",t[t.Numlock=144]="Numlock",t[t.Semicolon=186]="Semicolon",t[t.A=65]="A",t[t.B=66]="B",t[t.C=67]="C",t[t.D=68]="D",t[t.E=69]="E",t[t.F=70]="F",t[t.G=71]="G",t[t.H=72]="H",t[t.I=73]="I",t[t.J=74]="J",t[t.K=75]="K",t[t.L=76]="L",t[t.M=77]="M",t[t.N=78]="N",t[t.O=79]="O",t[t.P=80]="P",t[t.Q=81]="Q",t[t.R=82]="R",t[t.S=83]="S",t[t.T=84]="T",t[t.U=85]="U",t[t.V=86]="V",t[t.W=87]="W",t[t.X=88]="X",t[t.Y=89]="Y",t[t.Z=90]="Z",t[t.Shift=16]="Shift",t[t.Alt=18]="Alt",t[t.Up=38]="Up",t[t.Down=40]="Down",t[t.Left=37]="Left",t[t.Right=39]="Right",t[t.Space=32]="Space",t[t.Esc=27]="Esc"}(xi||(xi={}));var Ti,Mi,Di,Bi,Oi=function(t){function e(e){var i=t.call(this)||this;return i.key=e,i}return Ci(e,t),e}(W),Ri=function(t){function e(){var e=t.call(this)||this;return e._keys=[],e._keysUp=[],e._keysDown=[],e}return Ci(e,t),e.prototype.on=function(e,i){t.prototype.on.call(this,e,i)},e.prototype.init=function(t){var e=this;(t=t||window).addEventListener("blur",function(){e._keys.length=0}),t.addEventListener("keyup",function(t){var i=e._normalizeKeyCode(t.keyCode),n=e._keys.indexOf(i);e._keys.splice(n,1),e._keysUp.push(i);var o=new Oi(i);e.eventDispatcher.emit("up",o),e.eventDispatcher.emit("release",o)}),t.addEventListener("keydown",function(t){var i=e._normalizeKeyCode(t.keyCode);if(-1===e._keys.indexOf(i)){e._keys.push(i),e._keysDown.push(i);var n=new Oi(i);e.eventDispatcher.emit("down",n),e.eventDispatcher.emit("press",n)}})},e.prototype.update=function(){this._keysDown.length=0,this._keysUp.length=0;for(var t=0;t<this._keys.length;t++)this.eventDispatcher.emit("hold",new Oi(this._keys[t]))},e.prototype.getKeys=function(){return this._keys},e.prototype.wasPressed=function(t){return this._keysDown.indexOf(t)>-1},e.prototype.isHeld=function(t){return this._keys.indexOf(t)>-1},e.prototype.wasReleased=function(t){return this._keysUp.indexOf(t)>-1},e.prototype._normalizeKeyCode=function(t){switch(t){case 59:return xi.Semicolon;default:return t}},e}(xt),zi=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();!function(t){t[t.Touch=0]="Touch",t[t.Mouse=1]="Mouse",t[t.Pen=2]="Pen",t[t.Unknown=3]="Unknown"}(Ti||(Ti={})),function(t){t[t.Left=0]="Left",t[t.Middle=1]="Middle",t[t.Right=2]="Right",t[t.Unknown=3]="Unknown"}(Mi||(Mi={})),function(t){t[t.Pixel=0]="Pixel",t[t.Line=1]="Line",t[t.Page=2]="Page"}(Di||(Di={})),function(t){t[t.Canvas=0]="Canvas",t[t.Document=1]="Document"}(Bi||(Bi={}));var Fi=function(t){function e(e,i,n,o,r,s){var a=t.call(this)||this;return a.coordinates=e,a.pointer=i,a.index=n,a.pointerType=o,a.button=r,a.ev=s,a}return zi(e,t),Object.defineProperty(e.prototype,"worldPos",{get:function(){return this.coordinates.worldPos.clone()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pagePos",{get:function(){return this.coordinates.pagePos.clone()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"screenPos",{get:function(){return this.coordinates.screenPos.clone()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pos",{get:function(){return this.coordinates.worldPos.clone()},enumerable:!0,configurable:!0}),e.prototype.layPath=function(t){if(this.pointer.isActorUnderPointer(t)){var e=t.getAncestors();this._path=e.length>this._path.length?e:this._path}},e}(W),Ii=function(){function t(t){this._pointerEventType=t}return t.prototype.create=function(t,e,i,n,o,r){return new this._pointerEventType(t,e,i,n,o,r)},t}(),Li=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return zi(e,t),e}(Fi),Hi=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._name="pointerup",e}return zi(e,t),e.prototype._onActionEnd=function(t){this.pointer.isDragEnd&&t.capturePointer.captureDragEvents&&t.eventDispatcher.emit("pointerdragend",this)},e}(Fi),ji=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._name="pointerdown",e}return zi(e,t),e.prototype._onActionEnd=function(t){this.pointer.isDragStart&&t.capturePointer.captureDragEvents&&t.eventDispatcher.emit("pointerdragstart",this)},e}(Fi),Ui=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._name="pointermove",e}return zi(e,t),e.prototype.propagate=function(){var t=this;this.eventPath.length?(this.action(),this.bubbles&&this.propagate()):this.pointer.hasActorsUnderPointer&&this.pointer.getActorsUnderPointer().forEach(function(e){t.pointer.isActorUnderPointer(e)||t._onActorLeave(e)})},e.prototype.layPath=function(t){if(this.pointer.isDragging)t=this.pointer.dragTarget||t;else if(!this.pointer.isActorUnderPointer(t))return;var e=t.getAncestors();this._path=e.length>this._path.length?e:this._path},e.prototype._onActionStart=function(t){t.capturePointer.captureMoveEvents&&(this.pointer.isActorUnderPointer(t)&&!this.pointer.hasActorUnderPointerInList(t)&&this._onActorEnter(t),this.pointer.isDragging&&t.capturePointer.captureDragEvents&&t.eventDispatcher.emit("pointerdragmove",this))},e.prototype._onActorEnter=function(t){var e=Vi("enter",this.coordinates,this.pointer,this.index,this.pointerType,this.button,this.ev);e.layPath(t),e.propagate(),this.pointer.addActorUnderPointer(t),this.pointer.isDragging&&(this.pointer.dragTarget=t)},e.prototype._onActorLeave=function(t){var e=Vi("leave",this.coordinates,this.pointer,this.index,this.pointerType,this.button,this.ev);e.layPath(t),e.propagate(),this.pointer.removeActorUnderPointer(t)},e}(Fi),Wi=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._name="pointerenter",e}return zi(e,t),e.prototype._onActionStart=function(t){t.capturePointer.captureMoveEvents},e.prototype._onActionEnd=function(t){this.pointer.isDragging&&t.capturePointer.captureDragEvents&&t.eventDispatcher.emit("pointerdragenter",this)},e}(Fi),Ni=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._name="pointerleave",e}return zi(e,t),e.prototype.layPath=function(t){var e=t.getAncestors();this._path=e.length>this._path.length?e:this._path},e.prototype._onActionStart=function(t){t.capturePointer.captureMoveEvents},e.prototype._onActionEnd=function(t){this.pointer.isDragging&&t.capturePointer.captureDragEvents&&t.eventDispatcher.emit("pointerdragleave",this)},e}(Fi),qi=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._name="pointercancel",e}return zi(e,t),e}(Fi),Xi=function(t){function e(e,i,n,o,r,s,a,h,c,u,l,p){var d=t.call(this)||this;return d.x=e,d.y=i,d.pageX=n,d.pageY=o,d.screenX=r,d.screenY=s,d.index=a,d.deltaX=h,d.deltaY=c,d.deltaZ=u,d.deltaMode=l,d.ev=p,d}return zi(e,t),e}(W);function Vi(t,e,i,n,o,r,s){var a;switch(t){case"up":a=new Ii(Hi);break;case"down":a=new Ii(ji);break;case"move":a=new Ii(Ui);break;case"cancel":a=new Ii(qi);break;case"enter":a=new Ii(Wi);break;case"leave":a=new Ii(Ni)}return a.create(e,i,n,o,r,s)}var Gi,Zi,Ki=function(t){function e(e){var i=t.call(this)||this;return i._pointerDown=[],i._pointerUp=[],i._pointerMove=[],i._pointerCancel=[],i._wheel=[],i._pointers=[],i._activePointers=[],i._engine=e,i._pointers.push(new Yi),i._activePointers=[-1],i.primary=i._pointers[0],i}return zi(e,t),e.prototype.on=function(e,i){t.prototype.on.call(this,e,i)},e.prototype.init=function(t){(t=t||this._engine.canvas).addEventListener("touchstart",this._handleTouchEvent("down",this._pointerDown)),t.addEventListener("touchend",this._handleTouchEvent("up",this._pointerUp)),t.addEventListener("touchmove",this._handleTouchEvent("move",this._pointerMove)),t.addEventListener("touchcancel",this._handleTouchEvent("cancel",this._pointerCancel)),window.PointerEvent?(this._engine.canvas.style.touchAction="none",t.addEventListener("pointerdown",this._handlePointerEvent("down",this._pointerDown)),t.addEventListener("pointerup",this._handlePointerEvent("up",this._pointerUp)),t.addEventListener("pointermove",this._handlePointerEvent("move",this._pointerMove)),t.addEventListener("pointercancel",this._handlePointerEvent("cancel",this._pointerCancel))):window.MSPointerEvent?(this._engine.canvas.style.msTouchAction="none",t.addEventListener("MSPointerDown",this._handlePointerEvent("down",this._pointerDown)),t.addEventListener("MSPointerUp",this._handlePointerEvent("up",this._pointerUp)),t.addEventListener("MSPointerMove",this._handlePointerEvent("move",this._pointerMove)),t.addEventListener("MSPointerCancel",this._handlePointerEvent("cancel",this._pointerCancel))):(t.addEventListener("mousedown",this._handleMouseEvent("down",this._pointerDown)),t.addEventListener("mouseup",this._handleMouseEvent("up",this._pointerUp)),t.addEventListener("mousemove",this._handleMouseEvent("move",this._pointerMove))),"onwheel"in document.createElement("div")?t.addEventListener("wheel",this._handleWheelEvent("wheel",this._wheel)):void 0!==document.onmousewheel?t.addEventListener("mousewheel",this._handleWheelEvent("wheel",this._wheel)):t.addEventListener("MozMousePixelScroll",this._handleWheelEvent("wheel",this._wheel))},e.prototype.update=function(){this._pointerUp.length=0,this._pointerDown.length=0,this._pointerMove.length=0,this._pointerCancel.length=0,this._wheel.length=0;for(var t=0;t<this._pointers.length;t++)this._pointers[t].update()},e.prototype.at=function(t){if(t>=this._pointers.length)for(var e=this._pointers.length-1,i=t;e<i;e++)this._pointers.push(new Yi),this._activePointers.push(-1);return this._pointers[t]},e.prototype.count=function(){return this._pointers.length},e.prototype.propagate=function(){this._propagatePointerEvent(this._pointerDown),this._propagatePointerEvent(this._pointerUp),this._propagatePointerEvent(this._pointerMove),this._propagatePointerEvent(this._pointerCancel),this._propagateWheelEvent("pointerwheel",this._wheel)},e.prototype.revisePointerEventsPaths=function(t){this._revisePointerEventPath(t,this._pointerDown),this._revisePointerEventPath(t,this._pointerUp),this._revisePointerEventPath(t,this._pointerMove),this._revisePointerEventPath(t,this._pointerCancel),this._validateWheelEventPath(this._wheel,t)},e.prototype._propagatePointerEvent=function(t){for(var e=t.length,i=0;i<e;i++)t[i].propagate()},e.prototype._revisePointerEventPath=function(t,e){for(var i=e.length,n=0;n<i;n++)e[n].layPath(t)},e.prototype._validateWheelEventPath=function(t,e){for(var i=0;i<t.length;i++){var n=t[i],o=!wi(e);e.contains(n.x,n.y,o)&&n.layPath(e)}},e.prototype._propagateWheelEvent=function(t,e){for(var i,n=e.length,o=0;o<n;o++)switch(i=e[o],t){case"pointerwheel":this._propagateWheelPointerEvent(i)}},e.prototype._propagateWheelPointerEvent=function(t){t.eventPath.length&&(t.eventPath.pop().eventDispatcher.emit("pointerwheel",t),t.bubbles&&this._propagateWheelPointerEvent(t))},e.prototype._handleMouseEvent=function(t,e){var i=this;return function(n){n.preventDefault();var o=i.at(0),r=I.fromPagePosition(n.pageX,n.pageY,i._engine),s=Vi(t,r,o,0,Ti.Mouse,n.button,n);e.push(s),o.eventDispatcher.emit(t,s)}},e.prototype._handleTouchEvent=function(t,e){var i=this;return function(n){n.preventDefault();for(var o=0,r=n.changedTouches.length;o<r;o++){var s=i._pointers.length>1?i._getPointerIndex(n.changedTouches[o].identifier):0;if(-1!==s){var a=i.at(s),h=I.fromPagePosition(n.changedTouches[o].pageX,n.changedTouches[o].pageY,i._engine),c=Vi(t,h,a,s,Ti.Touch,Mi.Unknown,n);e.push(c),a.eventDispatcher.emit(t,c),i._pointers.length>1&&("up"===t?i._activePointers[s]=-1:"down"===t&&(i._activePointers[s]=n.changedTouches[o].identifier))}}}},e.prototype._handlePointerEvent=function(t,e){var i=this;return function(n){n.preventDefault();var o=i._pointers.length>1?i._getPointerIndex(n.pointerId):0;if(-1!==o){var r=i.at(o),s=I.fromPagePosition(n.pageX,n.pageY,i._engine),a=Vi(t,s,r,o,i._stringToPointerType(n.pointerType),n.button,n);e.push(a),r.eventDispatcher.emit(t,a),i._pointers.length>1&&("up"===t?i._activePointers[o]=-1:"down"===t&&(i._activePointers[o]=n.pointerId))}}},e.prototype._handleWheelEvent=function(t,e){var i=this;return function(n){(i._engine.pageScrollPreventionMode===en.All||i._engine.pageScrollPreventionMode===en.Canvas&&n.target===i._engine.canvas)&&n.preventDefault();var o=n.pageX-P(i._engine.canvas).x,r=n.pageY-P(i._engine.canvas).y,s=i._engine.screenToWorldCoordinates(new O(o,r)),a=n.deltaX||-.025*n.wheelDeltaX||0,h=n.deltaY||-.025*n.wheelDeltaY||-.025*n.wheelDelta||n.detail||0,c=n.deltaZ||0,u=Di.Pixel;n.deltaMode&&(1===n.deltaMode?u=Di.Line:2===n.deltaMode&&(u=Di.Page));var l=new Xi(s.x,s.y,n.pageX,n.pageY,o,r,0,a,h,c,u,n);e.push(l),i.at(0).eventDispatcher.emit(t,l)}},e.prototype._getPointerIndex=function(t){var e;if((e=this._activePointers.indexOf(t))>-1)return e;for(var i=0;i<this._activePointers.length;i++)if(-1===this._activePointers[i])return i;return-1},e.prototype._stringToPointerType=function(t){switch(t){case"touch":return Ti.Touch;case"mouse":return Ti.Mouse;case"pen":return Ti.Pen;default:return Ti.Unknown}},e}(xt),Yi=function(t){function e(){var e=t.call(this)||this;return e._isDown=!1,e._wasDown=!1,e._actorsUnderPointer={length:0},e.lastPagePos=null,e.lastScreenPos=null,e.lastWorldPos=null,e.dragTarget=null,e.on("move",e._onPointerMove),e.on("down",e._onPointerDown),e.on("up",e._onPointerUp),e}return zi(e,t),Object.defineProperty(e.prototype,"isDragging",{get:function(){return this._isDown},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isDragStart",{get:function(){return!this._wasDown&&this._isDown},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isDragEnd",{get:function(){return this._wasDown&&!this._isDown},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasActorsUnderPointer",{get:function(){return!!this._actorsUnderPointer.length},enumerable:!0,configurable:!0}),e.prototype.update=function(){this._wasDown&&!this._isDown?this._wasDown=!1:!this._wasDown&&this._isDown&&(this._wasDown=!0)},e.prototype.addActorUnderPointer=function(t){this.hasActorUnderPointerInList(t)||(this._actorsUnderPointer[t.id]=t,this._actorsUnderPointer.length+=1)},e.prototype.removeActorUnderPointer=function(t){this.hasActorUnderPointerInList(t)&&(delete this._actorsUnderPointer[t.id],this._actorsUnderPointer.length-=1)},e.prototype.getActorsUnderPointer=function(){var t=[];for(var e in this._actorsUnderPointer)if("length"!==e){var i=this._actorsUnderPointer[e];t.push(i)}return t},e.prototype.isActorUnderPointer=function(t){return!!this.lastWorldPos&&t.contains(this.lastWorldPos.x,this.lastWorldPos.y,!wi(t))},e.prototype.hasActorUnderPointerInList=function(t){return this._actorsUnderPointer.hasOwnProperty(t.id.toString())},e.prototype._onPointerMove=function(t){this.lastPagePos=new O(t.pagePos.x,t.pagePos.y),this.lastScreenPos=new O(t.screenPos.x,t.screenPos.y),this.lastWorldPos=new O(t.worldPos.x,t.worldPos.y)},e.prototype._onPointerDown=function(t){this.lastPagePos=new O(t.pagePos.x,t.pagePos.y),this.lastScreenPos=new O(t.screenPos.x,t.screenPos.y),this.lastWorldPos=new O(t.worldPos.x,t.worldPos.y),this._isDown=!0},e.prototype._onPointerUp=function(){this._isDown=!1,this.dragTarget=null},e}(xt),Qi=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Ji=function(t){function e(){var e=t.call(this)||this;return e.enabled=!1,e.supported=!!navigator.getGamepads,e._gamePadTimeStamps=[0,0,0,0],e._oldPads=[],e._pads=[],e._initSuccess=!1,e._navigator=navigator,e._minimumConfiguration=null,e}return Qi(e,t),e.prototype.init=function(){this.supported&&(this._initSuccess||(this._oldPads=this._clonePads(this._navigator.getGamepads()),this._oldPads.length&&this._oldPads[0]&&(this._initSuccess=!0)))},e.prototype.setMinimumGamepadConfiguration=function(t){this._enableAndUpdate(),this._minimumConfiguration=t},e.prototype._enableAndUpdate=function(){this.enabled||(this.enabled=!0,this.update())},e.prototype._isGamepadValid=function(t){if(!this._minimumConfiguration)return!0;if(!t)return!1;var e=t.axes.filter(function(t){return void 0!==typeof t}).length,i=t.buttons.filter(function(t){return void 0!==typeof t}).length;return e>=this._minimumConfiguration.axis&&i>=this._minimumConfiguration.buttons&&t.connected},e.prototype.on=function(e,i){this._enableAndUpdate(),t.prototype.on.call(this,e,i)},e.prototype.off=function(e,i){this._enableAndUpdate(),t.prototype.off.call(this,e,i)},e.prototype.update=function(){if(this.enabled&&this.supported){this.init();for(var t=this._navigator.getGamepads(),e=0;e<t.length;e++)if(t[e]){if(!this.at(e).connected&&this._isGamepadValid(t[e])&&this.eventDispatcher.emit("connect",new it(e,this.at(e))),this.at(e).connected=!0,!t[e].timestamp||t[e].timestamp!==this._gamePadTimeStamps[e]){var i,n,o,r,s;for(i in this._gamePadTimeStamps[e]=t[e].timestamp,this.at(e).navigatorGamepad=t[e],Gi)"number"==typeof(n=Gi[i])&&t[e].buttons[n]&&(s=t[e].buttons[n].value)!==this._oldPads[e].getButton(n)&&(t[e].buttons[n].pressed?(this.at(e).updateButton(n,s),this.at(e).eventDispatcher.emit("button",new ot(n,s,this.at(e)))):this.at(e).updateButton(n,0));for(o in Zi)"number"==typeof(r=Zi[o])&&(s=t[e].axes[r])!==this._oldPads[e].getAxes(r)&&(this.at(e).updateAxes(r,s),this.at(e).eventDispatcher.emit("axis",new rt(r,s,this.at(e))));this._oldPads[e]=this._clonePad(t[e])}}else{var a=this.at(e);a.connected&&this.eventDispatcher.emit("disconnect",new nt(e,a)),a.connected=!1}}},e.prototype.at=function(t){if(this._enableAndUpdate(),t>=this._pads.length)for(var e=this._pads.length-1,i=t;e<i;e++)this._pads.push(new $i),this._oldPads.push(new $i);return this._pads[t]},e.prototype.getValidGamepads=function(){this._enableAndUpdate();for(var t=[],e=0;e<this._pads.length;e++)this._isGamepadValid(this.at(e).navigatorGamepad)&&this.at(e).connected&&t.push(this.at(e));return t},e.prototype.count=function(){return this._pads.filter(function(t){return t.connected}).length},e.prototype._clonePads=function(t){for(var e=[],i=0,n=t.length;i<n;i++)e.push(this._clonePad(t[i]));return e},e.prototype._clonePad=function(t){var e,i,n=new $i;if(!t)return n;for(e=0,i=t.buttons.length;e<i;e++)t.buttons[e]&&n.updateButton(e,t.buttons[e].value);for(e=0,i=t.axes.length;e<i;e++)n.updateAxes(e,t.axes[e]);return n},e.MinAxisMoveThreshold=.05,e}(xt),$i=function(t){function e(){var e,i=t.call(this)||this;for(i.connected=!1,i._buttons=new Array(16),i._axes=new Array(4),e=0;e<i._buttons.length;e++)i._buttons[e]=0;for(e=0;e<i._axes.length;e++)i._axes[e]=0;return i}return Qi(e,t),e.prototype.isButtonPressed=function(t,e){return void 0===e&&(e=1),this._buttons[t]>=e},e.prototype.getButton=function(t){return this._buttons[t]},e.prototype.getAxes=function(t){var e=this._axes[t];return Math.abs(e)<Ji.MinAxisMoveThreshold?0:e},e.prototype.updateButton=function(t,e){this._buttons[t]=e},e.prototype.updateAxes=function(t,e){this._axes[t]=e},e}(xt);!function(t){t[t.Face1=0]="Face1",t[t.Face2=1]="Face2",t[t.Face3=2]="Face3",t[t.Face4=3]="Face4",t[t.LeftBumper=4]="LeftBumper",t[t.RightBumper=5]="RightBumper",t[t.LeftTrigger=6]="LeftTrigger",t[t.RightTrigger=7]="RightTrigger",t[t.Select=8]="Select",t[t.Start=9]="Start",t[t.LeftStick=10]="LeftStick",t[t.RightStick=11]="RightStick",t[t.DpadUp=12]="DpadUp",t[t.DpadDown=13]="DpadDown",t[t.DpadLeft=14]="DpadLeft",t[t.DpadRight=15]="DpadRight"}(Gi||(Gi={})),function(t){t[t.LeftStickX=0]="LeftStickX",t[t.LeftStickY=1]="LeftStickY",t[t.RightStickX=2]="RightStickX",t[t.RightStickY=3]="RightStickY"}(Zi||(Zi={}));var tn,en,nn=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();!function(t){t[t.FullScreen=0]="FullScreen",t[t.Container=1]="Container",t[t.Fixed=2]="Fixed",t[t.Position=3]="Position"}(tn||(tn={})),function(t){t[t.None=0]="None",t[t.Canvas=1]="Canvas",t[t.All=2]="All"}(en||(en={}));var on,rn=function(t){function e(i){var n=t.call(this)||this;n._hasStarted=!1,n.debug=new Ai,n.postProcessors=[],n.scenes={},n._animations=[],n.isFullscreen=!1,n.displayMode=tn.FullScreen,n._suppressHiDPIScaling=!1,n._suppressPlayButton=!1,n.pauseAudioWhenHidden=!0,n.isDebug=!1,n.debugColor=new Pt(255,255,255),n.onFatalException=function(t){Dt.getInstance().fatal(t)},n._isSmoothingEnabled=!0,n._timescale=1,n._isLoading=!1,n._isInitialized=!1,i=_({},e._DefaultEngineOptions,i);var o=new Ye;if(!i.suppressMinimumBrowserFeatureDetection&&!(n._compatible=o.test())){var r=document.createElement("div");if(r.innerText="Sorry, your browser does not support all the features needed for Excalibur",document.body.appendChild(r),o.failedTests.forEach(function(t){var e=document.createElement("div");e.innerText="Browser feature missing "+t,document.body.appendChild(e)}),i.canvasElementId){var s=document.getElementById(i.canvasElementId);s&&s.parentElement.removeChild(s)}return n}return n._compatible=!0,console.log&&!i.suppressConsoleBootMessage&&(console.log("%cPowered by Excalibur.js (v"+In+")","background: #176BAA; color: white; border-radius: 5px; padding: 15px; font-size: 1.5em; line-height: 80px;"),console.log("\n      /| ________________\nO|===|* >________________>\n      \\|"),console.log("Visit","http://excaliburjs.com","for more information")),i.suppressPlayButton&&(n._suppressPlayButton=!0),n._logger=Dt.getInstance(),n._logger.defaultLevel===H.Debug&&o.logBrowserFeatures(),n._logger.debug("Building engine..."),n.canvasElementId=i.canvasElementId,i.canvasElementId?(n._logger.debug("Using Canvas element specified: "+i.canvasElementId),n.canvas=document.getElementById(i.canvasElementId)):(n._logger.debug("Using generated canvas element"),n.canvas=document.createElement("canvas")),i.width&&i.height?(void 0===i.displayMode&&(n.displayMode=tn.Fixed),n._logger.debug("Engine viewport is size "+i.width+" x "+i.height),n.canvas.width=i.width,n.canvas.height=i.height):i.displayMode||(n._logger.debug("Engine viewport is fullscreen"),n.displayMode=tn.FullScreen),i.backgroundColor&&(n.backgroundColor=i.backgroundColor.clone()),n._loader=new Ge,n._initialize(i),n.rootScene=n.currentScene=new Si(n),n.addScene("root",n.rootScene),n.goToScene("root"),n}return nn(e,t),Object.defineProperty(e.prototype,"canvasWidth",{get:function(){return this.canvas.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"halfCanvasWidth",{get:function(){return this.canvas.width/2},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canvasHeight",{get:function(){return this.canvas.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"halfCanvasHeight",{get:function(){return this.canvas.height/2},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"drawWidth",{get:function(){return this.currentScene&&this.currentScene.camera?this.canvasWidth/this.currentScene.camera.getZoom()/this.pixelRatio:this.canvasWidth/this.pixelRatio},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"halfDrawWidth",{get:function(){return this.drawWidth/2},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"drawHeight",{get:function(){return this.currentScene&&this.currentScene.camera?this.canvasHeight/this.currentScene.camera.getZoom()/this.pixelRatio:this.canvasHeight/this.pixelRatio},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"halfDrawHeight",{get:function(){return this.drawHeight/2},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isHiDpi",{get:function(){return 1!==this.pixelRatio},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stats",{get:function(){return this.debug.stats},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pixelRatio",{get:function(){return this._suppressHiDPIScaling?1:window.devicePixelRatio<1?1:window.devicePixelRatio||1},enumerable:!0,configurable:!0}),e.prototype.on=function(e,i){t.prototype.on.call(this,e,i)},e.prototype.once=function(e,i){t.prototype.once.call(this,e,i)},e.prototype.off=function(e,i){t.prototype.off.call(this,e,i)},e.prototype.getWorldBounds=function(){var t=this.screenToWorldCoordinates(O.Zero).x,e=this.screenToWorldCoordinates(O.Zero).y,i=t+this.drawWidth,n=e+this.drawHeight;return new Mt(t,e,i,n)},Object.defineProperty(e.prototype,"timescale",{get:function(){return this._timescale},set:function(t){t<=0?Dt.getInstance().error("Cannot set engine.timescale to a value of 0 or less than 0."):this._timescale=t},enumerable:!0,configurable:!0}),e.prototype.playAnimation=function(t,e,i){this._animations.push(new sn(t,e,i))},e.prototype.addTileMap=function(t){this.currentScene.addTileMap(t)},e.prototype.removeTileMap=function(t){this.currentScene.removeTileMap(t)},e.prototype.addTimer=function(t){return this.currentScene.addTimer(t)},e.prototype.removeTimer=function(t){return this.currentScene.removeTimer(t)},e.prototype.addScene=function(t,e){this.scenes[t]&&this._logger.warn("Scene",t,"already exists overwriting"),this.scenes[t]=e,e.engine=this},e.prototype.removeScene=function(t){if(t instanceof Si)for(var e in this.scenes)this.scenes.hasOwnProperty(e)&&this.scenes[e]===t&&delete this.scenes[e];"string"==typeof t&&delete this.scenes[t]},e.prototype.add=function(t){t instanceof Be?this.currentScene.addUIActor(t):(t instanceof Me&&this._addChild(t),t instanceof Oe&&this.addTimer(t),t instanceof ze&&this.addTileMap(t),2===arguments.length&&this.addScene(arguments[0],arguments[1]))},e.prototype.remove=function(t){t instanceof Be?this.currentScene.removeUIActor(t):(t instanceof Me&&this._removeChild(t),t instanceof Oe&&this.removeTimer(t),t instanceof ze&&this.removeTileMap(t),t instanceof Si&&this.removeScene(t),"string"==typeof t&&this.removeScene(t))},e.prototype._addChild=function(t){this.currentScene.add(t)},e.prototype._removeChild=function(t){this.currentScene.remove(t)},e.prototype.goToScene=function(t){if(this.scenes[t]){var e=this.currentScene,i=this.scenes[t];this._logger.debug("Going to scene:",t),this.currentScene.isInitialized&&(this.currentScene._deactivate.call(this.currentScene,[e,i]),this.currentScene.eventDispatcher.emit("deactivate",new gt(i,this.currentScene))),this.currentScene=i,this.currentScene._initialize(this),this.currentScene._activate.call(this.currentScene,[e,i]),this.currentScene.eventDispatcher.emit("activate",new _t(e,this.currentScene))}else this._logger.error("Scene",t,"does not exist!")},e.prototype.screenToWorldCoordinates=function(t){var e=t.x,i=t.y;if(e=e/this.canvas.clientWidth*this.drawWidth,i=i/this.canvas.clientHeight*this.drawHeight,e-=this.halfDrawWidth,i-=this.halfDrawHeight,this.currentScene&&this.currentScene.camera){var n=this.currentScene.camera.getFocus();e+=n.x,i+=n.y}return new O(Math.floor(e),Math.floor(i))},e.prototype.worldToScreenCoordinates=function(t){var e=t.x,i=t.y;if(this.currentScene&&this.currentScene.camera){var n=this.currentScene.camera.getFocus();e-=n.x,i-=n.y}return e+=this.halfDrawWidth,i+=this.halfDrawHeight,e=e*this.canvas.clientWidth/this.drawWidth,i=i*this.canvas.clientHeight/this.drawHeight,new O(Math.floor(e),Math.floor(i))},e.prototype._setHeightByDisplayMode=function(t){this.displayMode===tn.Container&&(this.canvas.width=t.clientWidth,this.canvas.height=t.clientHeight),this.displayMode===tn.FullScreen&&(document.body.style.margin="0px",document.body.style.overflow="hidden",this.canvas.width=t.innerWidth,this.canvas.height=t.innerHeight)},e.prototype._initialize=function(t){var e,i,n=this;if(t.displayMode&&(this.displayMode=t.displayMode),this.displayMode===tn.FullScreen||this.displayMode===tn.Container){var o=this.displayMode===tn.Container?this.canvas.parentElement||document.body:window;this._setHeightByDisplayMode(o),window.addEventListener("resize",function(){n._logger.debug("View port resized"),n._setHeightByDisplayMode(o),n._logger.info("parent.clientHeight "+o.clientHeight),n.setAntialiasing(n._isSmoothingEnabled)})}else this.displayMode===tn.Position&&this._intializeDisplayModePosition(t);this.input={keyboard:new Ri,pointers:new Ki(this),gamepads:new Ji},this.input.keyboard.init(),this.input.pointers.init(t&&t.pointerScope===Bi.Document?document:this.canvas),this.input.gamepads.init(),this.pageScrollPreventionMode=t.scrollPreventionMode,void 0!==document.hidden?(e="hidden",i="visibilitychange"):"msHidden"in document?(e="msHidden",i="msvisibilitychange"):"webkitHidden"in document&&(e="webkitHidden",i="webkitvisibilitychange"),document.addEventListener(i,function(){document[e]?(n.eventDispatcher.emit("hidden",new ct(n)),n._logger.debug("Window hidden")):(n.eventDispatcher.emit("visible",new ht(n)),n._logger.debug("Window visible"))}),this.ctx=this.canvas.getContext("2d"),this._suppressHiDPIScaling=!!t.suppressHiDPIScaling,t.suppressHiDPIScaling||this._initializeHiDpi(),this.canvasElementId||document.body.appendChild(this.canvas)},e.prototype.onInitialize=function(t){},e.prototype._intializeDisplayModePosition=function(t){if(!t.position)throw new Error("DisplayMode of Position was selected but no position option was given");if(this.canvas.style.display="block",this.canvas.style.position="absolute","string"==typeof t.position){var e=t.position.split(" ");switch(e[0]){case"top":this.canvas.style.top="0px";break;case"bottom":this.canvas.style.bottom="0px";break;case"middle":this.canvas.style.top="50%";var i=-this.halfDrawHeight;this.canvas.style.marginTop=i.toString();break;default:throw new Error("Invalid Position Given")}if(e[1])switch(e[1]){case"left":this.canvas.style.left="0px";break;case"right":this.canvas.style.right="0px";break;case"center":this.canvas.style.left="50%";var n=-this.halfDrawWidth;this.canvas.style.marginLeft=n.toString();break;default:throw new Error("Invalid Position Given")}}else t.position.top&&("number"==typeof t.position.top?this.canvas.style.top=t.position.top.toString()+"px":this.canvas.style.top=t.position.top),t.position.right&&("number"==typeof t.position.right?this.canvas.style.right=t.position.right.toString()+"px":this.canvas.style.right=t.position.right),t.position.bottom&&("number"==typeof t.position.bottom?this.canvas.style.bottom=t.position.bottom.toString()+"px":this.canvas.style.bottom=t.position.bottom),t.position.left&&("number"==typeof t.position.left?this.canvas.style.left=t.position.left.toString()+"px":this.canvas.style.left=t.position.left)},e.prototype._initializeHiDpi=function(){if(this.isHiDpi){var t=this.canvas.width,e=this.canvas.height;this.canvas.width=t*this.pixelRatio,this.canvas.height=e*this.pixelRatio,this.canvas.style.width=t+"px",this.canvas.style.height=e+"px",this._logger.warn("Hi DPI screen detected, resetting canvas resolution from \n                           "+t+"x"+e+" to "+this.canvas.width+"x"+this.canvas.height+" \n                           css size will remain "+t+"x"+e),this.ctx.scale(this.pixelRatio,this.pixelRatio),this._logger.warn("Canvas drawing context was scaled by "+this.pixelRatio)}},e.prototype.setAntialiasing=function(t){this._isSmoothingEnabled=t;var e=this.ctx;e.imageSmoothingEnabled=t;for(var i=0,n=["webkitImageSmoothingEnabled","mozImageSmoothingEnabled","msImageSmoothingEnabled"];i<n.length;i++){var o=n[i];o in e&&(e[o]=t)}},e.prototype.getAntialiasing=function(){return this.ctx.imageSmoothingEnabled||this.ctx.webkitImageSmoothingEnabled||this.ctx.mozImageSmoothingEnabled||this.ctx.msImageSmoothingEnabled},Object.defineProperty(e.prototype,"isInitialized",{get:function(){return this._isInitialized},enumerable:!0,configurable:!0}),e.prototype._overrideInitialize=function(e){this.isInitialized||(this.onInitialize(e),t.prototype.emit.call(this,"initialize",new ft(e,this)),this._isInitialized=!0)},e.prototype._update=function(t){if(this._isLoading)return this._loader.update(this,t),this.input.keyboard.update(),this.input.pointers.update(),void this.input.gamepads.update();this._overrideInitialize(this),this._preupdate(t),this.currentScene.update(this,t),this._animations=this._animations.filter(function(t){return!t.animation.isDone()}),this.input.keyboard.update(),this.input.pointers.update(),this.input.gamepads.update(),this._postupdate(t)},e.prototype._preupdate=function(t){this.emit("preupdate",new J(this,t,this)),this.onPreUpdate(this,t)},e.prototype.onPreUpdate=function(t,e){},e.prototype._postupdate=function(t){this.emit("postupdate",new $(this,t,this)),this.onPostUpdate(this,t)},e.prototype.onPostUpdate=function(t,e){},e.prototype._draw=function(t){var e=this.ctx;if(this._predraw(e,t),this._isLoading)this._loader.draw(e,t);else{e.clearRect(0,0,this.canvasWidth,this.canvasHeight),e.fillStyle=this.backgroundColor.toString(),e.fillRect(0,0,this.canvasWidth,this.canvasHeight),this.currentScene.draw(this.ctx,t);for(var i=0,n=this._animations.length;i<n;i++)this._animations[i].animation.draw(e,this._animations[i].x,this._animations[i].y);if(this.isDebug){this.ctx.font="Consolas",this.ctx.fillStyle=this.debugColor.toString();for(var o=this.input.keyboard.getKeys(),r=0;r<o.length;r++)this.ctx.fillText(o[r].toString()+" : "+(xi[o[r]]?xi[o[r]]:"Not Mapped"),100,10*r+10);this.ctx.fillText("FPS:"+this.stats.currFrame.fps.toFixed(2).toString(),10,10)}for(var s=0;s<this.postProcessors.length;s++)this.postProcessors[s].process(this.ctx.getImageData(0,0,this.canvasWidth,this.canvasHeight),this.ctx);this._postdraw(e,t)}},e.prototype._predraw=function(t,e){this.emit("predraw",new Z(t,e,this)),this.onPreDraw(t,e)},e.prototype.onPreDraw=function(t,e){},e.prototype._postdraw=function(t,e){this.emit("postdraw",new K(t,e,this)),this.onPostDraw(t,e)},e.prototype.onPostDraw=function(t,e){},e.prototype.start=function(t){var i,n=this;return this._compatible?(t?(this._loader=t,this._loader.suppressPlayButton=this._suppressPlayButton,this._loader.wireEngine(this),i=this.load(this._loader)):i=p.resolve(),i.then(function(){n.emit("start",new V(n))}),this._hasStarted||(this._hasStarted=!0,this._logger.debug("Starting game..."),e.createMainLoop(this,window.requestAnimationFrame,Date.now)(),this._logger.debug("Game started")),i):(new p).reject("Excalibur is incompatible with your browser")},e.createMainLoop=function(t,e,i){var n=i();return function o(){if(t._hasStarted)try{t._requestId=e(o),t.emit("preframe",new tt(t,t.stats.prevFrame));var r=i(),s=Math.floor(r-n)||1;s>200&&(s=1);var a=s*t.timescale,h=t.stats.prevFrame.id+1;t.stats.prevFrame.reset(t.stats.currFrame),t.stats.currFrame.reset(),t.stats.currFrame.id=h,t.stats.currFrame.delta=a,t.stats.currFrame.fps=1/(a/1e3);var c=i();t._update(a);var u=i();t._draw(a);var l=i();t.stats.currFrame.duration.update=u-c,t.stats.currFrame.duration.draw=l-u,n=r,t.emit("postframe",new et(t,t.stats.currFrame))}catch(e){window.cancelAnimationFrame(t._requestId),t.stop(),t.onFatalException(e)}}},e.prototype.stop=function(){this._hasStarted&&(this.emit("stop",new G(this)),this._hasStarted=!1,this._logger.debug("Game stopped"))},e.prototype.isPaused=function(){return!this._hasStarted},e.prototype.screenshot=function(){var t=new Image,e=this.canvas.toDataURL("image/png");return t.src=e,t},e.prototype.load=function(t){var e=this,i=new p;return this._isLoading=!0,t.load().then(function(){e._suppressPlayButton?setTimeout(function(){e._isLoading=!1,i.resolve()},500):(e._isLoading=!1,i.resolve())}),i},e._DefaultEngineOptions={width:0,height:0,canvasElementId:"",pointerScope:Bi.Document,suppressConsoleBootMessage:null,suppressMinimumBrowserFeatureDetection:null,suppressHiDPIScaling:null,suppressPlayButton:null,scrollPreventionMode:en.Canvas,backgroundColor:Pt.fromHex("#2185d0")},e}(xt),sn=function(t,e,i){this.animation=t,this.x=e,this.y=i},an=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),hn=function(t){function e(e,i){void 0===i&&(i="MediaEvent");var n=t.call(this)||this;return n.target=e,n._name=i,n}return an(e,t),Object.defineProperty(e.prototype,"bubbles",{get:function(){return!1},set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_path",{get:function(){return null},set:function(t){},enumerable:!0,configurable:!0}),e.prototype.stopPropagation=function(){},e.prototype.action=function(){},e.prototype.propagate=function(){},e.prototype.layPath=function(t){},e}(W),cn=function(t){function e(e,i){var n=t.call(this,e,"NativeSoundEvent")||this;return n.track=i,n}return an(e,t),e}(hn),un=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();!function(t){t[t.Circle=0]="Circle",t[t.Rectangle=1]="Rectangle"}(on||(on={}));var ln=function(t){function e(e,i,n,o,r,s,a,h,c,u){return t.call(this,e,i,n,o,r,s,a,h,c,u)||this}return un(e,t),e}(Vt(function(){function t(t,e,i,n,o,r,s,a,h,c){this.position=new O(0,0),this.velocity=new O(0,0),this.acceleration=new O(0,0),this.particleRotationalVelocity=0,this.currentRotation=0,this.focus=null,this.focusAccel=0,this.opacity=1,this.beginColor=Pt.White.clone(),this.endColor=Pt.White.clone(),this.life=300,this.fadeFlag=!1,this._rRate=1,this._gRate=1,this._bRate=1,this._aRate=0,this._currentColor=Pt.White.clone(),this.emitter=null,this.particleSize=5,this.particleSprite=null,this.sizeRate=0,this.elapsedMultiplier=0;var u=t;if(u&&!(t instanceof pn)){var l=t;u=l.emitter,e=l.life,i=l.opacity,o=l.endColor,n=l.beginColor,r=l.position,s=l.velocity,a=l.acceleration,h=l.startSize,c=l.endSize}this.emitter=u,this.life=e||this.life,this.opacity=i||this.opacity,this.endColor=o||this.endColor.clone(),this.beginColor=n||this.beginColor.clone(),this._currentColor=this.beginColor.clone(),this.position=r||this.position,this.velocity=s||this.velocity,this.acceleration=a||this.acceleration,this._rRate=(this.endColor.r-this.beginColor.r)/this.life,this._gRate=(this.endColor.g-this.beginColor.g)/this.life,this._bRate=(this.endColor.b-this.beginColor.b)/this.life,this._aRate=this.opacity/this.life,this.startSize=h||0,this.endSize=c||0,this.endSize>0&&this.startSize>0&&(this.sizeRate=(this.endSize-this.startSize)/this.life,this.particleSize=this.startSize)}return t.prototype.kill=function(){this.emitter.removeParticle(this)},t.prototype.update=function(t){if(this.life=this.life-t,this.elapsedMultiplier=this.elapsedMultiplier+t,this.life<0&&this.kill(),this.fadeFlag&&(this.opacity=y(this._aRate*this.life,1e-4,1)),this.startSize>0&&this.endSize>0&&(this.particleSize=y(this.sizeRate*t+this.particleSize,Math.min(this.startSize,this.endSize),Math.max(this.startSize,this.endSize))),this._currentColor.r=y(this._currentColor.r+this._rRate*t,0,255),this._currentColor.g=y(this._currentColor.g+this._gRate*t,0,255),this._currentColor.b=y(this._currentColor.b+this._bRate*t,0,255),this._currentColor.a=y(this.opacity,1e-4,1),this.focus){var e=this.focus.sub(this.position).normalize().scale(this.focusAccel).scale(t/1e3);this.velocity=this.velocity.add(e)}else this.velocity=this.velocity.add(this.acceleration.scale(t/1e3));this.position=this.position.add(this.velocity.scale(t/1e3)),this.particleRotationalVelocity&&(this.currentRotation=(this.currentRotation+this.particleRotationalVelocity*t/1e3)%(2*Math.PI))},t.prototype.draw=function(t){if(this.particleSprite)return this.particleSprite.rotation=this.currentRotation,this.particleSprite.scale.setTo(this.particleSize,this.particleSize),void this.particleSprite.draw(t,this.position.x,this.position.y);this._currentColor.a=y(this.opacity,1e-4,1),t.fillStyle=this._currentColor.toString(),t.beginPath(),t.arc(this.position.x,this.position.y,this.particleSize,0,2*Math.PI),t.fill(),t.closePath()},t}())),pn=function(t){function e(e,i,n,o){return t.call(this,e,i,n,o)||this}return un(e,t),e}(Vt(function(t){function e(e,i,n,o){var r=t.call(this,"number"==typeof e?{x:e,y:i,width:n,height:o}:e)||this;r.numParticles=0,r.isEmitting=!0,r.particles=null,r.deadParticles=null,r.minVel=0,r.maxVel=0,r.acceleration=new O(0,0),r.minAngle=0,r.maxAngle=0,r.emitRate=1,r.particleLife=2e3,r.opacity=1,r.fadeFlag=!1,r.focus=null,r.focusAccel=1,r.startSize=null,r.endSize=null,r.minSize=5,r.maxSize=5,r.beginColor=Pt.White.clone(),r.endColor=Pt.White.clone(),r.particleSprite=null,r.emitterType=on.Rectangle,r.radius=0,r.particleRotationalVelocity=0,r.randomRotation=!1,r._particlesToEmit=0,r.collisionType=xe.PreventCollision,r.particles=new B,r.deadParticles=new B,r.random=new d;for(var s=0;s<r.traits.length;s++)r.traits[s]instanceof Ee&&r.traits.splice(s,1);return r}return un(e,t),e.prototype.removeParticle=function(t){this.deadParticles.push(t)},e.prototype.emitParticles=function(t){for(var e=0;e<t;e++)this.particles.push(this._createParticle())},e.prototype.clearParticles=function(){this.particles.clear()},e.prototype._createParticle=function(){var t=0,e=0,i=v(this.minAngle,this.maxAngle,this.random),n=v(this.minVel,this.maxVel,this.random),o=this.startSize||v(this.minSize,this.maxSize,this.random),r=n*Math.cos(i),s=n*Math.sin(i);if(this.emitterType===on.Rectangle)t=v(this.pos.x,this.pos.x+this.getWidth(),this.random),e=v(this.pos.y,this.pos.y+this.getHeight(),this.random);else if(this.emitterType===on.Circle){var a=v(0,this.radius,this.random);t=a*Math.cos(i)+this.pos.x,e=a*Math.sin(i)+this.pos.y}var h=new ln(this,this.particleLife,this.opacity,this.beginColor,this.endColor,new O(t,e),new O(r,s),this.acceleration,this.startSize,this.endSize);return h.fadeFlag=this.fadeFlag,h.particleSize=o,this.particleSprite&&(h.particleSprite=this.particleSprite),h.particleRotationalVelocity=this.particleRotationalVelocity,this.randomRotation&&(h.currentRotation=v(0,2*Math.PI,this.random)),this.focus&&(h.focus=this.focus.add(new O(this.pos.x,this.pos.y)),h.focusAccel=this.focusAccel),h},e.prototype.update=function(e,i){var n=this;t.prototype.update.call(this,e,i),this.isEmitting&&(this._particlesToEmit+=this.emitRate*(i/1e3),this._particlesToEmit>1&&(this.emitParticles(Math.floor(this._particlesToEmit)),this._particlesToEmit=this._particlesToEmit-Math.floor(this._particlesToEmit))),this.particles.forEach(function(t){return t.update(i)}),this.deadParticles.forEach(function(t){return n.particles.removeElement(t)}),this.deadParticles.clear()},e.prototype.draw=function(t){this.particles.forEach(function(e){return e.draw(t)})},e.prototype.debugDraw=function(e){t.prototype.debugDraw.call(this,e),e.fillStyle=Pt.Black.toString(),e.fillText("Particles: "+this.particles.count(),this.pos.x,this.pos.y+20),this.focus&&(e.fillRect(this.focus.x+this.pos.x,this.focus.y+this.pos.y,3,3),ye(e,Pt.Yellow,this.focus.x+this.pos.x,this.focus.y+this.pos.y,t.prototype.getCenter.call(this).x,t.prototype.getCenter.call(this).y),e.fillText("Focus",this.focus.x+this.pos.x,this.focus.y+this.pos.y))},e}(Me))),dn={Actions:r},fn=function(){function t(){this._lastFramePairs=[],this._lastFramePairsHash={}}return t.prototype.track=function(){},t.prototype.untrack=function(){},t.prototype.broadphase=function(t){for(var e,i,n=t.filter(function(t){return!t.isKilled()&&t.collisionType!==xe.PreventCollision}),o=[],r=0,s=n.length;r<s;r++){e=n[r];for(var a=r+1;a<s;a++){var h;if(i=n[a],h=e.collides(i)){var c=new Pe(e.body,i.body);c.collision=new At(e.collisionArea,i.collisionArea,h,e.pos,h),o.some(function(t){return t.id===c.id})||o.push(c)}}}return o},t.prototype.narrowphase=function(t){return t},t.prototype.runCollisionStartEnd=function(t){for(var e={},i=0,n=t;i<n.length;i++)if(e[(h=n[i]).id]=h,!this._lastFramePairsHash[h.id]){var o=h.bodyA.actor,r=h.bodyB.actor;o.emit("collisionstart",new pt(o,r,h)),r.emit("collisionstart",new pt(r,o,h))}for(var s=0,a=this._lastFramePairs;s<a.length;s++){var h;e[(h=a[s]).id]||(o=h.bodyA.actor,r=h.bodyB.actor,o.emit("collisionend",new dt(o,r)),r.emit("collisionend",new dt(r,o)))}this._lastFramePairs=t,this._lastFramePairsHash=e},t.prototype.resolve=function(t){for(var e=0,i=t;e<i.length;e++)i[e].resolve(j.collisionResolutionStrategy);return t.filter(function(t){return t.canCollide})},t.prototype.update=function(){return 0},t.prototype.debugDraw=function(){},t}(),_n=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),gn=function(t){function e(e,i,n,o){return t.call(this,e,i,n,o)||this}return _n(e,t),e}(Vt(function(){function t(t,e,i,n){this.sprites=[],this.currentFrame=0,this._oldTime=Date.now(),this.anchor=new O(0,0),this.rotation=0,this.scale=new O(1,1),this.loop=!0,this.freezeFrame=-1,this.flipVertical=!1,this.flipHorizontal=!1,this.drawWidth=0,this.drawHeight=0,this.width=0,this.height=0;var o=t;if(t&&!(t instanceof rn)){var r=t;o=r.engine,e=r.sprites,i=r.speed,n=r.loop}this.sprites=e,this.speed=i,this._engine=o,null!=n&&(this.loop=n),e&&e[0]&&(this.drawHeight=e[0]?e[0].drawHeight:0,this.drawWidth=e[0]?e[0].drawWidth:0,this.width=e[0]?e[0].width:0,this.height=e[0]?e[0].height:0,this.freezeFrame=e.length-1)}return t.prototype.opacity=function(t){this.addEffect(new Lt(t))},t.prototype.grayscale=function(){this.addEffect(new Ft)},t.prototype.invert=function(){this.addEffect(new It)},t.prototype.fill=function(t){this.addEffect(new qt(t))},t.prototype.colorize=function(t){this.addEffect(new Ht(t))},t.prototype.lighten=function(t){void 0===t&&(t=.1),this.addEffect(new jt(t))},t.prototype.darken=function(t){void 0===t&&(t=.1),this.addEffect(new Ut(t))},t.prototype.saturate=function(t){void 0===t&&(t=.1),this.addEffect(new Wt(t))},t.prototype.desaturate=function(t){void 0===t&&(t=.1),this.addEffect(new Nt(t))},t.prototype.addEffect=function(t){for(var e in this.sprites)this.sprites[e].addEffect(t)},t.prototype.removeEffect=function(t){for(var e in this.sprites)this.sprites[e].removeEffect(t)},t.prototype.clearEffects=function(){for(var t in this.sprites)this.sprites[t].clearEffects()},t.prototype._setAnchor=function(t){for(var e in this.sprites)this.sprites[e].anchor.setTo(t.x,t.y)},t.prototype._setRotation=function(t){for(var e in this.sprites)this.sprites[e].rotation=t},t.prototype._setScale=function(t){for(var e in this.sprites)this.sprites[e].scale=t},t.prototype.reset=function(){this.currentFrame=0},t.prototype.isDone=function(){return!this.loop&&this.currentFrame>=this.sprites.length},t.prototype.tick=function(){var t=Date.now();t-this._oldTime>this.speed&&(this.currentFrame=this.loop?(this.currentFrame+1)%this.sprites.length:this.currentFrame+1,this._oldTime=t)},t.prototype._updateValues=function(){this._setAnchor(this.anchor),this._setRotation(this.rotation),this._setScale(this.scale)},t.prototype.skip=function(t){this.currentFrame=(this.currentFrame+t)%this.sprites.length},t.prototype.draw=function(t,e,i){var n;this.tick(),this._updateValues(),this.currentFrame<this.sprites.length&&(n=this.sprites[this.currentFrame],this.flipVertical&&(n.flipVertical=this.flipVertical),this.flipHorizontal&&(n.flipHorizontal=this.flipHorizontal),n.draw(t,e,i)),-1!==this.freezeFrame&&this.currentFrame>=this.sprites.length&&(n=this.sprites[y(this.freezeFrame,0,this.sprites.length-1)]).draw(t,e,i),n&&(this.drawWidth=n.drawWidth,this.drawHeight=n.drawHeight)},t.prototype.play=function(t,e){this.reset(),this._engine.playAnimation(this,t,e)},t}())),yn=function(){function t(t){this.lineWidth=5,this.filled=!1,this._points=[],this.anchor=new O(0,0),this.rotation=0,this.scale=new O(1,1),this._points=t;var e=this._points.reduce(function(t,e){return Math.min(t,e.x)},0),i=this._points.reduce(function(t,e){return Math.max(t,e.x)},0);this.drawWidth=i-e;var n=this._points.reduce(function(t,e){return Math.min(t,e.y)},0),o=this._points.reduce(function(t,e){return Math.max(t,e.y)},0);this.drawHeight=o-n,this.height=this.drawHeight,this.width=this.drawWidth}return t.prototype.addEffect=function(){},t.prototype.removeEffect=function(){},t.prototype.clearEffects=function(){},t.prototype.reset=function(){},t.prototype.draw=function(t,e,i){t.save(),t.translate(e+this.anchor.x,i+this.anchor.y),t.scale(this.scale.x,this.scale.y),t.rotate(this.rotation),t.beginPath(),t.lineWidth=this.lineWidth;var n=this._points[0];t.moveTo(n.x,n.y);for(var o=0,r=this._points.length;o<r;o++)t.lineTo(this._points[o].x,this._points[o].y);t.lineTo(n.x,n.y),t.closePath(),this.filled&&(t.fillStyle=this.fillColor.toString(),t.fill()),t.strokeStyle=this.lineColor.toString(),this.flipHorizontal&&(t.translate(this.drawWidth,0),t.scale(-1,1)),this.flipVertical&&(t.translate(0,this.drawHeight),t.scale(1,-1)),t.stroke(),t.restore()},t}(),vn=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),mn=function(t){function e(e,i,n,o,r){return t.call(this,e,i,n,o,r)||this}return vn(e,t),e}(Vt(function(){function t(t,e,i,n,o){this.sprites=[],this.image=null,this.columns=0,this.rows=0,this.spWidth=0,this.spHeight=0;var r=!1;if(t instanceof Array?this.sprites=t:(!t||t instanceof Qt?(this.image=t,this.columns=e,this.rows=i,this.spWidth=n,this.spHeight=o):(this.columns=t.columns,this.rows=t.rows,this.spWidth=t.spWidth,this.spHeight=t.spHeight,this.image=t.image),this.sprites=new Array(this.columns*this.rows),r=!0),r){var s=0,a=0;for(s=0;s<this.rows;s++)for(a=0;a<this.columns;a++)this.sprites[a+s*this.columns]=new Kt(this.image,a*this.spWidth,s*this.spHeight,this.spWidth,this.spHeight)}}return t.prototype.getAnimationByIndices=function(t,e,i){var n=this,o=e.map(function(t){return n.sprites[t]});return o=o.map(function(t){return t.clone()}),new gn(t,o,i)},t.prototype.getAnimationBetween=function(t,e,i,n){var o=this.sprites.slice(e,i);return o=o.map(function(t){return t.clone()}),new gn(t,o,n)},t.prototype.getAnimationForAll=function(t,e){var i=this.sprites.map(function(t){return t.clone()});return new gn(t,i,e)},t.prototype.getSprite=function(t){if(t>=0&&t<this.sprites.length)return this.sprites[t];throw new Error("Invalid index: "+t)},t.prototype.getAnimationByCoords=function(t,e,i){for(var n=0,o=0,r=new Array(e.length),s=0;s<e.length;s++){var a=e[s];a.image=a.image||this.image,n=Math.max(n,a.drawWidth),o=Math.max(o,a.drawHeight),r[s]=new Kt(a)}var h=new gn(t,r,i);return h.drawWidth=n,h.drawHeight=o,h},t}())),bn=function(t){function e(e,i,n,o,r,s,a){return t.call(this,e,i,n,o,r,s,a)||this}return vn(e,t),e}(Vt(function(t){function e(e,i,n,o,r,s,a){var h=t.call(this,e instanceof Qt?{image:e,spWidth:s,spHeight:a,rows:r,columns:o}:e)||this;return h._currentColor=Pt.Black.clone(),h._currentOpacity=1,h._sprites={},h._textShadowOn=!1,h._textShadowDirty=!0,h._textShadowColor=Pt.Black.clone(),h._textShadowSprites={},h._shadowOffsetX=5,h._shadowOffsetY=5,!e||e instanceof Qt||(i=e.alphabet,n=e.caseInsensitive),h._alphabet=i,h._caseInsensitive=n,h._sprites=h.getTextSprites(),h}return vn(e,t),e.prototype.getTextSprites=function(){for(var t={},e=0;e<this._alphabet.length;e++){var i=this._alphabet[e];this._caseInsensitive&&(i=i.toLowerCase()),t[i]=this.sprites[e].clone()}return t},e.prototype.setTextShadow=function(t,e,i){for(var n in this._textShadowOn=!0,this._shadowOffsetX=t,this._shadowOffsetY=e,this._textShadowColor=i.clone(),this._textShadowDirty=!0,this._sprites)this._textShadowSprites[n]=this._sprites[n].clone()},e.prototype.useTextShadow=function(t){this._textShadowOn=t,t&&this.setTextShadow(5,5,this._textShadowColor)},e.prototype.draw=function(t,e,i,n,o){if(o=this._parseOptions(o),this._currentColor.toString()!==o.color.toString()||this._currentOpacity!==o.opacity)for(var r in this._currentOpacity=o.opacity,this._currentColor=o.color,this._sprites)this._sprites[r].clearEffects(),this._sprites[r].fill(o.color),this._sprites[r].opacity(o.opacity);if(this._textShadowOn&&this._textShadowDirty&&this._textShadowColor){for(var s in this._textShadowSprites)this._textShadowSprites[s].clearEffects(),this._textShadowSprites[s].addEffect(new qt(this._textShadowColor.clone()));this._textShadowDirty=!1}var a=this.sprites[0],h=a.drawHeight,c=o.fontSize/h,u=e.length*a.drawWidth*c+e.length*o.letterSpacing,l=i;o.textAlign===hi.Left||o.textAlign===hi.Start?l=i:o.textAlign===hi.Right||o.textAlign===hi.End?l=i-u:o.textAlign===hi.Center&&(l=i-u/2);var p=n-h*c;o.baseAlign===ci.Top||o.baseAlign===ci.Hanging?p=n:o.baseAlign===ci.Ideographic||o.baseAlign===ci.Bottom||o.baseAlign===ci.Alphabetic?p=n-h*c:o.baseAlign===ci.Middle&&(p=n-h*c/2);for(var d=0;d<e.length;d++){var f=e[d];this._caseInsensitive&&(f=f.toLowerCase());try{this._textShadowOn&&(this._textShadowSprites[f].scale.x=c,this._textShadowSprites[f].scale.y=c,this._textShadowSprites[f].draw(t,l+this._shadowOffsetX,p+this._shadowOffsetY));var _=this._sprites[f];_.scale.x=c,_.scale.y=c,_.draw(t,l,p),l+=_.drawWidth+o.letterSpacing}catch(t){Dt.getInstance().error("SpriteFont Error drawing char "+f)}}},e.prototype._parseOptions=function(t){return{fontSize:t.fontSize||10,letterSpacing:t.letterSpacing||0,color:t.color||Pt.Black.clone(),textAlign:void 0===typeof t.textAlign?hi.Left:t.textAlign,baseAlign:void 0===typeof t.baseAlign?ci.Bottom:t.baseAlign,maxWidth:t.maxWidth||-1,opacity:t.opacity||0}},e}(mn))),wn=function(){function t(){}return t.type={any:"",blob:"blob",json:"json",text:"text",document:"document",arraybuffer:"arraybuffer"},t}();function xn(t,e,i){return e+t*(i-e)}function Pn(t){return t*t*t*(t*(6*t-15)+10)}var Sn,An=function(){function t(t){this._perm=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],this._p=new Uint8Array(512),this._defaultPerlinOptions={octaves:1,frequency:1,amplitude:1,persistance:.5},t=_({},this._defaultPerlinOptions,t),this.persistance=t.persistance,this.amplitude=t.amplitude,this.frequency=t.frequency,this.octaves=t.octaves,t.seed?this._random=new d(t.seed):this._random=new d,this._perm=this._random.shuffle(this._perm);for(var e=0;e<512;e++)this._p[e]=255&this._perm[e%256]}return t.prototype.noise=function(){for(var t=this.amplitude,e=this.frequency,i=0,n=0,o=0;o<this.octaves;o++){switch(arguments.length){case 1:i+=this._noise1d(arguments[0]*e)*t;break;case 2:i+=this._noise2d(arguments[0]*e,arguments[1]*e)*t;break;case 3:i+=this._noise3d(arguments[0]*e,arguments[1]*e,arguments[2]*e)*t;break;default:throw new Error("Invalid arguments for perlin noise")}n+=t,t*=this.persistance,e*=2}return i/n},t.prototype.sequence=function(t,e){e||(e=1/t);for(var i=new Array(t),n=0;n<t;n++)i[n]=this.noise(n*e);return i},t.prototype.grid=function(t,e,i){i||(i=1/Math.min(t,e));for(var n=new Array(t*e),o=0;o<e;o++)for(var r=0;r<t;r++)n[r+o*t]=this.noise(r*i,o*i);return n},t.prototype._gradient3d=function(t,e,i,n){var o=15&t,r=o<8?e:i,s=o<4?i:12===o||14===o?e:n;return(0==(1&o)?r:-r)+(0==(2&o)?s:-s)},t.prototype._gradient2d=function(t,e,i){var n=0==(1&t)?e:i;return 0==(2&t)?-n:n},t.prototype._gradient1d=function(t,e){return 0==(1&t)?-e:e},t.prototype._noise1d=function(t){var e=255&Math.floor(t);return(xn(Pn(t-=Math.floor(t)),this._gradient1d(this._p[e],t),this._gradient1d(this._p[e+1],t-1))+1)/2},t.prototype._noise2d=function(t,e){var i=255&Math.floor(t),n=255&Math.floor(e);t-=Math.floor(t),e-=Math.floor(e);var o=Pn(t),r=Pn(e),s=this._p[i]+n,a=this._p[i+1]+n;return(xn(r,xn(o,this._gradient2d(this._p[s],t,e),this._gradient2d(this._p[a],t-1,e)),xn(o,this._gradient2d(this._p[s+1],t,e-1),this._gradient2d(this._p[a+1],t-1,e-1)))+1)/2},t.prototype._noise3d=function(t,e,i){var n=255&Math.floor(t),o=255&Math.floor(e),r=255&Math.floor(i);t-=Math.floor(t),e-=Math.floor(e),i-=Math.floor(i);var s=Pn(t),a=Pn(e),h=Pn(i),c=this._p[n]+o,u=this._p[n+1]+o,l=this._p[c]+r,p=this._p[u]+r,d=this._p[c+1]+r,f=this._p[u+1]+r;return(xn(h,xn(a,xn(s,this._gradient3d(this._p[l],t,e,i),this._gradient3d(this._p[p],t-1,e,i)),xn(s,this._gradient3d(this._p[d],t,e-1,i),this._gradient3d(this._p[f],t-1,e-1,i))),xn(a,xn(s,this._gradient3d(this._p[l+1],t,e,i-1),this._gradient3d(this._p[p+1],t-1,e,i-1)),xn(s,this._gradient3d(this._p[d+1],t,e-1,i-1),this._gradient3d(this._p[f+1],t-1,e-1,i-1))))+1)/2},t}(),En=function(){function t(t,e){this.generator=t,this.colorFcn=e,e||(this.colorFcn=function(t){return t<125?Pt.Black:Pt.White})}return t.prototype.image=function(t,e){var i=document.createElement("img"),n=document.createElement("canvas");n.width=t,n.height=e;var o=n.getContext("2d");return this.draw(o,0,0,t,e),i.src=n.toDataURL(),i},t.prototype.draw=function(t,e,i,n,o){for(var r=this.generator.grid(n,o),s=t.getImageData(e,i,n,o),a=0;a<o;a++)for(var h=0;h<n;h++){var c=r[h+n*a],u=255&Math.floor(255*c),l=4*(h+a*s.width),p=this.colorFcn(u);s.data[l]=p.r,s.data[l+1]=p.g,s.data[l+2]=p.b,s.data[l+3]=Math.floor(255*p.a)}t.putImageData(s,e,i)},t}();!function(t){t[t.Protanope=0]="Protanope",t[t.Deuteranope=1]="Deuteranope",t[t.Tritanope=2]="Tritanope"}(Sn||(Sn={}));var kn=function(){function t(t,e,i){void 0===e&&(e=!1),void 0===i&&(i=Sn.Protanope),this.engine=t,this.simulate=e,this.colorMode=i,this._vertexShader="attribute vec2 a_position;attribute vec2 a_texCoord;uniform vec2 u_resolution;varying vec2 v_texCoord;void main() {vec2 zeroToOne = a_position / u_resolution;vec2 zeroToTwo = zeroToOne * 2.0;vec2 clipSpace = zeroToTwo - 1.0;gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);v_texCoord = a_texCoord;}",this._fragmentShader="precision mediump float;uniform sampler2D u_image;varying vec2 v_texCoord;void main() {vec4 o =  texture2D(u_image, v_texCoord);float L = (17.8824 * o.r) + (43.5161 * o.g) + (4.11935 * o.b);float M = (3.45565 * o.r) + (27.1554 * o.g) + (3.86714 * o.b);float S = (0.0299566 * o.r) + (0.184309 * o.g) + (1.46709 * o.b);//MODE CODE//vec4 error;error.r = (0.0809444479 * l) + (-0.130504409 * m) + (0.116721066 * s);error.g = (-0.0102485335 * l) + (0.0540193266 * m) + (-0.113614708 * s);error.b = (-0.000365296938 * l) + (-0.00412161469 * m) + (0.693511405 * s);error.a = 1.0;vec4 diff = o - error;vec4 correction;correction.r = 0.0;correction.g =  (diff.r * 0.7) + (diff.g * 1.0);correction.b =  (diff.r * 0.7) + (diff.b * 1.0);correction = o + correction;correction.a = o.a;//SIMULATE//}",this._internalCanvas=document.createElement("canvas"),this._internalCanvas.width=t.drawWidth,this._internalCanvas.height=t.drawHeight,this._gl=this._internalCanvas.getContext("webgl",{preserveDrawingBuffer:!0}),this._program=this._gl.createProgram();var n=this._getShader("Fragment",this._getFragmentShaderByMode(i)),o=this._getShader("Vertex",this._vertexShader);this._gl.attachShader(this._program,o),this._gl.attachShader(this._program,n),this._gl.linkProgram(this._program),this._gl.getProgramParameter(this._program,this._gl.LINK_STATUS)||Dt.getInstance().error("Unable to link shader program!"),this._gl.useProgram(this._program)}return t.prototype._getFragmentShaderByMode=function(t){var e="";return t===Sn.Protanope?e="float l = 0.0 * L + 2.02344 * M + -2.52581 * S;float m = 0.0 * L + 1.0 * M + 0.0 * S;float s = 0.0 * L + 0.0 * M + 1.0 * S;":t===Sn.Deuteranope?e="float l = 1.0 * L + 0.0 * M + 0.0 * S;float m = 0.494207 * L + 0.0 * M + 1.24827 * S;float s = 0.0 * L + 0.0 * M + 1.0 * S;":t===Sn.Tritanope&&(e="float l = 1.0 * L + 0.0 * M + 0.0 * S;float m = 0.0 * L + 1.0 * M + 0.0 * S;float s = -0.395913 * L + 0.801109 * M + 0.0 * S;"),this.simulate?this._fragmentShader=this._fragmentShader.replace("//SIMULATE//","gl_FragColor = error.rgba;"):this._fragmentShader=this._fragmentShader.replace("//SIMULATE//","gl_FragColor = correction.rgba;"),this._fragmentShader.replace("//MODE CODE//",e)},t.prototype._setRectangle=function(t,e,i,n){var o=t,r=t+i,s=e,a=e+n;this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array([o,s,r,s,o,a,o,a,r,s,r,a]),this._gl.STATIC_DRAW)},t.prototype._getShader=function(t,e){var i;return"Fragment"===t?i=this._gl.createShader(this._gl.FRAGMENT_SHADER):"Vertex"===t?i=this._gl.createShader(this._gl.VERTEX_SHADER):Dt.getInstance().error("Error unknown shader type",t),this._gl.shaderSource(i,e),this._gl.compileShader(i),this._gl.getShaderParameter(i,this._gl.COMPILE_STATUS)?i:(Dt.getInstance().error("Unable to compile shader!",this._gl.getShaderInfoLog(i)),null)},t.prototype.process=function(t,e){var i=this._gl.getAttribLocation(this._program,"a_position"),n=this._gl.getAttribLocation(this._program,"a_texCoord"),o=this._gl.createBuffer();this._gl.bindBuffer(this._gl.ARRAY_BUFFER,o),this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),this._gl.STATIC_DRAW),this._gl.enableVertexAttribArray(n),this._gl.vertexAttribPointer(n,2,this._gl.FLOAT,!1,0,0);var r=this._gl.createTexture();this._gl.bindTexture(this._gl.TEXTURE_2D,r),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.NEAREST),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.NEAREST),this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,1),this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,t);var s=this._gl.getUniformLocation(this._program,"u_resolution");this._gl.uniform2f(s,this._internalCanvas.width,this._internalCanvas.height);var a=this._gl.createBuffer();this._gl.bindBuffer(this._gl.ARRAY_BUFFER,a),this._gl.enableVertexAttribArray(i),this._gl.vertexAttribPointer(i,2,this._gl.FLOAT,!1,0,0),this._setRectangle(0,0,t.width,t.height),this._gl.drawArrays(this._gl.TRIANGLES,0,6);var h=new Uint8Array(t.width*t.height*4);this._gl.readPixels(0,0,t.width,t.height,this._gl.RGBA,this._gl.UNSIGNED_BYTE,h),t.data.set(h),e.putImageData(t,0,0)},t}(),Cn=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Tn=function(){function t(){}return t.create=function(t){return"string"==typeof t?new Dn(t):t instanceof AudioBuffer?new Bn(t):new Mn(t)},t}(),Mn=function(){function t(t){this._src=t,this._volume=1,this._loop=!1,this._isPlaying=!1,this._isPaused=!1}return Object.defineProperty(t.prototype,"loop",{get:function(){return this._loop},set:function(t){this._loop=t,this._instance&&(this._instance.loop=t,this._wireUpOnEnded())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"volume",{get:function(){return this._volume},set:function(t){this._volume=y(t,0,1)},enumerable:!0,configurable:!0}),t.prototype.isPlaying=function(){return this._isPlaying},t.prototype.pause=function(){this._isPlaying&&(this._isPaused=!0,this._isPlaying=!1)},t.prototype.stop=function(){this._isPlaying&&(this._isPlaying=!1,this._isPaused=!1)},t.prototype.play=function(){return this._isPaused&&this._resumePlayBack(),this._isPlaying||this._startPlayBack(),this._playingPromise},t.prototype._startPlayBack=function(){this._isPlaying=!0,this._isPaused=!1,this._playingPromise=new p},t.prototype._resumePlayBack=function(){this._isPaused&&(this._isPaused=!1,this._isPlaying=!0)},t.prototype._wireUpOnEnded=function(){var t=this;this.loop||(this._instance.onended=function(){return t._handleOnEnded()})},t.prototype._handleOnEnded=function(){},t}(),Dn=function(t){function e(e){var i=t.call(this,e)||this;return i._instance=new Audio(e),i}return Cn(e,t),Object.defineProperty(e.prototype,"volume",{get:function(){return this._volume},set:function(t){t=y(t,0,1),this._volume=t,this._instance.volume=t},enumerable:!0,configurable:!0}),e.prototype.pause=function(){this._isPlaying&&(this._instance.pause(),this._isPaused=!0,this._isPlaying=!1)},e.prototype.stop=function(){t.prototype.stop.call(this),this._instance.pause(),this._instance.currentTime=0,this._handleOnEnded()},e.prototype._startPlayBack=function(){t.prototype._startPlayBack.call(this),this._instance.load(),this._instance.loop=this.loop,this._instance.play(),this._wireUpOnEnded()},e.prototype._resumePlayBack=function(){t.prototype._resumePlayBack.call(this),this._instance.play(),this._wireUpOnEnded()},e.prototype._handleOnEnded=function(){this._isPlaying=!1,this._isPaused=!1,this._playingPromise.resolve(!0)},e}(Mn),Bn=function(t){function e(e){var i=t.call(this,e)||this;return i._audioContext=Le.create(),i._volumeNode=i._audioContext.createGain(),i._currentOffset=0,i._createNewBufferSource(),i}return Cn(e,t),Object.defineProperty(e.prototype,"volume",{get:function(){return this._volume},set:function(t){t=y(t,0,1),this._volume=t,this._volumeNode.gain.setTargetAtTime?this._volumeNode.gain.setTargetAtTime(t,this._audioContext.currentTime,.1):this._volumeNode.gain.value=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_playbackRate",{get:function(){return this._instance?1/(this._instance.playbackRate.value||1):null},enumerable:!0,configurable:!0}),e.prototype.pause=function(){t.prototype.pause.call(this),this._instance.stop(0),this._setPauseOffset()},e.prototype.stop=function(){t.prototype.stop.call(this),this._currentOffset=0,this._instance.stop(0),this._instance.onended||this._handleOnEnded()},e.prototype._startPlayBack=function(){t.prototype._startPlayBack.call(this),this._instance||this._createNewBufferSource(),this._rememberStartTime(),this._volumeNode.connect(this._audioContext.destination),this._instance.start(0,0),this._currentOffset=0,this._playingPromise=new p,this._wireUpOnEnded()},e.prototype._resumePlayBack=function(){t.prototype._resumePlayBack.call(this),this._instance.onended=null,this._createNewBufferSource();var e=this._playbackRate*this._src.duration,i=this._currentOffset%e;this._rememberStartTime(-1e3*i),this._instance.start(0,i),this._wireUpOnEnded()},e.prototype._handleOnEnded=function(){this._isPaused||(this._isPlaying=!1,this._playingPromise.resolve(!0))},e.prototype._rememberStartTime=function(t){this._startTime=(new Date).getTime()+(0|t)},e.prototype._setPauseOffset=function(){this._currentOffset=((new Date).getTime()-this._startTime)*this._playbackRate/1e3},e.prototype._createNewBufferSource=function(){this._instance=this._audioContext.createBufferSource(),this._instance.buffer=this._src,this._instance.loop=this.loop,this._instance.playbackRate.setValueAtTime(1,0),this._instance.connect(this._volumeNode)},e}(Mn);function On(t){try{var e=new Audio,i=t.match(/.*\.([A-Za-z0-9]+)$/)[1];return!!e.canPlayType("audio/"+i)}catch(t){return Dt.getInstance().warn("Cannot determine audio support, assuming no support for the Audio Tag",t),!1}}var Rn=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),zn=function(t){function e(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];var n=t.call(this,"","")||this;n._loop=!1,n._volume=1,n._isPaused=!1,n._tracks=[],n._wasPlayingOnHidden=!1,n._processedData=new p,n._audioContext=Le.create(),n._detectResponseType();for(var o=0,r=e;o<r.length;o++){var s=r[o];if(On(s)){n.path=s;break}}return n.path||(n.logger.warn("This browser does not support any of the audio files specified:",e.join(", ")),n.logger.warn("Attempting to use",e[0]),n.path=e[0]),n}return Rn(e,t),Object.defineProperty(e.prototype,"loop",{get:function(){return this._loop},set:function(t){this._loop=t;for(var e=0,i=this._tracks;e<i.length;e++)i[e].loop=this._loop;this.logger.debug("Set loop for all instances of sound",this.path,"to",this._loop)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"volume",{get:function(){return this._volume},set:function(t){this._volume=t;for(var e=0,i=this._tracks;e<i.length;e++)i[e].volume=this._volume;this.emit("volumechange",new cn(this)),this.logger.debug("Set loop for all instances of sound",this.path,"to",this._volume)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"instances",{get:function(){return this._tracks},enumerable:!0,configurable:!0}),e.prototype.wireEngine=function(t){var e=this;t&&(this._engine=t,this._engine.on("hidden",function(){t.pauseAudioWhenHidden&&e.isPlaying()&&(e._wasPlayingOnHidden=!0,e.pause())}),this._engine.on("visible",function(){t.pauseAudioWhenHidden&&e._wasPlayingOnHidden&&(e.play(),e._wasPlayingOnHidden=!1)}))},e.prototype.instanceCount=function(){return this._tracks.length},e.prototype.isPlaying=function(){return this._tracks.some(function(t){return t.isPlaying()})},e.prototype.play=function(t){return this.isLoaded()?(this.volume=t||this.volume,this._isPaused?this._resumePlayback():this._startPlayback()):(this.logger.warn("Cannot start playing. Resource",this.path,"is not loaded yet"),p.resolve(!0))},e.prototype.pause=function(){if(this.isPlaying()){for(var t=0,e=this._tracks;t<e.length;t++)e[t].pause();this._isPaused=!0,this.emit("pause",new cn(this)),this.logger.debug("Paused all instances of sound",this.path)}},e.prototype.stop=function(){if(this.isPlaying()){for(var t=0,e=this._tracks;t<e.length;t++)e[t].stop();this.emit("stop",new cn(this)),this._isPaused=!1,this._tracks.length=0,this.logger.debug("Stopped all instances of sound",this.path)}},e.prototype.setData=function(t){this.emit("emptied",new cn(this)),this.data=t,this._processedData=new p},e.prototype.processData=function(t){var e=this;return(t instanceof ArrayBuffer?this._processArrayBufferData(t):this._processBlobData(t)).then(function(t){return e._setProcessedData(t)})},e.prototype.getTrackId=function(t){return this._tracks.indexOf(t)},e.prototype._resumePlayback=function(){if(this._isPaused){for(var t=[],e=0,i=this._tracks;e<i.length;e++){var n=i[e];t.push(n.play())}return this._isPaused=!1,this.emit("resume",new cn(this)),this.logger.debug("Resuming paused instances for sound",this.path,this._tracks),p.join(t)}return p.resolve(!0)},e.prototype._startPlayback=function(){var t=this,e=this._createNewTrack(),i=new p;return e.then(function(e){e.play().then(function(n){return t.emit("playbackend",new cn(t,e)),t._tracks.splice(t.getTrackId(e),1),i.resolve(n),n}),t.emit("playbackstart",new cn(t,e)),t.logger.debug("Playing new instance for sound",t.path)}),i},e.prototype._processArrayBufferData=function(t){var e=this,i=new p;return this._audioContext.decodeAudioData(t,function(t){i.resolve(t)},function(){e.logger.error("Unable to decode  this browser may not fully support this format, or the file may be corrupt, if this is an mp3 try removing id3 tags and album art from the file."),i.resolve(void 0)}),i},e.prototype._processBlobData=function(e){return(new p).resolve(t.prototype.processData.call(this,e))},e.prototype._setProcessedData=function(t){this._processedData.resolve(t)},e.prototype._createNewTrack=function(){var t=this,e=new p;return 0!==this._processedData.state()&&this.processData(this.data),this._processedData.then(function(i){return e.resolve(t._getTrackInstance(i)),i},function(e){t.logger.error(e,"Cannot create AudioInstance due to wrong processed data.")}),e},e.prototype._getTrackInstance=function(t){var e=Tn.create(t);return e.loop=this.loop,e.volume=this.volume,this._tracks.push(e),e},e.prototype._detectResponseType=function(){window.AudioContext?this.responseType=wn.type.arraybuffer:this.responseType=wn.type.blob},e}(zt),Fn=function(){function t(){}return t.prototype.update=function(t,e,i){var n=i/1e3,o=t.acc.clone();t.collisionType===xe.Active&&o.addEqual(j.acc),t.oldVel=t.vel,t.vel.addEqual(o.scale(n)),t.pos.addEqual(t.vel.scale(n)).addEqual(o.scale(.5*n*n)),t.rx+=t.torque*(1/t.moi)*n,t.rotation+=t.rx*n,t.scale.x+=t.sx*i/1e3,t.scale.y+=t.sy*i/1e3},t}();i.d(e,"EX_VERSION",function(){return In}),i.d(e,"DisplayMode",function(){return tn}),i.d(e,"ScrollPreventionMode",function(){return en}),i.d(e,"Engine",function(){return rn}),i.d(e,"Actor",function(){return Me}),i.d(e,"CollisionType",function(){return xe}),i.d(e,"Vector",function(){return O}),i.d(e,"Ray",function(){return R}),i.d(e,"Line",function(){return z}),i.d(e,"Projection",function(){return F}),i.d(e,"GlobalCoordinates",function(){return I}),i.d(e,"StrategyContainer",function(){return si}),i.d(e,"Axis",function(){return Ue}),i.d(e,"LockCameraToActorStrategy",function(){return li}),i.d(e,"LockCameraToActorAxisStrategy",function(){return pi}),i.d(e,"ElasticToActorStrategy",function(){return di}),i.d(e,"RadiusAroundActorStrategy",function(){return fi}),i.d(e,"BaseCamera",function(){return _i}),i.d(e,"Class",function(){return xt}),i.d(e,"Configurable",function(){return Vt}),i.d(e,"Debug",function(){return Ai}),i.d(e,"FrameStats",function(){return Ei}),i.d(e,"PhysicsStats",function(){return ki}),i.d(e,"EventDispatcher",function(){return wt}),i.d(e,"MediaEvent",function(){return hn}),i.d(e,"NativeSoundEvent",function(){return cn}),i.d(e,"GameEvent",function(){return W}),i.d(e,"KillEvent",function(){return N}),i.d(e,"PreKillEvent",function(){return q}),i.d(e,"PostKillEvent",function(){return X}),i.d(e,"GameStartEvent",function(){return V}),i.d(e,"GameStopEvent",function(){return G}),i.d(e,"PreDrawEvent",function(){return Z}),i.d(e,"PostDrawEvent",function(){return K}),i.d(e,"PreDebugDrawEvent",function(){return Y}),i.d(e,"PostDebugDrawEvent",function(){return Q}),i.d(e,"PreUpdateEvent",function(){return J}),i.d(e,"PostUpdateEvent",function(){return $}),i.d(e,"PreFrameEvent",function(){return tt}),i.d(e,"PostFrameEvent",function(){return et}),i.d(e,"GamepadConnectEvent",function(){return it}),i.d(e,"GamepadDisconnectEvent",function(){return nt}),i.d(e,"GamepadButtonEvent",function(){return ot}),i.d(e,"GamepadAxisEvent",function(){return rt}),i.d(e,"SubscribeEvent",function(){return st}),i.d(e,"UnsubscribeEvent",function(){return at}),i.d(e,"VisibleEvent",function(){return ht}),i.d(e,"HiddenEvent",function(){return ct}),i.d(e,"PreCollisionEvent",function(){return ut}),i.d(e,"PostCollisionEvent",function(){return lt}),i.d(e,"CollisionStartEvent",function(){return pt}),i.d(e,"CollisionEndEvent",function(){return dt}),i.d(e,"InitializeEvent",function(){return ft}),i.d(e,"ActivateEvent",function(){return _t}),i.d(e,"DeactivateEvent",function(){return gt}),i.d(e,"ExitViewPortEvent",function(){return yt}),i.d(e,"EnterViewPortEvent",function(){return vt}),i.d(e,"EnterTriggerEvent",function(){return mt}),i.d(e,"ExitTriggerEvent",function(){return bt}),i.d(e,"Group",function(){return oi}),i.d(e,"Label",function(){return yi}),i.d(e,"FontStyle",function(){return ui}),i.d(e,"FontUnit",function(){return ai}),i.d(e,"TextAlign",function(){return hi}),i.d(e,"BaseAlign",function(){return ci}),i.d(e,"Loader",function(){return Ge}),i.d(e,"PauseAfterLoader",function(){return Ze}),i.d(e,"Particle",function(){return ln}),i.d(e,"ParticleEmitter",function(){return pn}),i.d(e,"EmitterType",function(){return on}),i.d(e,"CollisionResolutionStrategy",function(){return T}),i.d(e,"BroadphaseStrategy",function(){return M}),i.d(e,"Integrator",function(){return D}),i.d(e,"Physics",function(){return j}),i.d(e,"PromiseState",function(){return c}),i.d(e,"Promise",function(){return p}),i.d(e,"Scene",function(){return Si}),i.d(e,"TileMap",function(){return ze}),i.d(e,"Cell",function(){return Ie}),i.d(e,"TileSprite",function(){return Fe}),i.d(e,"Timer",function(){return Oe}),i.d(e,"Trigger",function(){return bi}),i.d(e,"UIActor",function(){return Be}),i.d(e,"Actions",function(){return r}),i.d(e,"Internal",function(){return dn}),i.d(e,"ActionContext",function(){return ge}),i.d(e,"RotationType",function(){return Gt}),i.d(e,"Body",function(){return Se}),i.d(e,"BoundingBox",function(){return Mt}),i.d(e,"CircleArea",function(){return kt}),i.d(e,"CollisionContact",function(){return At}),i.d(e,"CollisionJumpTable",function(){return Et}),i.d(e,"TreeNode",function(){return Qe}),i.d(e,"DynamicTree",function(){return Je}),i.d(e,"DynamicTreeCollisionBroadphase",function(){return $e}),i.d(e,"EdgeArea",function(){return Ct}),i.d(e,"NaiveCollisionBroadphase",function(){return fn}),i.d(e,"Pair",function(){return Pe}),i.d(e,"PolygonArea",function(){return Tt}),i.d(e,"Side",function(){return l}),i.d(e,"Animation",function(){return gn}),i.d(e,"Sprite",function(){return Kt}),i.d(e,"SpriteSheet",function(){return mn}),i.d(e,"SpriteFont",function(){return bn}),i.d(e,"Effects",function(){return o}),i.d(e,"Color",function(){return Pt}),i.d(e,"Polygon",function(){return yn}),i.d(e,"ExResponse",function(){return wn}),i.d(e,"PerlinGenerator",function(){return An}),i.d(e,"PerlinDrawer2D",function(){return En}),i.d(e,"Random",function(){return d}),i.d(e,"ColorBlindness",function(){return Sn}),i.d(e,"ColorBlindCorrector",function(){return kn}),i.d(e,"Resource",function(){return zt}),i.d(e,"Texture",function(){return Qt}),i.d(e,"Sound",function(){return zn}),i.d(e,"AudioContextFactory",function(){return Le}),i.d(e,"AudioInstanceFactory",function(){return Tn}),i.d(e,"AudioInstance",function(){return Mn}),i.d(e,"AudioTagInstance",function(){return Dn}),i.d(e,"WebAudioInstance",function(){return Bn}),i.d(e,"Events",function(){return n}),i.d(e,"Input",function(){return a}),i.d(e,"Traits",function(){return h}),i.d(e,"Util",function(){return u}),i.d(e,"obsolete",function(){return je}),i.d(e,"Detector",function(){return Ye}),i.d(e,"CullingBox",function(){return Ae}),i.d(e,"EasingFunctions",function(){return _e}),i.d(e,"LogLevel",function(){return H}),i.d(e,"Logger",function(){return Dt}),i.d(e,"ConsoleAppender",function(){return Bt}),i.d(e,"ScreenAppender",function(){return Ot}),i.d(e,"SortedList",function(){return ti}),i.d(e,"BinaryTreeNode",function(){return ei}),i.d(e,"MockedElement",function(){return ii});var In="0.19.1"},function(t,e){t.exports=function(t){var e=[];return e.toString=function(){return this.map(function(e){var i=function(t,e){var i,n=t[1]||"",o=t[3];if(!o)return n;if(e&&"function"==typeof btoa){var r=(i=o,"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(i))))+" */"),s=o.sources.map(function(t){return"/*# sourceURL="+o.sourceRoot+t+" */"});return[n].concat(s).concat([r]).join("\n")}return[n].join("\n")}(e,t);return e[2]?"@media "+e[2]+"{"+i+"}":i}).join("")},e.i=function(t,i){"string"==typeof t&&(t=[[null,t,""]]);for(var n={},o=0;o<this.length;o++){var r=this[o][0];"number"==typeof r&&(n[r]=!0)}for(o=0;o<t.length;o++){var s=t[o];"number"==typeof s[0]&&n[s[0]]||(i&&!s[2]?s[2]=i:i&&(s[2]="("+s[2]+") and ("+i+")"),e.push(s))}},e}},function(t,e,i){(t.exports=i(1)(!1)).push([t.i,"/* Buttons styles start */\n\nbutton#excalibur-play {\n  display: inline-block;\n  position: relative;\n  border-radius: 6px;\n  border: none;\n  /*border: 3px solid;\n    border-color: white;\n    box-shadow: 0 0 10px #ccc;*/\n  padding: 1rem 1.5rem 1rem 4rem;\n  margin: 0;\n  text-decoration: none;\n  background: #00b233;\n  color: #ffffff;\n  font-family: sans-serif;\n  font-size: 2rem;\n  line-height: 1;\n  cursor: pointer;\n  text-align: center;\n  transition: background 250ms ease-in-out, transform 150ms ease;\n  -webkit-appearance: none;\n  -moz-appearance: none;\n\n  -webkit-animation: excalibur-button-fadein 200ms; /* Safari, Chrome and Opera > 12.1 */\n  -moz-animation: excalibur-button-fadein 200ms; /* Firefox < 16 */\n  -ms-animation: excalibur-button-fadein 200ms; /* Internet Explorer */\n  -o-animation: excalibur-button-fadein 200ms; /* Opera < 12.1 */\n  animation: excalibur-button-fadein 200ms;\n}\n\n/*\nbutton#excalibur-play {\n  display: none;\n}*/\n\nbutton#excalibur-play:after {\n  position: absolute;\n  content: '';\n  border: 8px solid;\n  border-color: transparent transparent transparent white;\n  left: 35px;\n  top: 24px;\n  width: 0;\n  height: 0;\n}\n\nbutton#excalibur-play:before {\n  position: absolute;\n  content: '';\n  border: 3px solid;\n  left: 19px;\n  top: 14px;\n  border-radius: 20px;\n  width: 30px;\n  height: 30px;\n}\n\nbutton#excalibur-play:hover,\nbutton#excalibur-play:focus {\n  background: #00982c;\n}\n\nbutton#excalibur-play:focus {\n  outline: 1px solid #fff;\n  outline-offset: -4px;\n}\n\nbutton#excalibur-play:active {\n  transform: scale(0.99);\n}\n\n@keyframes excalibur-button-fadein {\n  from {\n    opacity: 0;\n  }\n  to {\n    opacity: 1;\n  }\n}\n\n/* Firefox < 16 */\n@-moz-keyframes excalibur-button-fadein {\n  from {\n    opacity: 0;\n  }\n  to {\n    opacity: 1;\n  }\n}\n\n/* Safari, Chrome and Opera > 12.1 */\n@-webkit-keyframes excalibur-button-fadein {\n  from {\n    opacity: 0;\n  }\n  to {\n    opacity: 1;\n  }\n}\n\n/* Internet Explorer */\n@-ms-keyframes excalibur-button-fadein {\n  from {\n    opacity: 0;\n  }\n  to {\n    opacity: 1;\n  }\n}\n\n/* Opera < 12.1 */\n@-o-keyframes excalibur-button-fadein {\n  from {\n    opacity: 0;\n  }\n  to {\n    opacity: 1;\n  }\n}\n",""])},function(t,e,i){var n=i(2);t.exports="string"==typeof n?n:n.toString()},function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAdQAAAB2CAYAAABxhGI9AAAACXBIWXMAAAsSAAALEgHS3X78AAAKnUlEQVR42u3dP2wjSx0H8N8hJIonIRmJjsq0SBR+BQ1dcqKhe0lD77SvSwpKkJKGPulpktfRIMUdEqKIqV57rpAokM4dbSiyq7ONPTP7x39ifz7SFbnEnp3xer47O7uzH15fXwMA6OYHmgAABCoACFQAEKgAgEAFAIEKAAIVAAQqACBQAUCgAoBABQCBCgAIVAAQqAAgUAFAoAIAAhUABCoACFQAEKgAgECFLbmOiNeFf2PbAyz68Pr6qhUgbRwR92v+/zwiJrYHMEKFMmcN///UtgcQqFBk1PD/97U9Qx8VCFSgu4EmAIEKAAIVAAQqACBQ4Z25jojP8eX+0WtNAgIVaOY+Im5j+eKh24h41jQgUIEyZ7F5NaPU7wCBCiwYd/w9cOB+qAlgJ3KLLow0EV198803RWvJfvfddx+0lhEqHKu5JgAjVCBvlhmFzjQRXUekHz9+TP79y8uLRjNChXfvoePvAYEKxNtj1e42/O5JoIJABcrdRMRVLM+X3kTEpaaB988cKuzWg9EobTWdMx0Oly8uN4dqhAoARqgnaN3arHfqu7OyH8ItKLVB/P+CEfMTHyGPY3npx1m8zWGDEeoBfUk/xdti57dr/r1Wv2+6EPow3tZ5rRdS72s1neuF97xvWd+XTH0/V+UMttDWqbI/r2nrxfp+jv2uSjSO7S+OXy/A/3lN+9xX5T5HxEUPZZ0tfB71+w57eJ/HFu+z+jkv1u92YX9fbI/HhX3JA9rp5MPr66tWaG9UfUGbrHIzi7cLUyYFf/tpTady03EEeL8mUJ6i7MKYNvWNqr4Pe2jradXO60LrvPAz2PQ5RPX684ah8dxD+2zantnCgVipSVV+m/tgB9W2DDq2Sx/vM95wcHhZhWVJm8yrv58cSgfTdc70+++/X/r522+/tUKSEepBqo+om4ZLPerMjUwuNnQCtx1GWJtee1FwdD5uWd86xLs8UaVt2aNEO1/saZ/Z5rYMW4zq6v34rGV9Bg3q2eZ9SkeNm9qwyUh30OPIHYFKx5FG03C7znSOqYBq+qW/zpQ3anH037TNHluG6f0WPsPhHvab4QFty7ogOeuxDYcNy2/zu2214WNYWxmBurNO8bGn97pNBOO8xy/9uCorZZ4I2r4C7aJgO7ZV9iE49Dm6NvOWx+pWE9CUq3zbdTp9doz38TbXtzqH9RT5CyWe422OaZoZGeZCabrhPQY9HjwsjpTvCg4YtlE2+Ta/j2bzn8fqrDqgm+6yUHOmAvWUjAtGhbNYvsBknDnqH1Qhc7VmxHgeb/NbudA5j/UXlYwif2p6luhAc9teu1npiHKnDs8if6tCm7JLX3NKpgttXe9ruc9mHMd7a83iwdxF5vt8tutARaCeklRnNK9C8WnNF7geJQ4T4XG3JhSnVdilQrG+yOnrlVHfsEGYzhNBn7Lu6tS7+HJafJQ4EMiNlNqWXZ9WPvVgnVYHG5M1ByDXkT6leX2EgTqJtyt45yv7S2qO3sEZjZhDLXeR+YKdJ0Zdk8QocvH9N732KrNtq+FZ/zzIHABcJrYpd+Xv14lOd5ap76SgrduW/VTQ1qcQpqnbgu4ifZvUMNpd9XuoZmvCtPaQ2Y/BCHVLgbrJTeRPDdVf6pfMKDU2fOkHmVFFfXr3MsouLsnNvV5kRoe5+s431PeuoKPqWnaurY/ZPBEeqwceN4l96iwO6H7Mjq4y7VGPVNe10VaZMzVCPVWpI/Z6FZbcv5fMqGCU+dLfFGzj58jP8+bCdJCo7yzKTwdOF0bu9Ug7V4c+yz7FJfYeGoysUss0HssIdVZwYLDujMqlESoCdTtGsZtbHnJBeNdDSJSs0jTKdMJN1HNX54Wv7bvsU9NkVJVa13dX+/wuArV0X/l5RHyo/lnfF4G6p6DrS0kHdtXhy35TGErDPYZUn2WfWqDOo/lVqdMD2O/hKJhD7S/odukymq9s02QN4EEPR/zbaOumZc+r15zK1Zqznl9jsfiemTM1QmV3HUuTkedlg9HIQzRbUD93dfC+2tpj2fIHEH2+RqCCQH13gZq7hWXTNpVu19OB1fc9nQ0AKOKUb5lU0P1kDyOneoWk0lOZ9cIP0x7qu8+2BhCoR2wYu1+e7DmaXzBSsu5vaX1ne2zrpmUPTmxf7PM1Dm4y/vC7ny7Nif7+z/9ZmtM0Z3panPLtPmra9f16bcK0Dpbnwk43Vd/RHtu6zfNQTy1QBy3aqG2g9nVmxml+BOoJyT3NpWmn9xhfFnu4bvDa+44BXhqqfdf3uUF9+yz77AT31Yue2mjecYQ62NLfgkA9ghHqLNEhNem4H1c6vdyDxhf/bpz5m4coW/c39wi6VH2bPtHlcaV9cvXts+zxCe6rTeqc2ndL7uGd93QwM9bFcAzMoZZ7SgTBbWx+asui61h/iq1+RmjqdbnQXQ3T1DNQ63V/U9ucqm/pMzPb1rePsk/1iTOjgvatR4W3Lc8ULB78pELyrnAfeTcj1NU509/86mfJ33/8+Mf00a05UyPUEw7UVCeWG/WNEiExyHRMt5ltW30izUPk18ytt7lNfc8i//DvtvXto+ySA5BjljsLUF8lPkqMPEtW1JomDsiGBZ9Byb4NAvUITSN9GuwsIj6t6UTOqk7jJREkmzqli8xIs96udSO20sX0H1vW92IL9e1a9rgqVyf91gbPsTy9UD9n9lOkT8k+RfkFR5PMNqxOcdSf32PBvg3vilO+zdxE+okx9Wm0ph36XYsRZCpMF993GOk5qvqB3Dct6jvssb67KvuUNJ3frw92bhr8/STSF0JdRPMLpUCgnsgo9S76PZ246ZFk1wWvK5m3vVoYvW1Sz7nN91jfXbQ1ZQc7TW6HeaoOalypG/8/p/rP1aNAc6ZHzSnfdqPUPhdy2PQw6Nz9gSVhuhiqueUHR3uu7y7K3rdDX4u46ZrPbUa0IFBZ0seKQ3XQTRt2vm3W/a2DbNKys++rvm3ep6+y1x2UdP3bWU9lzra47U1GmlctX/sQ23t+aOlByLTh/4NAPaCRxtcdO5HLSJ/6vNtCwGx67VPmPbvWd1q9frKHtp4kAqRJ2HR9j762JfX3bZ//elPtj13PPDx1+D5tqk/Xi6NO8SHz7MmH19dXrdBNfVFP6T2PT1UHNit87/t4m5+aRH+nQBdvqyhZDKJLfZs8h7XPsqdV2ZOV+tanKB8aln0dyxdAXbV4j4gvt4oMOrbP6vbU73NW7TMlbdTnPrWpfqXfh9HKZ9vke7KuTeZRNtXRSe6+1FV//ce/ln5eXfsXgcqXzr6+9261M3moOoa7E6nvTZTfy7iNsmfb7kjfgXGsvxe0vihsEts9HTquPpt1q1vtahu2TqAiUAEEKj0zhwoARqgAu/OnX/442WH+9xc/Wvr58re/Tr7f41/+ZsRqhAoACFQAEKgAcHjMoQJskJsz/eqrr5Z+vvr7v5fmQFevAl5lztQIFQAQqAAgUAHgIJlDBdhgdQ41N2eKESoAIFABQKACwFEwhwoARqgAIFABQKACAAIVAAQqAAhUABCoAIBABQCBCgACFQAEKgAgUAFAoAKAQAUAgQoACFQAEKgAIFABQKACAAIVAAQqAAhUABCoAIBABQCBCgACFQAQqAAgUAFAoAKAQAUAlvwPcFDns1DsH4sAAAAASUVORK5CYII="}])},20:function(t,e,i){var n;n=function(t){return function(t){var e={};function i(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}return i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:n})},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=7)}([function(t,e,i){"use strict";var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function o(t,e){return Object.prototype.hasOwnProperty.call(t,e)}e.assign=function(t){for(var e=Array.prototype.slice.call(arguments,1);e.length;){var i=e.shift();if(i){if("object"!=typeof i)throw new TypeError(i+"must be non-object");for(var n in i)o(i,n)&&(t[n]=i[n])}}return t},e.shrinkBuf=function(t,e){return t.length===e?t:t.subarray?t.subarray(0,e):(t.length=e,t)};var r={arraySet:function(t,e,i,n,o){if(e.subarray&&t.subarray)t.set(e.subarray(i,i+n),o);else for(var r=0;r<n;r++)t[o+r]=e[i+r]},flattenChunks:function(t){var e,i,n,o,r,s;for(n=0,e=0,i=t.length;e<i;e++)n+=t[e].length;for(s=new Uint8Array(n),o=0,e=0,i=t.length;e<i;e++)r=t[e],s.set(r,o),o+=r.length;return s}},s={arraySet:function(t,e,i,n,o){for(var r=0;r<n;r++)t[o+r]=e[i+r]},flattenChunks:function(t){return[].concat.apply([],t)}};e.setTyped=function(t){t?(e.Buf8=Uint8Array,e.Buf16=Uint16Array,e.Buf32=Int32Array,e.assign(e,r)):(e.Buf8=Array,e.Buf16=Array,e.Buf32=Array,e.assign(e,s))},e.setTyped(n)},function(t,e,i){"use strict";t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},function(t,e,i){"use strict";t.exports=function(t,e,i,n){for(var o=65535&t|0,r=t>>>16&65535|0,s=0;0!==i;){i-=s=i>2e3?2e3:i;do{r=r+(o=o+e[n++]|0)|0}while(--s);o%=65521,r%=65521}return o|r<<16|0}},function(t,e,i){"use strict";var n=function(){for(var t,e=[],i=0;i<256;i++){t=i;for(var n=0;n<8;n++)t=1&t?3988292384^t>>>1:t>>>1;e[i]=t}return e}();t.exports=function(t,e,i,o){var r=n,s=o+i;t^=-1;for(var a=o;a<s;a++)t=t>>>8^r[255&(t^e[a])];return-1^t}},function(t,e,i){"use strict";var n=i(0),o=!0,r=!0;try{String.fromCharCode.apply(null,[0])}catch(t){o=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){r=!1}for(var s=new n.Buf8(256),a=0;a<256;a++)s[a]=a>=252?6:a>=248?5:a>=240?4:a>=224?3:a>=192?2:1;function h(t,e){if(e<65537&&(t.subarray&&r||!t.subarray&&o))return String.fromCharCode.apply(null,n.shrinkBuf(t,e));for(var i="",s=0;s<e;s++)i+=String.fromCharCode(t[s]);return i}s[254]=s[254]=1,e.string2buf=function(t){var e,i,o,r,s,a=t.length,h=0;for(r=0;r<a;r++)55296==(64512&(i=t.charCodeAt(r)))&&r+1<a&&56320==(64512&(o=t.charCodeAt(r+1)))&&(i=65536+(i-55296<<10)+(o-56320),r++),h+=i<128?1:i<2048?2:i<65536?3:4;for(e=new n.Buf8(h),s=0,r=0;s<h;r++)55296==(64512&(i=t.charCodeAt(r)))&&r+1<a&&56320==(64512&(o=t.charCodeAt(r+1)))&&(i=65536+(i-55296<<10)+(o-56320),r++),i<128?e[s++]=i:i<2048?(e[s++]=192|i>>>6,e[s++]=128|63&i):i<65536?(e[s++]=224|i>>>12,e[s++]=128|i>>>6&63,e[s++]=128|63&i):(e[s++]=240|i>>>18,e[s++]=128|i>>>12&63,e[s++]=128|i>>>6&63,e[s++]=128|63&i);return e},e.buf2binstring=function(t){return h(t,t.length)},e.binstring2buf=function(t){for(var e=new n.Buf8(t.length),i=0,o=e.length;i<o;i++)e[i]=t.charCodeAt(i);return e},e.buf2string=function(t,e){var i,n,o,r,a=e||t.length,c=new Array(2*a);for(n=0,i=0;i<a;)if((o=t[i++])<128)c[n++]=o;else if((r=s[o])>4)c[n++]=65533,i+=r-1;else{for(o&=2===r?31:3===r?15:7;r>1&&i<a;)o=o<<6|63&t[i++],r--;r>1?c[n++]=65533:o<65536?c[n++]=o:(o-=65536,c[n++]=55296|o>>10&1023,c[n++]=56320|1023&o)}return h(c,n)},e.utf8border=function(t,e){var i;for((e=e||t.length)>t.length&&(e=t.length),i=e-1;i>=0&&128==(192&t[i]);)i--;return i<0?e:0===i?e:i+s[t[i]]>e?i:e}},function(t,e,i){"use strict";t.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},function(t,e,i){"use strict";t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},function(t,e,i){"use strict";var n,o=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var r,s=i(8),a=i(9);!function(t){t[t.TMX=0]="TMX",t[t.JSON=1]="JSON"}(r=e.TiledMapFormat||(e.TiledMapFormat={}));var h=function(t){function e(e,i){void 0===i&&(i=r.JSON);var n=this;switch(i){case r.JSON:n=t.call(this,e,"json")||this;break;default:throw"The format "+i+" is not currently supported. Please export Tiled map as JSON."}return n.mapFormat=i,n.imagePathAccessor=n.externalTilesetPathAccessor=function(t,i){if(0===t.indexOf("/"))return t;var n=e.split("/"),o=n.concat([]);return n.length>0&&o.splice(-1),o.push(t),o.join("/")},n}return o(e,t),e.prototype.load=function(){var e=this,i=new s.Promise;return t.prototype.load.call(this).then(function(t){var n=[];e.data.tilesets.forEach(function(t){if(t.source){var i=new s.Resource(e.externalTilesetPathAccessor(t.source,t),"json");n.push(i.load().then(function(e){Object.assign(t,e)}))}}),s.Promise.join.apply(e,n).then(function(){n=[],e.data.tilesets.forEach(function(t){var i=new s.Texture(e.imagePathAccessor(t.image,t));t.imageTexture=i,n.push(i.load()),s.Logger.getInstance().debug("[Tiled] Loading associated tileset: "+t.image)}),s.Promise.join.apply(e,n).then(function(){i.resolve(t)},function(t){i.reject(t)})},function(t){i.reject(t)})}),i},e.prototype.processData=function(t){if("object"!=typeof t)throw"Tiled map resource "+this.path+" is not the correct content type";if(void 0===t)throw"Tiled map resource "+this.path+" is empty";switch(this.mapFormat){case r.JSON:return c(t)}},e.prototype.getTilesetForTile=function(t){for(var e=this.data.tilesets.length-1;e>=0;e--){var i=this.data.tilesets[e];if(i.firstgid<=t)return i}return null},e.prototype.getTileMap=function(){for(var t=new s.TileMap(0,0,this.data.tilewidth,this.data.tileheight,this.data.height,this.data.width),e=0,i=this.data.tilesets;e<i.length;e++){var n=i[e],o=Math.floor(n.imagewidth/n.tilewidth),r=Math.floor(n.imageheight/n.tileheight),a=new s.SpriteSheet(n.imageTexture,o,r,n.tilewidth,n.tileheight);t.registerSpriteSheet(n.firstgid.toString(),a)}for(var h=0,c=this.data.layers;h<c.length;h++){var u=c[h];if("tilelayer"===u.type)for(var l=0;l<u.data.length;l++){var p=u.data[l];0!==p&&(n=this.getTilesetForTile(p),t.data[l].sprites.push(new s.TileSprite(n.firstgid.toString(),p-n.firstgid)))}}return t},e}(s.Resource);e.default=h;var c=function(t){if(t.layers)for(var e=0,i=t.layers;e<i.length;e++){var n=i[e];"string"==typeof n.data?"base64"===n.encoding&&(n.data=u.decompressBase64(n.data,n.encoding,n.compression||"")):n.data=u.decompressCsv(n.data)}return t},u={decompressCsv:function(t){return t},decompressBase64:function(t,e,i){var n,o,r,s,h,c;if(t.length%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var u="undefined"!=typeof Uint8Array?Uint8Array:Array,l="+".charCodeAt(0),p="/".charCodeAt(0),d="0".charCodeAt(0),f="a".charCodeAt(0),_="A".charCodeAt(0),g="-".charCodeAt(0),y="_".charCodeAt(0);function v(t){var e=t.charCodeAt(0);return e===l||e===g?62:e===p||e===y?63:e<d?-1:e<d+10?e-d+26+26:e<_+26?e-_:e<f+26?e-f+26:void 0}var m=t.length;h="="===t.charAt(m-2)?2:"="===t.charAt(m-1)?1:0,c=new u(3*t.length/4-h),r=h>0?t.length-4:t.length;var b=0;function w(t){c[b++]=t}for(n=0,o=0;n<r;n+=4,o+=3)w((16711680&(s=v(t.charAt(n))<<18|v(t.charAt(n+1))<<12|v(t.charAt(n+2))<<6|v(t.charAt(n+3))))>>16),w((65280&s)>>8),w(255&s);2===h?w(255&(s=v(t.charAt(n))<<2|v(t.charAt(n+1))>>4)):1===h&&(w((s=v(t.charAt(n))<<10|v(t.charAt(n+1))<<4|v(t.charAt(n+2))>>2)>>8&255),w(255&s)),"zlib"!==i&&"gzip"!==i||(c=a.inflate(c));var x=function(t){for(var e=0,i=t.length-1;i>=0;i--)e=256*e+1*t[i];return e},P=c.length/4,S=new Array(P);for(n=0;n<P;n++)S[n]=x(c.slice(4*n,4*n+3));return S}}},function(e,i){e.exports=t},function(t,e,i){"use strict";var n={};(0,i(0).assign)(n,i(10),i(13),i(6)),t.exports=n},function(t,e,i){"use strict";var n=i(11),o=i(0),r=i(4),s=i(1),a=i(5),h=Object.prototype.toString,c=0,u=-1,l=0,p=8;function d(t){if(!(this instanceof d))return new d(t);this.options=o.assign({level:u,method:p,chunkSize:16384,windowBits:15,memLevel:8,strategy:l,to:""},t||{});var e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new a,this.strm.avail_out=0;var i=n.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(i!==c)throw new Error(s[i]);if(e.header&&n.deflateSetHeader(this.strm,e.header),e.dictionary){var f;if(f="string"==typeof e.dictionary?r.string2buf(e.dictionary):"[object ArrayBuffer]"===h.call(e.dictionary)?new Uint8Array(e.dictionary):e.dictionary,(i=n.deflateSetDictionary(this.strm,f))!==c)throw new Error(s[i]);this._dict_set=!0}}function f(t,e){var i=new d(e);if(i.push(t,!0),i.err)throw i.msg||s[i.err];return i.result}d.prototype.push=function(t,e){var i,s,a=this.strm,u=this.options.chunkSize;if(this.ended)return!1;s=e===~~e?e:!0===e?4:0,"string"==typeof t?a.input=r.string2buf(t):"[object ArrayBuffer]"===h.call(t)?a.input=new Uint8Array(t):a.input=t,a.next_in=0,a.avail_in=a.input.length;do{if(0===a.avail_out&&(a.output=new o.Buf8(u),a.next_out=0,a.avail_out=u),1!==(i=n.deflate(a,s))&&i!==c)return this.onEnd(i),this.ended=!0,!1;0!==a.avail_out&&(0!==a.avail_in||4!==s&&2!==s)||("string"===this.options.to?this.onData(r.buf2binstring(o.shrinkBuf(a.output,a.next_out))):this.onData(o.shrinkBuf(a.output,a.next_out)))}while((a.avail_in>0||0===a.avail_out)&&1!==i);return 4===s?(i=n.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===c):2!==s||(this.onEnd(c),a.avail_out=0,!0)},d.prototype.onData=function(t){this.chunks.push(t)},d.prototype.onEnd=function(t){t===c&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},e.Deflate=d,e.deflate=f,e.deflateRaw=function(t,e){return(e=e||{}).raw=!0,f(t,e)},e.gzip=function(t,e){return(e=e||{}).gzip=!0,f(t,e)}},function(t,e,i){"use strict";var n,o=i(0),r=i(12),s=i(2),a=i(3),h=i(1),c=0,u=4,l=0,p=-2,d=-1,f=1,_=4,g=2,y=8,v=9,m=286,b=30,w=19,x=2*m+1,P=15,S=3,A=258,E=A+S+1,k=42,C=103,T=113,M=666,D=1,B=2,O=3,R=4;function z(t,e){return t.msg=h[e],e}function F(t){return(t<<1)-(t>4?9:0)}function I(t){for(var e=t.length;--e>=0;)t[e]=0}function L(t){var e=t.state,i=e.pending;i>t.avail_out&&(i=t.avail_out),0!==i&&(o.arraySet(t.output,e.pending_buf,e.pending_out,i,t.next_out),t.next_out+=i,e.pending_out+=i,t.total_out+=i,t.avail_out-=i,e.pending-=i,0===e.pending&&(e.pending_out=0))}function H(t,e){r._tr_flush_block(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,L(t.strm)}function j(t,e){t.pending_buf[t.pending++]=e}function U(t,e){t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e}function W(t,e){var i,n,o=t.max_chain_length,r=t.strstart,s=t.prev_length,a=t.nice_match,h=t.strstart>t.w_size-E?t.strstart-(t.w_size-E):0,c=t.window,u=t.w_mask,l=t.prev,p=t.strstart+A,d=c[r+s-1],f=c[r+s];t.prev_length>=t.good_match&&(o>>=2),a>t.lookahead&&(a=t.lookahead);do{if(c[(i=e)+s]===f&&c[i+s-1]===d&&c[i]===c[r]&&c[++i]===c[r+1]){r+=2,i++;do{}while(c[++r]===c[++i]&&c[++r]===c[++i]&&c[++r]===c[++i]&&c[++r]===c[++i]&&c[++r]===c[++i]&&c[++r]===c[++i]&&c[++r]===c[++i]&&c[++r]===c[++i]&&r<p);if(n=A-(p-r),r=p-A,n>s){if(t.match_start=e,s=n,n>=a)break;d=c[r+s-1],f=c[r+s]}}}while((e=l[e&u])>h&&0!=--o);return s<=t.lookahead?s:t.lookahead}function N(t){var e,i,n,r,h,c,u,l,p,d,f=t.w_size;do{if(r=t.window_size-t.lookahead-t.strstart,t.strstart>=f+(f-E)){o.arraySet(t.window,t.window,f,f,0),t.match_start-=f,t.strstart-=f,t.block_start-=f,e=i=t.hash_size;do{n=t.head[--e],t.head[e]=n>=f?n-f:0}while(--i);e=i=f;do{n=t.prev[--e],t.prev[e]=n>=f?n-f:0}while(--i);r+=f}if(0===t.strm.avail_in)break;if(c=t.strm,u=t.window,l=t.strstart+t.lookahead,p=r,d=void 0,(d=c.avail_in)>p&&(d=p),i=0===d?0:(c.avail_in-=d,o.arraySet(u,c.input,c.next_in,d,l),1===c.state.wrap?c.adler=s(c.adler,u,d,l):2===c.state.wrap&&(c.adler=a(c.adler,u,d,l)),c.next_in+=d,c.total_in+=d,d),t.lookahead+=i,t.lookahead+t.insert>=S)for(h=t.strstart-t.insert,t.ins_h=t.window[h],t.ins_h=(t.ins_h<<t.hash_shift^t.window[h+1])&t.hash_mask;t.insert&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[h+S-1])&t.hash_mask,t.prev[h&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=h,h++,t.insert--,!(t.lookahead+t.insert<S)););}while(t.lookahead<E&&0!==t.strm.avail_in)}function q(t,e){for(var i,n;;){if(t.lookahead<E){if(N(t),t.lookahead<E&&e===c)return D;if(0===t.lookahead)break}if(i=0,t.lookahead>=S&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+S-1])&t.hash_mask,i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==i&&t.strstart-i<=t.w_size-E&&(t.match_length=W(t,i)),t.match_length>=S)if(n=r._tr_tally(t,t.strstart-t.match_start,t.match_length-S),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=S){t.match_length--;do{t.strstart++,t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+S-1])&t.hash_mask,i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart}while(0!=--t.match_length);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+1])&t.hash_mask;else n=r._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(n&&(H(t,!1),0===t.strm.avail_out))return D}return t.insert=t.strstart<S-1?t.strstart:S-1,e===u?(H(t,!0),0===t.strm.avail_out?O:R):t.last_lit&&(H(t,!1),0===t.strm.avail_out)?D:B}function X(t,e){for(var i,n,o;;){if(t.lookahead<E){if(N(t),t.lookahead<E&&e===c)return D;if(0===t.lookahead)break}if(i=0,t.lookahead>=S&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+S-1])&t.hash_mask,i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=S-1,0!==i&&t.prev_length<t.max_lazy_match&&t.strstart-i<=t.w_size-E&&(t.match_length=W(t,i),t.match_length<=5&&(t.strategy===f||t.match_length===S&&t.strstart-t.match_start>4096)&&(t.match_length=S-1)),t.prev_length>=S&&t.match_length<=t.prev_length){o=t.strstart+t.lookahead-S,n=r._tr_tally(t,t.strstart-1-t.prev_match,t.prev_length-S),t.lookahead-=t.prev_length-1,t.prev_length-=2;do{++t.strstart<=o&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+S-1])&t.hash_mask,i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart)}while(0!=--t.prev_length);if(t.match_available=0,t.match_length=S-1,t.strstart++,n&&(H(t,!1),0===t.strm.avail_out))return D}else if(t.match_available){if((n=r._tr_tally(t,0,t.window[t.strstart-1]))&&H(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return D}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(n=r._tr_tally(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<S-1?t.strstart:S-1,e===u?(H(t,!0),0===t.strm.avail_out?O:R):t.last_lit&&(H(t,!1),0===t.strm.avail_out)?D:B}function V(t,e,i,n,o){this.good_length=t,this.max_lazy=e,this.nice_length=i,this.max_chain=n,this.func=o}function G(t){var e;return t&&t.state?(t.total_in=t.total_out=0,t.data_type=g,(e=t.state).pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap?k:T,t.adler=2===e.wrap?0:1,e.last_flush=c,r._tr_init(e),l):z(t,p)}function Z(t){var e,i=G(t);return i===l&&((e=t.state).window_size=2*e.w_size,I(e.head),e.max_lazy_match=n[e.level].max_lazy,e.good_match=n[e.level].good_length,e.nice_match=n[e.level].nice_length,e.max_chain_length=n[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=S-1,e.match_available=0,e.ins_h=0),i}function K(t,e,i,n,r,s){if(!t)return p;var a=1;if(e===d&&(e=6),n<0?(a=0,n=-n):n>15&&(a=2,n-=16),r<1||r>v||i!==y||n<8||n>15||e<0||e>9||s<0||s>_)return z(t,p);8===n&&(n=9);var h=new function(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=y,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new o.Buf16(2*x),this.dyn_dtree=new o.Buf16(2*(2*b+1)),this.bl_tree=new o.Buf16(2*(2*w+1)),I(this.dyn_ltree),I(this.dyn_dtree),I(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new o.Buf16(P+1),this.heap=new o.Buf16(2*m+1),I(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new o.Buf16(2*m+1),I(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0};return t.state=h,h.strm=t,h.wrap=a,h.gzhead=null,h.w_bits=n,h.w_size=1<<h.w_bits,h.w_mask=h.w_size-1,h.hash_bits=r+7,h.hash_size=1<<h.hash_bits,h.hash_mask=h.hash_size-1,h.hash_shift=~~((h.hash_bits+S-1)/S),h.window=new o.Buf8(2*h.w_size),h.head=new o.Buf16(h.hash_size),h.prev=new o.Buf16(h.w_size),h.lit_bufsize=1<<r+6,h.pending_buf_size=4*h.lit_bufsize,h.pending_buf=new o.Buf8(h.pending_buf_size),h.d_buf=1*h.lit_bufsize,h.l_buf=3*h.lit_bufsize,h.level=e,h.strategy=s,h.method=i,Z(t)}n=[new V(0,0,0,0,function(t,e){var i=65535;for(i>t.pending_buf_size-5&&(i=t.pending_buf_size-5);;){if(t.lookahead<=1){if(N(t),0===t.lookahead&&e===c)return D;if(0===t.lookahead)break}t.strstart+=t.lookahead,t.lookahead=0;var n=t.block_start+i;if((0===t.strstart||t.strstart>=n)&&(t.lookahead=t.strstart-n,t.strstart=n,H(t,!1),0===t.strm.avail_out))return D;if(t.strstart-t.block_start>=t.w_size-E&&(H(t,!1),0===t.strm.avail_out))return D}return t.insert=0,e===u?(H(t,!0),0===t.strm.avail_out?O:R):(t.strstart>t.block_start&&(H(t,!1),t.strm.avail_out),D)}),new V(4,4,8,4,q),new V(4,5,16,8,q),new V(4,6,32,32,q),new V(4,4,16,16,X),new V(8,16,32,32,X),new V(8,16,128,128,X),new V(8,32,128,256,X),new V(32,128,258,1024,X),new V(32,258,258,4096,X)],e.deflateInit=function(t,e){return K(t,e,y,15,8,0)},e.deflateInit2=K,e.deflateReset=Z,e.deflateResetKeep=G,e.deflateSetHeader=function(t,e){return t&&t.state?2!==t.state.wrap?p:(t.state.gzhead=e,l):p},e.deflate=function(t,e){var i,o,s,h;if(!t||!t.state||e>5||e<0)return t?z(t,p):p;if(o=t.state,!t.output||!t.input&&0!==t.avail_in||o.status===M&&e!==u)return z(t,0===t.avail_out?-5:p);if(o.strm=t,i=o.last_flush,o.last_flush=e,o.status===k)if(2===o.wrap)t.adler=0,j(o,31),j(o,139),j(o,8),o.gzhead?(j(o,(o.gzhead.text?1:0)+(o.gzhead.hcrc?2:0)+(o.gzhead.extra?4:0)+(o.gzhead.name?8:0)+(o.gzhead.comment?16:0)),j(o,255&o.gzhead.time),j(o,o.gzhead.time>>8&255),j(o,o.gzhead.time>>16&255),j(o,o.gzhead.time>>24&255),j(o,9===o.level?2:o.strategy>=2||o.level<2?4:0),j(o,255&o.gzhead.os),o.gzhead.extra&&o.gzhead.extra.length&&(j(o,255&o.gzhead.extra.length),j(o,o.gzhead.extra.length>>8&255)),o.gzhead.hcrc&&(t.adler=a(t.adler,o.pending_buf,o.pending,0)),o.gzindex=0,o.status=69):(j(o,0),j(o,0),j(o,0),j(o,0),j(o,0),j(o,9===o.level?2:o.strategy>=2||o.level<2?4:0),j(o,3),o.status=T);else{var d=y+(o.w_bits-8<<4)<<8;d|=(o.strategy>=2||o.level<2?0:o.level<6?1:6===o.level?2:3)<<6,0!==o.strstart&&(d|=32),d+=31-d%31,o.status=T,U(o,d),0!==o.strstart&&(U(o,t.adler>>>16),U(o,65535&t.adler)),t.adler=1}if(69===o.status)if(o.gzhead.extra){for(s=o.pending;o.gzindex<(65535&o.gzhead.extra.length)&&(o.pending!==o.pending_buf_size||(o.gzhead.hcrc&&o.pending>s&&(t.adler=a(t.adler,o.pending_buf,o.pending-s,s)),L(t),s=o.pending,o.pending!==o.pending_buf_size));)j(o,255&o.gzhead.extra[o.gzindex]),o.gzindex++;o.gzhead.hcrc&&o.pending>s&&(t.adler=a(t.adler,o.pending_buf,o.pending-s,s)),o.gzindex===o.gzhead.extra.length&&(o.gzindex=0,o.status=73)}else o.status=73;if(73===o.status)if(o.gzhead.name){s=o.pending;do{if(o.pending===o.pending_buf_size&&(o.gzhead.hcrc&&o.pending>s&&(t.adler=a(t.adler,o.pending_buf,o.pending-s,s)),L(t),s=o.pending,o.pending===o.pending_buf_size)){h=1;break}h=o.gzindex<o.gzhead.name.length?255&o.gzhead.name.charCodeAt(o.gzindex++):0,j(o,h)}while(0!==h);o.gzhead.hcrc&&o.pending>s&&(t.adler=a(t.adler,o.pending_buf,o.pending-s,s)),0===h&&(o.gzindex=0,o.status=91)}else o.status=91;if(91===o.status)if(o.gzhead.comment){s=o.pending;do{if(o.pending===o.pending_buf_size&&(o.gzhead.hcrc&&o.pending>s&&(t.adler=a(t.adler,o.pending_buf,o.pending-s,s)),L(t),s=o.pending,o.pending===o.pending_buf_size)){h=1;break}h=o.gzindex<o.gzhead.comment.length?255&o.gzhead.comment.charCodeAt(o.gzindex++):0,j(o,h)}while(0!==h);o.gzhead.hcrc&&o.pending>s&&(t.adler=a(t.adler,o.pending_buf,o.pending-s,s)),0===h&&(o.status=C)}else o.status=C;if(o.status===C&&(o.gzhead.hcrc?(o.pending+2>o.pending_buf_size&&L(t),o.pending+2<=o.pending_buf_size&&(j(o,255&t.adler),j(o,t.adler>>8&255),t.adler=0,o.status=T)):o.status=T),0!==o.pending){if(L(t),0===t.avail_out)return o.last_flush=-1,l}else if(0===t.avail_in&&F(e)<=F(i)&&e!==u)return z(t,-5);if(o.status===M&&0!==t.avail_in)return z(t,-5);if(0!==t.avail_in||0!==o.lookahead||e!==c&&o.status!==M){var f=2===o.strategy?function(t,e){for(var i;;){if(0===t.lookahead&&(N(t),0===t.lookahead)){if(e===c)return D;break}if(t.match_length=0,i=r._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,i&&(H(t,!1),0===t.strm.avail_out))return D}return t.insert=0,e===u?(H(t,!0),0===t.strm.avail_out?O:R):t.last_lit&&(H(t,!1),0===t.strm.avail_out)?D:B}(o,e):3===o.strategy?function(t,e){for(var i,n,o,s,a=t.window;;){if(t.lookahead<=A){if(N(t),t.lookahead<=A&&e===c)return D;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=S&&t.strstart>0&&(n=a[o=t.strstart-1])===a[++o]&&n===a[++o]&&n===a[++o]){s=t.strstart+A;do{}while(n===a[++o]&&n===a[++o]&&n===a[++o]&&n===a[++o]&&n===a[++o]&&n===a[++o]&&n===a[++o]&&n===a[++o]&&o<s);t.match_length=A-(s-o),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=S?(i=r._tr_tally(t,1,t.match_length-S),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(i=r._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),i&&(H(t,!1),0===t.strm.avail_out))return D}return t.insert=0,e===u?(H(t,!0),0===t.strm.avail_out?O:R):t.last_lit&&(H(t,!1),0===t.strm.avail_out)?D:B}(o,e):n[o.level].func(o,e);if(f!==O&&f!==R||(o.status=M),f===D||f===O)return 0===t.avail_out&&(o.last_flush=-1),l;if(f===B&&(1===e?r._tr_align(o):5!==e&&(r._tr_stored_block(o,0,0,!1),3===e&&(I(o.head),0===o.lookahead&&(o.strstart=0,o.block_start=0,o.insert=0))),L(t),0===t.avail_out))return o.last_flush=-1,l}return e!==u?l:o.wrap<=0?1:(2===o.wrap?(j(o,255&t.adler),j(o,t.adler>>8&255),j(o,t.adler>>16&255),j(o,t.adler>>24&255),j(o,255&t.total_in),j(o,t.total_in>>8&255),j(o,t.total_in>>16&255),j(o,t.total_in>>24&255)):(U(o,t.adler>>>16),U(o,65535&t.adler)),L(t),o.wrap>0&&(o.wrap=-o.wrap),0!==o.pending?l:1)},e.deflateEnd=function(t){var e;return t&&t.state?(e=t.state.status)!==k&&69!==e&&73!==e&&91!==e&&e!==C&&e!==T&&e!==M?z(t,p):(t.state=null,e===T?z(t,-3):l):p},e.deflateSetDictionary=function(t,e){var i,n,r,a,h,c,u,d,f=e.length;if(!t||!t.state)return p;if(2===(a=(i=t.state).wrap)||1===a&&i.status!==k||i.lookahead)return p;for(1===a&&(t.adler=s(t.adler,e,f,0)),i.wrap=0,f>=i.w_size&&(0===a&&(I(i.head),i.strstart=0,i.block_start=0,i.insert=0),d=new o.Buf8(i.w_size),o.arraySet(d,e,f-i.w_size,i.w_size,0),e=d,f=i.w_size),h=t.avail_in,c=t.next_in,u=t.input,t.avail_in=f,t.next_in=0,t.input=e,N(i);i.lookahead>=S;){n=i.strstart,r=i.lookahead-(S-1);do{i.ins_h=(i.ins_h<<i.hash_shift^i.window[n+S-1])&i.hash_mask,i.prev[n&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=n,n++}while(--r);i.strstart=n,i.lookahead=S-1,N(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=S-1,i.match_available=0,t.next_in=c,t.input=u,t.avail_in=h,i.wrap=a,l},e.deflateInfo="pako deflate (from Nodeca project)"},function(t,e,i){"use strict";var n=i(0);function o(t){for(var e=t.length;--e>=0;)t[e]=0}var r=0,s=256,a=s+1+29,h=30,c=19,u=2*a+1,l=15,p=16,d=256,f=16,_=17,g=18,y=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],v=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],m=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],b=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],w=new Array(2*(a+2));o(w);var x=new Array(2*h);o(x);var P=new Array(512);o(P);var S=new Array(256);o(S);var A=new Array(29);o(A);var E,k,C,T=new Array(h);function M(t,e,i,n,o){this.static_tree=t,this.extra_bits=e,this.extra_base=i,this.elems=n,this.max_length=o,this.has_stree=t&&t.length}function D(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}function B(t){return t<256?P[t]:P[256+(t>>>7)]}function O(t,e){t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255}function R(t,e,i){t.bi_valid>p-i?(t.bi_buf|=e<<t.bi_valid&65535,O(t,t.bi_buf),t.bi_buf=e>>p-t.bi_valid,t.bi_valid+=i-p):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=i)}function z(t,e,i){R(t,i[2*e],i[2*e+1])}function F(t,e){var i=0;do{i|=1&t,t>>>=1,i<<=1}while(--e>0);return i>>>1}function I(t,e,i){var n,o,r=new Array(l+1),s=0;for(n=1;n<=l;n++)r[n]=s=s+i[n-1]<<1;for(o=0;o<=e;o++){var a=t[2*o+1];0!==a&&(t[2*o]=F(r[a]++,a))}}function L(t){var e;for(e=0;e<a;e++)t.dyn_ltree[2*e]=0;for(e=0;e<h;e++)t.dyn_dtree[2*e]=0;for(e=0;e<c;e++)t.bl_tree[2*e]=0;t.dyn_ltree[2*d]=1,t.opt_len=t.static_len=0,t.last_lit=t.matches=0}function H(t){t.bi_valid>8?O(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0}function j(t,e,i,n){var o=2*e,r=2*i;return t[o]<t[r]||t[o]===t[r]&&n[e]<=n[i]}function U(t,e,i){for(var n=t.heap[i],o=i<<1;o<=t.heap_len&&(o<t.heap_len&&j(e,t.heap[o+1],t.heap[o],t.depth)&&o++,!j(e,n,t.heap[o],t.depth));)t.heap[i]=t.heap[o],i=o,o<<=1;t.heap[i]=n}function W(t,e,i){var n,o,r,a,h=0;if(0!==t.last_lit)do{n=t.pending_buf[t.d_buf+2*h]<<8|t.pending_buf[t.d_buf+2*h+1],o=t.pending_buf[t.l_buf+h],h++,0===n?z(t,o,e):(z(t,(r=S[o])+s+1,e),0!==(a=y[r])&&R(t,o-=A[r],a),z(t,r=B(--n),i),0!==(a=v[r])&&R(t,n-=T[r],a))}while(h<t.last_lit);z(t,d,e)}function N(t,e){var i,n,o,r=e.dyn_tree,s=e.stat_desc.static_tree,a=e.stat_desc.has_stree,h=e.stat_desc.elems,c=-1;for(t.heap_len=0,t.heap_max=u,i=0;i<h;i++)0!==r[2*i]?(t.heap[++t.heap_len]=c=i,t.depth[i]=0):r[2*i+1]=0;for(;t.heap_len<2;)r[2*(o=t.heap[++t.heap_len]=c<2?++c:0)]=1,t.depth[o]=0,t.opt_len--,a&&(t.static_len-=s[2*o+1]);for(e.max_code=c,i=t.heap_len>>1;i>=1;i--)U(t,r,i);o=h;do{i=t.heap[1],t.heap[1]=t.heap[t.heap_len--],U(t,r,1),n=t.heap[1],t.heap[--t.heap_max]=i,t.heap[--t.heap_max]=n,r[2*o]=r[2*i]+r[2*n],t.depth[o]=(t.depth[i]>=t.depth[n]?t.depth[i]:t.depth[n])+1,r[2*i+1]=r[2*n+1]=o,t.heap[1]=o++,U(t,r,1)}while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],function(t,e){var i,n,o,r,s,a,h=e.dyn_tree,c=e.max_code,p=e.stat_desc.static_tree,d=e.stat_desc.has_stree,f=e.stat_desc.extra_bits,_=e.stat_desc.extra_base,g=e.stat_desc.max_length,y=0;for(r=0;r<=l;r++)t.bl_count[r]=0;for(h[2*t.heap[t.heap_max]+1]=0,i=t.heap_max+1;i<u;i++)(r=h[2*h[2*(n=t.heap[i])+1]+1]+1)>g&&(r=g,y++),h[2*n+1]=r,n>c||(t.bl_count[r]++,s=0,n>=_&&(s=f[n-_]),a=h[2*n],t.opt_len+=a*(r+s),d&&(t.static_len+=a*(p[2*n+1]+s)));if(0!==y){do{for(r=g-1;0===t.bl_count[r];)r--;t.bl_count[r]--,t.bl_count[r+1]+=2,t.bl_count[g]--,y-=2}while(y>0);for(r=g;0!==r;r--)for(n=t.bl_count[r];0!==n;)(o=t.heap[--i])>c||(h[2*o+1]!==r&&(t.opt_len+=(r-h[2*o+1])*h[2*o],h[2*o+1]=r),n--)}}(t,e),I(r,c,t.bl_count)}function q(t,e,i){var n,o,r=-1,s=e[1],a=0,h=7,c=4;for(0===s&&(h=138,c=3),e[2*(i+1)+1]=65535,n=0;n<=i;n++)o=s,s=e[2*(n+1)+1],++a<h&&o===s||(a<c?t.bl_tree[2*o]+=a:0!==o?(o!==r&&t.bl_tree[2*o]++,t.bl_tree[2*f]++):a<=10?t.bl_tree[2*_]++:t.bl_tree[2*g]++,a=0,r=o,0===s?(h=138,c=3):o===s?(h=6,c=3):(h=7,c=4))}function X(t,e,i){var n,o,r=-1,s=e[1],a=0,h=7,c=4;for(0===s&&(h=138,c=3),n=0;n<=i;n++)if(o=s,s=e[2*(n+1)+1],!(++a<h&&o===s)){if(a<c)do{z(t,o,t.bl_tree)}while(0!=--a);else 0!==o?(o!==r&&(z(t,o,t.bl_tree),a--),z(t,f,t.bl_tree),R(t,a-3,2)):a<=10?(z(t,_,t.bl_tree),R(t,a-3,3)):(z(t,g,t.bl_tree),R(t,a-11,7));a=0,r=o,0===s?(h=138,c=3):o===s?(h=6,c=3):(h=7,c=4)}}o(T);var V=!1;function G(t,e,i,o){R(t,(r<<1)+(o?1:0),3),function(t,e,i,o){H(t),O(t,i),O(t,~i),n.arraySet(t.pending_buf,t.window,e,i,t.pending),t.pending+=i}(t,e,i)}e._tr_init=function(t){V||(function(){var t,e,i,n,o,r=new Array(l+1);for(i=0,n=0;n<28;n++)for(A[n]=i,t=0;t<1<<y[n];t++)S[i++]=n;for(S[i-1]=n,o=0,n=0;n<16;n++)for(T[n]=o,t=0;t<1<<v[n];t++)P[o++]=n;for(o>>=7;n<h;n++)for(T[n]=o<<7,t=0;t<1<<v[n]-7;t++)P[256+o++]=n;for(e=0;e<=l;e++)r[e]=0;for(t=0;t<=143;)w[2*t+1]=8,t++,r[8]++;for(;t<=255;)w[2*t+1]=9,t++,r[9]++;for(;t<=279;)w[2*t+1]=7,t++,r[7]++;for(;t<=287;)w[2*t+1]=8,t++,r[8]++;for(I(w,a+1,r),t=0;t<h;t++)x[2*t+1]=5,x[2*t]=F(t,5);E=new M(w,y,s+1,a,l),k=new M(x,v,0,h,l),C=new M(new Array(0),m,0,c,7)}(),V=!0),t.l_desc=new D(t.dyn_ltree,E),t.d_desc=new D(t.dyn_dtree,k),t.bl_desc=new D(t.bl_tree,C),t.bi_buf=0,t.bi_valid=0,L(t)},e._tr_stored_block=G,e._tr_flush_block=function(t,e,i,n){var o,r,a=0;t.level>0?(2===t.strm.data_type&&(t.strm.data_type=function(t){var e,i=4093624447;for(e=0;e<=31;e++,i>>>=1)if(1&i&&0!==t.dyn_ltree[2*e])return 0;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return 1;for(e=32;e<s;e++)if(0!==t.dyn_ltree[2*e])return 1;return 0}(t)),N(t,t.l_desc),N(t,t.d_desc),a=function(t){var e;for(q(t,t.dyn_ltree,t.l_desc.max_code),q(t,t.dyn_dtree,t.d_desc.max_code),N(t,t.bl_desc),e=c-1;e>=3&&0===t.bl_tree[2*b[e]+1];e--);return t.opt_len+=3*(e+1)+5+5+4,e}(t),o=t.opt_len+3+7>>>3,(r=t.static_len+3+7>>>3)<=o&&(o=r)):o=r=i+5,i+4<=o&&-1!==e?G(t,e,i,n):4===t.strategy||r===o?(R(t,2+(n?1:0),3),W(t,w,x)):(R(t,4+(n?1:0),3),function(t,e,i,n){var o;for(R(t,e-257,5),R(t,i-1,5),R(t,n-4,4),o=0;o<n;o++)R(t,t.bl_tree[2*b[o]+1],3);X(t,t.dyn_ltree,e-1),X(t,t.dyn_dtree,i-1)}(t,t.l_desc.max_code+1,t.d_desc.max_code+1,a+1),W(t,t.dyn_ltree,t.dyn_dtree)),L(t),n&&H(t)},e._tr_tally=function(t,e,i){return t.pending_buf[t.d_buf+2*t.last_lit]=e>>>8&255,t.pending_buf[t.d_buf+2*t.last_lit+1]=255&e,t.pending_buf[t.l_buf+t.last_lit]=255&i,t.last_lit++,0===e?t.dyn_ltree[2*i]++:(t.matches++,e--,t.dyn_ltree[2*(S[i]+s+1)]++,t.dyn_dtree[2*B(e)]++),t.last_lit===t.lit_bufsize-1},e._tr_align=function(t){R(t,2,3),z(t,d,w),function(t){16===t.bi_valid?(O(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)}(t)}},function(t,e,i){"use strict";var n=i(14),o=i(0),r=i(4),s=i(6),a=i(1),h=i(5),c=i(17),u=Object.prototype.toString;function l(t){if(!(this instanceof l))return new l(t);this.options=o.assign({chunkSize:16384,windowBits:0,to:""},t||{});var e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&0==(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new h,this.strm.avail_out=0;var i=n.inflateInit2(this.strm,e.windowBits);if(i!==s.Z_OK)throw new Error(a[i]);this.header=new c,n.inflateGetHeader(this.strm,this.header)}function p(t,e){var i=new l(e);if(i.push(t,!0),i.err)throw i.msg||a[i.err];return i.result}l.prototype.push=function(t,e){var i,a,h,c,l,p,d=this.strm,f=this.options.chunkSize,_=this.options.dictionary,g=!1;if(this.ended)return!1;a=e===~~e?e:!0===e?s.Z_FINISH:s.Z_NO_FLUSH,"string"==typeof t?d.input=r.binstring2buf(t):"[object ArrayBuffer]"===u.call(t)?d.input=new Uint8Array(t):d.input=t,d.next_in=0,d.avail_in=d.input.length;do{if(0===d.avail_out&&(d.output=new o.Buf8(f),d.next_out=0,d.avail_out=f),(i=n.inflate(d,s.Z_NO_FLUSH))===s.Z_NEED_DICT&&_&&(p="string"==typeof _?r.string2buf(_):"[object ArrayBuffer]"===u.call(_)?new Uint8Array(_):_,i=n.inflateSetDictionary(this.strm,p)),i===s.Z_BUF_ERROR&&!0===g&&(i=s.Z_OK,g=!1),i!==s.Z_STREAM_END&&i!==s.Z_OK)return this.onEnd(i),this.ended=!0,!1;d.next_out&&(0!==d.avail_out&&i!==s.Z_STREAM_END&&(0!==d.avail_in||a!==s.Z_FINISH&&a!==s.Z_SYNC_FLUSH)||("string"===this.options.to?(h=r.utf8border(d.output,d.next_out),c=d.next_out-h,l=r.buf2string(d.output,h),d.next_out=c,d.avail_out=f-c,c&&o.arraySet(d.output,d.output,h,c,0),this.onData(l)):this.onData(o.shrinkBuf(d.output,d.next_out)))),0===d.avail_in&&0===d.avail_out&&(g=!0)}while((d.avail_in>0||0===d.avail_out)&&i!==s.Z_STREAM_END);return i===s.Z_STREAM_END&&(a=s.Z_FINISH),a===s.Z_FINISH?(i=n.inflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===s.Z_OK):a!==s.Z_SYNC_FLUSH||(this.onEnd(s.Z_OK),d.avail_out=0,!0)},l.prototype.onData=function(t){this.chunks.push(t)},l.prototype.onEnd=function(t){t===s.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},e.Inflate=l,e.inflate=p,e.inflateRaw=function(t,e){return(e=e||{}).raw=!0,p(t,e)},e.ungzip=p},function(t,e,i){"use strict";var n=i(0),o=i(2),r=i(3),s=i(15),a=i(16),h=1,c=2,u=0,l=-2,p=1,d=12,f=30,_=852,g=592;function y(t){return(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24)}function v(t){var e;return t&&t.state?(e=t.state,t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=p,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new n.Buf32(_),e.distcode=e.distdyn=new n.Buf32(g),e.sane=1,e.back=-1,u):l}function m(t){var e;return t&&t.state?((e=t.state).wsize=0,e.whave=0,e.wnext=0,v(t)):l}function b(t,e){var i,n;return t&&t.state?(n=t.state,e<0?(i=0,e=-e):(i=1+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?l:(null!==n.window&&n.wbits!==e&&(n.window=null),n.wrap=i,n.wbits=e,m(t))):l}function w(t,e){var i,o;return t?(o=new function(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new n.Buf16(320),this.work=new n.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0},t.state=o,o.window=null,(i=b(t,e))!==u&&(t.state=null),i):l}var x,P,S=!0;function A(t){if(S){var e;for(x=new n.Buf32(512),P=new n.Buf32(32),e=0;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(a(h,t.lens,0,288,x,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;a(c,t.lens,0,32,P,0,t.work,{bits:5}),S=!1}t.lencode=x,t.lenbits=9,t.distcode=P,t.distbits=5}function E(t,e,i,o){var r,s=t.state;return null===s.window&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new n.Buf8(s.wsize)),o>=s.wsize?(n.arraySet(s.window,e,i-s.wsize,s.wsize,0),s.wnext=0,s.whave=s.wsize):((r=s.wsize-s.wnext)>o&&(r=o),n.arraySet(s.window,e,i-o,r,s.wnext),(o-=r)?(n.arraySet(s.window,e,i-o,o,0),s.wnext=o,s.whave=s.wsize):(s.wnext+=r,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=r))),0}e.inflateReset=m,e.inflateReset2=b,e.inflateResetKeep=v,e.inflateInit=function(t){return w(t,15)},e.inflateInit2=w,e.inflate=function(t,e){var i,_,g,v,m,b,w,x,P,S,k,C,T,M,D,B,O,R,z,F,I,L,H,j,U=0,W=new n.Buf8(4),N=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!t||!t.state||!t.output||!t.input&&0!==t.avail_in)return l;(i=t.state).mode===d&&(i.mode=13),m=t.next_out,g=t.output,w=t.avail_out,v=t.next_in,_=t.input,b=t.avail_in,x=i.hold,P=i.bits,S=b,k=w,L=u;t:for(;;)switch(i.mode){case p:if(0===i.wrap){i.mode=13;break}for(;P<16;){if(0===b)break t;b--,x+=_[v++]<<P,P+=8}if(2&i.wrap&&35615===x){i.check=0,W[0]=255&x,W[1]=x>>>8&255,i.check=r(i.check,W,2,0),x=0,P=0,i.mode=2;break}if(i.flags=0,i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&x)<<8)+(x>>8))%31){t.msg="incorrect header check",i.mode=f;break}if(8!=(15&x)){t.msg="unknown compression method",i.mode=f;break}if(P-=4,I=8+(15&(x>>>=4)),0===i.wbits)i.wbits=I;else if(I>i.wbits){t.msg="invalid window size",i.mode=f;break}i.dmax=1<<I,t.adler=i.check=1,i.mode=512&x?10:d,x=0,P=0;break;case 2:for(;P<16;){if(0===b)break t;b--,x+=_[v++]<<P,P+=8}if(i.flags=x,8!=(255&i.flags)){t.msg="unknown compression method",i.mode=f;break}if(57344&i.flags){t.msg="unknown header flags set",i.mode=f;break}i.head&&(i.head.text=x>>8&1),512&i.flags&&(W[0]=255&x,W[1]=x>>>8&255,i.check=r(i.check,W,2,0)),x=0,P=0,i.mode=3;case 3:for(;P<32;){if(0===b)break t;b--,x+=_[v++]<<P,P+=8}i.head&&(i.head.time=x),512&i.flags&&(W[0]=255&x,W[1]=x>>>8&255,W[2]=x>>>16&255,W[3]=x>>>24&255,i.check=r(i.check,W,4,0)),x=0,P=0,i.mode=4;case 4:for(;P<16;){if(0===b)break t;b--,x+=_[v++]<<P,P+=8}i.head&&(i.head.xflags=255&x,i.head.os=x>>8),512&i.flags&&(W[0]=255&x,W[1]=x>>>8&255,i.check=r(i.check,W,2,0)),x=0,P=0,i.mode=5;case 5:if(1024&i.flags){for(;P<16;){if(0===b)break t;b--,x+=_[v++]<<P,P+=8}i.length=x,i.head&&(i.head.extra_len=x),512&i.flags&&(W[0]=255&x,W[1]=x>>>8&255,i.check=r(i.check,W,2,0)),x=0,P=0}else i.head&&(i.head.extra=null);i.mode=6;case 6:if(1024&i.flags&&((C=i.length)>b&&(C=b),C&&(i.head&&(I=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Array(i.head.extra_len)),n.arraySet(i.head.extra,_,v,C,I)),512&i.flags&&(i.check=r(i.check,_,C,v)),b-=C,v+=C,i.length-=C),i.length))break t;i.length=0,i.mode=7;case 7:if(2048&i.flags){if(0===b)break t;C=0;do{I=_[v+C++],i.head&&I&&i.length<65536&&(i.head.name+=String.fromCharCode(I))}while(I&&C<b);if(512&i.flags&&(i.check=r(i.check,_,C,v)),b-=C,v+=C,I)break t}else i.head&&(i.head.name=null);i.length=0,i.mode=8;case 8:if(4096&i.flags){if(0===b)break t;C=0;do{I=_[v+C++],i.head&&I&&i.length<65536&&(i.head.comment+=String.fromCharCode(I))}while(I&&C<b);if(512&i.flags&&(i.check=r(i.check,_,C,v)),b-=C,v+=C,I)break t}else i.head&&(i.head.comment=null);i.mode=9;case 9:if(512&i.flags){for(;P<16;){if(0===b)break t;b--,x+=_[v++]<<P,P+=8}if(x!==(65535&i.check)){t.msg="header crc mismatch",i.mode=f;break}x=0,P=0}i.head&&(i.head.hcrc=i.flags>>9&1,i.head.done=!0),t.adler=i.check=0,i.mode=d;break;case 10:for(;P<32;){if(0===b)break t;b--,x+=_[v++]<<P,P+=8}t.adler=i.check=y(x),x=0,P=0,i.mode=11;case 11:if(0===i.havedict)return t.next_out=m,t.avail_out=w,t.next_in=v,t.avail_in=b,i.hold=x,i.bits=P,2;t.adler=i.check=1,i.mode=d;case d:if(5===e||6===e)break t;case 13:if(i.last){x>>>=7&P,P-=7&P,i.mode=27;break}for(;P<3;){if(0===b)break t;b--,x+=_[v++]<<P,P+=8}switch(i.last=1&x,P-=1,3&(x>>>=1)){case 0:i.mode=14;break;case 1:if(A(i),i.mode=20,6===e){x>>>=2,P-=2;break t}break;case 2:i.mode=17;break;case 3:t.msg="invalid block type",i.mode=f}x>>>=2,P-=2;break;case 14:for(x>>>=7&P,P-=7&P;P<32;){if(0===b)break t;b--,x+=_[v++]<<P,P+=8}if((65535&x)!=(x>>>16^65535)){t.msg="invalid stored block lengths",i.mode=f;break}if(i.length=65535&x,x=0,P=0,i.mode=15,6===e)break t;case 15:i.mode=16;case 16:if(C=i.length){if(C>b&&(C=b),C>w&&(C=w),0===C)break t;n.arraySet(g,_,v,C,m),b-=C,v+=C,w-=C,m+=C,i.length-=C;break}i.mode=d;break;case 17:for(;P<14;){if(0===b)break t;b--,x+=_[v++]<<P,P+=8}if(i.nlen=257+(31&x),x>>>=5,P-=5,i.ndist=1+(31&x),x>>>=5,P-=5,i.ncode=4+(15&x),x>>>=4,P-=4,i.nlen>286||i.ndist>30){t.msg="too many length or distance symbols",i.mode=f;break}i.have=0,i.mode=18;case 18:for(;i.have<i.ncode;){for(;P<3;){if(0===b)break t;b--,x+=_[v++]<<P,P+=8}i.lens[N[i.have++]]=7&x,x>>>=3,P-=3}for(;i.have<19;)i.lens[N[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,H={bits:i.lenbits},L=a(0,i.lens,0,19,i.lencode,0,i.work,H),i.lenbits=H.bits,L){t.msg="invalid code lengths set",i.mode=f;break}i.have=0,i.mode=19;case 19:for(;i.have<i.nlen+i.ndist;){for(;B=(U=i.lencode[x&(1<<i.lenbits)-1])>>>16&255,O=65535&U,!((D=U>>>24)<=P);){if(0===b)break t;b--,x+=_[v++]<<P,P+=8}if(O<16)x>>>=D,P-=D,i.lens[i.have++]=O;else{if(16===O){for(j=D+2;P<j;){if(0===b)break t;b--,x+=_[v++]<<P,P+=8}if(x>>>=D,P-=D,0===i.have){t.msg="invalid bit length repeat",i.mode=f;break}I=i.lens[i.have-1],C=3+(3&x),x>>>=2,P-=2}else if(17===O){for(j=D+3;P<j;){if(0===b)break t;b--,x+=_[v++]<<P,P+=8}P-=D,I=0,C=3+(7&(x>>>=D)),x>>>=3,P-=3}else{for(j=D+7;P<j;){if(0===b)break t;b--,x+=_[v++]<<P,P+=8}P-=D,I=0,C=11+(127&(x>>>=D)),x>>>=7,P-=7}if(i.have+C>i.nlen+i.ndist){t.msg="invalid bit length repeat",i.mode=f;break}for(;C--;)i.lens[i.have++]=I}}if(i.mode===f)break;if(0===i.lens[256]){t.msg="invalid code -- missing end-of-block",i.mode=f;break}if(i.lenbits=9,H={bits:i.lenbits},L=a(h,i.lens,0,i.nlen,i.lencode,0,i.work,H),i.lenbits=H.bits,L){t.msg="invalid literal/lengths set",i.mode=f;break}if(i.distbits=6,i.distcode=i.distdyn,H={bits:i.distbits},L=a(c,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,H),i.distbits=H.bits,L){t.msg="invalid distances set",i.mode=f;break}if(i.mode=20,6===e)break t;case 20:i.mode=21;case 21:if(b>=6&&w>=258){t.next_out=m,t.avail_out=w,t.next_in=v,t.avail_in=b,i.hold=x,i.bits=P,s(t,k),m=t.next_out,g=t.output,w=t.avail_out,v=t.next_in,_=t.input,b=t.avail_in,x=i.hold,P=i.bits,i.mode===d&&(i.back=-1);break}for(i.back=0;B=(U=i.lencode[x&(1<<i.lenbits)-1])>>>16&255,O=65535&U,!((D=U>>>24)<=P);){if(0===b)break t;b--,x+=_[v++]<<P,P+=8}if(B&&0==(240&B)){for(R=D,z=B,F=O;B=(U=i.lencode[F+((x&(1<<R+z)-1)>>R)])>>>16&255,O=65535&U,!(R+(D=U>>>24)<=P);){if(0===b)break t;b--,x+=_[v++]<<P,P+=8}x>>>=R,P-=R,i.back+=R}if(x>>>=D,P-=D,i.back+=D,i.length=O,0===B){i.mode=26;break}if(32&B){i.back=-1,i.mode=d;break}if(64&B){t.msg="invalid literal/length code",i.mode=f;break}i.extra=15&B,i.mode=22;case 22:if(i.extra){for(j=i.extra;P<j;){if(0===b)break t;b--,x+=_[v++]<<P,P+=8}i.length+=x&(1<<i.extra)-1,x>>>=i.extra,P-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=23;case 23:for(;B=(U=i.distcode[x&(1<<i.distbits)-1])>>>16&255,O=65535&U,!((D=U>>>24)<=P);){if(0===b)break t;b--,x+=_[v++]<<P,P+=8}if(0==(240&B)){for(R=D,z=B,F=O;B=(U=i.distcode[F+((x&(1<<R+z)-1)>>R)])>>>16&255,O=65535&U,!(R+(D=U>>>24)<=P);){if(0===b)break t;b--,x+=_[v++]<<P,P+=8}x>>>=R,P-=R,i.back+=R}if(x>>>=D,P-=D,i.back+=D,64&B){t.msg="invalid distance code",i.mode=f;break}i.offset=O,i.extra=15&B,i.mode=24;case 24:if(i.extra){for(j=i.extra;P<j;){if(0===b)break t;b--,x+=_[v++]<<P,P+=8}i.offset+=x&(1<<i.extra)-1,x>>>=i.extra,P-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){t.msg="invalid distance too far back",i.mode=f;break}i.mode=25;case 25:if(0===w)break t;if(C=k-w,i.offset>C){if((C=i.offset-C)>i.whave&&i.sane){t.msg="invalid distance too far back",i.mode=f;break}C>i.wnext?(C-=i.wnext,T=i.wsize-C):T=i.wnext-C,C>i.length&&(C=i.length),M=i.window}else M=g,T=m-i.offset,C=i.length;C>w&&(C=w),w-=C,i.length-=C;do{g[m++]=M[T++]}while(--C);0===i.length&&(i.mode=21);break;case 26:if(0===w)break t;g[m++]=i.length,w--,i.mode=21;break;case 27:if(i.wrap){for(;P<32;){if(0===b)break t;b--,x|=_[v++]<<P,P+=8}if(k-=w,t.total_out+=k,i.total+=k,k&&(t.adler=i.check=i.flags?r(i.check,g,k,m-k):o(i.check,g,k,m-k)),k=w,(i.flags?x:y(x))!==i.check){t.msg="incorrect data check",i.mode=f;break}x=0,P=0}i.mode=28;case 28:if(i.wrap&&i.flags){for(;P<32;){if(0===b)break t;b--,x+=_[v++]<<P,P+=8}if(x!==(4294967295&i.total)){t.msg="incorrect length check",i.mode=f;break}x=0,P=0}i.mode=29;case 29:L=1;break t;case f:L=-3;break t;case 31:return-4;case 32:default:return l}return t.next_out=m,t.avail_out=w,t.next_in=v,t.avail_in=b,i.hold=x,i.bits=P,(i.wsize||k!==t.avail_out&&i.mode<f&&(i.mode<27||4!==e))&&E(t,t.output,t.next_out,k-t.avail_out)?(i.mode=31,-4):(S-=t.avail_in,k-=t.avail_out,t.total_in+=S,t.total_out+=k,i.total+=k,i.wrap&&k&&(t.adler=i.check=i.flags?r(i.check,g,k,t.next_out-k):o(i.check,g,k,t.next_out-k)),t.data_type=i.bits+(i.last?64:0)+(i.mode===d?128:0)+(20===i.mode||15===i.mode?256:0),(0===S&&0===k||4===e)&&L===u&&(L=-5),L)},e.inflateEnd=function(t){if(!t||!t.state)return l;var e=t.state;return e.window&&(e.window=null),t.state=null,u},e.inflateGetHeader=function(t,e){var i;return t&&t.state?0==(2&(i=t.state).wrap)?l:(i.head=e,e.done=!1,u):l},e.inflateSetDictionary=function(t,e){var i,n=e.length;return t&&t.state?0!==(i=t.state).wrap&&11!==i.mode?l:11===i.mode&&o(1,e,n,0)!==i.check?-3:E(t,e,n,n)?(i.mode=31,-4):(i.havedict=1,u):l},e.inflateInfo="pako inflate (from Nodeca project)"},function(t,e,i){"use strict";t.exports=function(t,e){var i,n,o,r,s,a,h,c,u,l,p,d,f,_,g,y,v,m,b,w,x,P,S,A,E;i=t.state,n=t.next_in,A=t.input,o=n+(t.avail_in-5),r=t.next_out,E=t.output,s=r-(e-t.avail_out),a=r+(t.avail_out-257),h=i.dmax,c=i.wsize,u=i.whave,l=i.wnext,p=i.window,d=i.hold,f=i.bits,_=i.lencode,g=i.distcode,y=(1<<i.lenbits)-1,v=(1<<i.distbits)-1;t:do{f<15&&(d+=A[n++]<<f,f+=8,d+=A[n++]<<f,f+=8),m=_[d&y];e:for(;;){if(d>>>=b=m>>>24,f-=b,0==(b=m>>>16&255))E[r++]=65535&m;else{if(!(16&b)){if(0==(64&b)){m=_[(65535&m)+(d&(1<<b)-1)];continue e}if(32&b){i.mode=12;break t}t.msg="invalid literal/length code",i.mode=30;break t}w=65535&m,(b&=15)&&(f<b&&(d+=A[n++]<<f,f+=8),w+=d&(1<<b)-1,d>>>=b,f-=b),f<15&&(d+=A[n++]<<f,f+=8,d+=A[n++]<<f,f+=8),m=g[d&v];i:for(;;){if(d>>>=b=m>>>24,f-=b,!(16&(b=m>>>16&255))){if(0==(64&b)){m=g[(65535&m)+(d&(1<<b)-1)];continue i}t.msg="invalid distance code",i.mode=30;break t}if(x=65535&m,f<(b&=15)&&(d+=A[n++]<<f,(f+=8)<b&&(d+=A[n++]<<f,f+=8)),(x+=d&(1<<b)-1)>h){t.msg="invalid distance too far back",i.mode=30;break t}if(d>>>=b,f-=b,x>(b=r-s)){if((b=x-b)>u&&i.sane){t.msg="invalid distance too far back",i.mode=30;break t}if(P=0,S=p,0===l){if(P+=c-b,b<w){w-=b;do{E[r++]=p[P++]}while(--b);P=r-x,S=E}}else if(l<b){if(P+=c+l-b,(b-=l)<w){w-=b;do{E[r++]=p[P++]}while(--b);if(P=0,l<w){w-=b=l;do{E[r++]=p[P++]}while(--b);P=r-x,S=E}}}else if(P+=l-b,b<w){w-=b;do{E[r++]=p[P++]}while(--b);P=r-x,S=E}for(;w>2;)E[r++]=S[P++],E[r++]=S[P++],E[r++]=S[P++],w-=3;w&&(E[r++]=S[P++],w>1&&(E[r++]=S[P++]))}else{P=r-x;do{E[r++]=E[P++],E[r++]=E[P++],E[r++]=E[P++],w-=3}while(w>2);w&&(E[r++]=E[P++],w>1&&(E[r++]=E[P++]))}break}}break}}while(n<o&&r<a);n-=w=f>>3,d&=(1<<(f-=w<<3))-1,t.next_in=n,t.next_out=r,t.avail_in=n<o?o-n+5:5-(n-o),t.avail_out=r<a?a-r+257:257-(r-a),i.hold=d,i.bits=f}},function(t,e,i){"use strict";var n=i(0),o=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],r=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],s=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],a=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function(t,e,i,h,c,u,l,p){var d,f,_,g,y,v,m,b,w,x=p.bits,P=0,S=0,A=0,E=0,k=0,C=0,T=0,M=0,D=0,B=0,O=null,R=0,z=new n.Buf16(16),F=new n.Buf16(16),I=null,L=0;for(P=0;P<=15;P++)z[P]=0;for(S=0;S<h;S++)z[e[i+S]]++;for(k=x,E=15;E>=1&&0===z[E];E--);if(k>E&&(k=E),0===E)return c[u++]=20971520,c[u++]=20971520,p.bits=1,0;for(A=1;A<E&&0===z[A];A++);for(k<A&&(k=A),M=1,P=1;P<=15;P++)if(M<<=1,(M-=z[P])<0)return-1;if(M>0&&(0===t||1!==E))return-1;for(F[1]=0,P=1;P<15;P++)F[P+1]=F[P]+z[P];for(S=0;S<h;S++)0!==e[i+S]&&(l[F[e[i+S]]++]=S);if(0===t?(O=I=l,v=19):1===t?(O=o,R-=257,I=r,L-=257,v=256):(O=s,I=a,v=-1),B=0,S=0,P=A,y=u,C=k,T=0,_=-1,g=(D=1<<k)-1,1===t&&D>852||2===t&&D>592)return 1;for(;;){m=P-T,l[S]<v?(b=0,w=l[S]):l[S]>v?(b=I[L+l[S]],w=O[R+l[S]]):(b=96,w=0),d=1<<P-T,A=f=1<<C;do{c[y+(B>>T)+(f-=d)]=m<<24|b<<16|w|0}while(0!==f);for(d=1<<P-1;B&d;)d>>=1;if(0!==d?(B&=d-1,B+=d):B=0,S++,0==--z[P]){if(P===E)break;P=e[i+l[S]]}if(P>k&&(B&g)!==_){for(0===T&&(T=k),y+=A,M=1<<(C=P-T);C+T<E&&!((M-=z[C+T])<=0);)C++,M<<=1;if(D+=1<<C,1===t&&D>852||2===t&&D>592)return 1;c[_=B&g]=k<<24|C<<16|y-u|0}}return 0!==B&&(c[y+B]=P-T<<24|64<<16|0),p.bits=k,0}},function(t,e,i){"use strict";t.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}}])},t.exports=n(i(0))}}]);
//# sourceMappingURL=vendors~main.js.map