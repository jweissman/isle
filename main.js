!function(e){function t(t){for(var s,r,l=t[0],a=t[1],c=t[2],h=0,d=[];h<l.length;h++)r=l[h],o[r]&&d.push(o[r][0]),o[r]=0;for(s in a)Object.prototype.hasOwnProperty.call(a,s)&&(e[s]=a[s]);for(p&&p(t);d.length;)d.shift()();return n.push.apply(n,c||[]),i()}function i(){for(var e,t=0;t<n.length;t++){for(var i=n[t],s=!0,l=1;l<i.length;l++){var a=i[l];0!==o[a]&&(s=!1)}s&&(n.splice(t--,1),e=r(r.s=i[0]))}return e}var s={},o={1:0},n=[];function r(t){if(s[t])return s[t].exports;var i=s[t]={i:t,l:!1,exports:{}};return e[t].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=e,r.c=s,r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},r.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="";var l=window.webpackJsonp=window.webpackJsonp||[],a=l.push.bind(l);l.push=t,l=l.slice();for(var c=0;c<l.length;c++)t(l[c]);var p=a;n.push([21,0]),i()}([,function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(0),o=i(15),n=i(14),r=i(13),l=i(12),a=i(11),c=i(10),p=i(9),h=i(8),d=i(7);let u={Sword:new s.Texture(n),Spritemap:new s.Texture(r),BasicSprites:new s.Texture(l),Alex:new s.Texture(a),Map:new o.default("map/solidity.json"),GreatPalm:new s.Texture(c),Palm:new s.Texture(p),FineMist:new s.Sound(h),Science:new s.Sound(d)};t.Resources=u,u.Map.imagePathAccessor=((e,t)=>{let i=e.replace(/^(?:\.\.\/)+/,"");return console.log("LOAD IMG",{path:e,actualPath:i}),i})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(0);t.clamp=((e,t)=>i=>{let s=Math.min(i,t);return Math.max(s,e)}),t.keyToDirection=(e=>{let t;return e!==s.Input.Keys.A&&e!==s.Input.Keys.Left||(t="left"),e!==s.Input.Keys.D&&e!==s.Input.Keys.Right||(t="right"),e!==s.Input.Keys.S&&e!==s.Input.Keys.Down||(t="down"),e!==s.Input.Keys.W&&e!==s.Input.Keys.Up||(t="up"),t}),t.oppositeWay=(e=>{let t;switch(e){case"left":t="right";break;case"right":t="left";break;case"up":t="down";break;case"down":t="up"}return t}),t.mode=(e=>{const t=new Map;let i,s=0;for(const o of e){let e=t.has(o)?t.get(o):0;++e>s&&(s=e,i=o),t.set(o,e)}return i}),t.addScalarToVec=((e,t,i)=>{switch(t){case"up":e.y-=i;break;case"down":e.y+=i;break;case"left":e.x-=i;break;case"right":e.x+=i}}),t.dirFromVec=(e=>{let{x:t,y:i}=e;return Math.abs(t)>Math.abs(i)?t>0?"right":"left":i>0?"down":"up"})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(0);t.Thing=class extends s.Actor{constructor(e,t,i=0,o=1,n){super(e,t,32*o,32*o,s.Color.Chartreuse),this.x=e,this.y=t,this.zOff=i,this.size=o,this.debugBoxes=n,this.computeZ=(()=>this.y+4+16*(this.size-1))}draw(e,t){super.draw(e,t),this.debugBoxes&&(this.collisionArea.debugDraw(e,s.Color.LightGray),e.fillRect(this.x,this.computeZ(),5,5))}constructCollisionArea(e){if(e)if(this.collisionType=s.CollisionType.Fixed,e.ellipse){let t=new s.Vector(e.x+e.width/2-16,e.y+e.height/2-16);this.body.useCircleCollision(e.height/2,t)}else if(e.polygon){let t=e.polygon.map(({x:t,y:i})=>new s.Vector(t+e.x,i+e.y));this.body.usePolygonCollision(t)}else console.warn("implement collider:",{collision:e});else this.size>1?(this.collisionType=s.CollisionType.Fixed,this.body.useBoxCollision(new s.Vector(0,16*this.size-14)),this.setHeight(26*this.size/4),this.setWidth(24*this.size)):this.collisionType=s.CollisionType.PreventCollision}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(0),o=i(1);class n{constructor(e,t,i,s){this.kind=e,this.actor=t,this.cell=i,this.world=s,this.initialize()}initialize(){}activate(){return console.warn("item is non-interactive",{kind:this.kind}),null}}t.Item=n;const r=new s.SpriteSheet(o.Resources.BasicSprites,8,8,32,32),l=o.Resources.GreatPalm.asSprite(),a=o.Resources.Palm.asSprite(),c={chestClosed:r.getSprite(2),chestOpen:r.getSprite(3),greatPalm:l,palm:a},p={Chest:class extends n{constructor(){super(...arguments),this.state={open:!1}}initialize(){this.actor.addDrawing("closed",c.chestClosed),this.actor.addDrawing("open",c.chestOpen)}activate(){return console.log("Chest activated!"),this.state.open?(this.actor.setDrawing("closed"),this.state={open:!1},"closed"):(this.actor.setDrawing("open"),this.state={open:!0},"opened")}},Palm:class extends n{initialize(){this.actor.addDrawing("palm",c.palm),this.actor.setDrawing("palm")}},GreatPalm:class extends n{constructor(){super(...arguments),this.state={hp:100}}initialize(){this.actor.addDrawing("palm",c.greatPalm),this.actor.setDrawing("palm")}activate(){if(this.state.hp>0){const e=`once a seed (${this.state.hp}%)`;return this.state.hp-=30,e}{let e=this.world.tileMap.getCellByIndex(this.cell.index+this.kind.size/2+(this.kind.size-1)*this.world.tileMap.cols);this.world.destroy(this);let t=this.world.spawn(this.world.itemKinds.WoodLogStack,e);return console.log("TIMBER",{base:e,newThing:t}),"timber"}}}};t.buildItem=((e,t,i,s)=>p[e.name]?new p[e.name](e,t,i,s):new n(e,t,i,s)),t.Isle=class{constructor(e,t=[]){this.name=e,this.items=t}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(4),o=i(3);t.World=class{constructor(e,t){this.debugBoxes=e,this.scene=t,this.island=new s.Isle("sorna"),this.itemKinds={}}interact(e){console.log("WOULD INTERACT WITH ITEM",{it:e});let{name:t,description:i}=e.kind;return e.activate()||i}entityAt(e,t){let i=this.tileMap.getCellByPoint(e,t);return i&&i.__isle_item?i.__isle_item:null}destroy(e){console.log("DESTROY",{it:e});let{kind:t,cell:i}=e,{size:s}=t;for(const e of Array(s).keys())for(const t of Array(s).keys())this.tileMap.getCellByIndex(i.index+e+t*this.tileMap.cols).__isle_item=null;return e.actor.kill(),!0}spawn(e,t){let{size:i}=e;i=i||1;let n=t.x+16*i,r=t.y+16*i,l=new o.Thing(n,r,i,i,this.debugBoxes);e.drawing&&l.addDrawing(e.drawing),l.constructCollisionArea(e.collision);let a=s.buildItem(e,l,t,this);this.island.items.push(a);for(const e of Array(i).keys())for(const s of Array(i).keys())this.tileMap.getCellByIndex(t.index+e+s*this.tileMap.cols).__isle_item=a;return this.scene.add(l),l.setZIndex(l.computeZ()),console.log("SPAWN",{kind:e,thing:l}),l}processTiledMap(e){let t=e,i={},s={},o={},n={};t.data.tilesets.forEach(e=>{e.terrains&&(e.terrains.forEach(e=>{e.properties&&(i[e.tile]=e.properties.reduce((e,t)=>{let{name:i,value:s}=t;return Object.assign(e,{[i]:s})},{}),i[e.tile].terrainName=e.name,console.log(`terrain ${e.name} (${e.tile}) has props: `,i[e.tile]))}),s=e.tiles.reduce((e,t)=>{let{terrain:s,id:o}=t,n={solid:s.every(e=>i[e]&&i[e].solid)};return Object.assign(e,{[o]:n})},{})),e.tiles&&e.tiles.some(e=>e.objectgroup)&&(o=e.tiles.reduce((e,t)=>{let{objectgroup:i,id:s}=t;return i&&i.objects&&i.objects.length?Object.assign(e,{[s]:i.objects[0]}):e},{}),console.log({spriteCollisionById:o}),console.log({ts:e}),n=e.tiles.reduce((e,t)=>{if(t.properties){let i=t.properties.reduce((e,t)=>{let{name:i,value:s}=t;return Object.assign(e,{[i]:s})},{});return Object.assign(e,{[t.id]:i})}return console.warn("no props for sprite with id",{curr:t}),e},{}))}),this.tileMap=t.getTileMap(),this.tileMap.data.forEach((e,t)=>{if(e.sprites[0]){let i=s[e.sprites[0].spriteId];if((e=Object.assign(e,i)).sprites[1]){let{spriteSheetKey:i,spriteId:s}=e.sprites[1];const r=n[s];this.itemKinds[r.name]=r;const l=o[s];let a=this.tileMap._spriteSheets[i],c=16,p=16,h=r.size||1;if(h>1){c=16*h,p=16*h;for(const e of Array(h).keys())for(const i of Array(h).keys()){let s=e,o=i,n=this.tileMap.getCellByIndex(t+s+o*this.tileMap.cols);n.sprites[1]&&n.removeSprite(n.sprites[1])}}r&&r.z,r.collision=l;let d=a.getSprite(s);r.drawing=d;let u=this.spawn(r,e);console.log("spawned",{thing:u})}}}),console.log({itemKinds:this.itemKinds})}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(0),o=i(1);t.Game=class extends s.Engine{constructor(e,t,i){super({width:e,height:t,displayMode:s.DisplayMode.FullScreen}),this.setup()}start(){let e=new s.Loader;for(let t in o.Resources)e.addResource(o.Resources[t]);return super.start(e).then(this.kick)}setup(){}kick(){}}},function(e,t,i){e.exports=i.p+"1452350757e2b9db94866b0f3a01e215.mp3"},function(e,t,i){e.exports=i.p+"fac8210e66067d101e48370329fc4c5a.mp3"},function(e,t,i){e.exports=i.p+"db6f4f593c47b1aa561da3453157f4bb.png"},function(e,t,i){e.exports=i.p+"e12b440e05a78caaa8a410ac5a9ae975.png"},function(e,t,i){e.exports=i.p+"11463f0311c27e615a3126fa867d1885.png"},function(e,t,i){e.exports=i.p+"0f2be413ac886c54bff59c2b3291754c.png"},function(e,t,i){e.exports=i.p+"b9b405c74e06d77b7a88f04d6d3ae5cd.png"},function(e,t,i){e.exports=i.p+"94754f62e0ae4d23d386e246f5e0cb6e.png"},,function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(0),o=i(2);t.Logo=class extends s.Label{constructor(e,t,i){super(i),this.strobeClamp=o.clamp(50,200),this.strobe=(()=>{this.intensity=this.intensity+Math.ceil(16*Math.random())-8,this.intensity=this.strobeClamp(this.intensity),this.opacity=this.intensity/255}),this.x=e,this.y=t,this.fontFamily="Arial",this.fontSize=256,this.color=new s.Color(255,255,255),this.intensity=150,this.strobe()}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(0);t.Enemy=class extends s.Actor{constructor({initialVelocity:e}){super(),this.setWidth(15),this.setHeight(15),this.x=200,this.y=200,this.color=s.Color.Red,this.collisionType=s.CollisionType.Passive,this.vel.setTo(e[0],e[1])}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(0),o=i(2);t.Player=class extends s.Actor{constructor(e,t,i,o){super(e,t,32,64),this.x=e,this.y=t,this.config=i,this.spriteSheet=o,this.wireWorld=(e=>{this._world=e}),this.computeZ=(()=>this.y+24),this.halt=(()=>{this.vel=new s.Vector(0,0)}),this.move=(e=>{this.facing=e;const t=32*this.speed;this.halt(),"left"===e&&(this.vel.x=-t),"right"===e&&(this.vel.x=t),"up"===e&&(this.vel.y=-t),"down"===e&&(this.vel.y=t)}),this.collisionArea.body.useCircleCollision(6,new s.Vector(0,22)),this.color=new s.Color(255,255,255),this.collisionType=s.CollisionType.Active,this.speed=i.playerSpeed,this.interacting=!1,this.alex={down:o.getSprite(0),up:o.getSprite(1),left:o.getSprite(3),right:o.getSprite(2)},this.move("down"),this.halt(),this.on("precollision",this.halt)}interact(){let e=this.interactionPos();this.interacting=!0;let t=this._world.entityAt(e.x,e.y)||this._world.entityAt(e.x,e.y+10)||this._world.entityAt(e.x,e.y-10)||this._world.entityAt(e.x-10,e.y)||this._world.entityAt(e.x+10,e.y);if(t)return this._world.interact(t)}interactionPos(){let e=this.getCenter().clone(),t=20;return"up"===this.facing&&(t-=2),"down"===this.facing&&(t-=4),e.y+=t,e.x-=2,o.addScalarToVec(e,this.facing,24),e}draw(e,t){if(super.draw(e,t),this.config.debugBoundingBoxes){if(this.collisionArea.debugDraw(e,s.Color.Chartreuse),this.interacting){let t=this.interactionPos();e.fillRect(t.x,t.y-10,4,4),e.fillRect(t.x,t.y,4,4),e.fillRect(t.x,t.y+10,4,4),e.fillRect(t.x-10,t.y,4,4),e.fillRect(t.x+10,t.y,4,4)}e.fillRect(this.x,this.computeZ(),3,3)}}update(e,t){this.currentDrawing=this.alex[this.facing],super.update(e,t),this.setZIndex(this.computeZ())}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(18);t.Player=s.Player;const o=i(17);t.Enemy=o.Enemy;const n=i(16);t.Logo=n.Logo},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(0);t.LevelOne=class extends s.Scene{onInitialize(e){}onActivate(){}onDeactivate(){}update(e,t){super.update(e,t)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(0),o=i(20),n=i(19),r=i(1),l=i(6),a=i(2),c=i(5),p={debugCells:!1,debugBoundingBoxes:!1,zoom:2,playerStart:{x:24,y:20},playerSpeed:7.5,bgMusic:!0},h=new l.Game(800,600,p),d=new o.LevelOne,u=new c.World(p.debugBoundingBoxes,d),y=(new s.SpriteSheet(r.Resources.BasicSprites,8,8,32,32),new s.SpriteSheet(r.Resources.Alex,4,1,32,64)),f=p.playerStart.x,g=p.playerStart.y,w=new n.Player(32*f,32*g,p,y),m=new s.Label("(welcome to isle)",500,500,"Arial"),b=new s.Label("(welcome to isle)",500,500,"Arial");d.add(m),d.add(b),h.input.pointers.primary.on("scroll",e=>{d.camera.zoom(4)}),h.input.keyboard.on("press",e=>{let{key:t}=e;if(t==s.Input.Keys.E){let e=w.interact();e&&(m.x=d.camera.x,m.y=d.camera.y,m.text=e,m.color=s.Color.White,m.fontSize=24)}else{let e=a.keyToDirection(t);e&&w.move(e)}}),h.input.keyboard.on("hold",e=>{let{key:t}=e,i=a.keyToDirection(t);i&&w.move(i)}),h.input.keyboard.on("release",e=>{let{key:t}=e;a.keyToDirection(t)&&(w.halt(),w.interacting=!1)}),d.add(w),d.camera.strategy.lockToActor(w),d.camera.zoom(p.zoom),h.add("wander",d),h.start().then(()=>{u.processTiledMap(r.Resources.Map);let e=u.tileMap;if(d.addTileMap(e),w.wireWorld(u),m.setZIndex(1e3),p.debugCells){let t=null;h.input.pointers.primary.on("move",i=>{let{pos:s}=i,o=e.getCellByPoint(s.x,s.y);o&&t!=o&&(console.debug("CELL",{pos:s,spriteId:o.sprites[0].spriteId},o),t=o)})}if(h.goToScene("wander"),p.bgMusic){let e=r.Resources.FineMist;setTimeout(()=>{console.log("about to play music",{theme:e,isLoaded:e.isLoaded()}),e.play(.2)},3e3)}})}]);
//# sourceMappingURL=main.js.map