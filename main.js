!function(e){function t(t){for(var s,r,l=t[0],a=t[1],c=t[2],u=0,p=[];u<l.length;u++)r=l[u],n[r]&&p.push(n[r][0]),n[r]=0;for(s in a)Object.prototype.hasOwnProperty.call(a,s)&&(e[s]=a[s]);for(d&&d(t);p.length;)p.shift()();return o.push.apply(o,c||[]),i()}function i(){for(var e,t=0;t<o.length;t++){for(var i=o[t],s=!0,l=1;l<i.length;l++){var a=i[l];0!==n[a]&&(s=!1)}s&&(o.splice(t--,1),e=r(r.s=i[0]))}return e}var s={},n={1:0},o=[];function r(t){if(s[t])return s[t].exports;var i=s[t]={i:t,l:!1,exports:{}};return e[t].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=e,r.c=s,r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},r.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="";var l=window.webpackJsonp=window.webpackJsonp||[],a=l.push.bind(l);l.push=t,l=l.slice();for(var c=0;c<l.length;c++)t(l[c]);var d=a;o.push([17,0]),i()}([,function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(0);t.clamp=((e,t)=>i=>{let s=Math.min(i,t);return Math.max(s,e)}),t.keyToDirection=(e=>{let t;return e!==s.Input.Keys.A&&e!==s.Input.Keys.Left||(t="left"),e!==s.Input.Keys.D&&e!==s.Input.Keys.Right||(t="right"),e!==s.Input.Keys.S&&e!==s.Input.Keys.Down||(t="down"),e!==s.Input.Keys.W&&e!==s.Input.Keys.Up||(t="up"),t}),t.oppositeWay=(e=>{let t;switch(e){case"left":t="right";break;case"right":t="left";break;case"up":t="down";break;case"down":t="up"}return t}),t.mode=(e=>{const t=new Map;let i,s=0;for(const n of e){let e=t.has(n)?t.get(n):0;++e>s&&(s=e,i=n),t.set(n,e)}return i}),t.addScalarToVec=((e,t,i)=>{switch(t){case"up":e.y-=i;break;case"down":e.y+=i;break;case"left":e.x-=i;break;case"right":e.x+=i}}),t.dirFromVec=(e=>{let{x:t,y:i}=e;return Math.abs(t)>Math.abs(i)?t>0?"right":"left":i>0?"down":"up"})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(0),n=i(11),o=i(10),r=i(9),l=i(8),a=i(7);let c={Sword:new s.Texture(o),Spritemap:new s.Texture(r),BasicSprites:new s.Texture(l),Alex:new s.Texture(a),Map:new n.default("map/solidity.json")};t.Resources=c,c.Map.imagePathAccessor=((e,t)=>{let i=e.replace(/^(?:\.\.\/)+/,"");return console.log("LOAD IMG",{path:e,actualPath:i}),i})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(14);t.Player=s.Player;const n=i(13);t.Enemy=n.Enemy;const o=i(12);t.Logo=o.Logo},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class s{constructor(e,t,i={}){this.kind=e,this.sprite=t,this.state=i}activate(){return console.warn("item is non-interactive",{kind:this.kind}),null}}t.Item=s;const n={Chest:class extends s{constructor(){super(...arguments),this.state={open:!1}}activate(){return console.log("Chest activated!",{sprite:this.sprite}),this.state.open?(this.sprite.spriteId-=1,this.state={open:!1},"closed"):(this.sprite.spriteId+=1,this.state={open:!0},"opened")}}};t.buildItem=((e,t)=>n[e.name]?new n[e.name](e,t):new s(e,t)),t.Isle=class{constructor(e,t=[]){this.name=e,this.items=t}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(0),n=i(4);t.World=class{constructor(e,t){this.mapResource=e,this.debugBoxes=t,this.island=new n.Isle("sorna"),this._processTiledMap()}interact(e){console.log("WOULD INTERACT WITH ITEM",{it:e});let{name:t,description:i}=e.kind;return e.activate()||i}entityAt(e,t){let i=this.tileMap.getCellByPoint(e,t);return i.sprites.length>1?i.__isle_item:null}_processTiledMap(){let e=this.mapResource,t={},i={},s={},o={};e.data.tilesets.forEach(e=>{e.terrains&&(e.terrains.forEach(e=>{e.properties&&(t[e.tile]=e.properties.reduce((e,t)=>{let{name:i,value:s}=t;return Object.assign(e,{[i]:s})},{}),t[e.tile].terrainName=e.name,console.log(`terrain ${e.name} (${e.tile}) has props: `,t[e.tile]))}),i=e.tiles.reduce((e,i)=>{let{terrain:s,id:n}=i,o={solid:s.every(e=>t[e]&&t[e].solid)};return Object.assign(e,{[n]:o})},{})),e.tiles&&e.tiles.some(e=>e.objectgroup)&&(s=e.tiles.reduce((e,t)=>{let{objectgroup:i,id:s}=t;return i&&i.objects&&i.objects.length?Object.assign(e,{[s]:i.objects[0]}):e},{}),console.log({spriteCollisionById:s}),o=e.tiles.reduce((e,t)=>{if(t.properties){let i=t.properties.reduce((e,t)=>{let{name:i,value:s}=t;return Object.assign(e,{[i]:s})},{});return Object.assign(e,{[t.id]:i})}return console.warn("no props for sprite with id",{curr:t}),e},{}),console.log({itemKindBySpriteId:o}))}),this.tileMap=e.getTileMap(),this.blockingActors=[],this.tileMap.data.forEach(e=>{if(e.sprites[0]){let t=i[e.sprites[0].spriteId];if((e=Object.assign(e,t)).sprites[1]){const t=e.sprites[1].spriteId,i=s[t];if(i){let s=this._buildColliderBlock(i,e);this.blockingActors.push(s);const r=o[t];if(r){let t=e.sprites[1],i=n.buildItem(r,t);this.island.items.push(i),e.__isle_item=i}}}}})}_buildColliderBlock(e,t){let i=new s.Actor(t.x,t.y,32,32);if(i.collisionType=s.CollisionType.Fixed,e.ellipse){let t=new s.Vector(e.x+e.width/2,e.y+e.height/2);i.body.useCircleCollision(e.height/2,t)}else if(e.polygon){let t=e.polygon.map(({x:t,y:i})=>new s.Vector(t+e.x,i+e.y));i.body.usePolygonCollision(t)}else console.warn("implement collider:",{collision:e});return this.debugBoxes&&(i.draw=(e=>{i.collisionArea.debugDraw(e,s.Color.LightGray)})),i}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(0),n=i(2);t.Game=class extends s.Engine{constructor(e,t){super({width:e,height:t,displayMode:s.DisplayMode.FullScreen})}start(){let e=new s.Loader;for(let t in n.Resources)e.addResource(n.Resources[t]);return super.start(e)}}},function(e,t,i){e.exports=i.p+"11463f0311c27e615a3126fa867d1885.png"},function(e,t,i){e.exports=i.p+"d1299304ed674b0e916f1c74a4a95eb2.png"},function(e,t,i){e.exports=i.p+"b9b405c74e06d77b7a88f04d6d3ae5cd.png"},function(e,t,i){e.exports=i.p+"94754f62e0ae4d23d386e246f5e0cb6e.png"},,function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(0),n=i(1);t.Logo=class extends s.Label{constructor(e,t,i){super(i),this.strobeClamp=n.clamp(50,200),this.strobe=(()=>{this.intensity=this.intensity+Math.ceil(16*Math.random())-8,this.intensity=this.strobeClamp(this.intensity),this.opacity=this.intensity/255}),this.x=e,this.y=t,this.fontFamily="Arial",this.fontSize=256,this.color=new s.Color(255,255,255),this.intensity=150,this.strobe()}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(0);t.Enemy=class extends s.Actor{constructor({initialVelocity:e}){super(),this.setWidth(15),this.setHeight(15),this.x=200,this.y=200,this.color=s.Color.Red,this.collisionType=s.CollisionType.Passive,this.vel.setTo(e[0],e[1])}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(0),n=i(1);t.Player=class extends s.Actor{constructor(e,t,i,n){super(),this.x=e,this.y=t,this.config=i,this.spriteSheet=n,this.wireWorld=(e=>{this._world=e}),this.halt=(()=>{this.vel=new s.Vector(0,0)}),this.move=(e=>{this.facing=e;const t=32*this.speed;this.halt(),"left"===e&&(this.vel.x=-t),"right"===e&&(this.vel.x=t),"up"===e&&(this.vel.y=-t),"down"===e&&(this.vel.y=t)}),this.setWidth(20),this.setHeight(14),this.collisionArea.pos.y=28,this.color=new s.Color(255,255,255),this.collisionType=s.CollisionType.Active,this.speed=i.playerSpeed,this.interacting=!1,this.alex={down:n.getSprite(0),up:n.getSprite(1),left:n.getSprite(3),right:n.getSprite(2)},this.move("down"),this.halt()}interact(){let e=this.interactionPos();this.interacting=!0;let t=this._world.entityAt(e.x,e.y)||this._world.entityAt(e.x,e.y+10)||this._world.entityAt(e.x,e.y-10)||this._world.entityAt(e.x-10,e.y)||this._world.entityAt(e.x+10,e.y);if(t)return this._world.interact(t)}interactionPos(){let e=this.getCenter().clone(),t="up"===this.facing?10:16;return e.y+=t,e.x-=2,n.addScalarToVec(e,this.facing,24),e}draw(e,t){if(super.draw(e,t),this.config.debugBoundingBoxes&&(this.collisionArea.debugDraw(e,s.Color.Chartreuse),this.interacting)){let t=this.interactionPos();e.fillRect(t.x,t.y-10,4,4),e.fillRect(t.x,t.y,4,4),e.fillRect(t.x,t.y+10,4,4),e.fillRect(t.x-10,t.y,4,4),e.fillRect(t.x+10,t.y,4,4)}}update(e,t){this.currentDrawing=this.alex[this.facing],super.update(e,t),this.setZIndex(this.y)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(0),n=i(3),o=e=>{let t=document.createElement("button");return t.textContent=e,t};t.MainMenu=class extends s.Scene{onInitialize(e){const t=new n.Logo(e.drawWidth/2,400,"Isle");this.add(t),e.addTimer(new s.Timer(t.strobe,20,!0));const i=new class extends s.UIActor{constructor(e,t,i,s,n=o){super(),this.hide=(()=>this.rootElement.style.display="none"),this.rootElement=document.createElement("div"),this.rootElement.style.position="absolute",document.body.appendChild(this.rootElement),this.buttonElement=n(e),this.rootElement.appendChild(this.buttonElement),this.buttonElement.addEventListener("click",s)}draw(e){let t=this._engine.canvasHeight/window.devicePixelRatio,i=this._engine.canvasWidth/window.devicePixelRatio,s=e.canvas.offsetLeft,n=e.canvas.offsetTop,o=this.buttonElement.clientWidth,r=this.buttonElement.clientHeight;this.rootElement.style.left=`${s+i/2-o/2}px`,this.rootElement.style.top=`${n+t/2-r/2+100}px`}}("start game",e.drawWidth/2,400,()=>{i.hide(),e.goToScene("wander")});this.add(i)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(0);t.LevelOne=class extends s.Scene{onInitialize(e){}onActivate(){}onDeactivate(){}update(e,t){super.update(e,t)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(0),n=i(16),o=i(15),r=i(3),l=i(2),a=i(6),c=i(1),d=i(5),u={debugCells:!1,debugBoundingBoxes:!1,zoom:3,playerStart:{x:30,y:30},playerSpeed:6};s.Physics.collisionPasses=8;const p=new a.Game(800,600),h=new o.MainMenu;p.add("main-menu",h);const y=new n.LevelOne,f=(new s.SpriteSheet(l.Resources.Spritemap,8,8,32,32),new s.SpriteSheet(l.Resources.BasicSprites,8,8,32,32)),g=new s.SpriteSheet(l.Resources.Alex,4,1,32,64),b=(f.getSprite(4),u.playerStart.x),m=u.playerStart.y,w=new r.Player(32*b,32*m,u,g),x=new s.Label("(welcome to isle)",500,500,"Arial"),v=new s.Label("(welcome to isle)",500,500,"Arial");y.add(x),y.add(v),p.input.keyboard.on("press",e=>{let{key:t}=e;if(t==s.Input.Keys.E){let e=w.interact();e&&(x.x=y.camera.x,x.y=y.camera.y,x.text=e,x.color=s.Color.White,x.fontSize=24)}else{let e=c.keyToDirection(t);e&&w.move(e)}}),p.input.keyboard.on("hold",e=>{let{key:t}=e,i=c.keyToDirection(t);i&&w.move(i)}),p.input.keyboard.on("release",e=>{let{key:t}=e;c.keyToDirection(t)&&(w.halt(),w.interacting=!1)}),y.add(w),y.camera.strategy.lockToActor(w),y.camera.zoom(u.zoom),p.add("wander",y),p.start().then(()=>{p.goToScene("wander");let e=new d.World(l.Resources.Map,u.debugBoundingBoxes),t=e.tileMap;if(y.addTileMap(t),w.wireWorld(e),e.blockingActors.forEach(e=>y.add(e)),u.debugCells){let e=null;p.input.pointers.primary.on("move",i=>{let{pos:s}=i,n=t.getCellByPoint(s.x,s.y);n&&e!=n&&(console.debug("CELL",{pos:s,spriteId:n.sprites[0].spriteId},n),e=n)})}})}]);
//# sourceMappingURL=main.js.map